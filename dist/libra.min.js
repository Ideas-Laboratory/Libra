var Da=Object.defineProperty;var ku=t=>Da(t,"__esModule",{value:!0});var d=(t,e)=>()=>(t&&(e=t(t=0)),e);var Ou=(t,e)=>{ku(t);for(var r in e)Da(t,r,{get:e[r],enumerable:!0})};var La,zr,Vt,Jn,Pa,J,Du,Fp,Lu,Pu,Fr=d(()=>{ge();zr={},Vt=[],Jn=[],Pa=()=>{let t;for(;t=Jn.pop();)try{t.remove()}catch(e){}Ya.stopTransient||Vt.filter(e=>e._transient).forEach(e=>e.redraw()),requestAnimationFrame(Pa)};requestAnimationFrame(Pa);J=class{constructor(e,r){this[La]=!0,this._baseName=e,this._userOptions=r,this._name=r.name??this._baseName,this._sharedVar=r.sharedVar??{},this._redraw=r.redraw??(()=>{}),this._layer=r.layer,this._transient=r.transient??!1;try{this.redraw()}catch(n){}}getSharedVar(e){return this._sharedVar[e]}setSharedVar(e,r){this._sharedVar[e]=r,this.redraw()}setSharedVars(e){Object.entries(e).forEach(([r,n])=>this._sharedVar[r]=n),this.redraw()}redraw(e=!1){if(!this._layer&&!this.getSharedVar("layer"))return;let r=this._layer||this.getSharedVar("layer");e=e||this._transient;let n=[],s=[],a=new Set([r]);e&&(n=r.getVisualElements(),r._getLayerFromQueue||(r._getLayerFromQueue=r.getLayerFromQueue,r.getLayerFromQueue=function(){let i=r._getLayerFromQueue(...arguments);return n=n.concat(i.getVisualElements()),a.add(i),i})),this._redraw({layer:r,transformer:this}),e&&(r.getLayerFromQueue=r._getLayerFromQueue,delete r._getLayerFromQueue,a.forEach(i=>{s=s.concat(Array.prototype.slice.call(i.getGraphic()?.childNodes??[]));let o=s.filter(c=>!n.includes(c));Jn=Jn.concat(o)}))}isInstanceOf(e){return this._baseName===e||this._name===e||(this._userOptions.className??[]).includes(e)}static register(e,r){zr[e]=r}static unregister(e){return delete zr[e],!0}static initialize(e,r){let n=Object.assign({constructor:J},zr[e]??{},r??{},{sharedVar:Object.assign({},(zr[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return Vt.push(s),s}static findTransformer(e){return Vt.filter(r=>r.isInstanceOf(e))}static findTransformerByLayer(e){return Vt.filter(r=>r._layer===e||r.getSharedVar("layer")===e)}};La=_e;Du=J.register,Fp=J.unregister,Lu=J.initialize,Pu=J.findTransformer});var Xa=d(()=>{});function Bt(t,e){let r=0,n=0;if(e===void 0)for(let s of t)s!=null&&(s=+s)>=s&&(++r,n+=s);else{let s=-1;for(let a of t)(a=e(a,++s,t))!=null&&(a=+a)>=a&&(++r,n+=a)}if(r)return n/r}var za=d(()=>{});function $t(t,e){let r=0;if(e===void 0)for(let n of t)(n=+n)&&(r+=n);else{let n=-1;for(let s of t)(s=+e(s,++n,t))&&(r+=s)}return r}var Fa=d(()=>{});var Na=d(()=>{za();Fa()});var qa=d(()=>{});function Ga(){for(var t=0,e=arguments.length,r={},n;t<e;++t){if(!(n=arguments[t]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Nr(r)}function Nr(t){this._=t}function Xu(t,e){return t.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function zu(t,e){for(var r=0,n=t.length,s;r<n;++r)if((s=t[r]).name===e)return s.value}function Ua(t,e,r){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=Yu,t=t.slice(0,n).concat(t.slice(n+1));break}return r!=null&&t.push({name:e,value:r}),t}var Yu,es,Ba=d(()=>{Yu={value:()=>{}};Nr.prototype=Ga.prototype={constructor:Nr,on:function(t,e){var r=this._,n=Xu(t+"",r),s,a=-1,i=n.length;if(arguments.length<2){for(;++a<i;)if((s=(t=n[a]).type)&&(s=zu(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<i;)if(s=(t=n[a]).type)r[s]=Ua(r[s],t.name,e);else if(e==null)for(s in r)r[s]=Ua(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new Nr(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,a;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,s=a.length;n<s;++n)a[n].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,a=n.length;s<a;++s)n[s].value.apply(e,r)}};es=Ga});var ts=d(()=>{Ba()});var qr,rs,ns=d(()=>{qr="http://www.w3.org/1999/xhtml",rs={svg:"http://www.w3.org/2000/svg",xhtml:qr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function Ne(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),rs.hasOwnProperty(e)?{space:rs[e],local:t}:t}var Gr=d(()=>{ns()});function Fu(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===qr&&e.documentElement.namespaceURI===qr?e.createElement(t):e.createElementNS(r,t)}}function Nu(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ur(t){var e=Ne(t);return(e.local?Nu:Fu)(e)}var ss=d(()=>{Gr();ns()});function qu(){}function at(t){return t==null?qu:function(){return this.querySelector(t)}}var Br=d(()=>{});function $a(t){typeof t!="function"&&(t=at(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=new Array(i),c,l,f=0;f<i;++f)(c=a[f])&&(l=t.call(c,c.__data__,f,a))&&("__data__"in c&&(l.__data__=c.__data__),o[f]=l);return new Q(n,this._parents)}var Qa=d(()=>{Te();Br()});function jt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}var $r=d(()=>{});function Gu(){return[]}function Qt(t){return t==null?Gu:function(){return this.querySelectorAll(t)}}var as=d(()=>{});function Uu(t){return function(){var e=t.apply(this,arguments);return e==null?[]:jt(e)}}function Ha(t){typeof t=="function"?t=Uu(t):t=Qt(t);for(var e=this._groups,r=e.length,n=[],s=[],a=0;a<r;++a)for(var i=e[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&(n.push(t.call(c,c.__data__,l,i)),s.push(c));return new Q(n,s)}var Wa=d(()=>{Te();$r();as()});function Ht(t){return function(){return this.matches(t)}}function Qr(t){return function(e){return e.matches(t)}}var Wt=d(()=>{});function $u(t){return function(){return Bu.call(this.children,t)}}function Qu(){return this.firstElementChild}function Za(t){return this.select(t==null?Qu:$u(typeof t=="function"?t:Qr(t)))}var Bu,Ka=d(()=>{Wt();Bu=Array.prototype.find});function Wu(){return this.children}function Zu(t){return function(){return Hu.call(this.children,t)}}function Ja(t){return this.selectAll(t==null?Wu:Zu(typeof t=="function"?t:Qr(t)))}var Hu,ei=d(()=>{Wt();Hu=Array.prototype.filter});function ti(t){typeof t!="function"&&(t=Ht(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new Q(n,this._parents)}var ri=d(()=>{Te();Wt()});function Hr(t){return new Array(t.length)}var is=d(()=>{});function ni(){return new Q(this._enter||this._groups.map(Hr),this._parents)}function Zt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}var os=d(()=>{is();Te();Zt.prototype={constructor:Zt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}}});function si(t){return function(){return t}}var ai=d(()=>{});function Ku(t,e,r,n,s,a){for(var i=0,o,c=e.length,l=a.length;i<l;++i)(o=e[i])?(o.__data__=a[i],n[i]=o):r[i]=new Zt(t,a[i]);for(;i<c;++i)(o=e[i])&&(s[i]=o)}function Ju(t,e,r,n,s,a,i){var o,c,l=new Map,f=e.length,h=a.length,p=new Array(f),m;for(o=0;o<f;++o)(c=e[o])&&(p[o]=m=i.call(c,c.__data__,o,e)+"",l.has(m)?s[o]=c:l.set(m,c));for(o=0;o<h;++o)m=i.call(t,a[o],o,a)+"",(c=l.get(m))?(n[o]=c,c.__data__=a[o],l.delete(m)):r[o]=new Zt(t,a[o]);for(o=0;o<f;++o)(c=e[o])&&l.get(p[o])===c&&(s[o]=c)}function eh(t){return t.__data__}function ii(t,e){if(!arguments.length)return Array.from(this,eh);var r=e?Ju:Ku,n=this._parents,s=this._groups;typeof t!="function"&&(t=si(t));for(var a=s.length,i=new Array(a),o=new Array(a),c=new Array(a),l=0;l<a;++l){var f=n[l],h=s[l],p=h.length,m=jt(t.call(f,f&&f.__data__,l,n)),x=m.length,_=o[l]=new Array(x),v=i[l]=new Array(x),V=c[l]=new Array(p);r(f,h,_,v,V,m,e);for(var E=0,j=0,W,M;E<x;++E)if(W=_[E]){for(E>=j&&(j=E+1);!(M=v[j])&&++j<x;);W._next=M||null}}return i=new Q(i,n),i._enter=o,i._exit=c,i}var oi=d(()=>{Te();os();$r();ai()});function ci(){return new Q(this._exit||this._groups.map(Hr),this._parents)}var li=d(()=>{is();Te()});function fi(t,e,r){var n=this.enter(),s=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(s=e(s)),r==null?a.remove():r(a),n&&s?n.merge(s).order():s}var ui=d(()=>{});function hi(t){if(!(t instanceof Q))throw new Error("invalid merge");for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],f=c.length,h=i[o]=new Array(f),p,m=0;m<f;++m)(p=c[m]||l[m])&&(h[m]=p);for(;o<n;++o)i[o]=e[o];return new Q(i,this._parents)}var di=d(()=>{Te()});function mi(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var n=t[e],s=n.length-1,a=n[s],i;--s>=0;)(i=n[s])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}var pi=d(()=>{});function gi(t){t||(t=th);function e(h,p){return h&&p?t(h.__data__,p.__data__):!h-!p}for(var r=this._groups,n=r.length,s=new Array(n),a=0;a<n;++a){for(var i=r[a],o=i.length,c=s[a]=new Array(o),l,f=0;f<o;++f)(l=i[f])&&(c[f]=l);c.sort(e)}return new Q(s,this._parents).order()}function th(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var yi=d(()=>{Te()});function xi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}var _i=d(()=>{});function vi(){return Array.from(this)}var wi=d(()=>{});function Si(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length;s<a;++s){var i=n[s];if(i)return i}return null}var bi=d(()=>{});function Vi(){let t=0;for(let e of this)++t;return t}var ji=d(()=>{});function Ti(){return!this.node()}var Ii=d(()=>{});function Ei(t){for(var e=this._groups,r=0,n=e.length;r<n;++r)for(var s=e[r],a=0,i=s.length,o;a<i;++a)(o=s[a])&&t.call(o,o.__data__,a,s);return this}var Ai=d(()=>{});function rh(t){return function(){this.removeAttribute(t)}}function nh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function sh(t,e){return function(){this.setAttribute(t,e)}}function ah(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ih(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function oh(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function Ci(t,e){var r=Ne(t);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((e==null?r.local?nh:rh:typeof e=="function"?r.local?oh:ih:r.local?ah:sh)(r,e))}var Mi=d(()=>{Gr()});function Wr(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}var cs=d(()=>{});function ch(t){return function(){this.style.removeProperty(t)}}function lh(t,e,r){return function(){this.style.setProperty(t,e,r)}}function fh(t,e,r){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,r)}}function Ri(t,e,r){return arguments.length>1?this.each((e==null?ch:typeof e=="function"?fh:lh)(t,e,r??"")):We(this.node(),t)}function We(t,e){return t.style.getPropertyValue(e)||Wr(t).getComputedStyle(t,null).getPropertyValue(e)}var ls=d(()=>{cs()});function uh(t){return function(){delete this[t]}}function hh(t,e){return function(){this[t]=e}}function dh(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function ki(t,e){return arguments.length>1?this.each((e==null?uh:typeof e=="function"?dh:hh)(t,e)):this.node()[t]}var Oi=d(()=>{});function Di(t){return t.trim().split(/^|\s+/)}function fs(t){return t.classList||new Li(t)}function Li(t){this._node=t,this._names=Di(t.getAttribute("class")||"")}function Pi(t,e){for(var r=fs(t),n=-1,s=e.length;++n<s;)r.add(e[n])}function Yi(t,e){for(var r=fs(t),n=-1,s=e.length;++n<s;)r.remove(e[n])}function mh(t){return function(){Pi(this,t)}}function ph(t){return function(){Yi(this,t)}}function gh(t,e){return function(){(e.apply(this,arguments)?Pi:Yi)(this,t)}}function Xi(t,e){var r=Di(t+"");if(arguments.length<2){for(var n=fs(this.node()),s=-1,a=r.length;++s<a;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?gh:e?mh:ph)(r,e))}var zi=d(()=>{Li.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}}});function yh(){this.textContent=""}function xh(t){return function(){this.textContent=t}}function _h(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Fi(t){return arguments.length?this.each(t==null?yh:(typeof t=="function"?_h:xh)(t)):this.node().textContent}var Ni=d(()=>{});function vh(){this.innerHTML=""}function wh(t){return function(){this.innerHTML=t}}function Sh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function qi(t){return arguments.length?this.each(t==null?vh:(typeof t=="function"?Sh:wh)(t)):this.node().innerHTML}var Gi=d(()=>{});function bh(){this.nextSibling&&this.parentNode.appendChild(this)}function Ui(){return this.each(bh)}var Bi=d(()=>{});function Vh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function $i(){return this.each(Vh)}var Qi=d(()=>{});function Hi(t){var e=typeof t=="function"?t:Ur(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}var Wi=d(()=>{ss()});function jh(){return null}function Zi(t,e){var r=typeof t=="function"?t:Ur(t),n=e==null?jh:typeof e=="function"?e:at(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var Ki=d(()=>{ss();Br()});function Th(){var t=this.parentNode;t&&t.removeChild(this)}function Ji(){return this.each(Th)}var eo=d(()=>{});function Ih(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Eh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function to(t){return this.select(t?Eh:Ih)}var ro=d(()=>{});function no(t){return arguments.length?this.property("__data__",t):this.node().__data__}var so=d(()=>{});function Ah(t){return function(e){t.call(this,e,this.__data__)}}function Ch(t){return t.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");return n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),{type:e,name:r}})}function Mh(t){return function(){var e=this.__on;if(!!e){for(var r=0,n=-1,s=e.length,a;r<s;++r)a=e[r],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++n]=a;++n?e.length=n:delete this.__on}}}function Rh(t,e,r){return function(){var n=this.__on,s,a=Ah(e);if(n){for(var i=0,o=n.length;i<o;++i)if((s=n[i]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=r),s.value=e;return}}this.addEventListener(t.type,a,r),s={type:t.type,name:t.name,value:e,listener:a,options:r},n?n.push(s):this.__on=[s]}}function ao(t,e,r){var n=Ch(t+""),s,a=n.length,i;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,l=o.length,f;c<l;++c)for(s=0,f=o[c];s<a;++s)if((i=n[s]).type===f.type&&i.name===f.name)return f.value}return}for(o=e?Rh:Mh,s=0;s<a;++s)this.each(o(n[s],e,r));return this}var io=d(()=>{});function oo(t,e,r){var n=Wr(t),s=n.CustomEvent;typeof s=="function"?s=new s(e,r):(s=n.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function kh(t,e){return function(){return oo(this,t,e)}}function Oh(t,e){return function(){return oo(this,t,e.apply(this,arguments))}}function co(t,e){return this.each((typeof e=="function"?Oh:kh)(t,e))}var lo=d(()=>{cs()});function*fo(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length,i;s<a;++s)(i=n[s])&&(yield i)}var uo=d(()=>{});function Q(t,e){this._groups=t,this._parents=e}function ho(){return new Q([[document.documentElement]],Kt)}function Dh(){return this}var Kt,qe,Te=d(()=>{Qa();Wa();Ka();ei();ri();oi();os();li();ui();di();pi();yi();_i();wi();bi();ji();Ii();Ai();Mi();ls();Oi();zi();Ni();Gi();Bi();Qi();Wi();Ki();eo();ro();so();io();lo();uo();Kt=[null];Q.prototype=ho.prototype={constructor:Q,select:$a,selectAll:Ha,selectChild:Za,selectChildren:Ja,filter:ti,data:ii,enter:ni,exit:ci,join:fi,merge:hi,selection:Dh,order:mi,sort:gi,call:xi,nodes:vi,node:Si,size:Vi,empty:Ti,each:Ei,attr:Ci,style:Ri,property:ki,classed:Xi,text:Fi,html:qi,raise:Ui,lower:$i,append:Hi,insert:Zi,remove:Ji,clone:to,datum:no,on:ao,dispatch:co,[Symbol.iterator]:fo};qe=ho});function Y(t){return typeof t=="string"?new Q([[document.querySelector(t)]],[document.documentElement]):new Q([[t]],Kt)}var mo=d(()=>{Te()});function po(t){let e;for(;e=t.sourceEvent;)t=e;return t}var go=d(()=>{});function Ze(t,e){if(t=po(t),e===void 0&&(e=t.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}var yo=d(()=>{go()});function Ie(t){return typeof t=="string"?new Q([document.querySelectorAll(t)],[document.documentElement]):new Q([t==null?[]:jt(t)],Kt)}var xo=d(()=>{$r();Te()});var Ce=d(()=>{Wt();Gr();yo();mo();xo();Te();Br();as();ls()});var _o=d(()=>{});function Zr(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function us(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}var vo=d(()=>{});function Jt(){}function So(){return this.rgb().formatHex()}function qh(){return Eo(this).formatHsl()}function bo(){return this.rgb().formatRgb()}function Ke(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Lh.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?Vo(e):r===3?new be(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Jr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Jr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ph.exec(t))?new be(e[1],e[2],e[3],1):(e=Yh.exec(t))?new be(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Xh.exec(t))?Jr(e[1],e[2],e[3],e[4]):(e=zh.exec(t))?Jr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Fh.exec(t))?Io(e[1],e[2]/100,e[3]/100,1):(e=Nh.exec(t))?Io(e[1],e[2]/100,e[3]/100,e[4]):wo.hasOwnProperty(t)?Vo(wo[t]):t==="transparent"?new be(NaN,NaN,NaN,0):null}function Vo(t){return new be(t>>16&255,t>>8&255,t&255,1)}function Jr(t,e,r,n){return n<=0&&(t=e=r=NaN),new be(t,e,r,n)}function Gh(t){return t instanceof Jt||(t=Ke(t)),t?(t=t.rgb(),new be(t.r,t.g,t.b,t.opacity)):new be}function It(t,e,r,n){return arguments.length===1?Gh(t):new be(t,e,r,n??1)}function be(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}function jo(){return"#"+hs(this.r)+hs(this.g)+hs(this.b)}function To(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function hs(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Io(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Le(t,e,r,n)}function Eo(t){if(t instanceof Le)return new Le(t.h,t.s,t.l,t.opacity);if(t instanceof Jt||(t=Ke(t)),!t)return new Le;if(t instanceof Le)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(e,r,n),a=Math.max(e,r,n),i=NaN,o=a-s,c=(a+s)/2;return o?(e===a?i=(r-n)/o+(r<n)*6:r===a?i=(n-e)/o+2:i=(e-r)/o+4,o/=c<.5?a+s:2-a-s,i*=60):o=c>0&&c<1?0:i,new Le(i,o,c,t.opacity)}function Ao(t,e,r,n){return arguments.length===1?Eo(t):new Le(t,e,r,n??1)}function Le(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}function ds(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var er,Kr,Tt,tr,De,Lh,Ph,Yh,Xh,zh,Fh,Nh,wo,Co=d(()=>{vo();er=.7,Kr=1/er,Tt="\\s*([+-]?\\d+)\\s*",tr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",De="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Lh=/^#([0-9a-f]{3,8})$/,Ph=new RegExp("^rgb\\("+[Tt,Tt,Tt]+"\\)$"),Yh=new RegExp("^rgb\\("+[De,De,De]+"\\)$"),Xh=new RegExp("^rgba\\("+[Tt,Tt,Tt,tr]+"\\)$"),zh=new RegExp("^rgba\\("+[De,De,De,tr]+"\\)$"),Fh=new RegExp("^hsl\\("+[tr,De,De]+"\\)$"),Nh=new RegExp("^hsla\\("+[tr,De,De,tr]+"\\)$"),wo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Zr(Jt,Ke,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:So,formatHex:So,formatHsl:qh,formatRgb:bo,toString:bo});Zr(be,It,us(Jt,{brighter:function(t){return t=t==null?Kr:Math.pow(Kr,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?er:Math.pow(er,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jo,formatHex:jo,formatRgb:To,toString:To}));Zr(Le,Ao,us(Jt,{brighter:function(t){return t=t==null?Kr:Math.pow(Kr,t),new Le(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?er:Math.pow(er,t),new Le(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,s=2*r-n;return new be(ds(t>=240?t-240:t+120,s,n),ds(t,s,n),ds(t<120?t+240:t-120,s,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}))});var en=d(()=>{Co()});function ms(t,e,r,n,s){var a=t*t,i=a*t;return((1-3*t+3*a-i)*e+(4-6*a+3*i)*r+(1+3*t+3*a-3*i)*n+i*s)/6}function Mo(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),s=t[n],a=t[n+1],i=n>0?t[n-1]:2*s-a,o=n<e-1?t[n+2]:2*a-s;return ms((r-n/e)*e,i,s,a,o)}}var ps=d(()=>{});function Ro(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),s=t[(n+e-1)%e],a=t[n%e],i=t[(n+1)%e],o=t[(n+2)%e];return ms((r-n/e)*e,s,a,i,o)}}var ko=d(()=>{ps()});var gs,Oo=d(()=>{gs=t=>()=>t});function Uh(t,e){return function(r){return t+r*e}}function Bh(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Do(t){return(t=+t)==1?tn:function(e,r){return r-e?Bh(e,r,t):gs(isNaN(e)?r:e)}}function tn(t,e){var r=e-t;return r?Uh(t,r):gs(isNaN(t)?e:t)}var Lo=d(()=>{Oo()});function Po(t){return function(e){var r=e.length,n=new Array(r),s=new Array(r),a=new Array(r),i,o;for(i=0;i<r;++i)o=It(e[i]),n[i]=o.r||0,s[i]=o.g||0,a[i]=o.b||0;return n=t(n),s=t(s),a=t(a),o.opacity=1,function(c){return o.r=n(c),o.g=s(c),o.b=a(c),o+""}}}var rn,$h,Qh,Yo=d(()=>{en();ps();ko();Lo();rn=function t(e){var r=Do(e);function n(s,a){var i=r((s=It(s)).r,(a=It(a)).r),o=r(s.g,a.g),c=r(s.b,a.b),l=tn(s.opacity,a.opacity);return function(f){return s.r=i(f),s.g=o(f),s.b=c(f),s.opacity=l(f),s+""}}return n.gamma=t,n}(1);$h=Po(Mo),Qh=Po(Ro)});function Ee(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}var nn=d(()=>{});function Hh(t){return function(){return t}}function Wh(t){return function(e){return t(e)+""}}function _s(t,e){var r=ys.lastIndex=xs.lastIndex=0,n,s,a,i=-1,o=[],c=[];for(t=t+"",e=e+"";(n=ys.exec(t))&&(s=xs.exec(e));)(a=s.index)>r&&(a=e.slice(r,a),o[i]?o[i]+=a:o[++i]=a),(n=n[0])===(s=s[0])?o[i]?o[i]+=s:o[++i]=s:(o[++i]=null,c.push({i,x:Ee(n,s)})),r=xs.lastIndex;return r<e.length&&(a=e.slice(r),o[i]?o[i]+=a:o[++i]=a),o.length<2?c[0]?Wh(c[0].x):Hh(e):(e=c.length,function(l){for(var f=0,h;f<e;++f)o[(h=c[f]).i]=h.x(l);return o.join("")})}var ys,xs,Xo=d(()=>{nn();ys=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xs=new RegExp(ys.source,"g")});function vs(t,e,r,n,s,a){var i,o,c;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(c=t*r+e*n)&&(r-=t*c,n-=e*c),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,c/=o),t*n<e*r&&(t=-t,e=-e,c=-c,i=-i),{translateX:s,translateY:a,rotate:Math.atan2(e,t)*zo,skewX:Math.atan(c)*zo,scaleX:i,scaleY:o}}var zo,sn,Fo=d(()=>{zo=180/Math.PI,sn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function No(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?sn:vs(e.a,e.b,e.c,e.d,e.e,e.f)}function qo(t){return t==null?sn:(an||(an=document.createElementNS("http://www.w3.org/2000/svg","g")),an.setAttribute("transform",t),(t=an.transform.baseVal.consolidate())?(t=t.matrix,vs(t.a,t.b,t.c,t.d,t.e,t.f)):sn)}var an,Go=d(()=>{Fo()});function Uo(t,e,r,n){function s(l){return l.length?l.pop()+" ":""}function a(l,f,h,p,m,x){if(l!==h||f!==p){var _=m.push("translate(",null,e,null,r);x.push({i:_-4,x:Ee(l,h)},{i:_-2,x:Ee(f,p)})}else(h||p)&&m.push("translate("+h+e+p+r)}function i(l,f,h,p){l!==f?(l-f>180?f+=360:f-l>180&&(l+=360),p.push({i:h.push(s(h)+"rotate(",null,n)-2,x:Ee(l,f)})):f&&h.push(s(h)+"rotate("+f+n)}function o(l,f,h,p){l!==f?p.push({i:h.push(s(h)+"skewX(",null,n)-2,x:Ee(l,f)}):f&&h.push(s(h)+"skewX("+f+n)}function c(l,f,h,p,m,x){if(l!==h||f!==p){var _=m.push(s(m)+"scale(",null,",",null,")");x.push({i:_-4,x:Ee(l,h)},{i:_-2,x:Ee(f,p)})}else(h!==1||p!==1)&&m.push(s(m)+"scale("+h+","+p+")")}return function(l,f){var h=[],p=[];return l=t(l),f=t(f),a(l.translateX,l.translateY,f.translateX,f.translateY,h,p),i(l.rotate,f.rotate,h,p),o(l.skewX,f.skewX,h,p),c(l.scaleX,l.scaleY,f.scaleX,f.scaleY,h,p),l=f=null,function(m){for(var x=-1,_=p.length,v;++x<_;)h[(v=p[x]).i]=v.x(m);return h.join("")}}}var ws,Ss,Bo=d(()=>{nn();Go();ws=Uo(No,"px, ","px)","deg)"),Ss=Uo(qo,", ",")",")")});var rr=d(()=>{nn();Xo();Bo();Yo()});function or(){return it||(Qo(Zh),it=ir.now()+ln)}function Zh(){it=0}function cr(){this._call=this._time=this._next=null}function fn(t,e,r){var n=new cr;return n.restart(t,e,r),n}function Ho(){or(),++Et;for(var t=on,e;t;)(e=it-t._time)>=0&&t._call.call(null,e),t=t._next;--Et}function Wo(){it=(cn=ir.now())+ln,Et=nr=0;try{Ho()}finally{Et=0,Jh(),it=0}}function Kh(){var t=ir.now(),e=t-cn;e>$o&&(ln-=e,cn=t)}function Jh(){for(var t,e=on,r,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:on=r);ar=t,bs(n)}function bs(t){if(!Et){nr&&(nr=clearTimeout(nr));var e=t-it;e>24?(t<1/0&&(nr=setTimeout(Wo,t-ir.now()-ln)),sr&&(sr=clearInterval(sr))):(sr||(cn=ir.now(),sr=setInterval(Kh,$o)),Et=1,Qo(Wo))}}var Et,nr,sr,$o,on,ar,cn,it,ln,ir,Qo,Vs=d(()=>{Et=0,nr=0,sr=0,$o=1e3,cn=0,it=0,ln=0,ir=typeof performance=="object"&&performance.now?performance:Date,Qo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};cr.prototype=fn.prototype={constructor:cr,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?or():+r)+(e==null?0:+e),!this._next&&ar!==this&&(ar?ar._next=this:on=this,ar=this),this._call=t,this._time=r,bs()},stop:function(){this._call&&(this._call=null,this._time=1/0,bs())}}});function un(t,e,r){var n=new cr;return e=e==null?0:+e,n.restart(s=>{n.stop(),t(s+e)},e,r),n}var Zo=d(()=>{Vs()});var hn=d(()=>{Vs();Zo()});function Je(t,e,r,n,s,a){var i=t.__transition;if(!i)t.__transition={};else if(r in i)return;rd(t,r,{name:e,index:n,group:s,on:ed,tween:td,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ko})}function fr(t,e){var r=ae(t,e);if(r.state>Ko)throw new Error("too late; already scheduled");return r}function oe(t,e){var r=ae(t,e);if(r.state>mn)throw new Error("too late; already running");return r}function ae(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function rd(t,e,r){var n=t.__transition,s;n[e]=r,r.timer=fn(a,0,r.time);function a(l){r.state=js,r.timer.restart(i,r.delay,r.time),r.delay<=l&&i(l-r.delay)}function i(l){var f,h,p,m;if(r.state!==js)return c();for(f in n)if(m=n[f],m.name===r.name){if(m.state===mn)return un(i);m.state===Jo?(m.state=lr,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete n[f]):+f<e&&(m.state=lr,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete n[f])}if(un(function(){r.state===mn&&(r.state=Jo,r.timer.restart(o,r.delay,r.time),o(l))}),r.state=dn,r.on.call("start",t,t.__data__,r.index,r.group),r.state===dn){for(r.state=mn,s=new Array(p=r.tween.length),f=0,h=-1;f<p;++f)(m=r.tween[f].value.call(t,t.__data__,r.index,r.group))&&(s[++h]=m);s.length=h+1}}function o(l){for(var f=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(c),r.state=pn,1),h=-1,p=s.length;++h<p;)s[h].call(t,f);r.state===pn&&(r.on.call("end",t,t.__data__,r.index,r.group),c())}function c(){r.state=lr,r.timer.stop(),delete n[e];for(var l in n)return;delete t.__transition}}var ed,td,Ko,js,dn,mn,Jo,pn,lr,ye=d(()=>{ts();hn();ed=es("start","end","cancel","interrupt"),td=[],Ko=0,js=1,dn=2,mn=3,Jo=4,pn=5,lr=6});function ur(t,e){var r=t.__transition,n,s,a=!0,i;if(!!r){e=e==null?null:e+"";for(i in r){if((n=r[i]).name!==e){a=!1;continue}s=n.state>dn&&n.state<pn,n.state=lr,n.timer.stop(),n.on.call(s?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete r[i]}a&&delete t.__transition}}var Ts=d(()=>{ye()});function ec(t){return this.each(function(){ur(this,t)})}var tc=d(()=>{Ts()});function nd(t,e){var r,n;return function(){var s=oe(this,t),a=s.tween;if(a!==r){n=r=a;for(var i=0,o=n.length;i<o;++i)if(n[i].name===e){n=n.slice(),n.splice(i,1);break}}s.tween=n}}function sd(t,e,r){var n,s;if(typeof r!="function")throw new Error;return function(){var a=oe(this,t),i=a.tween;if(i!==n){s=(n=i).slice();for(var o={name:e,value:r},c=0,l=s.length;c<l;++c)if(s[c].name===e){s[c]=o;break}c===l&&s.push(o)}a.tween=s}}function rc(t,e){var r=this._id;if(t+="",arguments.length<2){for(var n=ae(this.node(),r).tween,s=0,a=n.length,i;s<a;++s)if((i=n[s]).name===t)return i.value;return null}return this.each((e==null?nd:sd)(r,t,e))}function At(t,e,r){var n=t._id;return t.each(function(){var s=oe(this,n);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return ae(s,n).value[e]}}var hr=d(()=>{ye()});function gn(t,e){var r;return(typeof e=="number"?Ee:e instanceof Ke?rn:(r=Ke(e))?(e=r,rn):_s)(t,e)}var Is=d(()=>{en();rr()});function ad(t){return function(){this.removeAttribute(t)}}function id(t){return function(){this.removeAttributeNS(t.space,t.local)}}function od(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttribute(t);return i===s?null:i===n?a:a=e(n=i,r)}}function cd(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttributeNS(t.space,t.local);return i===s?null:i===n?a:a=e(n=i,r)}}function ld(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttribute(t):(i=this.getAttribute(t),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function fd(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function nc(t,e){var r=Ne(t),n=r==="transform"?Ss:gn;return this.attrTween(t,typeof e=="function"?(r.local?fd:ld)(r,n,At(this,"attr."+t,e)):e==null?(r.local?id:ad)(r):(r.local?cd:od)(r,n,e))}var sc=d(()=>{rr();Ce();hr();Is()});function ud(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function hd(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function dd(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&hd(t,a)),r}return s._value=e,s}function md(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&ud(t,a)),r}return s._value=e,s}function ac(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var n=Ne(t);return this.tween(r,(n.local?dd:md)(n,e))}var ic=d(()=>{Ce()});function pd(t,e){return function(){fr(this,t).delay=+e.apply(this,arguments)}}function gd(t,e){return e=+e,function(){fr(this,t).delay=e}}function oc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?pd:gd)(e,t)):ae(this.node(),e).delay}var cc=d(()=>{ye()});function yd(t,e){return function(){oe(this,t).duration=+e.apply(this,arguments)}}function xd(t,e){return e=+e,function(){oe(this,t).duration=e}}function lc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?yd:xd)(e,t)):ae(this.node(),e).duration}var fc=d(()=>{ye()});function _d(t,e){if(typeof e!="function")throw new Error;return function(){oe(this,t).ease=e}}function uc(t){var e=this._id;return arguments.length?this.each(_d(e,t)):ae(this.node(),e).ease}var hc=d(()=>{ye()});function vd(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;oe(this,t).ease=r}}function dc(t){if(typeof t!="function")throw new Error;return this.each(vd(this._id,t))}var mc=d(()=>{ye()});function pc(t){typeof t!="function"&&(t=Ht(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new ue(n,this._parents,this._name,this._id)}var gc=d(()=>{Ce();Ge()});function yc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],f=c.length,h=i[o]=new Array(f),p,m=0;m<f;++m)(p=c[m]||l[m])&&(h[m]=p);for(;o<n;++o)i[o]=e[o];return new ue(i,this._parents,this._name,this._id)}var xc=d(()=>{Ge()});function wd(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function Sd(t,e,r){var n,s,a=wd(e)?fr:oe;return function(){var i=a(this,t),o=i.on;o!==n&&(s=(n=o).copy()).on(e,r),i.on=s}}function _c(t,e){var r=this._id;return arguments.length<2?ae(this.node(),r).on.on(t):this.each(Sd(r,t,e))}var vc=d(()=>{ye()});function bd(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function wc(){return this.on("end.remove",bd(this._id))}var Sc=d(()=>{});function bc(t){var e=this._name,r=this._id;typeof t!="function"&&(t=at(t));for(var n=this._groups,s=n.length,a=new Array(s),i=0;i<s;++i)for(var o=n[i],c=o.length,l=a[i]=new Array(c),f,h,p=0;p<c;++p)(f=o[p])&&(h=t.call(f,f.__data__,p,o))&&("__data__"in f&&(h.__data__=f.__data__),l[p]=h,Je(l[p],e,r,p,l,ae(f,r)));return new ue(a,this._parents,e,r)}var Vc=d(()=>{Ce();Ge();ye()});function jc(t){var e=this._name,r=this._id;typeof t!="function"&&(t=Qt(t));for(var n=this._groups,s=n.length,a=[],i=[],o=0;o<s;++o)for(var c=n[o],l=c.length,f,h=0;h<l;++h)if(f=c[h]){for(var p=t.call(f,f.__data__,h,c),m,x=ae(f,r),_=0,v=p.length;_<v;++_)(m=p[_])&&Je(m,e,r,_,p,x);a.push(p),i.push(f)}return new ue(a,i,e,r)}var Tc=d(()=>{Ce();Ge();ye()});function Ic(){return new Vd(this._groups,this._parents)}var Vd,Ec=d(()=>{Ce();Vd=qe.prototype.constructor});function jd(t,e){var r,n,s;return function(){var a=We(this,t),i=(this.style.removeProperty(t),We(this,t));return a===i?null:a===r&&i===n?s:s=e(r=a,n=i)}}function Ac(t){return function(){this.style.removeProperty(t)}}function Td(t,e,r){var n,s=r+"",a;return function(){var i=We(this,t);return i===s?null:i===n?a:a=e(n=i,r)}}function Id(t,e,r){var n,s,a;return function(){var i=We(this,t),o=r(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(t),We(this,t))),i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o))}}function Ed(t,e){var r,n,s,a="style."+e,i="end."+a,o;return function(){var c=oe(this,t),l=c.on,f=c.value[a]==null?o||(o=Ac(e)):void 0;(l!==r||s!==f)&&(n=(r=l).copy()).on(i,s=f),c.on=n}}function Cc(t,e,r){var n=(t+="")==="transform"?ws:gn;return e==null?this.styleTween(t,jd(t,n)).on("end.style."+t,Ac(t)):typeof e=="function"?this.styleTween(t,Id(t,n,At(this,"style."+t,e))).each(Ed(this._id,t)):this.styleTween(t,Td(t,n,e),r).on("end.style."+t,null)}var Mc=d(()=>{rr();Ce();ye();hr();Is()});function Ad(t,e,r){return function(n){this.style.setProperty(t,e.call(this,n),r)}}function Cd(t,e,r){var n,s;function a(){var i=e.apply(this,arguments);return i!==s&&(n=(s=i)&&Ad(t,i,r)),n}return a._value=e,a}function Rc(t,e,r){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Cd(t,e,r??""))}var kc=d(()=>{});function Md(t){return function(){this.textContent=t}}function Rd(t){return function(){var e=t(this);this.textContent=e??""}}function Oc(t){return this.tween("text",typeof t=="function"?Rd(At(this,"text",t)):Md(t==null?"":t+""))}var Dc=d(()=>{hr()});function kd(t){return function(e){this.textContent=t.call(this,e)}}function Od(t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&kd(s)),e}return n._value=t,n}function Lc(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Od(t))}var Pc=d(()=>{});function Yc(){for(var t=this._name,e=this._id,r=yn(),n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)if(c=i[l]){var f=ae(c,e);Je(c,t,r,l,i,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new ue(n,this._parents,t,r)}var Xc=d(()=>{Ge();ye()});function zc(){var t,e,r=this,n=r._id,s=r.size();return new Promise(function(a,i){var o={value:i},c={value:function(){--s==0&&a()}};r.each(function(){var l=oe(this,n),f=l.on;f!==t&&(e=(t=f).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(c)),l.on=e}),s===0&&a()})}var Fc=d(()=>{ye()});function ue(t,e,r,n){this._groups=t,this._parents=e,this._name=r,this._id=n}function Es(t){return qe().transition(t)}function yn(){return++Dd}var Dd,ot,Ge=d(()=>{Ce();sc();ic();cc();fc();hc();mc();gc();xc();vc();Sc();Vc();Tc();Ec();Mc();kc();Dc();Pc();Xc();hr();Fc();Dd=0;ot=qe.prototype;ue.prototype=Es.prototype={constructor:ue,select:bc,selectAll:jc,filter:pc,merge:yc,selection:Ic,transition:Yc,call:ot.call,nodes:ot.nodes,node:ot.node,size:ot.size,empty:ot.empty,each:ot.each,on:_c,attr:nc,attrTween:ac,style:Cc,styleTween:Rc,text:Oc,textTween:Lc,remove:wc,tween:rc,delay:oc,duration:lc,ease:uc,easeVarying:dc,end:zc,[Symbol.iterator]:ot[Symbol.iterator]}});function xn(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Nc=d(()=>{});var As=d(()=>{Nc()});function Pd(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function qc(t){var e,r;t instanceof ue?(e=t._id,t=t._name):(e=yn(),(r=Ld).time=or(),t=t==null?null:t+"");for(var n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&Je(c,t,e,l,i,r||Pd(c,e));return new ue(n,this._parents,t,e)}var Ld,Gc=d(()=>{Ge();ye();As();hn();Ld={time:null,delay:0,duration:250,ease:xn}});var Uc=d(()=>{Ce();tc();Gc();qe.prototype.interrupt=ec;qe.prototype.transition=qc});var Bc=d(()=>{Ge();ye()});var _n=d(()=>{Uc();Ge();Bc();Ts()});var $c=d(()=>{});var Qc=d(()=>{});var Hc=d(()=>{});function Wc(t){return[+t[0],+t[1]]}function Yd(t){return[Wc(t[0]),Wc(t[1])]}function Cs(t){return{type:t}}var ov,cv,lv,Zc=d(()=>{_n();$c();Qc();Hc();ov={name:"x",handles:["w","e"].map(Cs),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},cv={name:"y",handles:["n","s"].map(Cs),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},lv={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Cs),input:function(t){return t==null?null:Yd(t)},output:function(t){return t}}});var Kc=d(()=>{Zc()});var Jc=d(()=>{});var el=d(()=>{});var tl=d(()=>{});var rl=d(()=>{});var nl=d(()=>{});var sl=d(()=>{});var al=d(()=>{});var il=d(()=>{});function ol(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ct(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}var dr=d(()=>{});function cl(t){return t=ct(Math.abs(t)),t?t[1]:NaN}var ll=d(()=>{dr()});function fl(t,e){return function(r,n){for(var s=r.length,a=[],i=0,o=t[0],c=0;s>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),a.push(r.substring(s-=o,s+o)),!((c+=o+1)>n));)o=t[i=(i+1)%t.length];return a.reverse().join(e)}}var ul=d(()=>{});function hl(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var dl=d(()=>{});function mr(t){if(!(e=Xd.exec(t)))throw new Error("invalid format: "+t);var e;return new Ms({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Ms(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}var Xd,ml=d(()=>{Xd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;mr.prototype=Ms.prototype;Ms.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function pl(t){e:for(var e=t.length,r=1,n=-1,s;r<e;++r)switch(t[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var gl=d(()=>{});function yl(t,e){var r=ct(t,e);if(!r)return t+"";var n=r[0],s=r[1],a=s-(Rs=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return a===i?n:a>i?n+new Array(a-i+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+ct(t,Math.max(0,e+a-1))[0]}var Rs,ks=d(()=>{dr()});function Os(t,e){var r=ct(t,e);if(!r)return t+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}var xl=d(()=>{dr()});var Ds,_l=d(()=>{dr();ks();xl();Ds={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:ol,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Os(t*100,e),r:Os,s:yl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)}});function Ls(t){return t}var vl=d(()=>{});function bl(t){var e=t.grouping===void 0||t.thousands===void 0?Ls:fl(wl.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Ls:hl(wl.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"\u2212":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(h){h=mr(h);var p=h.fill,m=h.align,x=h.sign,_=h.symbol,v=h.zero,V=h.width,E=h.comma,j=h.precision,W=h.trim,M=h.type;M==="n"?(E=!0,M="g"):Ds[M]||(j===void 0&&(j=12),W=!0,M="g"),(v||p==="0"&&m==="=")&&(v=!0,p="0",m="=");var P=_==="$"?r:_==="#"&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",ce=_==="$"?n:/[%p]/.test(M)?i:"",de=Ds[M],Ae=/[defgprs%]/.test(M);j=j===void 0?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,j)):Math.max(0,Math.min(20,j));function je(R){var le=P,re=ce,we,St,$e;if(M==="c")re=de(R)+re,R="";else{R=+R;var Qe=R<0||1/R<0;if(R=isNaN(R)?c:de(Math.abs(R),j),W&&(R=pl(R)),Qe&&+R==0&&x!=="+"&&(Qe=!1),le=(Qe?x==="("?x:o:x==="-"||x==="("?"":x)+le,re=(M==="s"?Sl[8+Rs/3]:"")+re+(Qe&&x==="("?")":""),Ae){for(we=-1,St=R.length;++we<St;)if($e=R.charCodeAt(we),48>$e||$e>57){re=($e===46?s+R.slice(we+1):R.slice(we))+re,R=R.slice(0,we);break}}}E&&!v&&(R=e(R,1/0));var He=le.length+R.length+re.length,Se=He<V?new Array(V-He+1).join(p):"";switch(E&&v&&(R=e(Se+R,Se.length?V-re.length:1/0),Se=""),m){case"<":R=le+R+re+Se;break;case"=":R=le+Se+R+re;break;case"^":R=Se.slice(0,He=Se.length>>1)+le+R+re+Se.slice(He);break;default:R=Se+le+R+re;break}return a(R)}return je.toString=function(){return h+""},je}function f(h,p){var m=l((h=mr(h),h.type="f",h)),x=Math.max(-8,Math.min(8,Math.floor(cl(p)/3)))*3,_=Math.pow(10,-x),v=Sl[8+x/3];return function(V){return m(_*V)+v}}return{format:l,formatPrefix:f}}var wl,Sl,Vl=d(()=>{ll();ul();dl();ml();gl();_l();ks();vl();wl=Array.prototype.map,Sl=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function Ps(t){return vn=bl(t),jl=vn.format,Tl=vn.formatPrefix,vn}var vn,jl,Tl,Il=d(()=>{Vl();Ps({thousands:",",grouping:[3],currency:["$",""]})});var El=d(()=>{Il()});var Al=d(()=>{});var Cl=d(()=>{});var Ml=d(()=>{});var Rl=d(()=>{});function he(t,e,r,n){function s(a){return t(a=arguments.length===0?new Date:new Date(+a)),a}return s.floor=function(a){return t(a=new Date(+a)),a},s.ceil=function(a){return t(a=new Date(a-1)),e(a,1),t(a),a},s.round=function(a){var i=s(a),o=s.ceil(a);return a-i<o-a?i:o},s.offset=function(a,i){return e(a=new Date(+a),i==null?1:Math.floor(i)),a},s.range=function(a,i,o){var c=[],l;if(a=s.ceil(a),o=o==null?1:Math.floor(o),!(a<i)||!(o>0))return c;do c.push(l=new Date(+a)),e(a,o),t(a);while(l<a&&a<i);return c},s.filter=function(a){return he(function(i){if(i>=i)for(;t(i),!a(i);)i.setTime(i-1)},function(i,o){if(i>=i)if(o<0)for(;++o<=0;)for(;e(i,-1),!a(i););else for(;--o>=0;)for(;e(i,1),!a(i););})},r&&(s.count=function(a,i){return Ys.setTime(+a),Xs.setTime(+i),t(Ys),t(Xs),Math.floor(r(Ys,Xs))},s.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?s.filter(n?function(i){return n(i)%a==0}:function(i){return s.count(0,i)%a==0}):s}),s}var Ys,Xs,lt=d(()=>{Ys=new Date,Xs=new Date});var zd,pr,Fd,ft,wn,aw,iw,gr=d(()=>{zd=1e3,pr=zd*60,Fd=pr*60,ft=Fd*24,wn=ft*7,aw=ft*30,iw=ft*365});var kl,Sn,Nd,Ol=d(()=>{lt();gr();kl=he(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*pr)/ft,t=>t.getDate()-1),Sn=kl,Nd=kl.range});function ut(t){return he(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r*7)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*pr)/wn})}var yr,Ct,Dl,Ll,et,Pl,Yl,Xl,qd,Gd,Ud,Bd,$d,Qd,zl=d(()=>{lt();gr();yr=ut(0),Ct=ut(1),Dl=ut(2),Ll=ut(3),et=ut(4),Pl=ut(5),Yl=ut(6),Xl=yr.range,qd=Ct.range,Gd=Dl.range,Ud=Ll.range,Bd=et.range,$d=Pl.range,Qd=Yl.range});var zs,ht,Hd,Fl=d(()=>{lt();zs=he(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});zs.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r*t)})};ht=zs,Hd=zs.range});var Nl,bn,Wd,ql=d(()=>{lt();gr();Nl=he(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/ft},function(t){return t.getUTCDate()-1}),bn=Nl,Wd=Nl.range});function dt(t){return he(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r*7)},function(e,r){return(r-e)/wn})}var xr,Mt,Gl,Ul,tt,Bl,$l,Ql,Zd,Kd,Jd,em,tm,rm,Hl=d(()=>{lt();gr();xr=dt(0),Mt=dt(1),Gl=dt(2),Ul=dt(3),tt=dt(4),Bl=dt(5),$l=dt(6),Ql=xr.range,Zd=Mt.range,Kd=Gl.range,Jd=Ul.range,em=tt.range,tm=Bl.range,rm=$l.range});var Fs,mt,nm,Wl=d(()=>{lt();Fs=he(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});Fs.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})};mt=Fs,nm=Fs.range});var Ns=d(()=>{Ol();zl();Fl();ql();Hl();Wl()});function qs(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Gs(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function _r(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function Us(t){var e=t.dateTime,r=t.date,n=t.time,s=t.periods,a=t.days,i=t.shortDays,o=t.months,c=t.shortMonths,l=vr(s),f=wr(s),h=vr(a),p=wr(a),m=vr(i),x=wr(i),_=vr(o),v=wr(o),V=vr(c),E=wr(c),j={a:Qe,A:He,b:Se,B:Yn,c:null,d:rf,e:rf,f:Tm,g:Lm,G:Ym,H:bm,I:Vm,j:jm,L:nf,m:Im,M:Em,p:Xn,q:zn,Q:ff,s:uf,S:Am,u:Cm,U:Mm,V:Rm,w:km,W:Om,x:null,X:null,y:Dm,Y:Pm,Z:Xm,"%":lf},W={a:Fn,A:Nn,b:qn,B:Gn,c:null,d:af,e:af,f:qm,g:Jm,G:tp,H:zm,I:Fm,j:Nm,L:of,m:Gm,M:Um,p:Un,q:Bn,Q:ff,s:uf,S:Bm,u:$m,U:Qm,V:Hm,w:Wm,W:Zm,x:null,X:null,y:Km,Y:ep,Z:rp,"%":lf},M={a:je,A:R,b:le,B:re,c:we,d:ef,e:ef,f:_m,g:Jl,G:Kl,H:tf,I:tf,j:pm,L:xm,m:mm,M:gm,p:Ae,q:dm,Q:wm,s:Sm,S:ym,u:cm,U:lm,V:fm,w:om,W:um,x:St,X:$e,y:Jl,Y:Kl,Z:hm,"%":vm};j.x=P(r,j),j.X=P(n,j),j.c=P(e,j),W.x=P(r,W),W.X=P(n,W),W.c=P(e,W);function P(T,k){return function(L){var S=[],fe=-1,F=0,me=T.length,pe,y,N;for(L instanceof Date||(L=new Date(+L));++fe<me;)T.charCodeAt(fe)===37&&(S.push(T.slice(F,fe)),(y=Zl[pe=T.charAt(++fe)])!=null?pe=T.charAt(++fe):y=pe==="e"?" ":"0",(N=k[pe])&&(pe=N(L,y)),S.push(pe),F=fe+1);return S.push(T.slice(F,fe)),S.join("")}}function ce(T,k){return function(L){var S=_r(1900,void 0,1),fe=de(S,T,L+="",0),F,me;if(fe!=L.length)return null;if("Q"in S)return new Date(S.Q);if("s"in S)return new Date(S.s*1e3+("L"in S?S.L:0));if(k&&!("Z"in S)&&(S.Z=0),"p"in S&&(S.H=S.H%12+S.p*12),S.m===void 0&&(S.m="q"in S?S.q:0),"V"in S){if(S.V<1||S.V>53)return null;"w"in S||(S.w=1),"Z"in S?(F=Gs(_r(S.y,0,1)),me=F.getUTCDay(),F=me>4||me===0?Mt.ceil(F):Mt(F),F=bn.offset(F,(S.V-1)*7),S.y=F.getUTCFullYear(),S.m=F.getUTCMonth(),S.d=F.getUTCDate()+(S.w+6)%7):(F=qs(_r(S.y,0,1)),me=F.getDay(),F=me>4||me===0?Ct.ceil(F):Ct(F),F=Sn.offset(F,(S.V-1)*7),S.y=F.getFullYear(),S.m=F.getMonth(),S.d=F.getDate()+(S.w+6)%7)}else("W"in S||"U"in S)&&("w"in S||(S.w="u"in S?S.u%7:"W"in S?1:0),me="Z"in S?Gs(_r(S.y,0,1)).getUTCDay():qs(_r(S.y,0,1)).getDay(),S.m=0,S.d="W"in S?(S.w+6)%7+S.W*7-(me+5)%7:S.w+S.U*7-(me+6)%7);return"Z"in S?(S.H+=S.Z/100|0,S.M+=S.Z%100,Gs(S)):qs(S)}}function de(T,k,L,S){for(var fe=0,F=k.length,me=L.length,pe,y;fe<F;){if(S>=me)return-1;if(pe=k.charCodeAt(fe++),pe===37){if(pe=k.charAt(fe++),y=M[pe in Zl?k.charAt(fe++):pe],!y||(S=y(T,L,S))<0)return-1}else if(pe!=L.charCodeAt(S++))return-1}return S}function Ae(T,k,L){var S=l.exec(k.slice(L));return S?(T.p=f.get(S[0].toLowerCase()),L+S[0].length):-1}function je(T,k,L){var S=m.exec(k.slice(L));return S?(T.w=x.get(S[0].toLowerCase()),L+S[0].length):-1}function R(T,k,L){var S=h.exec(k.slice(L));return S?(T.w=p.get(S[0].toLowerCase()),L+S[0].length):-1}function le(T,k,L){var S=V.exec(k.slice(L));return S?(T.m=E.get(S[0].toLowerCase()),L+S[0].length):-1}function re(T,k,L){var S=_.exec(k.slice(L));return S?(T.m=v.get(S[0].toLowerCase()),L+S[0].length):-1}function we(T,k,L){return de(T,e,k,L)}function St(T,k,L){return de(T,r,k,L)}function $e(T,k,L){return de(T,n,k,L)}function Qe(T){return i[T.getDay()]}function He(T){return a[T.getDay()]}function Se(T){return c[T.getMonth()]}function Yn(T){return o[T.getMonth()]}function Xn(T){return s[+(T.getHours()>=12)]}function zn(T){return 1+~~(T.getMonth()/3)}function Fn(T){return i[T.getUTCDay()]}function Nn(T){return a[T.getUTCDay()]}function qn(T){return c[T.getUTCMonth()]}function Gn(T){return o[T.getUTCMonth()]}function Un(T){return s[+(T.getUTCHours()>=12)]}function Bn(T){return 1+~~(T.getUTCMonth()/3)}return{format:function(T){var k=P(T+="",j);return k.toString=function(){return T},k},parse:function(T){var k=ce(T+="",!1);return k.toString=function(){return T},k},utcFormat:function(T){var k=P(T+="",W);return k.toString=function(){return T},k},utcParse:function(T){var k=ce(T+="",!0);return k.toString=function(){return T},k}}}function X(t,e,r){var n=t<0?"-":"",s=(n?-t:t)+"",a=s.length;return n+(a<r?new Array(r-a+1).join(e)+s:s)}function im(t){return t.replace(am,"\\$&")}function vr(t){return new RegExp("^(?:"+t.map(im).join("|")+")","i")}function wr(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function om(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function cm(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function lm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function fm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function um(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function Kl(t,e,r){var n=ie.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function Jl(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function hm(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function dm(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function mm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function ef(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function pm(t,e,r){var n=ie.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function tf(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function gm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function ym(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function xm(t,e,r){var n=ie.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function _m(t,e,r){var n=ie.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function vm(t,e,r){var n=sm.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function wm(t,e,r){var n=ie.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function Sm(t,e,r){var n=ie.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function rf(t,e){return X(t.getDate(),e,2)}function bm(t,e){return X(t.getHours(),e,2)}function Vm(t,e){return X(t.getHours()%12||12,e,2)}function jm(t,e){return X(1+Sn.count(ht(t),t),e,3)}function nf(t,e){return X(t.getMilliseconds(),e,3)}function Tm(t,e){return nf(t,e)+"000"}function Im(t,e){return X(t.getMonth()+1,e,2)}function Em(t,e){return X(t.getMinutes(),e,2)}function Am(t,e){return X(t.getSeconds(),e,2)}function Cm(t){var e=t.getDay();return e===0?7:e}function Mm(t,e){return X(yr.count(ht(t)-1,t),e,2)}function sf(t){var e=t.getDay();return e>=4||e===0?et(t):et.ceil(t)}function Rm(t,e){return t=sf(t),X(et.count(ht(t),t)+(ht(t).getDay()===4),e,2)}function km(t){return t.getDay()}function Om(t,e){return X(Ct.count(ht(t)-1,t),e,2)}function Dm(t,e){return X(t.getFullYear()%100,e,2)}function Lm(t,e){return t=sf(t),X(t.getFullYear()%100,e,2)}function Pm(t,e){return X(t.getFullYear()%1e4,e,4)}function Ym(t,e){var r=t.getDay();return t=r>=4||r===0?et(t):et.ceil(t),X(t.getFullYear()%1e4,e,4)}function Xm(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+X(e/60|0,"0",2)+X(e%60,"0",2)}function af(t,e){return X(t.getUTCDate(),e,2)}function zm(t,e){return X(t.getUTCHours(),e,2)}function Fm(t,e){return X(t.getUTCHours()%12||12,e,2)}function Nm(t,e){return X(1+bn.count(mt(t),t),e,3)}function of(t,e){return X(t.getUTCMilliseconds(),e,3)}function qm(t,e){return of(t,e)+"000"}function Gm(t,e){return X(t.getUTCMonth()+1,e,2)}function Um(t,e){return X(t.getUTCMinutes(),e,2)}function Bm(t,e){return X(t.getUTCSeconds(),e,2)}function $m(t){var e=t.getUTCDay();return e===0?7:e}function Qm(t,e){return X(xr.count(mt(t)-1,t),e,2)}function cf(t){var e=t.getUTCDay();return e>=4||e===0?tt(t):tt.ceil(t)}function Hm(t,e){return t=cf(t),X(tt.count(mt(t),t)+(mt(t).getUTCDay()===4),e,2)}function Wm(t){return t.getUTCDay()}function Zm(t,e){return X(Mt.count(mt(t)-1,t),e,2)}function Km(t,e){return X(t.getUTCFullYear()%100,e,2)}function Jm(t,e){return t=cf(t),X(t.getUTCFullYear()%100,e,2)}function ep(t,e){return X(t.getUTCFullYear()%1e4,e,4)}function tp(t,e){var r=t.getUTCDay();return t=r>=4||r===0?tt(t):tt.ceil(t),X(t.getUTCFullYear()%1e4,e,4)}function rp(){return"+0000"}function lf(){return"%"}function ff(t){return+t}function uf(t){return Math.floor(+t/1e3)}var Zl,ie,sm,am,hf=d(()=>{Ns();Zl={"-":"",_:" ","0":"0"},ie=/^\s*\d+/,sm=/^%/,am=/[\\^$*+?|[\]().{}]/g});function Bs(t){return Rt=Us(t),df=Rt.format,mf=Rt.parse,pf=Rt.utcFormat,gf=Rt.utcParse,Rt}var Rt,df,mf,pf,gf,yf=d(()=>{hf();Bs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});var xf=d(()=>{yf()});var _f=d(()=>{});var vf=d(()=>{});var wf=d(()=>{});var Sf=d(()=>{});var bf=d(()=>{});function pt(t,e,r){this.k=t,this.x=e,this.y=r}function Qs(t){for(;!t.__zoom;)if(!(t=t.parentNode))return $s;return t.__zoom}var $s,Hs=d(()=>{pt.prototype={constructor:pt,scale:function(t){return t===1?this:new pt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new pt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};$s=new pt(1,0,0);Qs.prototype=pt.prototype});var Vf=d(()=>{});var jf=d(()=>{_n();Sf();bf();Hs();Vf()});var Tf=d(()=>{jf();Hs()});var gt=d(()=>{Xa();Na();qa();Kc();el();en();tl();rl();ts();_o();nl();As();sl();il();El();Al();Cl();rr();Jc();Ml();al();Rl();_f();vf();Ce();wf();Ns();xf();hn();_n();Tf()});var If=d(()=>{Fr();gt();J.register("SliderTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{Y(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove();let r=e.getSharedVar("x1")??0,n=e.getSharedVar("x2")??0,s=e.getSharedVar("height")??0,a=e.getSharedVar("fill")??"#000000",i=e.getSharedVar("opacity")??.3;Y(t.getGraphic()).append("rect").attr("x1",r).attr("x2",n).attr("width",n-r).attr("height",s).attr("fill",a).attr("opacity",i)}});J.register("HighlightSelection",{constructor:J,redraw({layer:t,transformer:e}){let r=Y(t.getGraphic()).selectAll(e.getSharedVar("selector")||"*");Object.entries(e.getSharedVar("highlightAttrValues")).forEach(([s,a])=>{r.attr(s,a)})}});J.register("TransientRectangleTransformer",{constructor:J,className:["draw-shape","transient-shape","rectangle-shape"],redraw:({layer:t,transformer:e})=>{Y(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove(),Y(t.getGraphic()).append("rect").attr("x",e.getSharedVar("x")).attr("y",e.getSharedVar("y")).attr("width",e.getSharedVar("width")).attr("height",e.getSharedVar("height")).attr("fill",e.getSharedVar("fillColor")).attr("opacity",e.getSharedVar("opacity"))}});J.register("SelectionTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{e.getSharedVar("result")?.forEach(a=>{t.getGraphic().appendChild(a)});let r=e.getSharedVar("highlightColor"),n=Object.entries(e.getSharedVar("highlightAttrValues")||{});if(r||n.length){let a=Ie(e.getSharedVar("result"));r&&a.attr("fill",r).attr("stroke",r),n.forEach(([i,o])=>{a.attr(i,o)})}let s=e.getSharedVar("tooltip");if(s){if(typeof s=="object"&&(s.fields&&s.fields.length||s.text)){let a=[],i=!1;if(typeof s=="object"&&s.prefix&&a.push(s.prefix),s.text&&(a.push(s.text),i=!0),s.fields&&s.fields.length){let c=e.getSharedVar("result");if(c&&c.length<=1)s.fields.forEach(l=>{let f=t.getDatum(c?.[0])?.[l]??"";f&&(a.push(f),i=!0)});else if(c&&c.length>1){let l=[];c.forEach(f=>{let h=t.getDatum(f);if(h){let p=[f];s.fields.forEach(m=>{let x=h?.[m]??"";x&&p.push(x)}),l.push(p)}}),i=!0,a.push(l)}}typeof s=="object"&&s.suffix&&a.push(s.suffix);let o=a.join(" ");if(o&&i)if(s.position=="absolute"){let c=a.findIndex(l=>l instanceof Array);if(c!==-1){let l=a.slice(0,c),f=a[c],h=a.slice(c+1);f.forEach(p=>{let m=p[0],x=[...l,...p.slice(1),...h].join(" "),_=(m.getBBox()?.x??0)+(s.offset?.x??0),v=(m.getBBox()?.y??0)+(s.offset?.y??0);Y(t.getGraphic()).append("text").attr("x",_).attr("y",v).text(x)})}}else Y(t.getGraphic()).append("text").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).text(o)}if(typeof s=="object"&&s.image){if(typeof s.image=="string")Y(t.getGraphic()).append("image").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).attr("width",s.width??100).attr("height",s.height??100).attr("style","object-fit: contain").attr("xlink:href",s.image);else if(s.image instanceof Function)try{let a=s.image(t.getDatum(e.getSharedVar("result")[0]));a&&Y(t.getGraphic()).append("image").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).attr("width",s.width??100).attr("height",s.height??100).attr("style","object-fit: contain").attr("xlink:href",a)}catch(a){}}}}});J.register("LineTransformer",{constructor:J,transient:!0,sharedVar:{orientation:["horizontal","vertical"],style:{}},redraw({layer:t,transformer:e}){let r=t.getLayerFromQueue("mainLayer"),n=e.getSharedVar("orientation"),s=e.getSharedVar("style"),a=e.getSharedVar("x"),i=e.getSharedVar("y"),o=e.getSharedVar("tooltip"),c=e.getSharedVar("scaleX"),l=e.getSharedVar("scaleY"),f=e.getSharedVar("result");if(f&&f.slope!==void 0&&f.intercept!==void 0){n.splice(0,n.length);let _=Y(t.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",f.intercept).attr("y2",f.slope*r.getGraphic().getBoundingClientRect().width+f.intercept).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([v,V])=>{_.attr(v,V)})}let h=[],p=0,m=0;o&&(typeof o=="object"&&o.prefix&&h.push(o.prefix),c&&c.invert&&typeof a=="number"&&h.push(c.invert(a-(t._offset?.x??0))),l&&l.invert&&typeof i=="number"&&h.push(l.invert(i-(t._offset?.y??0))),typeof o=="object"&&o.suffix&&h.push(o.suffix),typeof o=="object"&&o.offset&&(typeof o.offset.x=="number"&&(p=o.offset.x),typeof o.offset.y=="number"&&(m=o.offset.y),typeof o.offset.x=="function"&&typeof a=="number"&&(p=o.offset.x(a-(t._offset?.x??0))),typeof o.offset.y=="function"&&typeof i=="number"&&(m=o.offset.y(i-(t._offset?.y??0)))));let x=h.join(" ");if(n.includes("horizontal")&&typeof i=="number"){let _=Y(t.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",i-(t._offset?.y??0)).attr("y2",i-(t._offset?.y??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([v,V])=>{_.attr(v,V)})}if(n.includes("vertical")&&typeof a=="number"){let _=Y(t.getGraphic()).append("line").attr("y1",0).attr("y2",r.getGraphic().getBoundingClientRect().height).attr("x1",a-(t._offset?.x??0)).attr("x2",a-(t._offset?.x??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([v,V])=>{_.attr(v,V)})}x&&Y(t.getGraphic()).append("text").attr("x",a-(t._offset?.x??0)).attr("y",i-(t._offset?.y??0)).text(x)}});J.register("TextTransformer",{constructor:J,transient:!0,sharedVar:{style:{},content:"",field:null},redraw({layer:t,transformer:e}){let r=e.getSharedVar("style"),n=e.getSharedVar("offsetx")||e.getSharedVar("x"),s=e.getSharedVar("offsety")||e.getSharedVar("y"),a=e.getSharedVar("content"),i=e.getSharedVar("field"),o=e.getSharedVar("result"),c=e.getSharedVar("position"),l=a,f=n,h=s;if(i){let p=t.getDatum(o);if(p)if(l=p?.[i]??"",c instanceof Function){let{x:m,y:x}=c(p);f=m??f,h=x??h}else f=c?.x??f,h=c?.y??h;else l=""}Y(t.getGraphic()).append("text").attr("x",f).attr("y",h).text(l).call(p=>{r&&Object.entries(r).forEach(([m,x])=>{p.style(m,x)})})}})});var Sr,Ws,H,Ue=d(()=>{Fr();Fr();If();Sr=J,Ws=Vt,H=J});var Ef,kt,Vn,D,np,BS,sp,Af,Ot=d(()=>{ge();Ue();kt={},Vn=[],D=class{constructor(e,r){this.joining=!1,this._linkCache={},this._transformers=[],this._joinTransformers=[],this._services=[],this._joinServices=[],this._initializing=null,this._nextTick=0,this._computing=null,this._result=null,this._oldResult=null,this._command=[],this[Ef]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._sharedVar={},this._transformers=r.transformers??[],this._joinTransformers=r.joinTransformers??[],this._services=r.services??[],this._joinServices=r.joinServices??[],this._command=r.command??[],this._layerInstances=[],this._resultAlias=r.resultAlias??"result",this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._initializing=Promise.all(Object.entries(r.sharedVar||{}).map(n=>this.setSharedVar(n[0],n[1]))).then(async()=>{r.postUpdate&&r.postUpdate.call(this,this),this._postUpdate=r.postUpdate??null,this._initializing=null}),r.layer&&this._layerInstances.push(r.layer),Vn.push(this),r.postInitialize&&r.postInitialize.call(this,this)}getSharedVar(e,r){if(!(r&&r.layer&&this._layerInstances.length&&!this._layerInstances.includes(r.layer)))return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}async setSharedVar(e,r,n){if(this.preUpdate(),this._sharedVar[e]=r,this._userOptions.evaluate&&this._resultAlias){if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._oldResult=this._result;try{this._computing=this._userOptions.evaluate({self:this,...this._userOptions.params??{},...this._sharedVar}),this._result=await this._computing,this._computing=null,this._services.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})}),this._transformers.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})})}catch(s){console.error(s),this._result=void 0,this._computing=null}this._nextTick=0,this.postUpdate()})}else this.postUpdate()}async setSharedVars(e,r){Object.entries(e).forEach(([n,s])=>{this._sharedVar[n]=s}),Object.keys(e).length>0&&await this.setSharedVar(...Object.entries(e)[0],r)}async join(){if(this._resultAlias){this.joining=!0,Object.keys(this._sharedVar).length&&this.setSharedVar(...Object.entries(this._sharedVar)[0]);let e=await this._internalResults;this._joinServices&&this._joinServices.length?await Promise.all(this._joinServices.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))):this._initializing||await Promise.all(this._services.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))),this._joinTransformers&&this._joinTransformers.length?await Promise.all(this._joinTransformers.map(r=>r.setSharedVar(this._resultAlias,e))):this._initializing||await Promise.all(this._transformers.map(r=>r.setSharedVar(this._resultAlias,e))),this.joining=!1}}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}preAttach(e){this._preAttach&&this._preAttach.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}invokeCommand(){this._command.forEach(e=>{e.execute({self:this,...this._userOptions.params??{},...this._sharedVar})}),this._services.forEach(e=>{e.invokeCommand()})}isInstanceOf(e){return this._baseName===e||this._name===e}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>{e.setSharedVars({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}),this._transformers.splice(this._transformers.indexOf(e),1)},this)}get services(){return ve(this._services.slice(0),D,e=>this._services.push(e),e=>{Object.entries({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}).forEach(([r,n])=>{e.setSharedVar(r,n)}),this._services.splice(this._services.indexOf(e),1)},this)}get _internalResults(){return this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing?e(await this._computing):e(this._result)})}):this._computing||this._result}get results(){return this._initializing?this._initializing.then(()=>this._internalResults):this._internalResults}get oldCachedResults(){return this._oldResult}get oldResults(){return this._initializing?this._initializing.then(()=>this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult):this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult}static register(e,r){kt[e]=r}static unregister(e){return delete kt[e],!0}static initialize(e,r){let n=Object.assign({constructor:D},kt[e]??{},r??{},{on:Object.assign({},(kt[e]??{}).on??{},r?.on??{}),sharedVar:Object.assign({},(kt[e]??{}).sharedVar??{},r?.sharedVar??{}),params:Object.assign({},(kt[e]??{}).params??{},r?.params??{})});return new n.constructor(e,n)}static findService(e){return Vn.filter(r=>r.isInstanceOf(e))}};Ef=_e;np=D.register,BS=D.unregister,sp=D.initialize,Af=D.findService});var Ve,Zs=d(()=>{Ot();ge();Ue();Ve=class extends D{constructor(e,r){super(e,{...r,resultAlias:r?.resultAlias??"result"});this._currentDimension=[],this._transformers.push(H.initialize("SelectionTransformer",{transient:!0,sharedVar:{[this._resultAlias]:[],layer:null,highlightColor:r?.sharedVar?.highlightColor,highlightAttrValues:r?.sharedVar?.highlightAttrValues,tooltip:r?.sharedVar?.tooltip}})),this._selectionMapping=new Map,Object.entries({...this._userOptions?.query?.attrName?typeof this._userOptions.query.attrName=="string"?{[this._userOptions.query.attrName]:this._userOptions?.query?.extent??[]}:Object.fromEntries(this._userOptions.query.attrName.map((n,s)=>[n,this._userOptions?.query?.extent?.[s]??[]])):{},...this._sharedVar?.attrName?typeof this._sharedVar.attrName=="string"?{[this._sharedVar.attrName]:this._sharedVar?.extent??[]}:Object.fromEntries(this._sharedVar.attrName.map((n,s)=>[n,this._sharedVar?.extent?.[s]??[]])):{}}).filter(([n,s])=>s instanceof Array).forEach(([n,s])=>this._selectionMapping.set(n,s))}async setSharedVar(e,r,n){if(!(n&&n.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(n.layer)))if(this.preUpdate(),this._sharedVar[e]=r,this._transformers.filter(s=>s.isInstanceOf("draw-shape")).forEach(s=>{let a=n?.layer||this._layerInstances[0];if(!a)return;let i=a.getGraphic().getBoundingClientRect();if(a._width&&i.width>a._width||a._height&&i.height>a._height){let h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width",a._width.toString()),h.setAttribute("height",a._height.toString()),h.setAttribute("opacity","0"),a.getGraphic().appendChild(h),i=h.getBoundingClientRect(),a.getGraphic().removeChild(h)}let o=this._sharedVar.x??i.left,c=this._sharedVar.y??i.top,l=this._sharedVar.width??a._width??0,f=this._sharedVar.height??a._height??0;(this._sharedVar.width!==void 0||this._sharedVar.height!==void 0)&&s.setSharedVars({layer:a.getLayerFromQueue("transientLayer"),x:o-i.left,y:c-i.top,width:l,height:f})}),(n?.layer||this._layerInstances.length==1)&&this._userOptions.query){let s=n?.layer||this._layerInstances[0];if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._evaluate(s)})}else this.postUpdate()}_evaluate(e){if(!e)return;this._sharedVar.skipPicking||(this._oldResult=this._result,this._result=e.picking({...this._userOptions.query,...this._sharedVar}));let r=e.getLayerFromQueue("selectionLayer").getGraphic();for(;r?.firstChild;)r.removeChild(r.lastChild);if(this._sharedVar.deepClone){let n=[],s=[];this._result.forEach(a=>{if(a!==e.getGraphic()){let i=s.length;for(let o=0;o<i;o++){let c=s[o],l=n[o];a.contains(c)&&(s.splice(o,1),n.splice(o,1),l.remove(),o--,i--)}n.push(e.cloneVisualElements(a,!0)),s.push(a)}}),this._services.forEach(a=>{a.setSharedVars({...this._sharedVar,[this._resultAlias]:n})})}else this._services.forEach(n=>{n.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})}),this._transformers.filter(n=>!n.isInstanceOf("draw-shape")).forEach(n=>{n.setSharedVars({...this._sharedVar,x:this._sharedVar.offsetx??this._sharedVar.x,y:this._sharedVar.offsety??this._sharedVar.y,layer:e.getLayerFromQueue("selectionLayer"),[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})});if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert&&this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.offsety,a=this._sharedVar.width,i=this._sharedVar.height,o=e._offset?.x??0,c=e._offset?.y??0,l=[n-o,n-o+a].map(this._sharedVar.scaleX.invert),f=[s-c,s-c+i].map(this._sharedVar.scaleY.invert);this.filter([l,f],{passive:!0})}else if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.width,a=e._offset?.x??0,i=[n-a,n-a+s].map(this._sharedVar.scaleX.invert);this.filter(i,{passive:!0})}else if(this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsety,s=this._sharedVar.height,a=e._offset?.y??0,i=[n-a,n-a+s].map(this._sharedVar.scaleY.invert);this.filter(i,{passive:!0})}this._nextTick=0,this.postUpdate()}isInstanceOf(e){return e==="SelectionService"||this._baseName===e||this._name===e}dimension(e,r){let n=[],s=[];typeof e=="string"?(n=[e],s=[r??(c=>c)]):(n=se(e),s=r??n.map(()=>c=>c));let a=n.map((c,l)=>[c,s[l]]),i={},o=[];return this._currentDimension=a,new Proxy(this,{get(c,l,f){return l==="dimension"?c.dimension.bind(c):l==="_currentDimension"?a:l==="_scopeMode"?!0:l==="_sharedVar"?Object.keys(i).length?new Proxy({...c._sharedVar,scaleX:void 0,scaleY:void 0,...i},{set:(h,p,m)=>(i[p]=m,!0)}):new Proxy(c._sharedVar,{set:(h,p,m)=>(i[p]=m,!0)}):l==="_layerInstances"?o.length?o:c._layerInstances:c[l]instanceof Function?c[l].bind(f):c[l]},set(c,l,f){return l==="_layerInstances"?(o=f,!0):(c[l]=f,!0)}})}filter(e,r){if(r&&r.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(r.layer))return this;let n=r?.layer||this._layerInstances[0];return this._currentDimension.length===0&&e instanceof Array&&e.length>0?(this._sharedVar.attrName&&(this._userOptions.query.attrName=this._sharedVar.attrName),this._userOptions.query.attrName&&this.dimension(this._userOptions.query.attrName).filter(e)):this._currentDimension.length===1&&e instanceof Array&&e.length>0&&!(e[0]instanceof Array)?(this._selectionMapping.set(this._currentDimension[0][0],this._currentDimension[0][1](e).sort((s,a)=>typeof s=="number"?s-a:s<a?-1:s==a?0:1)),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})):this._currentDimension.length===e.length&&e.every(s=>s instanceof Array)&&(this._currentDimension.forEach((s,a)=>{this._selectionMapping.set(s[0],s[1](e[a]).sort((i,o)=>typeof i=="number"?i-o:i<o?-1:i==o?0:1))}),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})),this}get extents(){return Object.fromEntries(this._selectionMapping.entries())}};D.SelectionService=Ve;D.register("SelectionService",{constructor:Ve});D.register("SurfacePointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.SurfacePoint,x:0,y:0}});D.register("PointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Point,x:0,y:0}});D.register("RectSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Shape,type:U.Rect,x:0,y:0,width:1,height:1}});D.register("CircleSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Circle,x:0,y:0,r:1}});D.register("PolygonSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Polygon,points:[]}});D.register("QuantitativeSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Data,type:rt.Quantitative,attrName:"",extent:[0,0]}})});var br,Cf=d(()=>{Ot();br=class extends D{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="LayoutService"||this._baseName===e||this._name===e}};D.LayoutService=br;D.register("LayoutService",{constructor:br});D.register("ScaleService",{constructor:br,evaluate({offsetx:t,width:e,offsety:r,height:n,scaleX:s,scaleY:a,layer:i,self:o}){let c=i;if(!c&&o._layerInstances&&o._layerInstances.length==1&&(c=o._layerInstances[0]),s&&s.invert&&!a){if(e<=0||isNaN(e))return s;let l=s.copy(),f=l.invert(t-(c?._offset?.x??0)),h=l.invert(t+e-(c?._offset?.x??0));return l.domain([f,h]),l.clamp(!0),l}if(!s&&a&&a.invert){if(n<=0||isNaN(n))return a;let l=a.copy(),f=l.invert(r-(c?._offset?.y??0)),h=l.invert(r+n-(c?._offset?.y??0));return l.domain([f,h]),l.clamp(!0),l}if(s&&a&&s.invert&&a.invert){if(e<=0||isNaN(e)||n<=0||isNaN(n))return{scaleX:s,scaleY:a};let l=s.copy(),f=a.copy(),h=l.invert(t-(c?._offset?.x??0)),p=l.invert(t+e-(c?._offset?.x??0)),m=f.invert(r-(c?._offset?.y??0)),x=f.invert(r+n-(c?._offset?.y??0));return l.domain([h,p]),f.domain([m,x]),l.clamp(!0),f.clamp(!0),{scaleX:l,scaleY:f}}return{scaleX:s,scaleY:a}}})});var Pe,Mf=d(()=>{Ot();ge();gt();Pe=class extends D{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="AnalysisService"||this._baseName===e||this._name===e}};D.AnalysisService=Pe;D.register("AnalysisService",{constructor:Pe});D.register("FilterService",{constructor:Pe,evaluate({data:t,extents:e,result:r,fields:n,self:s}){if(!e&&(!r||!r.length||!n||!n.length))return e?t:[];if(!t)try{let a=s._layerInstances;a&&a.length>0&&(t=[...a[0].getGraphic().childNodes].filter(i=>a[0].getDatum(i)).map(i=>Object.assign(a[0].cloneVisualElements(i),a[0].getDatum(i))))}catch(a){console.error("failed to get data from layerInstances",a)}if(e)Object.entries(e).forEach(([a,i])=>{i[0]>=i[1]||isNaN(i[0])||isNaN(i[1])||(t=t.filter(o=>o[a]>=i[0]&&o[a]<=i[1]))});else{let a=s._layerInstances,i=Ie(r).datum();a&&a.length>0&&(i=a[0].getDatum(r[0])),i&&n.forEach(o=>{t=t.filter(c=>c[o]==i[o])})}return t}});D.register("InterpolationService",{constructor:Pe,evaluate({result:t,field:e,data:r,formula:n}){if(!t)return null;let{data:s,interpolatedNum:a}=t;if(!s||a===void 0||isNaN(a))return null;let i=Math.floor(a),o=s[i][e],c=r.filter(l=>l[e]===o);if(a>i){let l=i+1,f=a-i;c=c.map(h=>{let p=r.find(m=>m[e]===s[l][e]&&!Object.entries(h).find(([x,_])=>typeof _!="number"&&m[x]!==_));return Object.fromEntries(Object.entries(h).map(([m,x])=>typeof x=="number"?[m,x*(1-f)+p[m]*f]:[m,x]))})}return c.map(l=>(n&&Object.entries(n).forEach(([f,h])=>{l[f]=h(l)}),l))}});D.register("DataJoinService",{constructor:Pe,evaluate({data:t,result:e,offset:r,scaleX:n,scaleY:s,fieldX:a,fieldY:i,replace:o,self:c}){if(!e||e.length<=0)return t;let l=c._layerInstances;if(l&&l.length>0){let f=l[0].getDatum(e[0]);if(f){let h=se(f);if(r!==void 0&&n&&n.invert&&a&&(f[a]=n.invert(n(f[a])+parseFloat(r.x))),r!==void 0&&s&&s.invert&&i&&i!==a&&(f[i]=s.invert(s(f[i])+parseFloat(r.y))),o)return t;{let p=se(t);return Object.assign(f,h),p}}}return t}});D.register("AggregateService",{constructor:Pe,evaluate({result:t,operation:e,fields:r}){return t instanceof Array?e==="average"?Object.fromEntries(r.map(n=>[n,t.reduce((s,a)=>s+a[n],0)/t.length])):t.length:0}});D.register("ReverseSelectionService",{constructor:Pe,evaluate({result:t,self:e}){let r=e._layerInstances;if(r&&r.length>0){let s=[...r[0].getGraphic().childNodes].filter(o=>r[0].getDatum(o)),a=s.map(o=>r[0].getDatum(o)),i=(t||[]).map(o=>r[0].getDatum(o));return s.filter((o,c)=>!i.includes(a[c])).map(o=>r[0].cloneVisualElements(o,!0))}return[]}});D.register("RegressionService",{constructor:Pe,evaluate({result:t,xField:e,yField:r,self:n}){if(!t||t.length<=1||!(t instanceof Array))return null;let s=n._layerInstances;s&&s.length>0&&s[0].getDatum(t[0])&&(t=t.map(x=>s[0].getDatum(x)).filter(x=>x!==void 0));let a,i;e instanceof Function?a=t.map(m=>e(m)):e&&(a=t.map(m=>m[e])),r instanceof Function?i=t.map(m=>r(m)):r&&(i=t.map(m=>m[r]));let o=Bt(a),c=Bt(i),l=$t(a.map((m,x)=>(m-o)*(i[x]-c))),f=$t(a.map(m=>Math.pow(m-o,2))),h=l/f,p=c-h*o;return{slope:h,intercept:p}}})});var Rf,Ks,Z,Dt=d(()=>{Ot();Ot();Zs();Cf();Mf();Rf=Af,Ks=Vn,Z=D});var kf,Of=d(()=>{kf=`#JSGF V1.0;

grammar actions;

public <action> = start | stop | pause | resume | play | delete | add | insert | create | remove | drag | move | drag | brush;`});function ea(t){let e=t.events.map(r=>{if(typeof r=="string")return Tn(r)[0];{let n=Tn("*")[0];n.filterFuncs=[r]}});return{...t,eventStreams:e.map(r=>op(r))}}function op(t){return t.filter?{...t,filterFuncs:t.filter?t.filter.map(e=>new Function("event",`return ${e}`)):[]}:{...t}}var Df,ap,ip,Js,jn,z,db,mb,pb,gb,Vr=d(()=>{ge();Of();ap=window.SpeechRecognition||window.webkitSpeechRecognition,ip=window.SpeechGrammarList||window.webkitSpeechGrammarList,Js={},jn=[],z=class{constructor(e,r){this[Df]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._state=r.state,this._actions=se(r.actions??[]).map(ea),this._modalities={},this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUse=r.preUse??null,this._postUse=r.postUse??null,r.postInitialize&&r.postInitialize.call(this,this)}enableModality(e){switch(e){case"speech":if(this._modalities.speech)break;let r=new ap;this._modalities.speech=r;let n=new ip;n.addFromString(kf),r.grammars=n,r.lang="en-US";break}}disableModality(e){switch(e){case"speech":this._modalities.speech&&(this._modalities.speech.onresult=null,this._modalities.speech.onend=null,this._modalities.speech.abort(),this._modalities.speech=null);break}}getActions(){return this._actions.slice(0)}setActions(e){let r=e.concat(this._actions);this._actions=r.filter((n,s)=>s===r.findIndex(a=>a.action===n.action))}_parseEvent(e){let r=n=>"stream"in n?n.between.concat(n.stream).flatMap(r):"between"in n?n.between.concat([{type:n.type}]).flatMap(r):n.type;return Tn(e).flatMap(r)}getAcceptEvents(){return[...new Set(this._actions.flatMap(e=>e.eventStreams.flatMap(r=>r.type)).concat(["contextmenu"]))]}async dispatch(e,r){let n=this._actions.find(s=>{let a=s.eventStreams.map(o=>o.type),i=!1;return a.includes("*")&&(i=!0),e instanceof Event?i=s.eventStreams.filter(o=>o.type===e.type).some(o=>o.filterFuncs?o.filterFuncs.every(c=>c(e)):!0):a.includes(e)&&(i=!0),i&&(!s.transition||s.transition.find(o=>o[0]===this._state||o[0]==="*"))});if(n){let s=n.transition&&n.transition.find(a=>a[0]===this._state||a[0]==="*");if(s){if(this._state=s[1],this._state.startsWith("speech:")){this.enableModality("speech");try{this._modalities.speech.start()}catch{}this._modalities.speech.onresult=a=>{let i=a.results[a.resultIndex][0];this.dispatch(i.transcript,r)},this._modalities.speech.onend=a=>{this._modalities.speech.start()}}else this.disableModality("speech");if(n.sideEffect)try{await n.sideEffect({self:this,layer:r,instrument:null,interactor:this,event:e})}catch(a){console.error(a)}return!0}}return!1}preUse(e){this._preUse&&this._preUse.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return e=="Interactor"||this._baseName===e||this._name===e}static register(e,r){Js[e]=r}static unregister(e){return delete Js[e],!0}static initialize(e,r){let n=Object.assign({constructor:z},Js[e]??{},r??{}),s=new n.constructor(e,n);return jn.push(s),s}static findInteractor(e){return jn.filter(r=>r.isInstanceOf(e))}};Df=_e;db=z.register,mb=z.unregister,pb=z.initialize,gb=z.findInteractor});var Lf=d(()=>{Vr();z.register("MousePositionInteractor",{constructor:z,state:"start",actions:[{action:"hover",events:["mousemove"],transition:[["start","start"]]},{action:"click",events:["mouseup"],transition:[["start","start"]]}]});z.register("TouchPositionInteractor",{constructor:z,state:"start",actions:[{action:"enter",events:["touchstart"],transition:[["start","running"]]},{action:"hover",events:["touchmove"],transition:[["running","running"]]},{action:"leave",events:["touchend"],transition:[["running","start"],["start","start"]]}]});z.register("MouseTraceInteractor",{constructor:z,state:"start",actions:[{action:"dragabort",events:["mousedown[event.button==2]","mouseup[event.button==2]"],transition:[["drag","start"]]},{action:"dragstart",events:["mousedown"],transition:[["start","drag"]]},{action:"drag",events:["mousemove"],transition:[["drag","drag"]]},{action:"dragend",events:["mouseup[event.button==0]"],transition:[["drag","start"]]}]});z.register("TouchTraceInteractor",{constructor:z,state:"start",actions:[{action:"dragstart",events:["touchstart"],transition:[["start","drag"]]},{action:"drag",events:["touchmove"],transition:[["drag","drag"]]},{action:"dragend",events:["touchend"],transition:[["drag","start"]]}]});z.register("SpeechControlInteractor",{constructor:z,state:"start",actions:[{action:"enableSpeech",events:["click"],transition:[["*","speech:ready"]]},{action:"disableSpeech",events:["mouseup[event.button==2]"],transition:[["*","start"]]},{action:"speech",events:["*"],transition:[["*","speech:ready"]]}]});z.register("KeyboardPositionInteractor",{constructor:z,state:"start",actions:[{action:"begin",events:["keydown[event.key===' ']"],transition:[["start","running"]]},{action:"up",events:["keypress[event.key==='w' || event.key==='W']","keydown[event.key==='ArrowUp']{100}"],transition:[["running","running"]]},{action:"left",events:["keypress[event.key==='a' || event.key==='A']","keydown[event.key==='ArrowLeft']{100}"],transition:[["running","running"]]},{action:"down",events:["keypress[event.key==='s' || event.key==='S']","keydown[event.key==='ArrowDown']{100}"],transition:[["running","running"]]},{action:"right",events:["keypress[event.key==='d' || event.key==='D']","keydown[event.key==='ArrowRight']{100}"],transition:[["running","running"]]}]});z.register("MouseWheelInteractor",{constructor:z,state:"start",actions:[{action:"enter",events:["mouseenter"],transition:[["start","running"]]},{action:"wheel",events:["wheel","mousewheel"],transition:[["running","running"]]},{action:"leave",events:["mouseleave"],transition:[["running","start"],["start","start"]]},{action:"abort",events:["mouseup[event.button==2]"],transition:[["running","running"],["start","start"]]}]})});var bb,Vb,jb,ta,Be,jr=d(()=>{Vr();Vr();Lf();bb=z.register,Vb=z.initialize,jb=z.findInteractor,ta=jn,Be=z});function zf(t,e){Yf[t]=e}function Ff(t,e){let r=Object.assign({constructor:K},Yf[t]??{},e??{},{});return new r.constructor(t,r)}function Nf(t){return Xf.filter(e=>e.isInstanceOf(t))}var Pf,Yf,Xf,Lt,nt,K,Pt=d(()=>{ge();Yf={},Xf=[],Lt=new Map,nt=new Map,K=class{constructor(e,r){this._nextTick=0,this[Pf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._container=r.container,this._order=0,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._postUpdate=r.postUpdate??null,Xf.push(this),this._postInitialize&&this._postInitialize.call(this,this)}getGraphic(){return this._graphic}getContainerGraphic(){return this._container}getVisualElements(){return[]}cloneVisualElements(e,r=!1){let n=e.cloneNode(r);return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}getDatum(e){return null}join(e,r){return[]}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}picking(e){return[]}isPointInPolygon(e,r){let n=!1;for(let s=0,a=r.length-1;s<r.length;a=s++){let i=r[s].x,o=r[s].y,c=r[a].x,l=r[a].y;o>e.y!=l>e.y&&e.x<(c-i)*(e.y-o)/(l-o)+i&&(n=!n)}return n}pathIntersectsRect(e,r){let n=e.getTotalLength();if(n<=0)return!1;let s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(i.x>=r.x&&i.x<=r.x+r.width&&i.y>=r.y&&i.y<=r.y+r.height)return!0}return!1}getLayerFromQueue(e){Lt.has(this)||Lt.set(this,{[this._name]:this}),nt.has(this)||nt.set(this,{[this._name]:0});let r=Lt.get(this);if(!(e in r)){let n=K.initialize(this._baseName,{...this._userOptions,name:e,group:"",redraw(){}});r[e]=n,Lt.set(n,r);let s=r[e].getGraphic();s&&s.style&&(s.style.pointerEvents="none")}return e in nt.get(this)||(nt.get(this)[e]=0),r[e]}setLayersOrder(e){Lt.has(this)||Lt.set(this,{[this._name]:this}),nt.has(this)||nt.set(this,{[this._name]:0});let r=nt.get(this),n=document.createDocumentFragment();Object.entries(e).forEach(([s,a])=>{r[s]=a}),Object.entries(r).sort((s,a)=>s[1]-a[1]).forEach(([s,a])=>{if(r[s]=a,nt.set(this.getLayerFromQueue(s),r),a>=0){let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="initial")}else{let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="none")}this.getLayerFromQueue(s)._order=a,n.append(this.getLayerFromQueue(s).getGraphic(!0))}),this.getContainerGraphic().appendChild(n)}isInstanceOf(e){return this._baseName===e||this._name===e}};Pf=_e;K.register=zf;K.initialize=Ff;K.findLayer=Nf});var qf,Yt,Tr,Gf=d(()=>{Pt();gt();ge();qf="D3Layer",Yt="ig-layer-background",Tr=class extends K{constructor(e,r){super(e,r);this._width=r.width,this._height=r.height,this._offset=r.offset,this._name=r.name,this._graphic=Y(r.container).append("g").call(s=>{this._name&&s.attr("className",this._name)}).call(s=>{this._offset&&s.attr("transform",`translate(${this._offset.x||0}, ${this._offset.y||0})`)}).node(),Y(this._graphic).append("rect").attr("class",Yt).attr("width",this._width).attr("height",this._height).attr("opacity",0);let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum():Y(e).datum()}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Yt})`)]}cloneVisualElements(e,r=!1){let n=Y(e).clone(r).node();return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Yt)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(this._isElementInLayer.bind(this)),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(this._isElementInLayer.bind(this))}else if(e.type===U.Circle){let i=e.x-n.left,o=e.y-n.top,c=e.r,l=Math.floor(c*Math.sin(Math.PI/4))<<1,f=i-(l>>>1),h=o-(l>>>1),p=new Set,m=this._svg.createSVGRect();m.x=f,m.y=h,m.width=l,m.height=l,this._svg.getIntersectionList(m,this._graphic).forEach(M=>p.add(M));let x=[...this._graphic.querySelectorAll("path")].filter(M=>window.getComputedStyle(M).fill==="none");x.length>0&&x.filter(P=>{let ce=this.transformRect(m,this._graphic);return this.pathIntersectsRect(P,ce)}).forEach(P=>p.add(P));let _=c,v=i-c,V=o-c,E=new Set,j=this._svg.createSVGRect();j.x=v,j.y=V,j.width=_*2,j.height=_*2,this._svg.getIntersectionList(j,this._graphic).forEach(M=>E.add(M)),x.length>0&&x.filter(P=>{let ce=this.transformRect(j,this._graphic);return this.pathIntersectsRect(P,ce)}).forEach(P=>E.add(P));let W=1;for(;;){for(let je of E)p.has(je)&&E.delete(je);if(!E.size||W*2+l>=c*2)break;let M=Math.sqrt(c*c-Math.pow(l/2+W,2)),P=this._svg.createSVGRect();P.x=i-M,P.y=h-W,P.width=M*2,P.height=1;let ce=this._svg.createSVGRect();ce.x=i-M,ce.y=h+l+W-1,ce.width=M*2,ce.height=1;let de=this._svg.createSVGRect();de.x=f-W,de.y=o-M,de.width=1,de.height=M*2;let Ae=this._svg.createSVGRect();Ae.x=f+l+W-1,Ae.y=o-M,Ae.width=1,Ae.height=M*2,[P,ce,de,Ae].forEach(je=>{this._svg.getIntersectionList(je,this._graphic).forEach(le=>p.add(le));let R=[...this._graphic.querySelectorAll("path")].filter(le=>window.getComputedStyle(le).fill==="none");R.length>0&&R.filter(re=>{let we=this.transformRect(je,this._graphic);return this.pathIntersectsRect(re,we)}).forEach(re=>p.add(re))}),W++}r=[...p].filter(this._isElementInLayer.bind(this))}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),x=this._svg.createSVGRect();x.x=f,x.y=h,x.width=p,x.height=m,r=[...this._svg.getIntersectionList(x,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(v=>!v.classList.contains(Yt));let _=[...this._graphic.querySelectorAll("path")].filter(v=>window.getComputedStyle(v).fill==="none");if(_.length>0){let v=_.filter(V=>{let E=this.transformRect(x,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...v])]}}else if(e.type===U.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(f=>({x:f.x-o.left,y:f.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement)}return a}_dataQuery(e){let r=[],n=Ie(this.getVisualElements());if(e.type===rt.Quantitative){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(f=>f&&f[o]!==void 0&&l[0]<f[o]&&f[o]<l[1])}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a[0]<i[s]&&i[s]<a[1]).nodes()}else if(e.type===rt.Nominal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(f=>f&&f[o]!==void 0&&l.findIndex(f[o])>=0)}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a.findIndex(i[s])>=0).nodes()}else if(e.type===rt.Temporal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c],f=e.dateParser?.[c]??(h=>h);i=i.filter(h=>h&&h[o]!==void 0&&l[0].getTime()<f(h[o]).getTime()&&f(h[o]).getTime()<l[1].getTime())}),r=i.nodes()}else{let i=e.dateParser||(o=>o);r=n.filter(o=>o&&o[s]!==void 0&&a[0].getTime()<i(o[s]).getTime()&&i(o[s]).getTime()<a[1].getTime()).nodes()}}return r}_attrQuery(e){let{attrName:r,value:n}=e;return Y(this._graphic).filter(a=>a[r]===n).nodes()}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Yt)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(f=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(f,h)}).forEach(f=>r.add(f)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let f=s/10;c+f<=r.maxY;f+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:f},e)){let h=l*f;h>a&&(a=h,i={x:o,y:c,width:l,height:f})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Yt)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(f=>this.isPointInPolygon(f,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.D3Layer=Tr;K.register(qf,{constructor:Tr});K.register(qf,{constructor:Tr})});var ra=d(()=>{});function Uf(t){return{a:parseFloat(t.a),b:parseFloat(t.b),c:parseFloat(t.c),d:parseFloat(t.d),e:parseFloat(t.e),f:parseFloat(t.f)}}var na=d(()=>{});var Bf=d(()=>{});var $f=d(()=>{});var sa=d(()=>{});function yt(t){return typeof t=="undefined"}var In=d(()=>{});var Qf=d(()=>{In()});function Ye(t,e=0){return{a:1,c:0,e:t,b:0,d:1,f:e}}var Xt=d(()=>{});function xt(...t){t=Array.isArray(t[0])?t[0]:t;let e=(r,n)=>({a:r.a*n.a+r.c*n.b,c:r.a*n.c+r.c*n.d,e:r.a*n.e+r.c*n.f+r.e,b:r.b*n.a+r.d*n.b,d:r.b*n.c+r.d*n.d,f:r.b*n.e+r.d*n.f+r.f});switch(t.length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{let[r,n,...s]=t,a=e(r,n);return xt(a,...s)}}}function zt(...t){return xt(...t)}var _t=d(()=>{});function Hf(t,e,r){let n=cp(t),s=lp(t),a={a:n,c:-s,e:0,b:s,d:n,f:0};return yt(e)||yt(r)?a:xt([Ye(e,r),a,Ye(-e,-r)])}function aa(t,e=void 0,r=void 0){return Hf(t*fp/180,e,r)}var cp,lp,fp,En=d(()=>{In();Xt();_t();({cos:cp,sin:lp,PI:fp}=Math)});function Ir(t,e=void 0,r=void 0,n=void 0){yt(e)&&(e=t);let s={a:t,c:0,e:0,b:0,d:e,f:0};return yt(r)||yt(n)?s:xt([Ye(r,n),s,Ye(-r,-n)])}var Er=d(()=>{In();Xt();_t()});function Wf(t,e){return{a:1,c:t,e:0,b:e,d:1,f:0}}var ia=d(()=>{});function up(t,e){return{a:1,c:Zf(t),e:0,b:Zf(e),d:1,f:0}}function oa(t,e){return up(t*Math.PI/180,e*Math.PI/180)}var Zf,ca=d(()=>{({tan:Zf}=Math)});var Kf=d(()=>{});var la=d(()=>{});var Jf=d(()=>{sa();_t();la()});function An(t){return Array.isArray(t)?t.map(e):e(t);function e(r){switch(r.type){case"matrix":if("a"in r&&"b"in r&&"c"in r&&"d"in r&&"e"in r&&"f"in r)return Uf(r);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in r?Ye(r.tx,r.ty):Ye(r.tx);case"scale":if(!("sx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in r?Ir(r.sx,r.sy):Ir(r.sx);case"rotate":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in r&&"cy"in r?aa(r.angle,r.cx,r.cy):aa(r.angle);case"skewX":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return oa(r.angle,0);case"skewY":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return oa(0,r.angle);case"shear":if(!("shx"in r&&"shy"in r))throw new Error("MISSING_MANDATORY_PARAM");return Wf(r.shx,r.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR")}}}var eu=d(()=>{na();Xt();Er();En();ca();ia()});function hp(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function vt(t,e,r,n){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,vt.prototype),s.expected=e,s.found=r,s.location=n,s.name="SyntaxError",s}function fa(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,r+=r.repeat(e),t+r.slice(0,e))}function tu(t,e){e=e!==void 0?e:{};var r={},n=e.grammarSource,s={transformList:Va},a=Va,i="matrix",o="(",c=")",l="translate",f="scale",h="rotate",p="skewX",m="skewY",x=",",_=".",v=/^[eE]/,V=/^[+\-]/,E=/^[0-9]/,j=/^[ \t\r\n]/,W=ke("matrix",!1),M=ke("(",!1),P=ke(")",!1),ce=ke("translate",!1),de=ke("scale",!1),Ae=ke("rotate",!1),je=ke("skewX",!1),R=ke("skewY",!1),le=ke(",",!1),re=wa("fractionalConstant"),we=ke(".",!1),St=Xr(["e","E"],!1,!1),$e=Xr(["+","-"],!1,!1),Qe=Xr([["0","9"]],!1,!1),He=Xr([" ","	","\r",`
`],!1,!1),Se=function(u){return u},Yn=function(u,g){return u.concat(g)},Xn=function(u,g,w,b,O,I){return[{type:"matrix",a:u,b:g,c:w,d:b,e:O,f:I}]},zn=function(u,g){var w={type:"translate",tx:u};return g&&(w.ty=g),[w]},Fn=function(u,g){var w={type:"scale",sx:u};return g&&(w.sy=g),[w]},Nn=function(u,g){var w={type:"rotate",angle:u};return g&&(w.cx=g[0],w.cy=g[1]),[w]},qn=function(u){return[{type:"skewX",angle:u}]},Gn=function(u){return[{type:"skewY",angle:u}]},Un=function(u){return parseFloat(u.join(""))},Bn=function(u){return parseInt(u.join(""))},T=function(u){return u},k=function(u,g){return[u,g]},L=function(u){return u.join("")},S=function(u,g){return[u,g||null].join("")},fe=function(u,g){return[u,g].join("")},F=function(u,g){return[u?u.join(""):null,".",g.join("")].join("")},me=function(u){return u.join("")},pe=function(u,g){return["e",u,g.join("")].join("")},y=0,N=0,Pr=[{line:1,column:1}],Re=0,$n=[],q=0,Yr;if("startRule"in e){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');a=s[e.startRule]}function Rp(){return t.substring(N,y)}function kp(){return N}function Op(){return{source:n,start:N,end:y}}function Dp(){return Ut(N,y)}function Lp(u,g){throw g=g!==void 0?g:Ut(N,y),ba([wa(u)],t.substring(N,y),g)}function Pp(u,g){throw g=g!==void 0?g:Ut(N,y),Su(u,g)}function ke(u,g){return{type:"literal",text:u,ignoreCase:g}}function Xr(u,g,w){return{type:"class",parts:u,inverted:g,ignoreCase:w}}function Yp(){return{type:"any"}}function wu(){return{type:"end"}}function wa(u){return{type:"other",description:u}}function Sa(u){var g=Pr[u],w;if(g)return g;for(w=u-1;!Pr[w];)w--;for(g=Pr[w],g={line:g.line,column:g.column};w<u;)t.charCodeAt(w)===10?(g.line++,g.column=1):g.column++,w++;return Pr[u]=g,g}function Ut(u,g,w){var b=Sa(u),O=Sa(g),I={source:n,start:{offset:u,line:b.line,column:b.column},end:{offset:g,line:O.line,column:O.column}};return w&&n&&typeof n.offset=="function"&&(I.start=n.offset(I.start),I.end=n.offset(I.end)),I}function B(u){y<Re||(y>Re&&(Re=y,$n=[]),$n.push(u))}function Su(u,g){return new vt(u,null,null,g)}function ba(u,g,w){return new vt(vt.buildMessage(u,g),u,g,w)}function Va(){var u,g,w,b,O;for(u=y,g=[],w=C();w!==r;)g.push(w),w=C();for(w=ja(),w===r&&(w=null),b=[],O=C();O!==r;)b.push(O),O=C();return N=u,u=Se(w),u}function ja(){var u,g,w,b;if(u=y,g=Ta(),g!==r){if(w=[],b=Oe(),b!==r)for(;b!==r;)w.push(b),b=Oe();else w=r;w!==r?(b=ja(),b!==r?(N=u,u=Yn(g,b)):(y=u,u=r)):(y=u,u=r)}else y=u,u=r;return u===r&&(u=Ta()),u}function Ta(){var u;return u=bu(),u===r&&(u=Vu(),u===r&&(u=ju(),u===r&&(u=Tu(),u===r&&(u=Iu(),u===r&&(u=Eu()))))),u}function bu(){var u,g,w,b,O,I,ee,G,$,Hn,Ma,Wn,Ra,Zn,ka,Kn,Oa,st;if(u=y,t.substr(y,6)===i?(g=i,y+=6):(g=r,q===0&&B(W)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r)if(ee=Oe(),ee!==r)if(G=xe(),G!==r)if($=Oe(),$!==r)if(Hn=xe(),Hn!==r)if(Ma=Oe(),Ma!==r)if(Wn=xe(),Wn!==r)if(Ra=Oe(),Ra!==r)if(Zn=xe(),Zn!==r)if(ka=Oe(),ka!==r)if(Kn=xe(),Kn!==r){for(Oa=[],st=C();st!==r;)Oa.push(st),st=C();t.charCodeAt(y)===41?(st=c,y++):(st=r,q===0&&B(P)),st!==r?(N=u,u=Xn(I,G,Hn,Wn,Zn,Kn)):(y=u,u=r)}else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Vu(){var u,g,w,b,O,I,ee,G,$;if(u=y,t.substr(y,9)===l?(g=l,y+=9):(g=r,q===0&&B(ce)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=Ia(),ee===r&&(ee=null),G=[],$=C();$!==r;)G.push($),$=C();t.charCodeAt(y)===41?($=c,y++):($=r,q===0&&B(P)),$!==r?(N=u,u=zn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function ju(){var u,g,w,b,O,I,ee,G,$;if(u=y,t.substr(y,5)===f?(g=f,y+=5):(g=r,q===0&&B(de)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=Ia(),ee===r&&(ee=null),G=[],$=C();$!==r;)G.push($),$=C();t.charCodeAt(y)===41?($=c,y++):($=r,q===0&&B(P)),$!==r?(N=u,u=Fn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Tu(){var u,g,w,b,O,I,ee,G,$;if(u=y,t.substr(y,6)===h?(g=h,y+=6):(g=r,q===0&&B(Ae)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=Au(),ee===r&&(ee=null),G=[],$=C();$!==r;)G.push($),$=C();t.charCodeAt(y)===41?($=c,y++):($=r,q===0&&B(P)),$!==r?(N=u,u=Nn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Iu(){var u,g,w,b,O,I,ee,G;if(u=y,t.substr(y,5)===p?(g=p,y+=5):(g=r,q===0&&B(je)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();t.charCodeAt(y)===41?(G=c,y++):(G=r,q===0&&B(P)),G!==r?(N=u,u=qn(I)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Eu(){var u,g,w,b,O,I,ee,G;if(u=y,t.substr(y,5)===m?(g=m,y+=5):(g=r,q===0&&B(R)),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&B(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();t.charCodeAt(y)===41?(G=c,y++):(G=r,q===0&&B(P)),G!==r?(N=u,u=Gn(I)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function xe(){var u,g,w,b;return u=y,g=y,w=Qn(),w===r&&(w=null),b=Mu(),b!==r?(w=[w,b],g=w):(y=g,g=r),g!==r&&(N=u,g=Un(g)),u=g,u===r&&(u=y,g=y,w=Qn(),w===r&&(w=null),b=Cu(),b!==r?(w=[w,b],g=w):(y=g,g=r),g!==r&&(N=u,g=Bn(g)),u=g),u}function Ia(){var u,g,w;return u=y,g=Oe(),g!==r?(w=xe(),w!==r?(N=u,u=T(w)):(y=u,u=r)):(y=u,u=r),u}function Au(){var u,g,w,b,O;return u=y,g=Oe(),g!==r?(w=xe(),w!==r?(b=Oe(),b!==r?(O=xe(),O!==r?(N=u,u=k(w,O)):(y=u,u=r)):(y=u,u=r)):(y=u,u=r)):(y=u,u=r),u}function Oe(){var u,g,w,b,O;if(u=y,g=[],w=C(),w!==r)for(;w!==r;)g.push(w),w=C();else g=r;if(g!==r){for(w=Ea(),w===r&&(w=null),b=[],O=C();O!==r;)b.push(O),O=C();g=[g,w,b],u=g}else y=u,u=r;if(u===r)if(u=y,g=Ea(),g!==r){for(w=[],b=C();b!==r;)w.push(b),b=C();g=[g,w],u=g}else y=u,u=r;return u}function Ea(){var u;return t.charCodeAt(y)===44?(u=x,y++):(u=r,q===0&&B(le)),u}function Cu(){var u,g;return u=y,g=bt(),g!==r&&(N=u,g=L(g)),u=g,u}function Mu(){var u,g,w;return u=y,g=Ru(),g!==r?(w=Aa(),w===r&&(w=null),N=u,u=S(g,w)):(y=u,u=r),u===r&&(u=y,g=bt(),g!==r?(w=Aa(),w!==r?(N=u,u=fe(g,w)):(y=u,u=r)):(y=u,u=r)),u}function Ru(){var u,g,w,b;return q++,u=y,g=bt(),g===r&&(g=null),t.charCodeAt(y)===46?(w=_,y++):(w=r,q===0&&B(we)),w!==r?(b=bt(),b!==r?(N=u,u=F(g,b)):(y=u,u=r)):(y=u,u=r),u===r&&(u=y,g=bt(),g!==r?(t.charCodeAt(y)===46?(w=_,y++):(w=r,q===0&&B(we)),w!==r?(N=u,u=me(g)):(y=u,u=r)):(y=u,u=r)),q--,u===r&&(g=r,q===0&&B(re)),u}function Aa(){var u,g,w,b;return u=y,v.test(t.charAt(y))?(g=t.charAt(y),y++):(g=r,q===0&&B(St)),g!==r?(w=Qn(),w===r&&(w=null),b=bt(),b!==r?(N=u,u=pe(w,b)):(y=u,u=r)):(y=u,u=r),u}function Qn(){var u;return V.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&B($e)),u}function bt(){var u,g;if(u=[],g=Ca(),g!==r)for(;g!==r;)u.push(g),g=Ca();else u=r;return u}function Ca(){var u;return E.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&B(Qe)),u}function C(){var u;return j.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&B(He)),u}if(Yr=a(),Yr!==r&&y===t.length)return Yr;throw Yr!==r&&y<t.length&&B(wu()),ba($n,Re<t.length?t.charAt(Re):null,Re<t.length?Ut(Re,Re+1):Ut(Re,Re))}var ru=d(()=>{hp(vt,Error);vt.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){r=t[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,i=this.location.source+":"+a.line+":"+a.column;if(r){var o=this.location.end,c=fa("",a.line.toString().length," "),l=r[s.line-1],f=s.line===o.line?o.column:l.length+1,h=f-s.column||1;e+=`
 --> `+i+`
`+c+` |
`+a.line+" | "+l+`
`+c+" | "+fa("",s.column-1," ")+fa("",h,"^")}else e+=`
 at `+i}return e};vt.buildMessage=function(t,e){var r={literal:function(l){return'"'+s(l.text)+'"'},class:function(l){var f=l.parts.map(function(h){return Array.isArray(h)?a(h[0])+"-"+a(h[1]):a(h)});return"["+(l.inverted?"^":"")+f.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function s(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function a(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function i(l){return r[l.type](l)}function o(l){var f=l.map(i),h,p;if(f.sort(),f.length>0){for(h=1,p=1;h<f.length;h++)f[h-1]!==f[h]&&(f[p]=f[h],p++);f.length=p}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function c(l){return l?'"'+s(l)+'"':"end of input"}return"Expected "+o(t)+" but "+c(e)+" found."}});function Cn(t){return tu(t)}var nu=d(()=>{ru()});var su=d(()=>{Er();_t()});var au=d(()=>{});var iu=d(()=>{Xt();ra();En();Er();_t()});var ua=d(()=>{ra();na();Bf();$f();sa();Qf();En();Er();ia();ca();Kf();_t();Xt();Jf();la();eu();nu();su();au();iu()});var ou,Ft,Ar,cu=d(()=>{Pt();gt();ge();ua();ou="VegaLayer",Ft="background",Ar=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`.${r.group}`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(An(Cn(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Ft})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:Y(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=Y(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform")||"";for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Ft)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===U.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,f=e.r,h=f,p=c-f,m=l-f,x=new Set,_=this._svg.createSVGRect();_.x=p,_.y=m,_.width=h*2,_.height=h*2,this._svg.getIntersectionList(_,this._graphic).forEach(v=>x.add(v)),r=[...x].filter(v=>{if(!this._isElementInLayer(v))return!1;let V=v.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+f||j>V.height/2+f?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=f*f})}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),x=this._svg.createSVGRect();x.x=f,x.y=h,x.width=p,x.height=m,r=[...this._svg.getIntersectionList(x,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(v=>!v.classList.contains(Ft));let _=[...this._graphic.querySelectorAll("path")].filter(v=>window.getComputedStyle(v).fill==="none");if(_.length>0){let v=_.filter(V=>{let E=this.transformRect(x,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...v])]}}else if(e.type===U.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(f=>({x:f.x-o.left,y:f.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(Ft)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Ft)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(f=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(f,h)}).forEach(f=>r.add(f)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let f=s/10;c+f<=r.maxY;f+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:f},e)){let h=l*f;h>a&&(a=h,i={x:o,y:c,width:l,height:f})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Ft)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(f=>this.isPointInPolygon(f,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.VegaLayer=Ar;K.register(ou,{constructor:Ar});K.register(ou,{constructor:Ar})});var lu,ha,Cr,fu=d(()=>{Pt();gt();ge();ua();lu="PlotLayer",ha="background",Cr=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`*[aria-label="${r.group}"]`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(An(Cn(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${ha})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:Y(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=Y(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform");for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(ha)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===U.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,f=e.r,h=f,p=c-f,m=l-f,x=new Set,_=this._svg.createSVGRect();_.x=p,_.y=m,_.width=h*2,_.height=h*2,this._svg.getIntersectionList(_,this._graphic).forEach(v=>x.add(v)),r=[...x].filter(v=>{if(!this._isElementInLayer(v))return!1;let V=v.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+f||j>V.height/2+f?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=f*f})}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),x=this._svg.createSVGRect();x.x=f,x.y=h,x.width=p,x.height=m,r=[...this._svg.getIntersectionList(x,this._graphic)].filter(_=>{if(!this._isElementInLayer(_))return!1;let v=_.getBoundingClientRect();return!(v.right<f+n.left||v.left>f+p+n.left||v.bottom<h+n.top||v.top>h+m+n.top)})}else if(e.type===U.Polygon){let{points:i}=e,o=Math.min(...i.map(p=>p.x))-n.left,c=Math.min(...i.map(p=>p.y))-n.top,l=Math.max(...i.map(p=>p.x))-n.left,f=Math.max(...i.map(p=>p.y))-n.top,h=this._svg.createSVGRect();h.x=o,h.y=c,h.width=l-o,h.height=f-c,r=[...this._svg.getIntersectionList(h,this._graphic)].filter(p=>{if(!this._isElementInLayer(p))return!1;let m=p.getBoundingClientRect();return!(m.right<o+n.left||m.left>l+n.left||m.bottom<c+n.top||m.top>f+n.top)})}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(ha)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}};K.PlotLayer=Cr;K.register(lu,{constructor:Cr});K.register(lu,{constructor:Cr})});var Xe,Mr=d(()=>{Pt();Pt();Gf();cu();fu();Xe=K});var uu,ze,wt,Me,Rr,da,A,dp,_V,mp,pp,Nt=d(()=>{jr();ge();qt();Mr();Dt();Ue();ze={},wt=[],Me=new Map,Rr=[],da=!1,A=class{constructor(e,r){this._transformers=[],this._linkCache={},this[uu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._baseName=e,this._userOptions=r,this._name=r.name??e,this._on=Object.assign({},r.on??{}),this._interactors=[],this._layers=[],this._layerInteractors=new Map,this._services=r.services??[],this._serviceInstances=[],this._sharedVar=r.sharedVar??{},this._transformers=r.transformers??[],r.interactors&&r.interactors.forEach(n=>{typeof n=="string"?this.useInteractor(Be.initialize(n)):"options"in n?typeof n.interactor=="string"?this.useInteractor(Be.initialize(n.interactor,n.options)):this.useInteractor(n.interactor,n.options):this.useInteractor(n)}),this._services.forEach(n=>{typeof n=="string"||!("options"in n)?this.useService(n):this.useService(n.service,n.options)}),r.layers&&r.layers.forEach(n=>{"options"in n?this.attach(n.layer,n.options):this.attach(n)}),r.postInitialize&&r.postInitialize.call(this,this)}emit(e,r){this._on[e]&&this._on[e].forEach(n=>{n instanceof Fe?n.execute(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{})):n(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{}))}),e.includes("confirm")&&this._serviceInstances.forEach(n=>{n.invokeCommand()})}on(e,r){return e instanceof Array?e.forEach(n=>{this._on[n]||(this._on[n]=[]),this._on[n].push(r)}):(this._on[e]||(this._on[e]=[]),this._on[e].push(r)),this}off(e,r){if(!!this._on[e])return this._on[e].includes(r)&&this._on[e].splice(this._on[e].indexOf(r),1),this}_use(e,r){e.preAttach(this),this._serviceInstances.push(e),e.postUse(this)}useService(e,r){typeof e!="string"&&this._serviceInstances.includes(e)||(arguments.length>=2?this._services.push({service:e,options:r}):this._services.push(e),typeof e=="string"?Rf(e).forEach(s=>this._use(s,r)):this._use(e,r))}useInteractor(e,r){e.preUse(this),arguments.length>=2?this._interactors.push({interactor:e,options:r}):this._interactors.push(e),this._layers.forEach(n=>{let s;n instanceof Xe?s=n:s=n.layer,this._layerInteractors.has(s)||this._layerInteractors.set(s,[]);let a=Be.initialize(e._baseName,e._userOptions);this._layerInteractors.get(s).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof Fe?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(s.getContainerGraphic())||Me.set(s.getContainerGraphic(),new Map),Me.get(s.getContainerGraphic()).has(i)||(s.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,s,i)),Me.get(s.getContainerGraphic()).set(i,[])),Me.get(s.getContainerGraphic()).get(i).push([a,s,n instanceof Xe?null:n.options,this])})}),e.postUse(this)}attach(e,r){this._layers.find(n=>n instanceof Xe?n===e:n.layer===e)||(this.preAttach(e,r??null),arguments.length>=2?this._layers.push({layer:e,options:r}):this._layers.push(e),this.postUse(e))}getSharedVar(e,r){return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}setSharedVar(e,r,n){this._sharedVar[e]=r,this._on[`update:${e}`]&&this._on[`update:${e}`].forEach(a=>{a instanceof Fe?a.execute({self:this,layer:null,instrument:this,interactor:null}):a({self:this,layer:null,instrument:this,interactor:null})})}watchSharedVar(e,r){this.on(`update:${e}`,r)}preAttach(e,r){this._preAttach&&this._preAttach.call(this,this,e),this._interactors.forEach(n=>{let s;n instanceof Be?s=n:s=n.interactor,this._layerInteractors.has(e)||this._layerInteractors.set(e,[]);let a=Be.initialize(s._baseName,s._userOptions);this._layerInteractors.get(e).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof Fe?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(e.getContainerGraphic())||Me.set(e.getContainerGraphic(),new Map),Me.get(e.getContainerGraphic()).has(i)||(e.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,e,i)),Me.get(e.getContainerGraphic()).set(i,[])),Me.get(e.getContainerGraphic()).get(i).push([a,e,r,this])})})}async _dispatch(e,r,n){if(e._baseName!=="Layer"&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()),da){let i=Rr.findIndex(o=>o.instrument===this&&o.layer===e&&o.eventType===r);i>=0&&Rr.splice(i,1),Rr.push({instrument:this,layer:e,eventType:r,event:n});return}da=!0;let s=Me.get(e.getContainerGraphic()).get(r).filter(([i,o])=>o._order>=0);s.sort((i,o)=>o[1]._order-i[1]._order);let a=!1;for(let[i,o,c,l]of s){if(n instanceof MouseEvent&&!(o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="backgroundlayer"||o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="bglayer"||c&&c.pointerEvents==="all"))if(!c||c.pointerEvents==="viewport"){let f=o;if(f._offset&&f._width&&f._height&&(n.offsetX<f._offset.x||n.offsetX>f._offset.x+f._width||n.offsetY<f._offset.y||n.offsetY>f._offset.y+f._height))continue}else{if(o.picking({baseOn:te.Shape,type:U.Point,x:n.clientX,y:n.clientY}).length<=0&&i._state==="start")continue;let h=o;if(h._offset&&h._width&&h._height&&(n.offsetX<h._offset.x||n.offsetX>h._offset.x+h._width||n.offsetY<h._offset.y||n.offsetY>h._offset.y+h._height))continue}try{if(await i.dispatch(n,o)&&n instanceof MouseEvent&&c&&c.pointerEvents==="visiblePainted"){a=!0;break}}catch(f){console.error(f);break}}if(da=!1,Rr.length){let i=Rr.shift();i.instrument._dispatch(i.layer,i.eventType,i.event)}}postUse(e){let r=e.getGraphic();r&&r.style&&(r.style.pointerEvents="auto"),this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return this._baseName===e||this._name===e}get services(){return ve(this._serviceInstances.slice(0),Z,this.useService.bind(this),()=>{throw new Error("Do not support dynamic change service yet")},this)}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>this._transformers.splice(this._transformers.indexOf(e),1),this)}static register(e,r){ze[e]=r}static unregister(e){return delete ze[e],!0}static initialize(e,r){let n=Object.assign({constructor:A},ze[e]??{},r??{},{on:se(Object.assign({},(ze[e]??{}).on??{},r?.on??{})),sharedVar:Object.assign({},(ze[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return wt.push(s),s}static findInstrument(e){return wt.filter(r=>r.isInstanceOf(e))}};uu=_e;dp=A.register,_V=A.unregister,mp=A.initialize,pp=A.findInstrument});var hu=d(()=>{Nt();Ue();ge();gt();Mn();A.register("HoverInstrument",{constructor:A,interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("SelectionService").setSharedVars({event:t,x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY},{layer:e}),r.transformers.setSharedVars({cx:t.clientX,cy:t.clientY})}],click:[ne.initialize("Log",{execute(){}})]},postInitialize:t=>{t.services.add("SurfacePointSelectionService",{sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues"),tooltip:t.getSharedVar("tooltip")}})},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues"),tooltip:t.getSharedVar("tooltip")}})}});A.register("ClickInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.setSharedVar("x",e.clientX),n.setSharedVar("y",e.clientY),n.services.find("SelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY},{layer:r}),n.emit("clickstart",{...t,self:t.instrument})},ne.initialize("Log",{execute(){}})],dragend:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:r}),e.clientX===n.getSharedVar("x")&&e.clientY===n.getSharedVar("y")?(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("click",{...t,self:t.instrument})):(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("clickabort",{...t,self:t.instrument}))}],dragabort:[t=>{t.event.changedTouches&&(t.event=t.event.changedTouches[0]),t.instrument.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:t.layer}),t.instrument.emit("clickabort",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("RectSelectionService").setSharedVars({x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY,width:1,height:1,startx:t.clientX,starty:t.clientY,startoffsetx:t.offsetX,startoffsety:t.offsetY,currentx:t.clientX,currenty:t.clientY},{layer:e});let s=t.offsetX,a=t.offsetY,i=0,o=0,c=e._offset?.x??0,l=e._offset?.y??0,f=r.getSharedVar("scaleX"),h=r.getSharedVar("scaleY");if(f&&f.invert&&h&&h.invert){let p=[s-c,s-c+i].map(f.invert),m=[a-l,a-l+o].map(h.invert);r.setSharedVar("extent",[p,m],{layer:e}),r.services.find("SelectionService").filter([p,m])}else r.services.find("SelectionService").filter([[s-c,s-c+i],[a-l,a-l+o]]);r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY),r.setSharedVar("startoffsetx",t.offsetX),r.setSharedVar("startoffsety",t.offsetY)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("starty"),i=n.getSharedVar("startoffsetx"),o=n.getSharedVar("startoffsety"),c=Math.min(s,e.clientX),l=Math.min(a,e.clientY),f=Math.min(i,e.offsetX),h=Math.min(o,e.offsetY),p=Math.abs(e.clientX-s),m=Math.abs(e.clientY-a);n.services.find("SelectionService").setSharedVars({x:c,y:l,offsetx:f,offsety:h,width:p,height:m,currentx:e.clientX,currenty:e.clientY},{layer:r})}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0,width:0,height:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{e.getLayerFromQueue("selectionLayer"),t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),...t.getSharedVar("highlightColor")?{highlightColor:t.getSharedVar("highlightColor")}:{},...t.getSharedVar("highlightAttrValues")?{highlightAttrValues:t.getSharedVar("highlightAttrValues")}:{}}})}});A.register("BrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.setSharedVars({x:t.clientX,offsetx:t.offsetX,width:0,startx:t.clientX,startoffsetx:t.offsetX,currentx:t.clientX},{layer:e}),r.setSharedVar("startx",t.clientX),r.setSharedVar("startoffsetx",t.offsetX)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("startoffsetx"),i=Math.min(s,e.clientX),o=Math.min(a,e.offsetX),c=Math.abs(e.clientX-s);n.services.find("SelectionService").setSharedVars({x:i,offsetx:o,width:c,currentx:e.clientX},{layer:r}),n.setSharedVar("currentx",e.clientX),n.setSharedVar("currentoffsetx",e.offsetX),n.emit("brush",t)}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.setSharedVars({x:0,offsetx:0,width:0,currentx:e.clientX},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushYInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("RectSelectionService");n.setSharedVar("y",t.clientY,{layer:e}),n.setSharedVar("height",1,{layer:e}),n.setSharedVar("starty",t.clientY,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),r.setSharedVar("starty",t.clientY),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=r.services.find("SelectionService");i.setSharedVar("y",s,{layer:e}),i.setSharedVar("height",a,{layer:e}),i.setSharedVar("currenty",t.clientY,{layer:e}),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=(e.getGraphic().querySelector(".ig-layer-background")||e.getGraphic()).getBoundingClientRect();r.transformers.find("TransientRectangleTransformer").setSharedVars({y:s-i.top,height:a})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("y",0,{layer:e}),n.setSharedVar("height",0,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),n.setSharedVar("endy",t.clientY,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("x")??0,n=t.getSharedVar("width")??e._width,s=t.services.add("RectSelectionService",{layer:e}),a=e.getGraphic().getBoundingClientRect();s.setSharedVar("x",a.x+r),s.setSharedVar("width",n),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:0,y:0,width:n,height:0,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:{}}})}});A.register("HelperLineInstrument",{constructor:A,sharedVar:{orientation:["horizontal"]},interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.transformers.setSharedVars({x:t.offsetX,y:t.offsetY}),r.setSharedVar("x",t.offsetX,{}),r.setSharedVar("y",t.offsetY,{})}],click:[ne.initialize("Log",{execute(){}})]},preAttach:function(t,e){t.transformers.add("HelperLineTransformer",{layer:e.getLayerFromQueue("transientLayer"),sharedVar:{orientation:t.getSharedVar("orientation"),style:t.getSharedVar("style")||{},tooltip:t.getSharedVar("tooltip"),scaleX:t.getSharedVar("scaleX"),scaleY:t.getSharedVar("scaleY")}})}});A.register("DataBrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.getSharedVar("scaleY"),a=r.services.find("Quantitative2DSelectionService"),i=Ze(t,e.getGraphic());r.setSharedVar("layerOffsetX",t.clientX-i[0]),r.setSharedVar("layerOffsetY",t.clientY-i[1]),r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY);let o=[i[0],i[0]+1].map(n.invert);a.setSharedVar("extentX",o);let c=[i[1],i[1]+1].map(s.invert);a.setSharedVar("extentX",c),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,y:0,width:1,height:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("starty"),a=r.getSharedVar("layerOffsetX"),i=r.getSharedVar("layerOffsetY"),o=r.getSharedVar("scaleX"),c=r.getSharedVar("scaleY"),l=Math.min(n,t.clientX)-a,f=Math.min(s,t.clientY)-i,h=Math.abs(t.clientX-n),p=Math.abs(t.clientY-s);r.setSharedVar("x",l),r.setSharedVar("y",f),r.setSharedVar("width",h),r.setSharedVar("height",p);let m=[l,l+h].map(o.invert),x=[f+p,f].map(c.invert),_=r.services.find("SelectionService");_.setSharedVar("extentX",m),_.setSharedVar("extentY",x),console.log(_),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("x"),s=r.getSharedVar("y"),a=r.getSharedVar("width"),i=r.getSharedVar("height");r.transformers.find("TransientRectangleTransformer").setSharedVars({x:n,y:s,width:a,height:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:async(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("scaleY"),s=t.getSharedVar("attrNameX"),a=t.getSharedVar("extentX")??[0,0],i=a.map(r),o=t.getSharedVar("attrNameY"),c=t.getSharedVar("extentY")??[0,0],l=a.map(n).reverse(),f=t.services.add("Quantitative2DSelectionService",{layer:e});f.setSharedVar("attrNameX",s),f.setSharedVar("extentX",a),f.setSharedVar("attrNameY",o),f.setSharedVar("extentY",c),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:i[0],y:l[0],width:i[1]-i[0],height:l[1]-l[0],fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}}),await Promise.all(t.services.results)}});A.register("DataBrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.services.find("QuantitativeSelectionService"),a=Ze(t,e.getGraphic())[0];r.setSharedVar("layerOffsetX",t.clientX-a),r.setSharedVar("startx",t.clientX),r.setSharedVar("startLayerPosX",a);let i=[a,a+1].map(n.invert);s.setSharedVar("extent",i),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("layerOffsetX"),a=r.getSharedVar("scaleX"),i=Math.min(n,t.clientX),o=Math.abs(t.clientX-n),c=[i-s,i-s+o].map(a.invert),l=r.services.find("QuantitativeSelectionService");r.setSharedVar("extent",c),l.setSharedVar("extent",c),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("startLayerPosX"),s=Ze(t,e.getGraphic())[0];console.log(n,s);let a=Math.min(n,s),i=Math.abs(s-n);r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("height")??e._height,s=t.getSharedVar("y")??0,a=t.getSharedVar("attrNameX"),i=t.getSharedVar("extentX")??[0,0],o=i.map(r),c=t.services.add("QuantitativeSelectionService",{layer:e});c.setSharedVar("attrName",a),c.setSharedVar("extent",i),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:o[0],y:s,width:o[1]-o[0],height:n,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}})}});A.register("DragInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.setSharedVars({x:e.clientX,y:e.clientY,startx:e.clientX,starty:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,offset:{x:0,y:0},skipPicking:!1},{layer:t})}],drag:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t}),r.services.setSharedVars({x:e.clientX,y:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,offset:{x:n,y:s},skipPicking:!0},{layer:t})}],dragend:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.services.setSharedVars({x:0,y:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY,offsetx:0,offsety:0,offset:{x:0,y:0},skipPicking:!1},{layer:t}),r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t})},ne.initialize("Log",{execute(){}})],dragabort:[t=>{let{layer:e,event:r,instrument:n}=t;r.changedTouches&&(r=r.changedTouches[0]),n.services.setSharedVars({x:0,y:0,currentx:r.clientX,currenty:r.clientY,endx:0,endy:0,offsetx:0,offsety:0,skipPicking:!1},{layer:e}),n.emit("dragconfirm",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone")}})}});A.register("SpeechInstrument",{constructor:A,interactors:["SpeechControlInteractor"]});A.register("KeyboardHelperBarInstrument",{constructor:A,interactors:["KeyboardPositionInteractor"],on:{begin:[()=>console.log("begin")],left:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ma(a)[0]-n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}],right:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ma(a)[0]+n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}]},preAttach:function(t,e){e.getGraphic().setAttribute("tabindex",0),e.getGraphic().focus();let r=e._height,n=t.getSharedVar("startPos"),s=e.getLayerFromQueue("transientLayer"),a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",n),a.setAttribute("y1","0"),a.setAttribute("x2",n),a.setAttribute("y2",r),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1px"),s.getGraphic().append(a)}});A.register("PanInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY);let n=r.transformers;n.length||(n=Sr.findTransformerByLayer(t)),n.forEach(s=>{let a=s.getSharedVar("scaleX"),i=s.getSharedVar("scaleY");a&&s.setSharedVar("$$scaleX",a.copy()),i&&s.setSharedVar("$$scaleY",i.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers;s.length||(s=Sr.findTransformerByLayer(t));let a=r.getSharedVar("startx"),i=r.getSharedVar("starty"),o=r.getSharedVar("fixRange")??!1;s.forEach(c=>{let l=c.getSharedVar("scaleX"),f=c.getSharedVar("scaleY");if(o){if(l){let h=c.getSharedVar("$$scaleX"),x=h.range().map((_,v)=>_-e.clientX+a).map(_=>h.invert(_));l.domain(x),c.setSharedVar("scaleX",l)}if(f){let h=c.getSharedVar("$$scaleY"),x=h.range().map((_,v)=>_-e.clientY+i).map(_=>h.invert(_));f.domain(x),c.setSharedVar("scaleY",f)}}else{if(l){let p=c.getSharedVar("$$scaleX").range().map((m,x)=>m+e.clientX-a);l.range(p),c.setSharedVar("scaleX",l)}if(f){let p=c.getSharedVar("$$scaleY").range().map((m,x)=>m+e.clientY-i);f.range(p),c.setSharedVar("scaleY",f)}}})}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("PanXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.transformers.forEach(s=>{let a=s.getSharedVar("scaleX");a&&s.setSharedVar("$$scaleX",a.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers,a=r.getSharedVar("startx"),i=r.getSharedVar("fixRange")??!1;s.forEach(o=>{let c=o.getSharedVar("scaleX");if(i){if(c){let l=o.getSharedVar("$$scaleX"),p=l.range().map((m,x)=>m-e.clientX+a).map(m=>l.invert(m));c.domain(p),o.setSharedVar("scaleX",c)}}else if(c){let f=o.getSharedVar("$$scaleX").range().map((h,p)=>h+e.clientX-a);c.range(f),o.setSharedVar("scaleX",c)}})}],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("GeometricZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=Y(n),a=e.transformers;a.length||(a=Sr.findTransformerByLayer(t)),e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=Ze(r,n),f=e.getSharedVar("centroidX")||c,h=e.getSharedVar("centroidY")||l,p=e.getSharedVar("fixRange")??!1;a.forEach(m=>{let x=m.getSharedVar("scaleX"),_=m.getSharedVar("scaleY");if(p){if(x){if(x.type==="time"){let v=x.invert(f);x.domain(x.domain().map(V=>new Date(V.getTime()-v.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+v.getTime())))}else{let v=x.invert(f);x.domain(x.domain().map(V=>V-v).map(V=>V*Math.exp(-i)).map(V=>V+v))}a.forEach(v=>v.setSharedVar("scaleX",x))}if(_){if(_.type==="time"){let v=_.invert(h);_.domain(_.domain().map(V=>new Date(V.getTime()-v.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+v.getTime())))}else{let v=_.invert(h);_.domain(_.domain().map(V=>V-v).map(V=>V*Math.exp(-i)).map(V=>V+v))}a.forEach(v=>v.setSharedVar("scaleY",_))}}else{if(x){let v=x.range().map(V=>(V-f)*Math.exp(i)+f);x.range(v),m.setSharedVar("scaleX",x)}if(_){let v=_.range().map(V=>(V-h)*Math.exp(i)+h);_.range(v),m.setSharedVar("scaleY",_)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("SemanticZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],sharedVar:{currentLevel:0},on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=Y(n),a=e.transformers;a.length||(a=Sr.findTransformerByLayer(t));let i=e.getSharedVar("scaleLevels"),o=e.getSharedVar("currentLevel");if(o+=Math.sign(r.deltaY),e.setSharedVar("currentLevel",o),typeof i=="object"){let _=Object.keys(i).reduce(function(v,V){return Math.abs(parseInt(V)-o)<Math.abs(parseInt(v)-o)?V:v});a.forEach(v=>v.setSharedVars(i[_]))}e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let c=r.deltaY;e.setSharedVar("delta",c);let l=e.getSharedVar("cumulativeDelta",{defaultValue:0});l+=c,e.setSharedVar("cumulativeDelta",l),c/=1e3;let[f,h]=Ze(r,n),p=e.getSharedVar("centroidX")||f,m=e.getSharedVar("centroidY")||h,x=e.getSharedVar("fixRange")??!1;a.forEach(_=>{let v=_.getSharedVar("scaleX"),V=_.getSharedVar("scaleY");if(x){if(v){if(v.type==="time"){let E=v.invert(p);v.domain(v.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=v.invert(p);v.domain(v.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleX",v))}if(V){if(V.type==="time"){let E=V.invert(m);V.domain(V.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=V.invert(m);V.domain(V.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleY",V))}}else{if(v){let E=v.range().map(j=>(j-p)*Math.exp(c)+p);v.range(E),_.setSharedVar("scaleX",v)}if(V){let E=V.range().map(j=>(j-m)*Math.exp(c)+m);V.range(E),_.setSharedVar("scaleY",V)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]},postUse(t,e){let r=t.getSharedVar("scaleLevels"),n=t.transformers,s=t.getSharedVar("currentLevel");if(typeof r=="object"){let a=Object.keys(r).reduce(function(i,o){return Math.abs(parseInt(o)-s)<Math.abs(parseInt(i)-s)?o:i});n.setSharedVars(r[a])}}});A.register("ZoomXInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=Y(n),a=e.transformers;e.setSharedVar("currentx",r.offsetX);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=Ze(r,n),f=e.getSharedVar("centroidX")||c,h=e.getSharedVar("fixRange")??!1;a.forEach(p=>{let m=p.getSharedVar("scaleX");if(h){if(m){let x=m.invert(f);m.domain(m.domain().map(_=>_-x).map(_=>_*Math.exp(-i)).map(_=>_+x)),a.forEach(_=>_.setSharedVar("scaleX",m))}}else if(m){let x=m.range().map(_=>(_-f)*Math.exp(i)+f);m.range(x),p.setSharedVar("scaleX",m)}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}})});var pa,ga,Rn=d(()=>{Nt();Nt();hu();pa=wt,ga=A});var ya={};Ou(ya,{createHistoryTrrack:()=>kn,tryGetHistoryTrrackInstance:()=>du,tryRegisterDynamicInstance:()=>gp});async function kn(){let t=null,e=null,r=!1,n={traceStructure:(s=t)=>({recordList:[...s.record.keys()],children:s.children.map(a=>n.traceStructure(a)),current:s===e}),commit:async s=>{if(r)return;let a=new Map;for(let{component:o,fields:c}of[{list:ta,fields:["_state","_modalities"]},{list:pa,fields:["_sharedVar"]},{list:Ks,fields:["_sharedVar","_result","_oldResult"]},{list:Ws,fields:["_sharedVar"]}].flatMap(({list:l,fields:f})=>l.filter(h=>du(h)===n).map(h=>({component:h,fields:f}))))await o.results,a.set(o,Object.fromEntries(c.map(l=>[l,se(o[l])])));if(s&&s!="Log"){let o=c=>c.name==="Log"&&c.prev&&c.prev.children.length==1?(c.prev.children=[],o(c.prev)):c.name==="Log"&&c.prev?(c.prev.children.splice(c.prev.children.indexOf(c),1),o(c.prev)):c;e=o(e)}let i={name:s,record:a,prev:e,next:null,children:[]};e&&e.children.push(i),e=i},async undo(){if(e&&e.prev){e.prev.next=e;let s=e.prev.record;r=!0;for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=se(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.prev,r=!1}},async redo(){if(e&&e.children.length===1&&!e.next&&(e.next=e.children[0]),e&&e.next){let s=e.next.record;r=!0;try{for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=se(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.next}catch(a){console.error("Fail to redo history!",a);let i=e.record;for(let[o,c]of i.entries())Object.entries(c).forEach(([l,f])=>o[l]=se(f)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async jump(s=[]){let a=s.reduce((i,o)=>i?.children[o],t);if(a){let i=a.record;r=!0;try{for(let[o,c]of i.entries()){let l=null;"_sharedVar"in o&&o._sharedVar.layer&&(l=o._sharedVar.layer),Object.entries(c).forEach(([f,h])=>o[f]=se(h)),l&&"_sharedVar"in o&&!o._sharedVar.layer&&(o._sharedVar.layer=l),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=a}catch(o){console.error("Fail to jump history!",o);let c=e.record;for(let[l,f]of c.entries())Object.entries(f).forEach(([h,p])=>l[h]=se(p)),"_sharedVar"in f&&await l.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}else console.error(`History path [${s.join(", ")}] does not exist!`)}};return[Ks,Ws,mu,pa,ta].flatMap(s=>s).forEach(s=>{kr.has(s)||kr.set(s,n)}),await n.commit(),t=e,n}function du(t){let e=kr.get(t);return e||{traceStructure(){return null},async commit(){},async undo(){},async redo(){}}}function gp(t,e){let r=kr.get(t);r&&kr.set(e,r)}var kr,Or=d(()=>{Dt();Ue();qt();Rn();jr();ge();kr=new Map});function ve(t,e,r,n,s){return new Proxy(t,{get(a,i){if(i==="find")return function(o,c){if("initialize"in e){let l=a.filter(f=>f.isInstanceOf(o));if(l.length<=0&&c){let f=e.initialize(c);r(f),l.push(f),xa(s,f)}return ve(l,e,r,n,s)}else{let l=a.slice();return l.forEach(f=>{f.find(...arguments)}),ve(l,e,r,n,s)}};if(i==="add")return(...o)=>{let c=a.slice();if("initialize"in e){let l=e.initialize(...o);return r(l),c.push(l),xa(s,l),ve(c,e,r,n,s)}else return c.forEach(l=>{l.add(...o)}),ve(c,e,r,n,s)};if(i==="remove")return o=>{if(e===On){let c=a.slice();return c.forEach(l=>{l.remove(o)}),ve(c,e,r,n,s)}else{let c=a.slice();return c.filter(f=>f.isInstanceOf(o)).forEach(f=>{n(f),c.splice(c.indexOf(f),1)}),ve(c,e,r,n,s)}};if(i in a&&i!=="join"&&i!=="filter")return a[i];if(a.length)return a[0][i]instanceof Function?function(){return ve(a.map(o=>o[i].apply(o,arguments)),On,()=>{},()=>{},s)}:ve(a.map(o=>o[i]),On,()=>{},()=>{},s);{let o=()=>{};return o[Symbol.iterator]=function*(){},o}}})}function ma(t){try{return t.getAttribute("transform").split("(")[1].split(")")[0].split(",").map(r=>parseFloat(r))}catch(e){return[0,0]}}function Tn(t){return xu(t.trim()).map(_a)}function jp(t){return Vp.hasOwnProperty(t)}function Dr(t,e,r,n,s){let a=0,i,o=t.length;for(;e<o;++e){if(i=t[e],!a&&i===r)return e;s&&s.indexOf(i)>=0?--a:n&&n.indexOf(i)>=0&&++a}return e}function xu(t){let e=[],r=t.length,n=0,s=0;for(;s<r;)s=Dr(t,s,yu,Dn+pu,Ln+gu),e.push(t.substring(n,s).trim()),n=++s;if(e.length===0)throw"Empty event selector: "+t;return e}function _a(t){return t[0]==="["?Tp(t):Ip(t)}function Tp(t){let e=t.length,r=1,n,s;if(r=Dr(t,r,Ln,Dn,Ln),r===e)throw"Empty between selector: "+t;if(n=xu(t.substring(1,r)),n.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(r+1).trim(),t[0]!==vp)throw"Expected '>' after between selector: "+t;let a=n.map(_a);return s=_a(t.slice(1).trim()),s.between?{between:a,stream:s}:(s.between=a,s)}function Ip(t){let e={source:Sp,type:""},r=[],n=[0,0],s=0,a=0,i=t.length,o=0,c,l;if(t[i-1]===gu){if(o=t.lastIndexOf(pu),o>=0){try{n=Ep(t.substring(o+1,i-1))}catch(f){throw"Invalid throttle specification: "+t}t=t.slice(0,o).trim(),i=t.length}else throw"Unmatched right brace: "+t;o=0}if(!i)throw t;if(t[0]===_p&&(s=++o),c=Dr(t,o,xp),c<i&&(r.push(t.substring(a,c).trim()),a=o=++c),o=Dr(t,o,Dn),o===i)r.push(t.substring(a,i).trim());else if(r.push(t.substring(a,o).trim()),l=[],a=++o,a===i)throw"Unmatched left bracket: "+t;for(;o<i;){if(o=Dr(t,o,Ln),o===i)throw"Unmatched left bracket: "+t;if(l.push(t.substring(a,o).trim()),o<i-1&&t[++o]!==Dn)throw"Expected left bracket: "+t;a=++o}if(!(i=r.length)||wp.test(r[i-1]))throw"Invalid event selector: "+t;return i>1?(e.type=r[1],s?e.markname=r[0].slice(1):jp(r[0])?e.marktype=r[0]:e.source=r[0]):e.type=r[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),l!=null&&(e.filter=l),n[0]&&(e.throttle=n[0]),n[1]&&(e.debounce=n[1]),e}function Ep(t){let e=t.split(yu);if(!t.length||e.length>2)throw t;return e.map(function(r){let n=+r;if(n!==n)throw t;return n})}function se(t){if(t&&t instanceof Object&&"copy"in t&&t.copy instanceof Function){let r=t.copy();for(let n in Object.getOwnPropertyDescriptors(t))n in r||(r[n]=t[n]);return r}if(t instanceof Array)return t.map(se);if(["string","number","boolean","undefined","bigint","symbol","function"].includes(typeof t))return t;if(t===null)return null;if(_e in t&&t[_e])return t;if(t instanceof Node){let r=t.cloneNode(!0);return Object.assign(r,t),r}let e=Object.fromEntries(Object.entries(t).map(([r,n])=>[r,se(n)]));return Object.assign(Object.create(Object.getPrototypeOf(t)),e)}var _e,te,U,rt,On,xa,yp,Dn,Ln,pu,gu,xp,yu,_p,vp,wp,Sp,bp,Vp,Ya,ge=d(()=>{_e=Symbol("Libra");(function(t){t[t.Shape=0]="Shape",t[t.Data=1]="Data",t[t.Attr=2]="Attr"})(te||(te={}));(function(t){t[t.SurfacePoint=0]="SurfacePoint",t[t.Point=1]="Point",t[t.Circle=2]="Circle",t[t.Rect=3]="Rect",t[t.Polygon=4]="Polygon"})(U||(U={}));(function(t){t[t.Quantitative=0]="Quantitative",t[t.Nominal=1]="Nominal",t[t.Temporal=2]="Temporal"})(rt||(rt={}));On=class{},xa=(...t)=>{};yp="view",Dn="[",Ln="]",pu="{",gu="}",xp=":",yu=",",_p="@",vp=">",wp=/[[\]{}]/,Sp=yp,bp={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Vp=bp;Ya={stopTransient:!1};Promise.resolve().then(()=>(Or(),ya)).then(t=>{xa=t.tryRegisterDynamicInstance})});var _u,vu,va,Pn,ne,Ap,XV,Cp,Mp,Mn=d(()=>{ge();va={},Pn=[],ne=class{constructor(e,r){this[_u]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._feedback=r.feedback??[],this._undo=r.undo??null,this._redo=r.redo??null,this._execute=r.execute??null,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preExecute=r.preExecute??null,this._postExecute=r.postExecute??null,r.postInitialize&&r.postInitialize.call(this,this)}undo(){this._undo&&this._undo.call(this)}redo(){this._redo&&this._redo.call(this)}async execute(e){try{this.preExecute(),this._execute&&await this._execute.call(this,e),this.postExecute();for(let r of this._feedback)await r.call(this,e);await vu(this).commit(this._name)}catch(r){console.error(r)}}preExecute(){this._preExecute&&this._preExecute.call(this,this)}postExecute(){this._postExecute&&this._postExecute.call(this,this)}isInstanceOf(e){return this._baseName===e||this._name===e}static register(e,r){va[e]=r}static unregister(e){return delete va[e],!0}static initialize(e,r){let n=Object.assign({constructor:ne},va[e]??{},r??{}),s=new n.constructor(e,n);return Pn.push(s),s}static findCommand(e){return Pn.filter(r=>r.isInstanceOf(e))}};_u=_e;Ap=ne.register,XV=ne.unregister,Cp=ne.initialize,Mp=ne.findCommand;Promise.resolve().then(()=>(Or(),ya)).then(t=>{vu=t.tryGetHistoryTrrackInstance})});var mu,Fe,qt=d(()=>{Mn();Mn();mu=Pn,Fe=ne});qt();Rn();jr();Mr();Dt();Or();Ue();Nt();Nt();Mr();Dt();Ue();Vr();Zs();ge();qt();var Lr={},Gt=class{static build(e){if(!(e.inherit in ze)&&!(e.inherit in Lr))throw new Error(`Interaction ${e.inherit} is not registered, please register it first`);let r;if(e.inherit in ze){let a=Object.assign({constructor:A},ze[e.inherit],{sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},ze[e.inherit].sharedVar??{},e.sharedVar??{})});e.layers&&(a.layers=e.layers),r=new a.constructor(e.inherit,a),wt.push(r)}else{let a=Object.assign({},Lr[e.inherit],e,{inherit:Lr[e.inherit].inherit,sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},Lr[e.inherit].sharedVar??{},e.sharedVar??{})});r=Gt.build(a),wt.push(r)}if(e.name&&(Lr[e.name]=e,!e.layers||!e.layers.length))return;let n=(a,i)=>{if(a instanceof A){let o=a._serviceInstances.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a._serviceInstances){let f=n(l,i);if(f)return f}}else{let o=a._services.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a.services){let f=n(l,i);if(f)return f}}return[void 0,void 0]},s=(a,i)=>{if(a.isInstanceOf(i))return a;if(a instanceof A){let o=a._serviceInstances.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a._serviceInstances){let l=s(c,i);if(l)return l}}else{let o=a._services.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a.services){let l=s(c,i);if(l)return l}}};if(e.remove)for(let a of e.remove)for(;;){let[i,o]=n(r,a.find);if(!i)break;let c=o instanceof A?o._serviceInstances:o._services;a.cascade?i instanceof Z?c.splice(c.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1):i instanceof Z?(c.splice(c.indexOf(i),1,...i._services),o._transformers.push(...i._transformers)):o._transformers.splice(o._transformers.indexOf(i),1)}if(e.override)for(let a of e.override)if(a.find.endsWith("Interactor")){let i=[...r._layerInteractors.values()],o=i.map(c=>c.filter(l=>l.isInstanceOf(a.find)));a.comp?o.forEach((c,l)=>{c.forEach(f=>{let h=z.initialize(a.comp);h&&i[l].splice(i[l].indexOf(f),1,h)})}):a.actions&&o.forEach(c=>{c.forEach(l=>{l._actions=se(a.actions).map(ea)})})}else{let[i,o]=n(r,a.find);if(!i)continue;let c;if(a.comp.includes("Transformer")){let f;a.name&&H.findTransformer(a.name).length>0&&(f=H.findTransformer(a.name)[0]),f||(f=H.initialize(a.comp,{name:a.name,sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),c=f}else if(a.comp.includes("Service")){let f;a.name&&Z.findService(a.name).length>0&&(f=Z.findService(a.name)[0]),f||(f=Z.initialize(a.comp,{...a,services:[...a.services||[],...i instanceof Z?i._services:[]],transformers:[...a.transformers||[],...i instanceof Z?i._transformers:[]],sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),a.dimension&&f.isInstanceOf("SelectionService")&&(f=f.dimension(a.dimension),a.layers&&(f._layerInstances=a.layers.slice(0)),a.sharedVar&&f.setSharedVars(a.sharedVar)),c=f}let l=o instanceof A?o._serviceInstances:o._services;i instanceof Z?l.splice(l.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1),a.comp.includes("Transformer")?o._transformers.push(c):l.push(c)}if(e.insert)for(let a of e.insert){let i=s(r,a.find);if(!i)continue;let o=null,c=null;for(let l=a.flow.length-1;l>=0;l--){let f=a.flow[l];if(f instanceof Function){let h=[],p=null;for(let m=0;m<e.layers?.length;m++){let x=e.layers[m],_=f(x,m);if(_.comp.includes("Transformer")){let v;_.name&&H.findTransformer(_.name).length>0&&(v=H.findTransformer(_.name)[0]),v||(v=H.initialize(_.comp,{..._,sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),h.push(v),p="Transformer"}else if(_.comp.includes("Service")){let v;_.name&&Z.findService(_.name).length>0&&(v=Z.findService(_.name)[0]),v||(v=Z.initialize(_.comp,{..._,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),_.dimension&&v instanceof Ve&&(v=v.dimension(_.dimension),_.layers&&(v._layerInstances=_.layers.slice(0)),_.sharedVar&&v.setSharedVars(_.sharedVar)),h.push(v),p="Service"}}o=h,c=p}else if(f instanceof Array){let h=[],p=null;for(let m=0;m<f.length;m++){let x=f[m];if(x instanceof H)h.push(x),p="Transformer";else if(x instanceof Z)c=="Transformer"?x._transformers.push(...o instanceof Array?o:[o]):x._services.push(...o instanceof Array?o:[o]),h.push(x),p="Service";else if(x.comp.includes("Transformer")){let _;x.name&&H.findTransformer(x.name).length>0&&(_=H.findTransformer(x.name)[0]),_||(_=H.initialize(x.comp,{...x,sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),h.push(_),p="Transformer"}else if(x.comp.includes("Service")){let _;x.name&&Z.findService(x.name).length>0&&(_=Z.findService(x.name)[0]),_||(_=Z.initialize(x.comp,{...x,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),x.dimension&&_ instanceof Ve&&(_=_.dimension(x.dimension),x.layers&&(_._layerInstances=x.layers.slice(0)),x.sharedVar&&_.setSharedVars(x.sharedVar)),h.push(_),p="Service"}}o=h,c=p}else if(f instanceof H)o=f,c="Transformer";else if(f instanceof Z)c=="Transformer"?f._transformers.push(...o instanceof Array?o:[o]):f._services.push(...o instanceof Array?o:[o]),o=f,c="Service";else if(f instanceof Fe)c=="Service"&&(o instanceof Array?o.forEach(h=>h._command.push(f)):o._command.push(f));else if(f.comp.includes("Transformer")){let h;f.name&&H.findTransformer(f.name).length>0&&(h=H.findTransformer(f.name)[0]),h||(h=H.initialize(f.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof Xe?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...f,sharedVar:{...e.sharedVar||{},...f.sharedVar||{}}})),o=h,c="Transformer"}else if(f.comp.includes("Service")){let h;f.name&&Z.findService(f.name).length>0&&(h=Z.findService(f.name)[0]),h||(h=Z.initialize(f.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof Xe?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...f,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...f.sharedVar||{}}})),f.dimension&&h.isInstanceOf("SelectionService")&&(h=h.dimension(f.dimension),f.layers&&(h._layerInstances=f.layers.slice(0)),f.sharedVar&&h.setSharedVars(f.sharedVar)),o=h,c="Service"}}o&&(c=="Transformer"?o instanceof Array?i._transformers.push(...o):i._transformers.push(o):i instanceof A?o instanceof Array?i._serviceInstances.push(...o):i._serviceInstances.push(o):o instanceof Array?i._services.push(...o):i._services.push(o))}return r}};qt();Rn();jr();Mr();Dt();Or();Ue();var cj={Command:Fe,Instrument:ga,Interactor:Be,Layer:Xe,Service:Z,createHistoryTrrack:kn,GraphicalTransformer:H,Interaction:Gt};export{Fe as Command,H as GraphicalTransformer,ga as Instrument,Gt as Interaction,Be as Interactor,Xe as Layer,Z as Service,kn as createHistoryTrrack,cj as default};
