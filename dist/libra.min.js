var ka=Object.defineProperty;var Au=t=>ka(t,"__esModule",{value:!0});var d=(t,e)=>()=>(t&&(e=t(t=0)),e);var Cu=(t,e)=>{Au(t);for(var r in e)ka(t,r,{get:e[r],enumerable:!0})};var Oa,Yr,Vt,Zn,La,J,Mu,Dp,Ru,ku,Xr=d(()=>{ge();Yr={},Vt=[],Zn=[],La=()=>{let t;for(;t=Zn.pop();)try{t.remove()}catch(e){}Pa.stopTransient||Vt.filter(e=>e._transient).forEach(e=>e.redraw()),requestAnimationFrame(La)};requestAnimationFrame(La);J=class{constructor(e,r){this[Oa]=!0,this._baseName=e,this._userOptions=r,this._name=r.name??this._baseName,this._sharedVar=r.sharedVar??{},this._redraw=r.redraw??(()=>{}),this._layer=r.layer,this._transient=r.transient??!1;try{this.redraw()}catch(n){}}getSharedVar(e){return this._sharedVar[e]}setSharedVar(e,r){this._sharedVar[e]=r,this.redraw()}setSharedVars(e){Object.entries(e).forEach(([r,n])=>this._sharedVar[r]=n),this.redraw()}redraw(e=!1){if(!this._layer&&!this.getSharedVar("layer"))return;let r=this._layer||this.getSharedVar("layer");e=e||this._transient;let n=[],s=[],a=new Set([r]);e&&(n=r.getVisualElements(),r._getLayerFromQueue||(r._getLayerFromQueue=r.getLayerFromQueue,r.getLayerFromQueue=function(){let i=r._getLayerFromQueue(...arguments);return n=n.concat(i.getVisualElements()),a.add(i),i})),this._redraw({layer:r,transformer:this}),e&&(r.getLayerFromQueue=r._getLayerFromQueue,delete r._getLayerFromQueue,a.forEach(i=>{s=s.concat(Array.prototype.slice.call(i.getGraphic()?.childNodes??[]));let o=s.filter(c=>!n.includes(c));Zn=Zn.concat(o)}))}isInstanceOf(e){return this._baseName===e||this._name===e||(this._userOptions.className??[]).includes(e)}static register(e,r){Yr[e]=r}static unregister(e){return delete Yr[e],!0}static initialize(e,r){let n=Object.assign({constructor:J},Yr[e]??{},r??{},{sharedVar:Object.assign({},(Yr[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return Vt.push(s),s}static findTransformer(e){return Vt.filter(r=>r.isInstanceOf(e))}static findTransformerByLayer(e){return Vt.filter(r=>r._layer===e||r.getSharedVar("layer")===e)}};Oa=_e;Mu=J.register,Dp=J.unregister,Ru=J.initialize,ku=J.findTransformer});var Da=d(()=>{});var Ya=d(()=>{});var Xa=d(()=>{});function za(){for(var t=0,e=arguments.length,r={},n;t<e;++t){if(!(n=arguments[t]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new zr(r)}function zr(t){this._=t}function Lu(t,e){return t.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function Pu(t,e){for(var r=0,n=t.length,s;r<n;++r)if((s=t[r]).name===e)return s.value}function Fa(t,e,r){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=Ou,t=t.slice(0,n).concat(t.slice(n+1));break}return r!=null&&t.push({name:e,value:r}),t}var Ou,Kn,Na=d(()=>{Ou={value:()=>{}};zr.prototype=za.prototype={constructor:zr,on:function(t,e){var r=this._,n=Lu(t+"",r),s,a=-1,i=n.length;if(arguments.length<2){for(;++a<i;)if((s=(t=n[a]).type)&&(s=Pu(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<i;)if(s=(t=n[a]).type)r[s]=Fa(r[s],t.name,e);else if(e==null)for(s in r)r[s]=Fa(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new zr(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,a;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,s=a.length;n<s;++n)a[n].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,a=n.length;s<a;++s)n[s].value.apply(e,r)}};Kn=za});var Jn=d(()=>{Na()});var Fr,es,ts=d(()=>{Fr="http://www.w3.org/1999/xhtml",es={svg:"http://www.w3.org/2000/svg",xhtml:Fr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function Fe(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),es.hasOwnProperty(e)?{space:es[e],local:t}:t}var Nr=d(()=>{ts()});function Du(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===Fr&&e.documentElement.namespaceURI===Fr?e.createElement(t):e.createElementNS(r,t)}}function Yu(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function qr(t){var e=Fe(t);return(e.local?Yu:Du)(e)}var rs=d(()=>{Nr();ts()});function Xu(){}function at(t){return t==null?Xu:function(){return this.querySelector(t)}}var Gr=d(()=>{});function qa(t){typeof t!="function"&&(t=at(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=new Array(i),c,l,f=0;f<i;++f)(c=a[f])&&(l=t.call(c,c.__data__,f,a))&&("__data__"in c&&(l.__data__=c.__data__),o[f]=l);return new Q(n,this._parents)}var Ga=d(()=>{Te();Gr()});function jt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}var Ur=d(()=>{});function zu(){return[]}function $t(t){return t==null?zu:function(){return this.querySelectorAll(t)}}var ns=d(()=>{});function Fu(t){return function(){var e=t.apply(this,arguments);return e==null?[]:jt(e)}}function Ua(t){typeof t=="function"?t=Fu(t):t=$t(t);for(var e=this._groups,r=e.length,n=[],s=[],a=0;a<r;++a)for(var i=e[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&(n.push(t.call(c,c.__data__,l,i)),s.push(c));return new Q(n,s)}var $a=d(()=>{Te();Ur();ns()});function Bt(t){return function(){return this.matches(t)}}function $r(t){return function(e){return e.matches(t)}}var Qt=d(()=>{});function qu(t){return function(){return Nu.call(this.children,t)}}function Gu(){return this.firstElementChild}function Ba(t){return this.select(t==null?Gu:qu(typeof t=="function"?t:$r(t)))}var Nu,Qa=d(()=>{Qt();Nu=Array.prototype.find});function $u(){return this.children}function Bu(t){return function(){return Uu.call(this.children,t)}}function Ha(t){return this.selectAll(t==null?$u:Bu(typeof t=="function"?t:$r(t)))}var Uu,Wa=d(()=>{Qt();Uu=Array.prototype.filter});function Za(t){typeof t!="function"&&(t=Bt(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new Q(n,this._parents)}var Ka=d(()=>{Te();Qt()});function Br(t){return new Array(t.length)}var ss=d(()=>{});function Ja(){return new Q(this._enter||this._groups.map(Br),this._parents)}function Ht(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}var as=d(()=>{ss();Te();Ht.prototype={constructor:Ht,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}}});function ei(t){return function(){return t}}var ti=d(()=>{});function Qu(t,e,r,n,s,a){for(var i=0,o,c=e.length,l=a.length;i<l;++i)(o=e[i])?(o.__data__=a[i],n[i]=o):r[i]=new Ht(t,a[i]);for(;i<c;++i)(o=e[i])&&(s[i]=o)}function Hu(t,e,r,n,s,a,i){var o,c,l=new Map,f=e.length,h=a.length,m=new Array(f),g;for(o=0;o<f;++o)(c=e[o])&&(m[o]=g=i.call(c,c.__data__,o,e)+"",l.has(g)?s[o]=c:l.set(g,c));for(o=0;o<h;++o)g=i.call(t,a[o],o,a)+"",(c=l.get(g))?(n[o]=c,c.__data__=a[o],l.delete(g)):r[o]=new Ht(t,a[o]);for(o=0;o<f;++o)(c=e[o])&&l.get(m[o])===c&&(s[o]=c)}function Wu(t){return t.__data__}function ri(t,e){if(!arguments.length)return Array.from(this,Wu);var r=e?Hu:Qu,n=this._parents,s=this._groups;typeof t!="function"&&(t=ei(t));for(var a=s.length,i=new Array(a),o=new Array(a),c=new Array(a),l=0;l<a;++l){var f=n[l],h=s[l],m=h.length,g=jt(t.call(f,f&&f.__data__,l,n)),_=g.length,x=o[l]=new Array(_),w=i[l]=new Array(_),V=c[l]=new Array(m);r(f,h,x,w,V,g,e);for(var E=0,j=0,W,M;E<_;++E)if(W=x[E]){for(E>=j&&(j=E+1);!(M=w[j])&&++j<_;);W._next=M||null}}return i=new Q(i,n),i._enter=o,i._exit=c,i}var ni=d(()=>{Te();as();Ur();ti()});function si(){return new Q(this._exit||this._groups.map(Br),this._parents)}var ai=d(()=>{ss();Te()});function ii(t,e,r){var n=this.enter(),s=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(s=e(s)),r==null?a.remove():r(a),n&&s?n.merge(s).order():s}var oi=d(()=>{});function ci(t){if(!(t instanceof Q))throw new Error("invalid merge");for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],f=c.length,h=i[o]=new Array(f),m,g=0;g<f;++g)(m=c[g]||l[g])&&(h[g]=m);for(;o<n;++o)i[o]=e[o];return new Q(i,this._parents)}var li=d(()=>{Te()});function fi(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var n=t[e],s=n.length-1,a=n[s],i;--s>=0;)(i=n[s])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}var ui=d(()=>{});function hi(t){t||(t=Zu);function e(h,m){return h&&m?t(h.__data__,m.__data__):!h-!m}for(var r=this._groups,n=r.length,s=new Array(n),a=0;a<n;++a){for(var i=r[a],o=i.length,c=s[a]=new Array(o),l,f=0;f<o;++f)(l=i[f])&&(c[f]=l);c.sort(e)}return new Q(s,this._parents).order()}function Zu(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var di=d(()=>{Te()});function mi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}var pi=d(()=>{});function gi(){return Array.from(this)}var yi=d(()=>{});function xi(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length;s<a;++s){var i=n[s];if(i)return i}return null}var _i=d(()=>{});function vi(){let t=0;for(let e of this)++t;return t}var wi=d(()=>{});function Si(){return!this.node()}var bi=d(()=>{});function Vi(t){for(var e=this._groups,r=0,n=e.length;r<n;++r)for(var s=e[r],a=0,i=s.length,o;a<i;++a)(o=s[a])&&t.call(o,o.__data__,a,s);return this}var ji=d(()=>{});function Ku(t){return function(){this.removeAttribute(t)}}function Ju(t){return function(){this.removeAttributeNS(t.space,t.local)}}function eh(t,e){return function(){this.setAttribute(t,e)}}function th(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function rh(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function nh(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function Ti(t,e){var r=Fe(t);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((e==null?r.local?Ju:Ku:typeof e=="function"?r.local?nh:rh:r.local?th:eh)(r,e))}var Ii=d(()=>{Nr()});function Qr(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}var is=d(()=>{});function sh(t){return function(){this.style.removeProperty(t)}}function ah(t,e,r){return function(){this.style.setProperty(t,e,r)}}function ih(t,e,r){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,r)}}function Ei(t,e,r){return arguments.length>1?this.each((e==null?sh:typeof e=="function"?ih:ah)(t,e,r??"")):He(this.node(),t)}function He(t,e){return t.style.getPropertyValue(e)||Qr(t).getComputedStyle(t,null).getPropertyValue(e)}var os=d(()=>{is()});function oh(t){return function(){delete this[t]}}function ch(t,e){return function(){this[t]=e}}function lh(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function Ai(t,e){return arguments.length>1?this.each((e==null?oh:typeof e=="function"?lh:ch)(t,e)):this.node()[t]}var Ci=d(()=>{});function Mi(t){return t.trim().split(/^|\s+/)}function cs(t){return t.classList||new Ri(t)}function Ri(t){this._node=t,this._names=Mi(t.getAttribute("class")||"")}function ki(t,e){for(var r=cs(t),n=-1,s=e.length;++n<s;)r.add(e[n])}function Oi(t,e){for(var r=cs(t),n=-1,s=e.length;++n<s;)r.remove(e[n])}function fh(t){return function(){ki(this,t)}}function uh(t){return function(){Oi(this,t)}}function hh(t,e){return function(){(e.apply(this,arguments)?ki:Oi)(this,t)}}function Li(t,e){var r=Mi(t+"");if(arguments.length<2){for(var n=cs(this.node()),s=-1,a=r.length;++s<a;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?hh:e?fh:uh)(r,e))}var Pi=d(()=>{Ri.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}}});function dh(){this.textContent=""}function mh(t){return function(){this.textContent=t}}function ph(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Di(t){return arguments.length?this.each(t==null?dh:(typeof t=="function"?ph:mh)(t)):this.node().textContent}var Yi=d(()=>{});function gh(){this.innerHTML=""}function yh(t){return function(){this.innerHTML=t}}function xh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Xi(t){return arguments.length?this.each(t==null?gh:(typeof t=="function"?xh:yh)(t)):this.node().innerHTML}var zi=d(()=>{});function _h(){this.nextSibling&&this.parentNode.appendChild(this)}function Fi(){return this.each(_h)}var Ni=d(()=>{});function vh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qi(){return this.each(vh)}var Gi=d(()=>{});function Ui(t){var e=typeof t=="function"?t:qr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}var $i=d(()=>{rs()});function wh(){return null}function Bi(t,e){var r=typeof t=="function"?t:qr(t),n=e==null?wh:typeof e=="function"?e:at(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var Qi=d(()=>{rs();Gr()});function Sh(){var t=this.parentNode;t&&t.removeChild(this)}function Hi(){return this.each(Sh)}var Wi=d(()=>{});function bh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Vh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Zi(t){return this.select(t?Vh:bh)}var Ki=d(()=>{});function Ji(t){return arguments.length?this.property("__data__",t):this.node().__data__}var eo=d(()=>{});function jh(t){return function(e){t.call(this,e,this.__data__)}}function Th(t){return t.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");return n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),{type:e,name:r}})}function Ih(t){return function(){var e=this.__on;if(!!e){for(var r=0,n=-1,s=e.length,a;r<s;++r)a=e[r],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++n]=a;++n?e.length=n:delete this.__on}}}function Eh(t,e,r){return function(){var n=this.__on,s,a=jh(e);if(n){for(var i=0,o=n.length;i<o;++i)if((s=n[i]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=r),s.value=e;return}}this.addEventListener(t.type,a,r),s={type:t.type,name:t.name,value:e,listener:a,options:r},n?n.push(s):this.__on=[s]}}function to(t,e,r){var n=Th(t+""),s,a=n.length,i;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,l=o.length,f;c<l;++c)for(s=0,f=o[c];s<a;++s)if((i=n[s]).type===f.type&&i.name===f.name)return f.value}return}for(o=e?Eh:Ih,s=0;s<a;++s)this.each(o(n[s],e,r));return this}var ro=d(()=>{});function no(t,e,r){var n=Qr(t),s=n.CustomEvent;typeof s=="function"?s=new s(e,r):(s=n.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function Ah(t,e){return function(){return no(this,t,e)}}function Ch(t,e){return function(){return no(this,t,e.apply(this,arguments))}}function so(t,e){return this.each((typeof e=="function"?Ch:Ah)(t,e))}var ao=d(()=>{is()});function*io(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length,i;s<a;++s)(i=n[s])&&(yield i)}var oo=d(()=>{});function Q(t,e){this._groups=t,this._parents=e}function co(){return new Q([[document.documentElement]],Wt)}function Mh(){return this}var Wt,Ne,Te=d(()=>{Ga();$a();Qa();Wa();Ka();ni();as();ai();oi();li();ui();di();pi();yi();_i();wi();bi();ji();Ii();os();Ci();Pi();Yi();zi();Ni();Gi();$i();Qi();Wi();Ki();eo();ro();ao();oo();Wt=[null];Q.prototype=co.prototype={constructor:Q,select:qa,selectAll:Ua,selectChild:Ba,selectChildren:Ha,filter:Za,data:ri,enter:Ja,exit:si,join:ii,merge:ci,selection:Mh,order:fi,sort:hi,call:mi,nodes:gi,node:xi,size:vi,empty:Si,each:Vi,attr:Ti,style:Ei,property:Ai,classed:Li,text:Di,html:Xi,raise:Fi,lower:qi,append:Ui,insert:Bi,remove:Hi,clone:Zi,datum:Ji,on:to,dispatch:so,[Symbol.iterator]:io};Ne=co});function X(t){return typeof t=="string"?new Q([[document.querySelector(t)]],[document.documentElement]):new Q([[t]],Wt)}var lo=d(()=>{Te()});function fo(t){let e;for(;e=t.sourceEvent;)t=e;return t}var uo=d(()=>{});function We(t,e){if(t=fo(t),e===void 0&&(e=t.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}var ho=d(()=>{uo()});function Ie(t){return typeof t=="string"?new Q([document.querySelectorAll(t)],[document.documentElement]):new Q([t==null?[]:jt(t)],Wt)}var mo=d(()=>{Ur();Te()});var Ce=d(()=>{Qt();Nr();ho();lo();mo();Te();Gr();ns();os()});var po=d(()=>{});function Hr(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function ls(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}var go=d(()=>{});function Zt(){}function xo(){return this.rgb().formatHex()}function Xh(){return Vo(this).formatHsl()}function _o(){return this.rgb().formatRgb()}function Ze(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Rh.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?vo(e):r===3?new be(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Zr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Zr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=kh.exec(t))?new be(e[1],e[2],e[3],1):(e=Oh.exec(t))?new be(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Lh.exec(t))?Zr(e[1],e[2],e[3],e[4]):(e=Ph.exec(t))?Zr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Dh.exec(t))?bo(e[1],e[2]/100,e[3]/100,1):(e=Yh.exec(t))?bo(e[1],e[2]/100,e[3]/100,e[4]):yo.hasOwnProperty(t)?vo(yo[t]):t==="transparent"?new be(NaN,NaN,NaN,0):null}function vo(t){return new be(t>>16&255,t>>8&255,t&255,1)}function Zr(t,e,r,n){return n<=0&&(t=e=r=NaN),new be(t,e,r,n)}function zh(t){return t instanceof Zt||(t=Ze(t)),t?(t=t.rgb(),new be(t.r,t.g,t.b,t.opacity)):new be}function It(t,e,r,n){return arguments.length===1?zh(t):new be(t,e,r,n??1)}function be(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}function wo(){return"#"+fs(this.r)+fs(this.g)+fs(this.b)}function So(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function fs(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function bo(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Pe(t,e,r,n)}function Vo(t){if(t instanceof Pe)return new Pe(t.h,t.s,t.l,t.opacity);if(t instanceof Zt||(t=Ze(t)),!t)return new Pe;if(t instanceof Pe)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(e,r,n),a=Math.max(e,r,n),i=NaN,o=a-s,c=(a+s)/2;return o?(e===a?i=(r-n)/o+(r<n)*6:r===a?i=(n-e)/o+2:i=(e-r)/o+4,o/=c<.5?a+s:2-a-s,i*=60):o=c>0&&c<1?0:i,new Pe(i,o,c,t.opacity)}function jo(t,e,r,n){return arguments.length===1?Vo(t):new Pe(t,e,r,n??1)}function Pe(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}function us(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var Kt,Wr,Tt,Jt,Le,Rh,kh,Oh,Lh,Ph,Dh,Yh,yo,To=d(()=>{go();Kt=.7,Wr=1/Kt,Tt="\\s*([+-]?\\d+)\\s*",Jt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Le="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Rh=/^#([0-9a-f]{3,8})$/,kh=new RegExp("^rgb\\("+[Tt,Tt,Tt]+"\\)$"),Oh=new RegExp("^rgb\\("+[Le,Le,Le]+"\\)$"),Lh=new RegExp("^rgba\\("+[Tt,Tt,Tt,Jt]+"\\)$"),Ph=new RegExp("^rgba\\("+[Le,Le,Le,Jt]+"\\)$"),Dh=new RegExp("^hsl\\("+[Jt,Le,Le]+"\\)$"),Yh=new RegExp("^hsla\\("+[Jt,Le,Le,Jt]+"\\)$"),yo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Hr(Zt,Ze,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:xo,formatHex:xo,formatHsl:Xh,formatRgb:_o,toString:_o});Hr(be,It,ls(Zt,{brighter:function(t){return t=t==null?Wr:Math.pow(Wr,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?Kt:Math.pow(Kt,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wo,formatHex:wo,formatRgb:So,toString:So}));Hr(Pe,jo,ls(Zt,{brighter:function(t){return t=t==null?Wr:Math.pow(Wr,t),new Pe(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?Kt:Math.pow(Kt,t),new Pe(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,s=2*r-n;return new be(us(t>=240?t-240:t+120,s,n),us(t,s,n),us(t<120?t+240:t-120,s,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}))});var Kr=d(()=>{To()});function hs(t,e,r,n,s){var a=t*t,i=a*t;return((1-3*t+3*a-i)*e+(4-6*a+3*i)*r+(1+3*t+3*a-3*i)*n+i*s)/6}function Io(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),s=t[n],a=t[n+1],i=n>0?t[n-1]:2*s-a,o=n<e-1?t[n+2]:2*a-s;return hs((r-n/e)*e,i,s,a,o)}}var ds=d(()=>{});function Eo(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),s=t[(n+e-1)%e],a=t[n%e],i=t[(n+1)%e],o=t[(n+2)%e];return hs((r-n/e)*e,s,a,i,o)}}var Ao=d(()=>{ds()});var ms,Co=d(()=>{ms=t=>()=>t});function Fh(t,e){return function(r){return t+r*e}}function Nh(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Mo(t){return(t=+t)==1?Jr:function(e,r){return r-e?Nh(e,r,t):ms(isNaN(e)?r:e)}}function Jr(t,e){var r=e-t;return r?Fh(t,r):ms(isNaN(t)?e:t)}var Ro=d(()=>{Co()});function ko(t){return function(e){var r=e.length,n=new Array(r),s=new Array(r),a=new Array(r),i,o;for(i=0;i<r;++i)o=It(e[i]),n[i]=o.r||0,s[i]=o.g||0,a[i]=o.b||0;return n=t(n),s=t(s),a=t(a),o.opacity=1,function(c){return o.r=n(c),o.g=s(c),o.b=a(c),o+""}}}var en,qh,Gh,Oo=d(()=>{Kr();ds();Ao();Ro();en=function t(e){var r=Mo(e);function n(s,a){var i=r((s=It(s)).r,(a=It(a)).r),o=r(s.g,a.g),c=r(s.b,a.b),l=Jr(s.opacity,a.opacity);return function(f){return s.r=i(f),s.g=o(f),s.b=c(f),s.opacity=l(f),s+""}}return n.gamma=t,n}(1);qh=ko(Io),Gh=ko(Eo)});function Ee(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}var tn=d(()=>{});function Uh(t){return function(){return t}}function $h(t){return function(e){return t(e)+""}}function ys(t,e){var r=ps.lastIndex=gs.lastIndex=0,n,s,a,i=-1,o=[],c=[];for(t=t+"",e=e+"";(n=ps.exec(t))&&(s=gs.exec(e));)(a=s.index)>r&&(a=e.slice(r,a),o[i]?o[i]+=a:o[++i]=a),(n=n[0])===(s=s[0])?o[i]?o[i]+=s:o[++i]=s:(o[++i]=null,c.push({i,x:Ee(n,s)})),r=gs.lastIndex;return r<e.length&&(a=e.slice(r),o[i]?o[i]+=a:o[++i]=a),o.length<2?c[0]?$h(c[0].x):Uh(e):(e=c.length,function(l){for(var f=0,h;f<e;++f)o[(h=c[f]).i]=h.x(l);return o.join("")})}var ps,gs,Lo=d(()=>{tn();ps=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gs=new RegExp(ps.source,"g")});function xs(t,e,r,n,s,a){var i,o,c;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(c=t*r+e*n)&&(r-=t*c,n-=e*c),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,c/=o),t*n<e*r&&(t=-t,e=-e,c=-c,i=-i),{translateX:s,translateY:a,rotate:Math.atan2(e,t)*Po,skewX:Math.atan(c)*Po,scaleX:i,scaleY:o}}var Po,rn,Do=d(()=>{Po=180/Math.PI,rn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function Yo(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?rn:xs(e.a,e.b,e.c,e.d,e.e,e.f)}function Xo(t){return t==null?rn:(nn||(nn=document.createElementNS("http://www.w3.org/2000/svg","g")),nn.setAttribute("transform",t),(t=nn.transform.baseVal.consolidate())?(t=t.matrix,xs(t.a,t.b,t.c,t.d,t.e,t.f)):rn)}var nn,zo=d(()=>{Do()});function Fo(t,e,r,n){function s(l){return l.length?l.pop()+" ":""}function a(l,f,h,m,g,_){if(l!==h||f!==m){var x=g.push("translate(",null,e,null,r);_.push({i:x-4,x:Ee(l,h)},{i:x-2,x:Ee(f,m)})}else(h||m)&&g.push("translate("+h+e+m+r)}function i(l,f,h,m){l!==f?(l-f>180?f+=360:f-l>180&&(l+=360),m.push({i:h.push(s(h)+"rotate(",null,n)-2,x:Ee(l,f)})):f&&h.push(s(h)+"rotate("+f+n)}function o(l,f,h,m){l!==f?m.push({i:h.push(s(h)+"skewX(",null,n)-2,x:Ee(l,f)}):f&&h.push(s(h)+"skewX("+f+n)}function c(l,f,h,m,g,_){if(l!==h||f!==m){var x=g.push(s(g)+"scale(",null,",",null,")");_.push({i:x-4,x:Ee(l,h)},{i:x-2,x:Ee(f,m)})}else(h!==1||m!==1)&&g.push(s(g)+"scale("+h+","+m+")")}return function(l,f){var h=[],m=[];return l=t(l),f=t(f),a(l.translateX,l.translateY,f.translateX,f.translateY,h,m),i(l.rotate,f.rotate,h,m),o(l.skewX,f.skewX,h,m),c(l.scaleX,l.scaleY,f.scaleX,f.scaleY,h,m),l=f=null,function(g){for(var _=-1,x=m.length,w;++_<x;)h[(w=m[_]).i]=w.x(g);return h.join("")}}}var _s,vs,No=d(()=>{tn();zo();_s=Fo(Yo,"px, ","px)","deg)"),vs=Fo(Xo,", ",")",")")});var er=d(()=>{tn();Lo();No();Oo()});function ar(){return it||(Go(Bh),it=sr.now()+on)}function Bh(){it=0}function ir(){this._call=this._time=this._next=null}function cn(t,e,r){var n=new ir;return n.restart(t,e,r),n}function Uo(){ar(),++Et;for(var t=sn,e;t;)(e=it-t._time)>=0&&t._call.call(null,e),t=t._next;--Et}function $o(){it=(an=sr.now())+on,Et=tr=0;try{Uo()}finally{Et=0,Hh(),it=0}}function Qh(){var t=sr.now(),e=t-an;e>qo&&(on-=e,an=t)}function Hh(){for(var t,e=sn,r,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:sn=r);nr=t,ws(n)}function ws(t){if(!Et){tr&&(tr=clearTimeout(tr));var e=t-it;e>24?(t<1/0&&(tr=setTimeout($o,t-sr.now()-on)),rr&&(rr=clearInterval(rr))):(rr||(an=sr.now(),rr=setInterval(Qh,qo)),Et=1,Go($o))}}var Et,tr,rr,qo,sn,nr,an,it,on,sr,Go,Ss=d(()=>{Et=0,tr=0,rr=0,qo=1e3,an=0,it=0,on=0,sr=typeof performance=="object"&&performance.now?performance:Date,Go=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};ir.prototype=cn.prototype={constructor:ir,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?ar():+r)+(e==null?0:+e),!this._next&&nr!==this&&(nr?nr._next=this:sn=this,nr=this),this._call=t,this._time=r,ws()},stop:function(){this._call&&(this._call=null,this._time=1/0,ws())}}});function ln(t,e,r){var n=new ir;return e=e==null?0:+e,n.restart(s=>{n.stop(),t(s+e)},e,r),n}var Bo=d(()=>{Ss()});var fn=d(()=>{Ss();Bo()});function Ke(t,e,r,n,s,a){var i=t.__transition;if(!i)t.__transition={};else if(r in i)return;Kh(t,r,{name:e,index:n,group:s,on:Wh,tween:Zh,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Qo})}function cr(t,e){var r=ae(t,e);if(r.state>Qo)throw new Error("too late; already scheduled");return r}function oe(t,e){var r=ae(t,e);if(r.state>hn)throw new Error("too late; already running");return r}function ae(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function Kh(t,e,r){var n=t.__transition,s;n[e]=r,r.timer=cn(a,0,r.time);function a(l){r.state=bs,r.timer.restart(i,r.delay,r.time),r.delay<=l&&i(l-r.delay)}function i(l){var f,h,m,g;if(r.state!==bs)return c();for(f in n)if(g=n[f],g.name===r.name){if(g.state===hn)return ln(i);g.state===Ho?(g.state=or,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete n[f]):+f<e&&(g.state=or,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete n[f])}if(ln(function(){r.state===hn&&(r.state=Ho,r.timer.restart(o,r.delay,r.time),o(l))}),r.state=un,r.on.call("start",t,t.__data__,r.index,r.group),r.state===un){for(r.state=hn,s=new Array(m=r.tween.length),f=0,h=-1;f<m;++f)(g=r.tween[f].value.call(t,t.__data__,r.index,r.group))&&(s[++h]=g);s.length=h+1}}function o(l){for(var f=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(c),r.state=dn,1),h=-1,m=s.length;++h<m;)s[h].call(t,f);r.state===dn&&(r.on.call("end",t,t.__data__,r.index,r.group),c())}function c(){r.state=or,r.timer.stop(),delete n[e];for(var l in n)return;delete t.__transition}}var Wh,Zh,Qo,bs,un,hn,Ho,dn,or,ye=d(()=>{Jn();fn();Wh=Kn("start","end","cancel","interrupt"),Zh=[],Qo=0,bs=1,un=2,hn=3,Ho=4,dn=5,or=6});function lr(t,e){var r=t.__transition,n,s,a=!0,i;if(!!r){e=e==null?null:e+"";for(i in r){if((n=r[i]).name!==e){a=!1;continue}s=n.state>un&&n.state<dn,n.state=or,n.timer.stop(),n.on.call(s?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete r[i]}a&&delete t.__transition}}var Vs=d(()=>{ye()});function Wo(t){return this.each(function(){lr(this,t)})}var Zo=d(()=>{Vs()});function Jh(t,e){var r,n;return function(){var s=oe(this,t),a=s.tween;if(a!==r){n=r=a;for(var i=0,o=n.length;i<o;++i)if(n[i].name===e){n=n.slice(),n.splice(i,1);break}}s.tween=n}}function ed(t,e,r){var n,s;if(typeof r!="function")throw new Error;return function(){var a=oe(this,t),i=a.tween;if(i!==n){s=(n=i).slice();for(var o={name:e,value:r},c=0,l=s.length;c<l;++c)if(s[c].name===e){s[c]=o;break}c===l&&s.push(o)}a.tween=s}}function Ko(t,e){var r=this._id;if(t+="",arguments.length<2){for(var n=ae(this.node(),r).tween,s=0,a=n.length,i;s<a;++s)if((i=n[s]).name===t)return i.value;return null}return this.each((e==null?Jh:ed)(r,t,e))}function At(t,e,r){var n=t._id;return t.each(function(){var s=oe(this,n);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return ae(s,n).value[e]}}var fr=d(()=>{ye()});function mn(t,e){var r;return(typeof e=="number"?Ee:e instanceof Ze?en:(r=Ze(e))?(e=r,en):ys)(t,e)}var js=d(()=>{Kr();er()});function td(t){return function(){this.removeAttribute(t)}}function rd(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nd(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttribute(t);return i===s?null:i===n?a:a=e(n=i,r)}}function sd(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttributeNS(t.space,t.local);return i===s?null:i===n?a:a=e(n=i,r)}}function ad(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttribute(t):(i=this.getAttribute(t),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function id(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function Jo(t,e){var r=Fe(t),n=r==="transform"?vs:mn;return this.attrTween(t,typeof e=="function"?(r.local?id:ad)(r,n,At(this,"attr."+t,e)):e==null?(r.local?rd:td)(r):(r.local?sd:nd)(r,n,e))}var ec=d(()=>{er();Ce();fr();js()});function od(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function cd(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function ld(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&cd(t,a)),r}return s._value=e,s}function fd(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&od(t,a)),r}return s._value=e,s}function tc(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var n=Fe(t);return this.tween(r,(n.local?ld:fd)(n,e))}var rc=d(()=>{Ce()});function ud(t,e){return function(){cr(this,t).delay=+e.apply(this,arguments)}}function hd(t,e){return e=+e,function(){cr(this,t).delay=e}}function nc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ud:hd)(e,t)):ae(this.node(),e).delay}var sc=d(()=>{ye()});function dd(t,e){return function(){oe(this,t).duration=+e.apply(this,arguments)}}function md(t,e){return e=+e,function(){oe(this,t).duration=e}}function ac(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?dd:md)(e,t)):ae(this.node(),e).duration}var ic=d(()=>{ye()});function pd(t,e){if(typeof e!="function")throw new Error;return function(){oe(this,t).ease=e}}function oc(t){var e=this._id;return arguments.length?this.each(pd(e,t)):ae(this.node(),e).ease}var cc=d(()=>{ye()});function gd(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;oe(this,t).ease=r}}function lc(t){if(typeof t!="function")throw new Error;return this.each(gd(this._id,t))}var fc=d(()=>{ye()});function uc(t){typeof t!="function"&&(t=Bt(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new ue(n,this._parents,this._name,this._id)}var hc=d(()=>{Ce();qe()});function dc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],f=c.length,h=i[o]=new Array(f),m,g=0;g<f;++g)(m=c[g]||l[g])&&(h[g]=m);for(;o<n;++o)i[o]=e[o];return new ue(i,this._parents,this._name,this._id)}var mc=d(()=>{qe()});function yd(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function xd(t,e,r){var n,s,a=yd(e)?cr:oe;return function(){var i=a(this,t),o=i.on;o!==n&&(s=(n=o).copy()).on(e,r),i.on=s}}function pc(t,e){var r=this._id;return arguments.length<2?ae(this.node(),r).on.on(t):this.each(xd(r,t,e))}var gc=d(()=>{ye()});function _d(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function yc(){return this.on("end.remove",_d(this._id))}var xc=d(()=>{});function _c(t){var e=this._name,r=this._id;typeof t!="function"&&(t=at(t));for(var n=this._groups,s=n.length,a=new Array(s),i=0;i<s;++i)for(var o=n[i],c=o.length,l=a[i]=new Array(c),f,h,m=0;m<c;++m)(f=o[m])&&(h=t.call(f,f.__data__,m,o))&&("__data__"in f&&(h.__data__=f.__data__),l[m]=h,Ke(l[m],e,r,m,l,ae(f,r)));return new ue(a,this._parents,e,r)}var vc=d(()=>{Ce();qe();ye()});function wc(t){var e=this._name,r=this._id;typeof t!="function"&&(t=$t(t));for(var n=this._groups,s=n.length,a=[],i=[],o=0;o<s;++o)for(var c=n[o],l=c.length,f,h=0;h<l;++h)if(f=c[h]){for(var m=t.call(f,f.__data__,h,c),g,_=ae(f,r),x=0,w=m.length;x<w;++x)(g=m[x])&&Ke(g,e,r,x,m,_);a.push(m),i.push(f)}return new ue(a,i,e,r)}var Sc=d(()=>{Ce();qe();ye()});function bc(){return new vd(this._groups,this._parents)}var vd,Vc=d(()=>{Ce();vd=Ne.prototype.constructor});function wd(t,e){var r,n,s;return function(){var a=He(this,t),i=(this.style.removeProperty(t),He(this,t));return a===i?null:a===r&&i===n?s:s=e(r=a,n=i)}}function jc(t){return function(){this.style.removeProperty(t)}}function Sd(t,e,r){var n,s=r+"",a;return function(){var i=He(this,t);return i===s?null:i===n?a:a=e(n=i,r)}}function bd(t,e,r){var n,s,a;return function(){var i=He(this,t),o=r(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(t),He(this,t))),i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o))}}function Vd(t,e){var r,n,s,a="style."+e,i="end."+a,o;return function(){var c=oe(this,t),l=c.on,f=c.value[a]==null?o||(o=jc(e)):void 0;(l!==r||s!==f)&&(n=(r=l).copy()).on(i,s=f),c.on=n}}function Tc(t,e,r){var n=(t+="")==="transform"?_s:mn;return e==null?this.styleTween(t,wd(t,n)).on("end.style."+t,jc(t)):typeof e=="function"?this.styleTween(t,bd(t,n,At(this,"style."+t,e))).each(Vd(this._id,t)):this.styleTween(t,Sd(t,n,e),r).on("end.style."+t,null)}var Ic=d(()=>{er();Ce();ye();fr();js()});function jd(t,e,r){return function(n){this.style.setProperty(t,e.call(this,n),r)}}function Td(t,e,r){var n,s;function a(){var i=e.apply(this,arguments);return i!==s&&(n=(s=i)&&jd(t,i,r)),n}return a._value=e,a}function Ec(t,e,r){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Td(t,e,r??""))}var Ac=d(()=>{});function Id(t){return function(){this.textContent=t}}function Ed(t){return function(){var e=t(this);this.textContent=e??""}}function Cc(t){return this.tween("text",typeof t=="function"?Ed(At(this,"text",t)):Id(t==null?"":t+""))}var Mc=d(()=>{fr()});function Ad(t){return function(e){this.textContent=t.call(this,e)}}function Cd(t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&Ad(s)),e}return n._value=t,n}function Rc(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Cd(t))}var kc=d(()=>{});function Oc(){for(var t=this._name,e=this._id,r=pn(),n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)if(c=i[l]){var f=ae(c,e);Ke(c,t,r,l,i,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new ue(n,this._parents,t,r)}var Lc=d(()=>{qe();ye()});function Pc(){var t,e,r=this,n=r._id,s=r.size();return new Promise(function(a,i){var o={value:i},c={value:function(){--s==0&&a()}};r.each(function(){var l=oe(this,n),f=l.on;f!==t&&(e=(t=f).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(c)),l.on=e}),s===0&&a()})}var Dc=d(()=>{ye()});function ue(t,e,r,n){this._groups=t,this._parents=e,this._name=r,this._id=n}function Ts(t){return Ne().transition(t)}function pn(){return++Md}var Md,ot,qe=d(()=>{Ce();ec();rc();sc();ic();cc();fc();hc();mc();gc();xc();vc();Sc();Vc();Ic();Ac();Mc();kc();Lc();fr();Dc();Md=0;ot=Ne.prototype;ue.prototype=Ts.prototype={constructor:ue,select:_c,selectAll:wc,filter:uc,merge:dc,selection:bc,transition:Oc,call:ot.call,nodes:ot.nodes,node:ot.node,size:ot.size,empty:ot.empty,each:ot.each,on:pc,attr:Jo,attrTween:tc,style:Tc,styleTween:Ec,text:Cc,textTween:Rc,remove:yc,tween:Ko,delay:nc,duration:ac,ease:oc,easeVarying:lc,end:Pc,[Symbol.iterator]:ot[Symbol.iterator]}});function gn(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Yc=d(()=>{});var Is=d(()=>{Yc()});function kd(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function Xc(t){var e,r;t instanceof ue?(e=t._id,t=t._name):(e=pn(),(r=Rd).time=ar(),t=t==null?null:t+"");for(var n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&Ke(c,t,e,l,i,r||kd(c,e));return new ue(n,this._parents,t,e)}var Rd,zc=d(()=>{qe();ye();Is();fn();Rd={time:null,delay:0,duration:250,ease:gn}});var Fc=d(()=>{Ce();Zo();zc();Ne.prototype.interrupt=Wo;Ne.prototype.transition=Xc});var Nc=d(()=>{qe();ye()});var yn=d(()=>{Fc();qe();Nc();Vs()});var qc=d(()=>{});var Gc=d(()=>{});var Uc=d(()=>{});function $c(t){return[+t[0],+t[1]]}function Od(t){return[$c(t[0]),$c(t[1])]}function Es(t){return{type:t}}var J_,ev,tv,Bc=d(()=>{yn();qc();Gc();Uc();J_={name:"x",handles:["w","e"].map(Es),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},ev={name:"y",handles:["n","s"].map(Es),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},tv={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Es),input:function(t){return t==null?null:Od(t)},output:function(t){return t}}});var Qc=d(()=>{Bc()});var Hc=d(()=>{});var Wc=d(()=>{});var Zc=d(()=>{});var Kc=d(()=>{});var Jc=d(()=>{});var el=d(()=>{});var tl=d(()=>{});var rl=d(()=>{});function nl(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ct(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}var ur=d(()=>{});function sl(t){return t=ct(Math.abs(t)),t?t[1]:NaN}var al=d(()=>{ur()});function il(t,e){return function(r,n){for(var s=r.length,a=[],i=0,o=t[0],c=0;s>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),a.push(r.substring(s-=o,s+o)),!((c+=o+1)>n));)o=t[i=(i+1)%t.length];return a.reverse().join(e)}}var ol=d(()=>{});function cl(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var ll=d(()=>{});function hr(t){if(!(e=Ld.exec(t)))throw new Error("invalid format: "+t);var e;return new As({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function As(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}var Ld,fl=d(()=>{Ld=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;hr.prototype=As.prototype;As.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function ul(t){e:for(var e=t.length,r=1,n=-1,s;r<e;++r)switch(t[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var hl=d(()=>{});function dl(t,e){var r=ct(t,e);if(!r)return t+"";var n=r[0],s=r[1],a=s-(Cs=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return a===i?n:a>i?n+new Array(a-i+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+ct(t,Math.max(0,e+a-1))[0]}var Cs,Ms=d(()=>{ur()});function Rs(t,e){var r=ct(t,e);if(!r)return t+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}var ml=d(()=>{ur()});var ks,pl=d(()=>{ur();Ms();ml();ks={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:nl,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Rs(t*100,e),r:Rs,s:dl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)}});function Os(t){return t}var gl=d(()=>{});function _l(t){var e=t.grouping===void 0||t.thousands===void 0?Os:il(yl.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Os:cl(yl.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"\u2212":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(h){h=hr(h);var m=h.fill,g=h.align,_=h.sign,x=h.symbol,w=h.zero,V=h.width,E=h.comma,j=h.precision,W=h.trim,M=h.type;M==="n"?(E=!0,M="g"):ks[M]||(j===void 0&&(j=12),W=!0,M="g"),(w||m==="0"&&g==="=")&&(w=!0,m="0",g="=");var D=x==="$"?r:x==="#"&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",ce=x==="$"?n:/[%p]/.test(M)?i:"",de=ks[M],Ae=/[defgprs%]/.test(M);j=j===void 0?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,j)):Math.max(0,Math.min(20,j));function je(R){var le=D,re=ce,we,St,$e;if(M==="c")re=de(R)+re,R="";else{R=+R;var Be=R<0||1/R<0;if(R=isNaN(R)?c:de(Math.abs(R),j),W&&(R=ul(R)),Be&&+R==0&&_!=="+"&&(Be=!1),le=(Be?_==="("?_:o:_==="-"||_==="("?"":_)+le,re=(M==="s"?xl[8+Cs/3]:"")+re+(Be&&_==="("?")":""),Ae){for(we=-1,St=R.length;++we<St;)if($e=R.charCodeAt(we),48>$e||$e>57){re=($e===46?s+R.slice(we+1):R.slice(we))+re,R=R.slice(0,we);break}}}E&&!w&&(R=e(R,1/0));var Qe=le.length+R.length+re.length,Se=Qe<V?new Array(V-Qe+1).join(m):"";switch(E&&w&&(R=e(Se+R,Se.length?V-re.length:1/0),Se=""),g){case"<":R=le+R+re+Se;break;case"=":R=le+Se+R+re;break;case"^":R=Se.slice(0,Qe=Se.length>>1)+le+R+re+Se.slice(Qe);break;default:R=Se+le+R+re;break}return a(R)}return je.toString=function(){return h+""},je}function f(h,m){var g=l((h=hr(h),h.type="f",h)),_=Math.max(-8,Math.min(8,Math.floor(sl(m)/3)))*3,x=Math.pow(10,-_),w=xl[8+_/3];return function(V){return g(x*V)+w}}return{format:l,formatPrefix:f}}var yl,xl,vl=d(()=>{al();ol();ll();fl();hl();pl();Ms();gl();yl=Array.prototype.map,xl=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function Ls(t){return xn=_l(t),wl=xn.format,Sl=xn.formatPrefix,xn}var xn,wl,Sl,bl=d(()=>{vl();Ls({thousands:",",grouping:[3],currency:["$",""]})});var Vl=d(()=>{bl()});var jl=d(()=>{});var Tl=d(()=>{});var Il=d(()=>{});var El=d(()=>{});function he(t,e,r,n){function s(a){return t(a=arguments.length===0?new Date:new Date(+a)),a}return s.floor=function(a){return t(a=new Date(+a)),a},s.ceil=function(a){return t(a=new Date(a-1)),e(a,1),t(a),a},s.round=function(a){var i=s(a),o=s.ceil(a);return a-i<o-a?i:o},s.offset=function(a,i){return e(a=new Date(+a),i==null?1:Math.floor(i)),a},s.range=function(a,i,o){var c=[],l;if(a=s.ceil(a),o=o==null?1:Math.floor(o),!(a<i)||!(o>0))return c;do c.push(l=new Date(+a)),e(a,o),t(a);while(l<a&&a<i);return c},s.filter=function(a){return he(function(i){if(i>=i)for(;t(i),!a(i);)i.setTime(i-1)},function(i,o){if(i>=i)if(o<0)for(;++o<=0;)for(;e(i,-1),!a(i););else for(;--o>=0;)for(;e(i,1),!a(i););})},r&&(s.count=function(a,i){return Ps.setTime(+a),Ds.setTime(+i),t(Ps),t(Ds),Math.floor(r(Ps,Ds))},s.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?s.filter(n?function(i){return n(i)%a==0}:function(i){return s.count(0,i)%a==0}):s}),s}var Ps,Ds,lt=d(()=>{Ps=new Date,Ds=new Date});var Pd,dr,Dd,ft,_n,Zv,Kv,mr=d(()=>{Pd=1e3,dr=Pd*60,Dd=dr*60,ft=Dd*24,_n=ft*7,Zv=ft*30,Kv=ft*365});var Al,vn,Yd,Cl=d(()=>{lt();mr();Al=he(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*dr)/ft,t=>t.getDate()-1),vn=Al,Yd=Al.range});function ut(t){return he(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r*7)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*dr)/_n})}var pr,Ct,Ml,Rl,Je,kl,Ol,Ll,Xd,zd,Fd,Nd,qd,Gd,Pl=d(()=>{lt();mr();pr=ut(0),Ct=ut(1),Ml=ut(2),Rl=ut(3),Je=ut(4),kl=ut(5),Ol=ut(6),Ll=pr.range,Xd=Ct.range,zd=Ml.range,Fd=Rl.range,Nd=Je.range,qd=kl.range,Gd=Ol.range});var Ys,ht,Ud,Dl=d(()=>{lt();Ys=he(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Ys.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r*t)})};ht=Ys,Ud=Ys.range});var Yl,wn,$d,Xl=d(()=>{lt();mr();Yl=he(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/ft},function(t){return t.getUTCDate()-1}),wn=Yl,$d=Yl.range});function dt(t){return he(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r*7)},function(e,r){return(r-e)/_n})}var gr,Mt,zl,Fl,et,Nl,ql,Gl,Bd,Qd,Hd,Wd,Zd,Kd,Ul=d(()=>{lt();mr();gr=dt(0),Mt=dt(1),zl=dt(2),Fl=dt(3),et=dt(4),Nl=dt(5),ql=dt(6),Gl=gr.range,Bd=Mt.range,Qd=zl.range,Hd=Fl.range,Wd=et.range,Zd=Nl.range,Kd=ql.range});var Xs,mt,Jd,$l=d(()=>{lt();Xs=he(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});Xs.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})};mt=Xs,Jd=Xs.range});var zs=d(()=>{Cl();Pl();Dl();Xl();Ul();$l()});function Fs(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Ns(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function yr(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function qs(t){var e=t.dateTime,r=t.date,n=t.time,s=t.periods,a=t.days,i=t.shortDays,o=t.months,c=t.shortMonths,l=xr(s),f=_r(s),h=xr(a),m=_r(a),g=xr(i),_=_r(i),x=xr(o),w=_r(o),V=xr(c),E=_r(c),j={a:Be,A:Qe,b:Se,B:Pn,c:null,d:Kl,e:Kl,f:Sm,g:Rm,G:Om,H:_m,I:vm,j:wm,L:Jl,m:bm,M:Vm,p:Dn,q:Yn,Q:af,s:of,S:jm,u:Tm,U:Im,V:Em,w:Am,W:Cm,x:null,X:null,y:Mm,Y:km,Z:Lm,"%":sf},W={a:Xn,A:zn,b:Fn,B:Nn,c:null,d:tf,e:tf,f:Xm,g:Hm,G:Zm,H:Pm,I:Dm,j:Ym,L:rf,m:zm,M:Fm,p:qn,q:Gn,Q:af,s:of,S:Nm,u:qm,U:Gm,V:Um,w:$m,W:Bm,x:null,X:null,y:Qm,Y:Wm,Z:Km,"%":sf},M={a:je,A:R,b:le,B:re,c:we,d:Wl,e:Wl,f:pm,g:Hl,G:Ql,H:Zl,I:Zl,j:um,L:mm,m:fm,M:hm,p:Ae,q:lm,Q:ym,s:xm,S:dm,u:sm,U:am,V:im,w:nm,W:om,x:St,X:$e,y:Hl,Y:Ql,Z:cm,"%":gm};j.x=D(r,j),j.X=D(n,j),j.c=D(e,j),W.x=D(r,W),W.X=D(n,W),W.c=D(e,W);function D(T,k){return function(L){var S=[],fe=-1,F=0,me=T.length,pe,y,N;for(L instanceof Date||(L=new Date(+L));++fe<me;)T.charCodeAt(fe)===37&&(S.push(T.slice(F,fe)),(y=Bl[pe=T.charAt(++fe)])!=null?pe=T.charAt(++fe):y=pe==="e"?" ":"0",(N=k[pe])&&(pe=N(L,y)),S.push(pe),F=fe+1);return S.push(T.slice(F,fe)),S.join("")}}function ce(T,k){return function(L){var S=yr(1900,void 0,1),fe=de(S,T,L+="",0),F,me;if(fe!=L.length)return null;if("Q"in S)return new Date(S.Q);if("s"in S)return new Date(S.s*1e3+("L"in S?S.L:0));if(k&&!("Z"in S)&&(S.Z=0),"p"in S&&(S.H=S.H%12+S.p*12),S.m===void 0&&(S.m="q"in S?S.q:0),"V"in S){if(S.V<1||S.V>53)return null;"w"in S||(S.w=1),"Z"in S?(F=Ns(yr(S.y,0,1)),me=F.getUTCDay(),F=me>4||me===0?Mt.ceil(F):Mt(F),F=wn.offset(F,(S.V-1)*7),S.y=F.getUTCFullYear(),S.m=F.getUTCMonth(),S.d=F.getUTCDate()+(S.w+6)%7):(F=Fs(yr(S.y,0,1)),me=F.getDay(),F=me>4||me===0?Ct.ceil(F):Ct(F),F=vn.offset(F,(S.V-1)*7),S.y=F.getFullYear(),S.m=F.getMonth(),S.d=F.getDate()+(S.w+6)%7)}else("W"in S||"U"in S)&&("w"in S||(S.w="u"in S?S.u%7:"W"in S?1:0),me="Z"in S?Ns(yr(S.y,0,1)).getUTCDay():Fs(yr(S.y,0,1)).getDay(),S.m=0,S.d="W"in S?(S.w+6)%7+S.W*7-(me+5)%7:S.w+S.U*7-(me+6)%7);return"Z"in S?(S.H+=S.Z/100|0,S.M+=S.Z%100,Ns(S)):Fs(S)}}function de(T,k,L,S){for(var fe=0,F=k.length,me=L.length,pe,y;fe<F;){if(S>=me)return-1;if(pe=k.charCodeAt(fe++),pe===37){if(pe=k.charAt(fe++),y=M[pe in Bl?k.charAt(fe++):pe],!y||(S=y(T,L,S))<0)return-1}else if(pe!=L.charCodeAt(S++))return-1}return S}function Ae(T,k,L){var S=l.exec(k.slice(L));return S?(T.p=f.get(S[0].toLowerCase()),L+S[0].length):-1}function je(T,k,L){var S=g.exec(k.slice(L));return S?(T.w=_.get(S[0].toLowerCase()),L+S[0].length):-1}function R(T,k,L){var S=h.exec(k.slice(L));return S?(T.w=m.get(S[0].toLowerCase()),L+S[0].length):-1}function le(T,k,L){var S=V.exec(k.slice(L));return S?(T.m=E.get(S[0].toLowerCase()),L+S[0].length):-1}function re(T,k,L){var S=x.exec(k.slice(L));return S?(T.m=w.get(S[0].toLowerCase()),L+S[0].length):-1}function we(T,k,L){return de(T,e,k,L)}function St(T,k,L){return de(T,r,k,L)}function $e(T,k,L){return de(T,n,k,L)}function Be(T){return i[T.getDay()]}function Qe(T){return a[T.getDay()]}function Se(T){return c[T.getMonth()]}function Pn(T){return o[T.getMonth()]}function Dn(T){return s[+(T.getHours()>=12)]}function Yn(T){return 1+~~(T.getMonth()/3)}function Xn(T){return i[T.getUTCDay()]}function zn(T){return a[T.getUTCDay()]}function Fn(T){return c[T.getUTCMonth()]}function Nn(T){return o[T.getUTCMonth()]}function qn(T){return s[+(T.getUTCHours()>=12)]}function Gn(T){return 1+~~(T.getUTCMonth()/3)}return{format:function(T){var k=D(T+="",j);return k.toString=function(){return T},k},parse:function(T){var k=ce(T+="",!1);return k.toString=function(){return T},k},utcFormat:function(T){var k=D(T+="",W);return k.toString=function(){return T},k},utcParse:function(T){var k=ce(T+="",!0);return k.toString=function(){return T},k}}}function Y(t,e,r){var n=t<0?"-":"",s=(n?-t:t)+"",a=s.length;return n+(a<r?new Array(r-a+1).join(e)+s:s)}function rm(t){return t.replace(tm,"\\$&")}function xr(t){return new RegExp("^(?:"+t.map(rm).join("|")+")","i")}function _r(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function nm(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function sm(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function am(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function im(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function om(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function Ql(t,e,r){var n=ie.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function Hl(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function cm(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function lm(t,e,r){var n=ie.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function fm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function Wl(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function um(t,e,r){var n=ie.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function Zl(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function hm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function dm(t,e,r){var n=ie.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function mm(t,e,r){var n=ie.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function pm(t,e,r){var n=ie.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function gm(t,e,r){var n=em.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function ym(t,e,r){var n=ie.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function xm(t,e,r){var n=ie.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function Kl(t,e){return Y(t.getDate(),e,2)}function _m(t,e){return Y(t.getHours(),e,2)}function vm(t,e){return Y(t.getHours()%12||12,e,2)}function wm(t,e){return Y(1+vn.count(ht(t),t),e,3)}function Jl(t,e){return Y(t.getMilliseconds(),e,3)}function Sm(t,e){return Jl(t,e)+"000"}function bm(t,e){return Y(t.getMonth()+1,e,2)}function Vm(t,e){return Y(t.getMinutes(),e,2)}function jm(t,e){return Y(t.getSeconds(),e,2)}function Tm(t){var e=t.getDay();return e===0?7:e}function Im(t,e){return Y(pr.count(ht(t)-1,t),e,2)}function ef(t){var e=t.getDay();return e>=4||e===0?Je(t):Je.ceil(t)}function Em(t,e){return t=ef(t),Y(Je.count(ht(t),t)+(ht(t).getDay()===4),e,2)}function Am(t){return t.getDay()}function Cm(t,e){return Y(Ct.count(ht(t)-1,t),e,2)}function Mm(t,e){return Y(t.getFullYear()%100,e,2)}function Rm(t,e){return t=ef(t),Y(t.getFullYear()%100,e,2)}function km(t,e){return Y(t.getFullYear()%1e4,e,4)}function Om(t,e){var r=t.getDay();return t=r>=4||r===0?Je(t):Je.ceil(t),Y(t.getFullYear()%1e4,e,4)}function Lm(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Y(e/60|0,"0",2)+Y(e%60,"0",2)}function tf(t,e){return Y(t.getUTCDate(),e,2)}function Pm(t,e){return Y(t.getUTCHours(),e,2)}function Dm(t,e){return Y(t.getUTCHours()%12||12,e,2)}function Ym(t,e){return Y(1+wn.count(mt(t),t),e,3)}function rf(t,e){return Y(t.getUTCMilliseconds(),e,3)}function Xm(t,e){return rf(t,e)+"000"}function zm(t,e){return Y(t.getUTCMonth()+1,e,2)}function Fm(t,e){return Y(t.getUTCMinutes(),e,2)}function Nm(t,e){return Y(t.getUTCSeconds(),e,2)}function qm(t){var e=t.getUTCDay();return e===0?7:e}function Gm(t,e){return Y(gr.count(mt(t)-1,t),e,2)}function nf(t){var e=t.getUTCDay();return e>=4||e===0?et(t):et.ceil(t)}function Um(t,e){return t=nf(t),Y(et.count(mt(t),t)+(mt(t).getUTCDay()===4),e,2)}function $m(t){return t.getUTCDay()}function Bm(t,e){return Y(Mt.count(mt(t)-1,t),e,2)}function Qm(t,e){return Y(t.getUTCFullYear()%100,e,2)}function Hm(t,e){return t=nf(t),Y(t.getUTCFullYear()%100,e,2)}function Wm(t,e){return Y(t.getUTCFullYear()%1e4,e,4)}function Zm(t,e){var r=t.getUTCDay();return t=r>=4||r===0?et(t):et.ceil(t),Y(t.getUTCFullYear()%1e4,e,4)}function Km(){return"+0000"}function sf(){return"%"}function af(t){return+t}function of(t){return Math.floor(+t/1e3)}var Bl,ie,em,tm,cf=d(()=>{zs();Bl={"-":"",_:" ","0":"0"},ie=/^\s*\d+/,em=/^%/,tm=/[\\^$*+?|[\]().{}]/g});function Gs(t){return Rt=qs(t),lf=Rt.format,ff=Rt.parse,uf=Rt.utcFormat,hf=Rt.utcParse,Rt}var Rt,lf,ff,uf,hf,df=d(()=>{cf();Gs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});var mf=d(()=>{df()});var pf=d(()=>{});var gf=d(()=>{});var yf=d(()=>{});var xf=d(()=>{});var _f=d(()=>{});function pt(t,e,r){this.k=t,this.x=e,this.y=r}function $s(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Us;return t.__zoom}var Us,Bs=d(()=>{pt.prototype={constructor:pt,scale:function(t){return t===1?this:new pt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new pt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Us=new pt(1,0,0);$s.prototype=pt.prototype});var vf=d(()=>{});var wf=d(()=>{yn();xf();_f();Bs();vf()});var Sf=d(()=>{wf();Bs()});var gt=d(()=>{Da();Ya();Xa();Qc();Wc();Kr();Zc();Kc();Jn();po();Jc();Is();el();rl();Vl();jl();Tl();er();Hc();Il();tl();El();pf();gf();Ce();yf();zs();mf();fn();yn();Sf()});var bf=d(()=>{Xr();gt();J.register("SliderTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{X(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove();let r=e.getSharedVar("x1")??0,n=e.getSharedVar("x2")??0,s=e.getSharedVar("height")??0,a=e.getSharedVar("fill")??"#000000",i=e.getSharedVar("opacity")??.3;X(t.getGraphic()).append("rect").attr("x1",r).attr("x2",n).attr("width",n-r).attr("height",s).attr("fill",a).attr("opacity",i)}});J.register("HighlightSelection",{constructor:J,redraw({layer:t,transformer:e}){let r=X(t.getGraphic()).selectAll(e.getSharedVar("selector")||"*");Object.entries(e.getSharedVar("highlightAttrValues")).forEach(([s,a])=>{r.attr(s,a)})}});J.register("TransientRectangleTransformer",{constructor:J,className:["draw-shape","transient-shape","rectangle-shape"],redraw:({layer:t,transformer:e})=>{X(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove(),X(t.getGraphic()).append("rect").attr("x",e.getSharedVar("x")).attr("y",e.getSharedVar("y")).attr("width",e.getSharedVar("width")).attr("height",e.getSharedVar("height")).attr("fill",e.getSharedVar("fillColor")).attr("opacity",e.getSharedVar("opacity"))}});J.register("SelectionTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{e.getSharedVar("result").forEach(a=>{t.getGraphic().appendChild(a)});let r=e.getSharedVar("highlightColor"),n=Object.entries(e.getSharedVar("highlightAttrValues")||{});if(r||n.length){let a=Ie(e.getSharedVar("result"));r&&a.attr("fill",r).attr("stroke",r),n.forEach(([i,o])=>{a.attr(i,o)})}let s=e.getSharedVar("tooltip");if(s){if(typeof s=="object"&&(s.fields&&s.fields.length||s.text)){let a=[],i=!1;typeof s=="object"&&s.prefix&&a.push(s.prefix),s.text&&(a.push(s.text),i=!0),s.fields&&s.fields.length&&s.fields.forEach(c=>{let l=t.getDatum(e.getSharedVar("result")?.[0])?.[c]??"";l&&(a.push(l),i=!0)}),typeof s=="object"&&s.suffix&&a.push(s.suffix);let o=a.join(" ");o&&i&&X(t.getGraphic()).append("text").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).text(o)}if(typeof s=="object"&&s.image){if(typeof s.image=="string")X(t.getGraphic()).append("image").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).attr("width",s.width??100).attr("height",s.height??100).attr("style","object-fit: contain").attr("xlink:href",s.image);else if(s.image instanceof Function)try{let a=s.image(t.getDatum(e.getSharedVar("result")[0]));a&&X(t.getGraphic()).append("image").attr("x",e.getSharedVar("x")-(t._offset?.x??0)+(s.offset?.x??0)).attr("y",e.getSharedVar("y")-(t._offset?.y??0)+(s.offset?.y??0)).attr("width",s.width??100).attr("height",s.height??100).attr("style","object-fit: contain").attr("xlink:href",a)}catch(a){}}}}});J.register("HelperLineTransformer",{constructor:J,transient:!0,sharedVar:{orientation:["horizontal","vertical"],style:{}},redraw({layer:t,transformer:e}){let r=t.getLayerFromQueue("mainLayer"),n=e.getSharedVar("orientation"),s=e.getSharedVar("style"),a=e.getSharedVar("x"),i=e.getSharedVar("y"),o=e.getSharedVar("tooltip"),c=e.getSharedVar("scaleX"),l=e.getSharedVar("scaleY"),f=[],h=0,m=0;o&&(typeof o=="object"&&o.prefix&&f.push(o.prefix),c&&c.invert&&typeof a=="number"&&f.push(c.invert(a-(t._offset?.x??0))),l&&l.invert&&typeof i=="number"&&f.push(l.invert(i-(t._offset?.y??0))),typeof o=="object"&&o.suffix&&f.push(o.suffix),typeof o=="object"&&o.offset&&(typeof o.offset.x=="number"&&(h=o.offset.x),typeof o.offset.y=="number"&&(m=o.offset.y),typeof o.offset.x=="function"&&typeof a=="number"&&(h=o.offset.x(a-(t._offset?.x??0))),typeof o.offset.y=="function"&&typeof i=="number"&&(m=o.offset.y(i-(t._offset?.y??0)))));let g=f.join(" ");if(n.includes("horizontal")&&typeof i=="number"){let _=X(t.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",i-(t._offset?.y??0)).attr("y2",i-(t._offset?.y??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}if(n.includes("vertical")&&typeof a=="number"){let _=X(t.getGraphic()).append("line").attr("y1",0).attr("y2",r.getGraphic().getBoundingClientRect().height).attr("x1",a-(t._offset?.x??0)).attr("x2",a-(t._offset?.x??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}g&&X(t.getGraphic()).append("text").attr("x",a-(t._offset?.x??0)).attr("y",i-(t._offset?.y??0)).text(g)}});J.register("TextTransformer",{constructor:J,transient:!0,sharedVar:{style:{},content:"",field:null},redraw({layer:t,transformer:e}){let r=e.getSharedVar("style"),n=e.getSharedVar("offsetx")||e.getSharedVar("x"),s=e.getSharedVar("offsety")||e.getSharedVar("y"),a=e.getSharedVar("content"),i=e.getSharedVar("field"),o=e.getSharedVar("result"),c=e.getSharedVar("position"),l=a,f=n,h=s;if(i){let m=t.getDatum(o);if(m)if(l=m?.[i]??"",c instanceof Function){let{x:g,y:_}=c(m);f=g??f,h=_??h}else f=c?.x??f,h=c?.y??h;else l=""}X(t.getGraphic()).append("text").attr("x",f).attr("y",h).text(l).call(m=>{r&&Object.entries(r).forEach(([g,_])=>{m.style(g,_)})})}})});var vr,Qs,H,Ge=d(()=>{Xr();Xr();bf();vr=J,Qs=Vt,H=J});var Vf,kt,Sn,P,Jm,YS,ep,jf,Ot=d(()=>{ge();Ge();kt={},Sn=[],P=class{constructor(e,r){this.joining=!1,this._linkCache={},this._transformers=[],this._joinTransformers=[],this._services=[],this._joinServices=[],this._initializing=null,this._nextTick=0,this._computing=null,this._result=null,this._oldResult=null,this._command=[],this[Vf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._sharedVar={},this._transformers=r.transformers??[],this._joinTransformers=r.joinTransformers??[],this._services=r.services??[],this._joinServices=r.joinServices??[],this._command=r.command??[],this._layerInstances=[],this._resultAlias=r.resultAlias??"result",this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._initializing=Promise.all(Object.entries(r.sharedVar||{}).map(n=>this.setSharedVar(n[0],n[1]))).then(async()=>{r.postUpdate&&r.postUpdate.call(this,this),this._postUpdate=r.postUpdate??null,this._initializing=null}),r.layer&&this._layerInstances.push(r.layer),Sn.push(this),r.postInitialize&&r.postInitialize.call(this,this)}getSharedVar(e,r){if(!(r&&r.layer&&this._layerInstances.length&&!this._layerInstances.includes(r.layer)))return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}async setSharedVar(e,r,n){if(this.preUpdate(),this._sharedVar[e]=r,this._userOptions.evaluate&&this._resultAlias){if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._oldResult=this._result;try{this._computing=this._userOptions.evaluate({self:this,...this._userOptions.params??{},...this._sharedVar}),this._result=await this._computing,this._computing=null,this._services.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})}),this._transformers.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})})}catch(s){console.error(s),this._result=void 0,this._computing=null}this._nextTick=0,this.postUpdate()})}else this.postUpdate()}async setSharedVars(e,r){Object.entries(e).forEach(([n,s])=>{this._sharedVar[n]=s}),Object.keys(e).length>0&&await this.setSharedVar(...Object.entries(e)[0],r)}async join(){if(this._resultAlias){this.joining=!0,Object.keys(this._sharedVar).length&&this.setSharedVar(...Object.entries(this._sharedVar)[0]);let e=await this._internalResults;this._joinServices&&this._joinServices.length?await Promise.all(this._joinServices.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))):this._initializing||await Promise.all(this._services.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))),this._joinTransformers&&this._joinTransformers.length?await Promise.all(this._joinTransformers.map(r=>r.setSharedVar(this._resultAlias,e))):this._initializing||await Promise.all(this._transformers.map(r=>r.setSharedVar(this._resultAlias,e))),this.joining=!1}}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}preAttach(e){this._preAttach&&this._preAttach.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}invokeCommand(){this._command.forEach(e=>{e.execute({self:this,...this._userOptions.params??{},...this._sharedVar})}),this._services.forEach(e=>{e.invokeCommand()})}isInstanceOf(e){return this._baseName===e||this._name===e}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>{e.setSharedVars({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}),this._transformers.splice(this._transformers.indexOf(e),1)},this)}get services(){return ve(this._services.slice(0),P,e=>this._services.push(e),e=>{Object.entries({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}).forEach(([r,n])=>{e.setSharedVar(r,n)}),this._services.splice(this._services.indexOf(e),1)},this)}get _internalResults(){return this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing?e(await this._computing):e(this._result)})}):this._computing||this._result}get results(){return this._initializing?this._initializing.then(()=>this._internalResults):this._internalResults}get oldResults(){return this._initializing?this._initializing.then(()=>this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult):this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult}static register(e,r){kt[e]=r}static unregister(e){return delete kt[e],!0}static initialize(e,r){let n=Object.assign({constructor:P},kt[e]??{},r??{},{on:Object.assign({},(kt[e]??{}).on??{},r?.on??{}),sharedVar:Object.assign({},(kt[e]??{}).sharedVar??{},r?.sharedVar??{}),params:Object.assign({},(kt[e]??{}).params??{},r?.params??{})});return new n.constructor(e,n)}static findService(e){return Sn.filter(r=>r.isInstanceOf(e))}};Vf=_e;Jm=P.register,YS=P.unregister,ep=P.initialize,jf=P.findService});var Ve,Hs=d(()=>{Ot();ge();Ge();Ve=class extends P{constructor(e,r){super(e,{...r,resultAlias:r?.resultAlias??"result"});this._currentDimension=[],this._transformers.push(H.initialize("SelectionTransformer",{transient:!0,sharedVar:{[this._resultAlias]:[],layer:null,highlightColor:r?.sharedVar?.highlightColor,highlightAttrValues:r?.sharedVar?.highlightAttrValues,tooltip:r?.sharedVar?.tooltip}})),this._selectionMapping=new Map,Object.entries({...this._userOptions?.query?.attrName?typeof this._userOptions.query.attrName=="string"?{[this._userOptions.query.attrName]:this._userOptions?.query?.extent??[]}:Object.fromEntries(this._userOptions.query.attrName.map((n,s)=>[n,this._userOptions?.query?.extent?.[s]??[]])):{},...this._sharedVar?.attrName?typeof this._sharedVar.attrName=="string"?{[this._sharedVar.attrName]:this._sharedVar?.extent??[]}:Object.fromEntries(this._sharedVar.attrName.map((n,s)=>[n,this._sharedVar?.extent?.[s]??[]])):{}}).filter(([n,s])=>s instanceof Array).forEach(([n,s])=>this._selectionMapping.set(n,s))}async setSharedVar(e,r,n){if(!(n&&n.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(n.layer)))if(this.preUpdate(),this._sharedVar[e]=r,this._transformers.filter(s=>s.isInstanceOf("draw-shape")).forEach(s=>{let a=n?.layer||this._layerInstances[0];if(!a)return;let i=a.getGraphic().getBoundingClientRect();if(a._width&&i.width>a._width||a._height&&i.height>a._height){let h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width",a._width.toString()),h.setAttribute("height",a._height.toString()),h.setAttribute("opacity","0"),a.getGraphic().appendChild(h),i=h.getBoundingClientRect(),a.getGraphic().removeChild(h)}let o=this._sharedVar.x??i.left,c=this._sharedVar.y??i.top,l=this._sharedVar.width??a._width??0,f=this._sharedVar.height??a._height??0;(this._sharedVar.width!==void 0||this._sharedVar.height!==void 0)&&s.setSharedVars({layer:a.getLayerFromQueue("transientLayer"),x:o-i.left,y:c-i.top,width:l,height:f})}),(n?.layer||this._layerInstances.length==1)&&this._userOptions.query){let s=n?.layer||this._layerInstances[0];if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._evaluate(s)})}else this.postUpdate()}_evaluate(e){if(!e)return;this._sharedVar.skipPicking||(this._oldResult=this._result,this._result=e.picking({...this._userOptions.query,...this._sharedVar}));let r=e.getLayerFromQueue("selectionLayer").getGraphic();for(;r?.firstChild;)r.removeChild(r.lastChild);if(this._sharedVar.deepClone){let n=[],s=[];this._result.forEach(a=>{if(a!==e.getGraphic()){let i=s.length;for(let o=0;o<i;o++){let c=s[o],l=n[o];a.contains(c)&&(s.splice(o,1),n.splice(o,1),l.remove(),o--,i--)}n.push(e.cloneVisualElements(a,!0)),s.push(a)}}),this._services.forEach(a=>{a.setSharedVars({...this._sharedVar,[this._resultAlias]:n})}),this._transformers.filter(a=>!a.isInstanceOf("draw-shape")).forEach(a=>{a.setSharedVars({...this._sharedVar,layer:e.getLayerFromQueue("selectionLayer"),[this._resultAlias]:n})})}else this._services.forEach(n=>{n.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})}),this._transformers.filter(n=>!n.isInstanceOf("draw-shape")).forEach(n=>{n.setSharedVars({...this._sharedVar,layer:e.getLayerFromQueue("selectionLayer"),[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})});if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert&&this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.offsety,a=this._sharedVar.width,i=this._sharedVar.height,o=e._offset?.x??0,c=e._offset?.y??0,l=[n-o,n-o+a].map(this._sharedVar.scaleX.invert),f=[s-c,s-c+i].map(this._sharedVar.scaleY.invert);this.filter([l,f],{passive:!0})}else if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.width,a=e._offset?.x??0,i=[n-a,n-a+s].map(this._sharedVar.scaleX.invert);this.filter(i,{passive:!0})}else if(this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsety,s=this._sharedVar.height,a=e._offset?.y??0,i=[n-a,n-a+s].map(this._sharedVar.scaleY.invert);this.filter(i,{passive:!0})}this._nextTick=0,this.postUpdate()}isInstanceOf(e){return e==="SelectionService"||this._baseName===e||this._name===e}dimension(e,r){let n=[],s=[];typeof e=="string"?(n=[e],s=[r??(c=>c)]):(n=se(e),s=r??n.map(()=>c=>c));let a=n.map((c,l)=>[c,s[l]]),i={},o=[];return this._currentDimension=a,new Proxy(this,{get(c,l,f){return l==="dimension"?c.dimension.bind(c):l==="_currentDimension"?a:l==="_scopeMode"?!0:l==="_sharedVar"?Object.keys(i).length?new Proxy({...c._sharedVar,scaleX:void 0,scaleY:void 0,...i},{set:(h,m,g)=>(i[m]=g,!0)}):new Proxy(c._sharedVar,{set:(h,m,g)=>(i[m]=g,!0)}):l==="_layerInstances"?o.length?o:c._layerInstances:c[l]instanceof Function?c[l].bind(f):c[l]},set(c,l,f){return l==="_layerInstances"?(o=f,!0):(c[l]=f,!0)}})}filter(e,r){if(r&&r.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(r.layer))return this;let n=r?.layer||this._layerInstances[0];return this._currentDimension.length===0&&e instanceof Array&&e.length>0?(this._sharedVar.attrName&&(this._userOptions.query.attrName=this._sharedVar.attrName),this._userOptions.query.attrName&&this.dimension(this._userOptions.query.attrName).filter(e)):this._currentDimension.length===1&&e instanceof Array&&e.length>0&&!(e[0]instanceof Array)?(this._selectionMapping.set(this._currentDimension[0][0],this._currentDimension[0][1](e).sort((s,a)=>typeof s=="number"?s-a:s<a?-1:s==a?0:1)),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})):this._currentDimension.length===e.length&&e.every(s=>s instanceof Array)&&(this._currentDimension.forEach((s,a)=>{this._selectionMapping.set(s[0],s[1](e[a]).sort((i,o)=>typeof i=="number"?i-o:i<o?-1:i==o?0:1))}),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})),this}get extents(){return Object.fromEntries(this._selectionMapping.entries())}};P.SelectionService=Ve;P.register("SelectionService",{constructor:Ve});P.register("SurfacePointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.SurfacePoint,x:0,y:0}});P.register("PointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Point,x:0,y:0}});P.register("RectSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Shape,type:U.Rect,x:0,y:0,width:1,height:1}});P.register("CircleSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Circle,x:0,y:0,r:1}});P.register("PolygonSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:U.Polygon,points:[]}});P.register("QuantitativeSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Data,type:tt.Quantitative,attrName:"",extent:[0,0]}})});var wr,Tf=d(()=>{Ot();wr=class extends P{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="LayoutService"||this._baseName===e||this._name===e}};P.LayoutService=wr;P.register("LayoutService",{constructor:wr});P.register("ScaleService",{constructor:wr,evaluate({offsetx:t,width:e,offsety:r,height:n,scaleX:s,scaleY:a,layer:i,self:o}){let c=i;if(!c&&o._layerInstances&&o._layerInstances.length==1&&(c=o._layerInstances[0]),s&&s.invert&&!a){if(e<=0||isNaN(e))return s;let l=s.copy(),f=l.invert(t-(c?._offset?.x??0)),h=l.invert(t+e-(c?._offset?.x??0));return l.domain([f,h]),l.clamp(!0),l}if(!s&&a&&a.invert){if(n<=0||isNaN(n))return a;let l=a.copy(),f=l.invert(r-(c?._offset?.y??0)),h=l.invert(r+n-(c?._offset?.y??0));return l.domain([f,h]),l.clamp(!0),l}if(s&&a&&s.invert&&a.invert){if(e<=0||isNaN(e)||n<=0||isNaN(n))return{scaleX:s,scaleY:a};let l=s.copy(),f=a.copy(),h=l.invert(t-(c?._offset?.x??0)),m=l.invert(t+e-(c?._offset?.x??0)),g=f.invert(r-(c?._offset?.y??0)),_=f.invert(r+n-(c?._offset?.y??0));return l.domain([h,m]),f.domain([g,_]),l.clamp(!0),f.clamp(!0),{scaleX:l,scaleY:f}}return{scaleX:s,scaleY:a}}})});var rt,If=d(()=>{Ot();ge();gt();rt=class extends P{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="AnalysisService"||this._baseName===e||this._name===e}};P.AnalysisService=rt;P.register("AnalysisService",{constructor:rt});P.register("FilterService",{constructor:rt,evaluate({data:t,extents:e,result:r,fields:n,self:s}){if(!e&&(!r||!r.length||!n||!n.length))return e?t:[];if(!t)try{let a=s._layerInstances;a&&a.length>0&&(t=[...a[0].getGraphic().childNodes].filter(i=>a[0].getDatum(i)).map(i=>Object.assign(a[0].cloneVisualElements(i),a[0].getDatum(i))))}catch(a){console.error("failed to get data from layerInstances",a)}if(e)Object.entries(e).forEach(([a,i])=>{i[0]>=i[1]||isNaN(i[0])||isNaN(i[1])||(t=t.filter(o=>o[a]>=i[0]&&o[a]<=i[1]))});else{let a=s._layerInstances,i=Ie(r).datum();a&&a.length>0&&(i=a[0].getDatum(r[0])),i&&n.forEach(o=>{t=t.filter(c=>c[o]==i[o])})}return t}});P.register("InterpolationService",{constructor:rt,evaluate({result:t,field:e,data:r,formula:n}){if(!t)return null;let{data:s,interpolatedNum:a}=t;if(!s||a===void 0||isNaN(a))return null;let i=Math.floor(a),o=s[i][e],c=r.filter(l=>l[e]===o);if(a>i){let l=i+1,f=a-i;c=c.map(h=>{let m=r.find(g=>g[e]===s[l][e]&&!Object.entries(h).find(([_,x])=>typeof x!="number"&&g[_]!==x));return Object.fromEntries(Object.entries(h).map(([g,_])=>typeof _=="number"?[g,_*(1-f)+m[g]*f]:[g,_]))})}return c.map(l=>(n&&Object.entries(n).forEach(([f,h])=>{l[f]=h(l)}),l))}});P.register("DataJoinService",{constructor:rt,evaluate({data:t,result:e,offset:r,scaleX:n,scaleY:s,fieldX:a,fieldY:i,replace:o,self:c}){if(!e||e.length<=0)return t;let l=c._layerInstances;if(l&&l.length>0){let f=l[0].getDatum(e[0]);if(f){let h=se(f);if(r!==void 0&&n&&n.invert&&a&&(f[a]=n.invert(n(f[a])+parseFloat(r.x))),r!==void 0&&s&&s.invert&&i&&i!==a&&(f[i]=s.invert(s(f[i])+parseFloat(r.y))),o)return t;{let m=se(t);return Object.assign(f,h),m}}}return t}});P.register("AggregateService",{constructor:rt,evaluate({result:t}){return t instanceof Array?t.length:0}})});var Ef,Ws,Z,Lt=d(()=>{Ot();Ot();Hs();Tf();If();Ef=jf,Ws=Sn,Z=P});var Af,Cf=d(()=>{Af=`#JSGF V1.0;

grammar actions;

public <action> = start | stop | pause | resume | play | delete | add | insert | create | remove | drag | move | drag | brush;`});function Ks(t){let e=t.events.map(r=>{if(typeof r=="string")return Vn(r)[0];{let n=Vn("*")[0];n.filterFuncs=[r]}});return{...t,eventStreams:e.map(r=>np(r))}}function np(t){return t.filter?{...t,filterFuncs:t.filter?t.filter.map(e=>new Function("event",`return ${e}`)):[]}:{...t}}var Mf,tp,rp,Zs,bn,z,ab,ib,ob,cb,Sr=d(()=>{ge();Cf();tp=window.SpeechRecognition||window.webkitSpeechRecognition,rp=window.SpeechGrammarList||window.webkitSpeechGrammarList,Zs={},bn=[],z=class{constructor(e,r){this[Mf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._state=r.state,this._actions=se(r.actions??[]).map(Ks),this._modalities={},this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUse=r.preUse??null,this._postUse=r.postUse??null,r.postInitialize&&r.postInitialize.call(this,this)}enableModality(e){switch(e){case"speech":if(this._modalities.speech)break;let r=new tp;this._modalities.speech=r;let n=new rp;n.addFromString(Af),r.grammars=n,r.lang="en-US";break}}disableModality(e){switch(e){case"speech":this._modalities.speech&&(this._modalities.speech.onresult=null,this._modalities.speech.onend=null,this._modalities.speech.abort(),this._modalities.speech=null);break}}getActions(){return this._actions.slice(0)}setActions(e){let r=e.concat(this._actions);this._actions=r.filter((n,s)=>s===r.findIndex(a=>a.action===n.action))}_parseEvent(e){let r=n=>"stream"in n?n.between.concat(n.stream).flatMap(r):"between"in n?n.between.concat([{type:n.type}]).flatMap(r):n.type;return Vn(e).flatMap(r)}getAcceptEvents(){return[...new Set(this._actions.flatMap(e=>e.eventStreams.flatMap(r=>r.type)).concat(["contextmenu"]))]}async dispatch(e,r){let n=this._actions.find(s=>{let a=s.eventStreams.map(o=>o.type),i=!1;return a.includes("*")&&(i=!0),e instanceof Event?i=s.eventStreams.filter(o=>o.type===e.type).some(o=>o.filterFuncs?o.filterFuncs.every(c=>c(e)):!0):a.includes(e)&&(i=!0),i&&(!s.transition||s.transition.find(o=>o[0]===this._state||o[0]==="*"))});if(n){let s=n.transition&&n.transition.find(a=>a[0]===this._state||a[0]==="*");if(s){if(this._state=s[1],this._state.startsWith("speech:")){this.enableModality("speech");try{this._modalities.speech.start()}catch{}this._modalities.speech.onresult=a=>{let i=a.results[a.resultIndex][0];this.dispatch(i.transcript,r)},this._modalities.speech.onend=a=>{this._modalities.speech.start()}}else this.disableModality("speech");if(n.sideEffect)try{await n.sideEffect({self:this,layer:r,instrument:null,interactor:this,event:e})}catch(a){console.error(a)}return!0}}return!1}preUse(e){this._preUse&&this._preUse.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return e=="Interactor"||this._baseName===e||this._name===e}static register(e,r){Zs[e]=r}static unregister(e){return delete Zs[e],!0}static initialize(e,r){let n=Object.assign({constructor:z},Zs[e]??{},r??{}),s=new n.constructor(e,n);return bn.push(s),s}static findInteractor(e){return bn.filter(r=>r.isInstanceOf(e))}};Mf=_e;ab=z.register,ib=z.unregister,ob=z.initialize,cb=z.findInteractor});var Rf=d(()=>{Sr();z.register("MousePositionInteractor",{constructor:z,state:"start",actions:[{action:"hover",events:["mousemove"],transition:[["start","start"]]},{action:"click",events:["mouseup"],transition:[["start","start"]]}]});z.register("TouchPositionInteractor",{constructor:z,state:"start",actions:[{action:"enter",events:["touchstart"],transition:[["start","running"]]},{action:"hover",events:["touchmove"],transition:[["running","running"]]},{action:"leave",events:["touchend"],transition:[["running","start"],["start","start"]]}]});z.register("MouseTraceInteractor",{constructor:z,state:"start",actions:[{action:"dragabort",events:["mousedown[event.button==2]","mouseup[event.button==2]"],transition:[["drag","start"]]},{action:"dragstart",events:["mousedown"],transition:[["start","drag"]]},{action:"drag",events:["mousemove"],transition:[["drag","drag"]]},{action:"dragend",events:["mouseup[event.button==0]"],transition:[["drag","start"]]}]});z.register("TouchTraceInteractor",{constructor:z,state:"start",actions:[{action:"dragstart",events:["touchstart"],transition:[["start","drag"]]},{action:"drag",events:["touchmove"],transition:[["drag","drag"]]},{action:"dragend",events:["touchend"],transition:[["drag","start"]]}]});z.register("SpeechControlInteractor",{constructor:z,state:"start",actions:[{action:"enableSpeech",events:["click"],transition:[["*","speech:ready"]]},{action:"disableSpeech",events:["mouseup[event.button==2]"],transition:[["*","start"]]},{action:"speech",events:["*"],transition:[["*","speech:ready"]]}]});z.register("KeyboardPositionInteractor",{constructor:z,state:"start",actions:[{action:"begin",events:["keydown[event.key===' ']"],transition:[["start","running"]]},{action:"up",events:["keypress[event.key==='w' || event.key==='W']","keydown[event.key==='ArrowUp']{100}"],transition:[["running","running"]]},{action:"left",events:["keypress[event.key==='a' || event.key==='A']","keydown[event.key==='ArrowLeft']{100}"],transition:[["running","running"]]},{action:"down",events:["keypress[event.key==='s' || event.key==='S']","keydown[event.key==='ArrowDown']{100}"],transition:[["running","running"]]},{action:"right",events:["keypress[event.key==='d' || event.key==='D']","keydown[event.key==='ArrowRight']{100}"],transition:[["running","running"]]}]});z.register("MouseWheelInteractor",{constructor:z,state:"start",actions:[{action:"enter",events:["mouseenter"],transition:[["start","running"]]},{action:"wheel",events:["wheel","mousewheel"],transition:[["running","running"]]},{action:"leave",events:["mouseleave"],transition:[["running","start"],["start","start"]]},{action:"abort",events:["mouseup[event.button==2]"],transition:[["running","running"],["start","start"]]}]})});var pb,gb,yb,Js,Ue,br=d(()=>{Sr();Sr();Rf();pb=z.register,gb=z.initialize,yb=z.findInteractor,Js=bn,Ue=z});function Pf(t,e){Of[t]=e}function Df(t,e){let r=Object.assign({constructor:K},Of[t]??{},e??{},{});return new r.constructor(t,r)}function Yf(t){return Lf.filter(e=>e.isInstanceOf(t))}var kf,Of,Lf,Pt,nt,K,Dt=d(()=>{ge();Of={},Lf=[],Pt=new Map,nt=new Map,K=class{constructor(e,r){this._nextTick=0,this[kf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._container=r.container,this._order=0,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._postUpdate=r.postUpdate??null,Lf.push(this),this._postInitialize&&this._postInitialize.call(this,this)}getGraphic(){return this._graphic}getContainerGraphic(){return this._container}getVisualElements(){return[]}cloneVisualElements(e,r=!1){let n=e.cloneNode(r);return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}getDatum(e){return null}join(e,r){return[]}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}picking(e){return[]}isPointInPolygon(e,r){let n=!1;for(let s=0,a=r.length-1;s<r.length;a=s++){let i=r[s].x,o=r[s].y,c=r[a].x,l=r[a].y;o>e.y!=l>e.y&&e.x<(c-i)*(e.y-o)/(l-o)+i&&(n=!n)}return n}pathIntersectsRect(e,r){let n=e.getTotalLength();if(n<=0)return!1;let s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(i.x>=r.x&&i.x<=r.x+r.width&&i.y>=r.y&&i.y<=r.y+r.height)return!0}return!1}getLayerFromQueue(e){Pt.has(this)||Pt.set(this,{[this._name]:this}),nt.has(this)||nt.set(this,{[this._name]:0});let r=Pt.get(this);if(!(e in r)){let n=K.initialize(this._baseName,{...this._userOptions,name:e,group:"",redraw(){}});r[e]=n,Pt.set(n,r);let s=r[e].getGraphic();s&&s.style&&(s.style.pointerEvents="none")}return e in nt.get(this)||(nt.get(this)[e]=0),r[e]}setLayersOrder(e){Pt.has(this)||Pt.set(this,{[this._name]:this}),nt.has(this)||nt.set(this,{[this._name]:0});let r=nt.get(this),n=document.createDocumentFragment();Object.entries(e).forEach(([s,a])=>{r[s]=a}),Object.entries(r).sort((s,a)=>s[1]-a[1]).forEach(([s,a])=>{if(r[s]=a,nt.set(this.getLayerFromQueue(s),r),a>=0){let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="initial")}else{let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="none")}this.getLayerFromQueue(s)._order=a,n.append(this.getLayerFromQueue(s).getGraphic(!0))}),this.getContainerGraphic().appendChild(n)}isInstanceOf(e){return this._baseName===e||this._name===e}};kf=_e;K.register=Pf;K.initialize=Df;K.findLayer=Yf});var Xf,Yt,Vr,zf=d(()=>{Dt();gt();ge();Xf="D3Layer",Yt="ig-layer-background",Vr=class extends K{constructor(e,r){super(e,r);this._width=r.width,this._height=r.height,this._offset=r.offset,this._name=r.name,this._graphic=X(r.container).append("g").call(s=>{this._name&&s.attr("className",this._name)}).call(s=>{this._offset&&s.attr("transform",`translate(${this._offset.x||0}, ${this._offset.y||0})`)}).node(),X(this._graphic).append("rect").attr("class",Yt).attr("width",this._width).attr("height",this._height).attr("opacity",0);let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum():X(e).datum()}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Yt})`)]}cloneVisualElements(e,r=!1){let n=X(e).clone(r).node();return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Yt)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(this._isElementInLayer.bind(this)),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(this._isElementInLayer.bind(this))}else if(e.type===U.Circle){let i=e.x-n.left,o=e.y-n.top,c=e.r,l=Math.floor(c*Math.sin(Math.PI/4))<<1,f=i-(l>>>1),h=o-(l>>>1),m=new Set,g=this._svg.createSVGRect();g.x=f,g.y=h,g.width=l,g.height=l,this._svg.getIntersectionList(g,this._graphic).forEach(M=>m.add(M));let _=[...this._graphic.querySelectorAll("path")].filter(M=>window.getComputedStyle(M).fill==="none");_.length>0&&_.filter(D=>{let ce=this.transformRect(g,this._graphic);return this.pathIntersectsRect(D,ce)}).forEach(D=>m.add(D));let x=c,w=i-c,V=o-c,E=new Set,j=this._svg.createSVGRect();j.x=w,j.y=V,j.width=x*2,j.height=x*2,this._svg.getIntersectionList(j,this._graphic).forEach(M=>E.add(M)),_.length>0&&_.filter(D=>{let ce=this.transformRect(j,this._graphic);return this.pathIntersectsRect(D,ce)}).forEach(D=>E.add(D));let W=1;for(;;){for(let je of E)m.has(je)&&E.delete(je);if(!E.size||W*2+l>=c*2)break;let M=Math.sqrt(c*c-Math.pow(l/2+W,2)),D=this._svg.createSVGRect();D.x=i-M,D.y=h-W,D.width=M*2,D.height=1;let ce=this._svg.createSVGRect();ce.x=i-M,ce.y=h+l+W-1,ce.width=M*2,ce.height=1;let de=this._svg.createSVGRect();de.x=f-W,de.y=o-M,de.width=1,de.height=M*2;let Ae=this._svg.createSVGRect();Ae.x=f+l+W-1,Ae.y=o-M,Ae.width=1,Ae.height=M*2,[D,ce,de,Ae].forEach(je=>{this._svg.getIntersectionList(je,this._graphic).forEach(le=>m.add(le));let R=[...this._graphic.querySelectorAll("path")].filter(le=>window.getComputedStyle(le).fill==="none");R.length>0&&R.filter(re=>{let we=this.transformRect(je,this._graphic);return this.pathIntersectsRect(re,we)}).forEach(re=>m.add(re))}),W++}r=[...m].filter(this._isElementInLayer.bind(this))}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,m=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=f,_.y=h,_.width=m,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(w=>!w.classList.contains(Yt));let x=[...this._graphic.querySelectorAll("path")].filter(w=>window.getComputedStyle(w).fill==="none");if(x.length>0){let w=x.filter(V=>{let E=this.transformRect(_,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...w])]}}else if(e.type===U.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(f=>({x:f.x-o.left,y:f.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement)}return a}_dataQuery(e){let r=[],n=Ie(this.getVisualElements());if(e.type===tt.Quantitative){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(f=>f&&f[o]!==void 0&&l[0]<f[o]&&f[o]<l[1])}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a[0]<i[s]&&i[s]<a[1]).nodes()}else if(e.type===tt.Nominal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(f=>f&&f[o]!==void 0&&l.findIndex(f[o])>=0)}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a.findIndex(i[s])>=0).nodes()}else if(e.type===tt.Temporal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c],f=e.dateParser?.[c]??(h=>h);i=i.filter(h=>h&&h[o]!==void 0&&l[0].getTime()<f(h[o]).getTime()&&f(h[o]).getTime()<l[1].getTime())}),r=i.nodes()}else{let i=e.dateParser||(o=>o);r=n.filter(o=>o&&o[s]!==void 0&&a[0].getTime()<i(o[s]).getTime()&&i(o[s]).getTime()<a[1].getTime()).nodes()}}return r}_attrQuery(e){let{attrName:r,value:n}=e;return X(this._graphic).filter(a=>a[r]===n).nodes()}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Yt)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(f=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(f,h)}).forEach(f=>r.add(f)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let f=s/10;c+f<=r.maxY;f+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:f},e)){let h=l*f;h>a&&(a=h,i={x:o,y:c,width:l,height:f})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Yt)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(f=>this.isPointInPolygon(f,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.D3Layer=Vr;K.register(Xf,{constructor:Vr});K.register(Xf,{constructor:Vr})});var ea=d(()=>{});function Ff(t){return{a:parseFloat(t.a),b:parseFloat(t.b),c:parseFloat(t.c),d:parseFloat(t.d),e:parseFloat(t.e),f:parseFloat(t.f)}}var ta=d(()=>{});var Nf=d(()=>{});var qf=d(()=>{});var ra=d(()=>{});function yt(t){return typeof t=="undefined"}var jn=d(()=>{});var Gf=d(()=>{jn()});function De(t,e=0){return{a:1,c:0,e:t,b:0,d:1,f:e}}var Xt=d(()=>{});function xt(...t){t=Array.isArray(t[0])?t[0]:t;let e=(r,n)=>({a:r.a*n.a+r.c*n.b,c:r.a*n.c+r.c*n.d,e:r.a*n.e+r.c*n.f+r.e,b:r.b*n.a+r.d*n.b,d:r.b*n.c+r.d*n.d,f:r.b*n.e+r.d*n.f+r.f});switch(t.length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{let[r,n,...s]=t,a=e(r,n);return xt(a,...s)}}}function zt(...t){return xt(...t)}var _t=d(()=>{});function Uf(t,e,r){let n=sp(t),s=ap(t),a={a:n,c:-s,e:0,b:s,d:n,f:0};return yt(e)||yt(r)?a:xt([De(e,r),a,De(-e,-r)])}function na(t,e=void 0,r=void 0){return Uf(t*ip/180,e,r)}var sp,ap,ip,Tn=d(()=>{jn();Xt();_t();({cos:sp,sin:ap,PI:ip}=Math)});function jr(t,e=void 0,r=void 0,n=void 0){yt(e)&&(e=t);let s={a:t,c:0,e:0,b:0,d:e,f:0};return yt(r)||yt(n)?s:xt([De(r,n),s,De(-r,-n)])}var Tr=d(()=>{jn();Xt();_t()});function $f(t,e){return{a:1,c:t,e:0,b:e,d:1,f:0}}var sa=d(()=>{});function op(t,e){return{a:1,c:Bf(t),e:0,b:Bf(e),d:1,f:0}}function aa(t,e){return op(t*Math.PI/180,e*Math.PI/180)}var Bf,ia=d(()=>{({tan:Bf}=Math)});var Qf=d(()=>{});var oa=d(()=>{});var Hf=d(()=>{ra();_t();oa()});function In(t){return Array.isArray(t)?t.map(e):e(t);function e(r){switch(r.type){case"matrix":if("a"in r&&"b"in r&&"c"in r&&"d"in r&&"e"in r&&"f"in r)return Ff(r);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in r?De(r.tx,r.ty):De(r.tx);case"scale":if(!("sx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in r?jr(r.sx,r.sy):jr(r.sx);case"rotate":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in r&&"cy"in r?na(r.angle,r.cx,r.cy):na(r.angle);case"skewX":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return aa(r.angle,0);case"skewY":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return aa(0,r.angle);case"shear":if(!("shx"in r&&"shy"in r))throw new Error("MISSING_MANDATORY_PARAM");return $f(r.shx,r.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR")}}}var Wf=d(()=>{ta();Xt();Tr();Tn();ia();sa()});function cp(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function vt(t,e,r,n){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,vt.prototype),s.expected=e,s.found=r,s.location=n,s.name="SyntaxError",s}function ca(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,r+=r.repeat(e),t+r.slice(0,e))}function Zf(t,e){e=e!==void 0?e:{};var r={},n=e.grammarSource,s={transformList:Sa},a=Sa,i="matrix",o="(",c=")",l="translate",f="scale",h="rotate",m="skewX",g="skewY",_=",",x=".",w=/^[eE]/,V=/^[+\-]/,E=/^[0-9]/,j=/^[ \t\r\n]/,W=ke("matrix",!1),M=ke("(",!1),D=ke(")",!1),ce=ke("translate",!1),de=ke("scale",!1),Ae=ke("rotate",!1),je=ke("skewX",!1),R=ke("skewY",!1),le=ke(",",!1),re=_a("fractionalConstant"),we=ke(".",!1),St=Dr(["e","E"],!1,!1),$e=Dr(["+","-"],!1,!1),Be=Dr([["0","9"]],!1,!1),Qe=Dr([" ","	","\r",`
`],!1,!1),Se=function(u){return u},Pn=function(u,p){return u.concat(p)},Dn=function(u,p,v,b,O,I){return[{type:"matrix",a:u,b:p,c:v,d:b,e:O,f:I}]},Yn=function(u,p){var v={type:"translate",tx:u};return p&&(v.ty=p),[v]},Xn=function(u,p){var v={type:"scale",sx:u};return p&&(v.sy=p),[v]},zn=function(u,p){var v={type:"rotate",angle:u};return p&&(v.cx=p[0],v.cy=p[1]),[v]},Fn=function(u){return[{type:"skewX",angle:u}]},Nn=function(u){return[{type:"skewY",angle:u}]},qn=function(u){return parseFloat(u.join(""))},Gn=function(u){return parseInt(u.join(""))},T=function(u){return u},k=function(u,p){return[u,p]},L=function(u){return u.join("")},S=function(u,p){return[u,p||null].join("")},fe=function(u,p){return[u,p].join("")},F=function(u,p){return[u?u.join(""):null,".",p.join("")].join("")},me=function(u){return u.join("")},pe=function(u,p){return["e",u,p.join("")].join("")},y=0,N=0,Lr=[{line:1,column:1}],Re=0,Un=[],q=0,Pr;if("startRule"in e){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');a=s[e.startRule]}function Ep(){return t.substring(N,y)}function Ap(){return N}function Cp(){return{source:n,start:N,end:y}}function Mp(){return Ut(N,y)}function Rp(u,p){throw p=p!==void 0?p:Ut(N,y),wa([_a(u)],t.substring(N,y),p)}function kp(u,p){throw p=p!==void 0?p:Ut(N,y),xu(u,p)}function ke(u,p){return{type:"literal",text:u,ignoreCase:p}}function Dr(u,p,v){return{type:"class",parts:u,inverted:p,ignoreCase:v}}function Op(){return{type:"any"}}function yu(){return{type:"end"}}function _a(u){return{type:"other",description:u}}function va(u){var p=Lr[u],v;if(p)return p;for(v=u-1;!Lr[v];)v--;for(p=Lr[v],p={line:p.line,column:p.column};v<u;)t.charCodeAt(v)===10?(p.line++,p.column=1):p.column++,v++;return Lr[u]=p,p}function Ut(u,p,v){var b=va(u),O=va(p),I={source:n,start:{offset:u,line:b.line,column:b.column},end:{offset:p,line:O.line,column:O.column}};return v&&n&&typeof n.offset=="function"&&(I.start=n.offset(I.start),I.end=n.offset(I.end)),I}function $(u){y<Re||(y>Re&&(Re=y,Un=[]),Un.push(u))}function xu(u,p){return new vt(u,null,null,p)}function wa(u,p,v){return new vt(vt.buildMessage(u,p),u,p,v)}function Sa(){var u,p,v,b,O;for(u=y,p=[],v=C();v!==r;)p.push(v),v=C();for(v=ba(),v===r&&(v=null),b=[],O=C();O!==r;)b.push(O),O=C();return N=u,u=Se(v),u}function ba(){var u,p,v,b;if(u=y,p=Va(),p!==r){if(v=[],b=Oe(),b!==r)for(;b!==r;)v.push(b),b=Oe();else v=r;v!==r?(b=ba(),b!==r?(N=u,u=Pn(p,b)):(y=u,u=r)):(y=u,u=r)}else y=u,u=r;return u===r&&(u=Va()),u}function Va(){var u;return u=_u(),u===r&&(u=vu(),u===r&&(u=wu(),u===r&&(u=Su(),u===r&&(u=bu(),u===r&&(u=Vu()))))),u}function _u(){var u,p,v,b,O,I,ee,G,B,Bn,Aa,Qn,Ca,Hn,Ma,Wn,Ra,st;if(u=y,t.substr(y,6)===i?(p=i,y+=6):(p=r,q===0&&$(W)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r)if(ee=Oe(),ee!==r)if(G=xe(),G!==r)if(B=Oe(),B!==r)if(Bn=xe(),Bn!==r)if(Aa=Oe(),Aa!==r)if(Qn=xe(),Qn!==r)if(Ca=Oe(),Ca!==r)if(Hn=xe(),Hn!==r)if(Ma=Oe(),Ma!==r)if(Wn=xe(),Wn!==r){for(Ra=[],st=C();st!==r;)Ra.push(st),st=C();t.charCodeAt(y)===41?(st=c,y++):(st=r,q===0&&$(D)),st!==r?(N=u,u=Dn(I,G,Bn,Qn,Hn,Wn)):(y=u,u=r)}else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r;else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function vu(){var u,p,v,b,O,I,ee,G,B;if(u=y,t.substr(y,9)===l?(p=l,y+=9):(p=r,q===0&&$(ce)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=ja(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,q===0&&$(D)),B!==r?(N=u,u=Yn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function wu(){var u,p,v,b,O,I,ee,G,B;if(u=y,t.substr(y,5)===f?(p=f,y+=5):(p=r,q===0&&$(de)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=ja(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,q===0&&$(D)),B!==r?(N=u,u=Xn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Su(){var u,p,v,b,O,I,ee,G,B;if(u=y,t.substr(y,6)===h?(p=h,y+=6):(p=r,q===0&&$(Ae)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=ju(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,q===0&&$(D)),B!==r?(N=u,u=zn(I,ee)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function bu(){var u,p,v,b,O,I,ee,G;if(u=y,t.substr(y,5)===m?(p=m,y+=5):(p=r,q===0&&$(je)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();t.charCodeAt(y)===41?(G=c,y++):(G=r,q===0&&$(D)),G!==r?(N=u,u=Fn(I)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function Vu(){var u,p,v,b,O,I,ee,G;if(u=y,t.substr(y,5)===g?(p=g,y+=5):(p=r,q===0&&$(R)),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,q===0&&$(M)),b!==r){for(O=[],I=C();I!==r;)O.push(I),I=C();if(I=xe(),I!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();t.charCodeAt(y)===41?(G=c,y++):(G=r,q===0&&$(D)),G!==r?(N=u,u=Nn(I)):(y=u,u=r)}else y=u,u=r}else y=u,u=r}else y=u,u=r;return u}function xe(){var u,p,v,b;return u=y,p=y,v=$n(),v===r&&(v=null),b=Iu(),b!==r?(v=[v,b],p=v):(y=p,p=r),p!==r&&(N=u,p=qn(p)),u=p,u===r&&(u=y,p=y,v=$n(),v===r&&(v=null),b=Tu(),b!==r?(v=[v,b],p=v):(y=p,p=r),p!==r&&(N=u,p=Gn(p)),u=p),u}function ja(){var u,p,v;return u=y,p=Oe(),p!==r?(v=xe(),v!==r?(N=u,u=T(v)):(y=u,u=r)):(y=u,u=r),u}function ju(){var u,p,v,b,O;return u=y,p=Oe(),p!==r?(v=xe(),v!==r?(b=Oe(),b!==r?(O=xe(),O!==r?(N=u,u=k(v,O)):(y=u,u=r)):(y=u,u=r)):(y=u,u=r)):(y=u,u=r),u}function Oe(){var u,p,v,b,O;if(u=y,p=[],v=C(),v!==r)for(;v!==r;)p.push(v),v=C();else p=r;if(p!==r){for(v=Ta(),v===r&&(v=null),b=[],O=C();O!==r;)b.push(O),O=C();p=[p,v,b],u=p}else y=u,u=r;if(u===r)if(u=y,p=Ta(),p!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();p=[p,v],u=p}else y=u,u=r;return u}function Ta(){var u;return t.charCodeAt(y)===44?(u=_,y++):(u=r,q===0&&$(le)),u}function Tu(){var u,p;return u=y,p=bt(),p!==r&&(N=u,p=L(p)),u=p,u}function Iu(){var u,p,v;return u=y,p=Eu(),p!==r?(v=Ia(),v===r&&(v=null),N=u,u=S(p,v)):(y=u,u=r),u===r&&(u=y,p=bt(),p!==r?(v=Ia(),v!==r?(N=u,u=fe(p,v)):(y=u,u=r)):(y=u,u=r)),u}function Eu(){var u,p,v,b;return q++,u=y,p=bt(),p===r&&(p=null),t.charCodeAt(y)===46?(v=x,y++):(v=r,q===0&&$(we)),v!==r?(b=bt(),b!==r?(N=u,u=F(p,b)):(y=u,u=r)):(y=u,u=r),u===r&&(u=y,p=bt(),p!==r?(t.charCodeAt(y)===46?(v=x,y++):(v=r,q===0&&$(we)),v!==r?(N=u,u=me(p)):(y=u,u=r)):(y=u,u=r)),q--,u===r&&(p=r,q===0&&$(re)),u}function Ia(){var u,p,v,b;return u=y,w.test(t.charAt(y))?(p=t.charAt(y),y++):(p=r,q===0&&$(St)),p!==r?(v=$n(),v===r&&(v=null),b=bt(),b!==r?(N=u,u=pe(v,b)):(y=u,u=r)):(y=u,u=r),u}function $n(){var u;return V.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&$($e)),u}function bt(){var u,p;if(u=[],p=Ea(),p!==r)for(;p!==r;)u.push(p),p=Ea();else u=r;return u}function Ea(){var u;return E.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&$(Be)),u}function C(){var u;return j.test(t.charAt(y))?(u=t.charAt(y),y++):(u=r,q===0&&$(Qe)),u}if(Pr=a(),Pr!==r&&y===t.length)return Pr;throw Pr!==r&&y<t.length&&$(yu()),wa(Un,Re<t.length?t.charAt(Re):null,Re<t.length?Ut(Re,Re+1):Ut(Re,Re))}var Kf=d(()=>{cp(vt,Error);vt.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){r=t[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,i=this.location.source+":"+a.line+":"+a.column;if(r){var o=this.location.end,c=ca("",a.line.toString().length," "),l=r[s.line-1],f=s.line===o.line?o.column:l.length+1,h=f-s.column||1;e+=`
 --> `+i+`
`+c+` |
`+a.line+" | "+l+`
`+c+" | "+ca("",s.column-1," ")+ca("",h,"^")}else e+=`
 at `+i}return e};vt.buildMessage=function(t,e){var r={literal:function(l){return'"'+s(l.text)+'"'},class:function(l){var f=l.parts.map(function(h){return Array.isArray(h)?a(h[0])+"-"+a(h[1]):a(h)});return"["+(l.inverted?"^":"")+f.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function s(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function a(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function i(l){return r[l.type](l)}function o(l){var f=l.map(i),h,m;if(f.sort(),f.length>0){for(h=1,m=1;h<f.length;h++)f[h-1]!==f[h]&&(f[m]=f[h],m++);f.length=m}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function c(l){return l?'"'+s(l)+'"':"end of input"}return"Expected "+o(t)+" but "+c(e)+" found."}});function En(t){return Zf(t)}var Jf=d(()=>{Kf()});var eu=d(()=>{Tr();_t()});var tu=d(()=>{});var ru=d(()=>{Xt();ea();Tn();Tr();_t()});var la=d(()=>{ea();ta();Nf();qf();ra();Gf();Tn();Tr();sa();ia();Qf();_t();Xt();Hf();oa();Wf();Jf();eu();tu();ru()});var nu,Ft,Ir,su=d(()=>{Dt();gt();ge();la();nu="VegaLayer",Ft="background",Ir=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`.${r.group}`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(In(En(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Ft})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:X(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=X(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform")||"";for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Ft)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===U.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,f=e.r,h=f,m=c-f,g=l-f,_=new Set,x=this._svg.createSVGRect();x.x=m,x.y=g,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let V=w.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+f||j>V.height/2+f?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=f*f})}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,m=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=f,_.y=h,_.width=m,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(w=>!w.classList.contains(Ft));let x=[...this._graphic.querySelectorAll("path")].filter(w=>window.getComputedStyle(w).fill==="none");if(x.length>0){let w=x.filter(V=>{let E=this.transformRect(_,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...w])]}}else if(e.type===U.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(f=>({x:f.x-o.left,y:f.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(Ft)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Ft)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(f=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(f,h)}).forEach(f=>r.add(f)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let f=s/10;c+f<=r.maxY;f+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:f},e)){let h=l*f;h>a&&(a=h,i={x:o,y:c,width:l,height:f})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Ft)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(f=>this.isPointInPolygon(f,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.VegaLayer=Ir;K.register(nu,{constructor:Ir});K.register(nu,{constructor:Ir})});var au,fa,Er,iu=d(()=>{Dt();gt();ge();la();au="PlotLayer",fa="background",Er=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`*[aria-label="${r.group}"]`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(In(En(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${fa})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:X(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=X(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform");for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(fa)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===U.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===U.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===U.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,f=e.r,h=f,m=c-f,g=l-f,_=new Set,x=this._svg.createSVGRect();x.x=m,x.y=g,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let V=w.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+f||j>V.height/2+f?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=f*f})}else if(e.type===U.Rect){let{x:i,y:o,width:c,height:l}=e,f=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,m=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=f,_.y=h,_.width=m,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(x=>{if(!this._isElementInLayer(x))return!1;let w=x.getBoundingClientRect();return!(w.right<f+n.left||w.left>f+m+n.left||w.bottom<h+n.top||w.top>h+g+n.top)})}else if(e.type===U.Polygon){let{points:i}=e,o=Math.min(...i.map(m=>m.x))-n.left,c=Math.min(...i.map(m=>m.y))-n.top,l=Math.max(...i.map(m=>m.x))-n.left,f=Math.max(...i.map(m=>m.y))-n.top,h=this._svg.createSVGRect();h.x=o,h.y=c,h.width=l-o,h.height=f-c,r=[...this._svg.getIntersectionList(h,this._graphic)].filter(m=>{if(!this._isElementInLayer(m))return!1;let g=m.getBoundingClientRect();return!(g.right<o+n.left||g.left>l+n.left||g.bottom<c+n.top||g.top>f+n.top)})}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(fa)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}};K.PlotLayer=Er;K.register(au,{constructor:Er});K.register(au,{constructor:Er})});var Ye,Ar=d(()=>{Dt();Dt();zf();su();iu();Ye=K});var ou,Xe,wt,Me,Cr,ua,A,lp,uV,fp,up,Nt=d(()=>{br();ge();qt();Ar();Lt();Ge();Xe={},wt=[],Me=new Map,Cr=[],ua=!1,A=class{constructor(e,r){this._transformers=[],this._linkCache={},this[ou]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._baseName=e,this._userOptions=r,this._name=r.name??e,this._on=Object.assign({},r.on??{}),this._interactors=[],this._layers=[],this._layerInteractors=new Map,this._services=r.services??[],this._serviceInstances=[],this._sharedVar=r.sharedVar??{},this._transformers=r.transformers??[],r.interactors&&r.interactors.forEach(n=>{typeof n=="string"?this.useInteractor(Ue.initialize(n)):"options"in n?typeof n.interactor=="string"?this.useInteractor(Ue.initialize(n.interactor,n.options)):this.useInteractor(n.interactor,n.options):this.useInteractor(n)}),this._services.forEach(n=>{typeof n=="string"||!("options"in n)?this.useService(n):this.useService(n.service,n.options)}),r.layers&&r.layers.forEach(n=>{"options"in n?this.attach(n.layer,n.options):this.attach(n)}),r.postInitialize&&r.postInitialize.call(this,this)}emit(e,r){this._on[e]&&this._on[e].forEach(n=>{n instanceof ze?n.execute(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{})):n(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{}))}),e.includes("confirm")&&this._serviceInstances.forEach(n=>{n.invokeCommand()})}on(e,r){return e instanceof Array?e.forEach(n=>{this._on[n]||(this._on[n]=[]),this._on[n].push(r)}):(this._on[e]||(this._on[e]=[]),this._on[e].push(r)),this}off(e,r){if(!!this._on[e])return this._on[e].includes(r)&&this._on[e].splice(this._on[e].indexOf(r),1),this}_use(e,r){e.preAttach(this),this._serviceInstances.push(e),e.postUse(this)}useService(e,r){typeof e!="string"&&this._serviceInstances.includes(e)||(arguments.length>=2?this._services.push({service:e,options:r}):this._services.push(e),typeof e=="string"?Ef(e).forEach(s=>this._use(s,r)):this._use(e,r))}useInteractor(e,r){e.preUse(this),arguments.length>=2?this._interactors.push({interactor:e,options:r}):this._interactors.push(e),this._layers.forEach(n=>{let s;n instanceof Ye?s=n:s=n.layer,this._layerInteractors.has(s)||this._layerInteractors.set(s,[]);let a=Ue.initialize(e._baseName,e._userOptions);this._layerInteractors.get(s).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof ze?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(s.getContainerGraphic())||Me.set(s.getContainerGraphic(),new Map),Me.get(s.getContainerGraphic()).has(i)||(s.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,s,i)),Me.get(s.getContainerGraphic()).set(i,[])),Me.get(s.getContainerGraphic()).get(i).push([a,s,n instanceof Ye?null:n.options,this])})}),e.postUse(this)}attach(e,r){this._layers.find(n=>n instanceof Ye?n===e:n.layer===e)||(this.preAttach(e,r??null),arguments.length>=2?this._layers.push({layer:e,options:r}):this._layers.push(e),this.postUse(e))}getSharedVar(e,r){return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}setSharedVar(e,r,n){this._sharedVar[e]=r,this._on[`update:${e}`]&&this._on[`update:${e}`].forEach(a=>{a instanceof ze?a.execute({self:this,layer:null,instrument:this,interactor:null}):a({self:this,layer:null,instrument:this,interactor:null})})}watchSharedVar(e,r){this.on(`update:${e}`,r)}preAttach(e,r){this._preAttach&&this._preAttach.call(this,this,e),this._interactors.forEach(n=>{let s;n instanceof Ue?s=n:s=n.interactor,this._layerInteractors.has(e)||this._layerInteractors.set(e,[]);let a=Ue.initialize(s._baseName,s._userOptions);this._layerInteractors.get(e).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof ze?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(e.getContainerGraphic())||Me.set(e.getContainerGraphic(),new Map),Me.get(e.getContainerGraphic()).has(i)||(e.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,e,i)),Me.get(e.getContainerGraphic()).set(i,[])),Me.get(e.getContainerGraphic()).get(i).push([a,e,r,this])})})}async _dispatch(e,r,n){if(e._baseName!=="Layer"&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()),ua){let i=Cr.findIndex(o=>o.instrument===this&&o.layer===e&&o.eventType===r);i>=0&&Cr.splice(i,1),Cr.push({instrument:this,layer:e,eventType:r,event:n});return}ua=!0;let s=Me.get(e.getContainerGraphic()).get(r).filter(([i,o])=>o._order>=0);s.sort((i,o)=>o[1]._order-i[1]._order);let a=!1;for(let[i,o,c,l]of s){if(n instanceof MouseEvent&&!(o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="backgroundlayer"||o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="bglayer"||c&&c.pointerEvents==="all"))if(!c||c.pointerEvents==="viewport"){let f=o;if(f._offset&&f._width&&f._height&&(n.offsetX<f._offset.x||n.offsetX>f._offset.x+f._width||n.offsetY<f._offset.y||n.offsetY>f._offset.y+f._height))continue}else{if(o.picking({baseOn:te.Shape,type:U.Point,x:n.clientX,y:n.clientY}).length<=0&&i._state==="start")continue;let h=o;if(h._offset&&h._width&&h._height&&(n.offsetX<h._offset.x||n.offsetX>h._offset.x+h._width||n.offsetY<h._offset.y||n.offsetY>h._offset.y+h._height))continue}try{if(await i.dispatch(n,o)&&n instanceof MouseEvent&&c&&c.pointerEvents==="visiblePainted"){a=!0;break}}catch(f){console.error(f);break}}if(ua=!1,Cr.length){let i=Cr.shift();i.instrument._dispatch(i.layer,i.eventType,i.event)}}postUse(e){let r=e.getGraphic();r&&r.style&&(r.style.pointerEvents="auto"),this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return this._baseName===e||this._name===e}get services(){return ve(this._serviceInstances.slice(0),Z,this.useService.bind(this),()=>{throw new Error("Do not support dynamic change service yet")},this)}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>this._transformers.splice(this._transformers.indexOf(e),1),this)}static register(e,r){Xe[e]=r}static unregister(e){return delete Xe[e],!0}static initialize(e,r){let n=Object.assign({constructor:A},Xe[e]??{},r??{},{on:se(Object.assign({},(Xe[e]??{}).on??{},r?.on??{})),sharedVar:Object.assign({},(Xe[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return wt.push(s),s}static findInstrument(e){return wt.filter(r=>r.isInstanceOf(e))}};ou=_e;lp=A.register,uV=A.unregister,fp=A.initialize,up=A.findInstrument});var cu=d(()=>{Nt();Ge();ge();gt();An();A.register("HoverInstrument",{constructor:A,interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("SelectionService").setSharedVars({event:t,x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY},{layer:e}),r.transformers.setSharedVars({cx:t.clientX,cy:t.clientY})}],click:[ne.initialize("Log",{execute(){}})]},postInitialize:t=>{t.services.add("SurfacePointSelectionService",{sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues"),tooltip:t.getSharedVar("tooltip")}})},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues"),tooltip:t.getSharedVar("tooltip")}})}});A.register("ClickInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.setSharedVar("x",e.clientX),n.setSharedVar("y",e.clientY),n.services.find("SelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY},{layer:r}),n.emit("clickstart",{...t,self:t.instrument})},ne.initialize("Log",{execute(){}})],dragend:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:r}),e.clientX===n.getSharedVar("x")&&e.clientY===n.getSharedVar("y")?(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("click",{...t,self:t.instrument})):(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("clickabort",{...t,self:t.instrument}))}],dragabort:[t=>{t.event.changedTouches&&(t.event=t.event.changedTouches[0]),t.instrument.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:t.layer}),t.instrument.emit("clickabort",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("RectSelectionService").setSharedVars({x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY,width:1,height:1,startx:t.clientX,starty:t.clientY,startoffsetx:t.offsetX,startoffsety:t.offsetY,currentx:t.clientX,currenty:t.clientY},{layer:e});let s=t.offsetX,a=t.offsetY,i=0,o=0,c=e._offset?.x??0,l=e._offset?.y??0,f=r.getSharedVar("scaleX"),h=r.getSharedVar("scaleY");if(f&&f.invert&&h&&h.invert){let m=[s-c,s-c+i].map(f.invert),g=[a-l,a-l+o].map(h.invert);r.setSharedVar("extent",[m,g],{layer:e}),r.services.find("SelectionService").filter([m,g])}else r.services.find("SelectionService").filter([[s-c,s-c+i],[a-l,a-l+o]]);r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY),r.setSharedVar("startoffsetx",t.offsetX),r.setSharedVar("startoffsety",t.offsetY)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("starty"),i=n.getSharedVar("startoffsetx"),o=n.getSharedVar("startoffsety"),c=Math.min(s,e.clientX),l=Math.min(a,e.clientY),f=Math.min(i,e.offsetX),h=Math.min(o,e.offsetY),m=Math.abs(e.clientX-s),g=Math.abs(e.clientY-a);n.services.find("SelectionService").setSharedVars({x:c,y:l,offsetx:f,offsety:h,width:m,height:g,currentx:e.clientX,currenty:e.clientY},{layer:r})}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0,width:0,height:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{e.getLayerFromQueue("selectionLayer"),t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.setSharedVars({x:t.clientX,offsetx:t.offsetX,width:0,startx:t.clientX,startoffsetx:t.offsetX,currentx:t.clientX},{layer:e}),r.setSharedVar("startx",t.clientX),r.setSharedVar("startoffsetx",t.offsetX)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("startoffsetx"),i=Math.min(s,e.clientX),o=Math.min(a,e.offsetX),c=Math.abs(e.clientX-s);n.services.find("SelectionService").setSharedVars({x:i,offsetx:o,width:c,currentx:e.clientX},{layer:r}),n.setSharedVar("currentx",e.clientX),n.setSharedVar("currentoffsetx",e.offsetX),n.emit("brush",t)}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.setSharedVars({x:0,offsetx:0,width:0,currentx:e.clientX},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushYInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("RectSelectionService");n.setSharedVar("y",t.clientY,{layer:e}),n.setSharedVar("height",1,{layer:e}),n.setSharedVar("starty",t.clientY,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),r.setSharedVar("starty",t.clientY),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=r.services.find("SelectionService");i.setSharedVar("y",s,{layer:e}),i.setSharedVar("height",a,{layer:e}),i.setSharedVar("currenty",t.clientY,{layer:e}),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=(e.getGraphic().querySelector(".ig-layer-background")||e.getGraphic()).getBoundingClientRect();r.transformers.find("TransientRectangleTransformer").setSharedVars({y:s-i.top,height:a})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("y",0,{layer:e}),n.setSharedVar("height",0,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),n.setSharedVar("endy",t.clientY,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("x")??0,n=t.getSharedVar("width")??e._width,s=t.services.add("RectSelectionService",{layer:e}),a=e.getGraphic().getBoundingClientRect();s.setSharedVar("x",a.x+r),s.setSharedVar("width",n),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:0,y:0,width:n,height:0,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:{}}})}});A.register("HelperLineInstrument",{constructor:A,sharedVar:{orientation:["horizontal"]},interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.transformers.setSharedVars({x:t.offsetX,y:t.offsetY}),r.setSharedVar("x",t.offsetX,{}),r.setSharedVar("y",t.offsetY,{})}],click:[ne.initialize("Log",{execute(){}})]},preAttach:function(t,e){t.transformers.add("HelperLineTransformer",{layer:e.getLayerFromQueue("transientLayer"),sharedVar:{orientation:t.getSharedVar("orientation"),style:t.getSharedVar("style")||{},tooltip:t.getSharedVar("tooltip"),scaleX:t.getSharedVar("scaleX"),scaleY:t.getSharedVar("scaleY")}})}});A.register("DataBrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.getSharedVar("scaleY"),a=r.services.find("Quantitative2DSelectionService"),i=We(t,e.getGraphic());r.setSharedVar("layerOffsetX",t.clientX-i[0]),r.setSharedVar("layerOffsetY",t.clientY-i[1]),r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY);let o=[i[0],i[0]+1].map(n.invert);a.setSharedVar("extentX",o);let c=[i[1],i[1]+1].map(s.invert);a.setSharedVar("extentX",c),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,y:0,width:1,height:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("starty"),a=r.getSharedVar("layerOffsetX"),i=r.getSharedVar("layerOffsetY"),o=r.getSharedVar("scaleX"),c=r.getSharedVar("scaleY"),l=Math.min(n,t.clientX)-a,f=Math.min(s,t.clientY)-i,h=Math.abs(t.clientX-n),m=Math.abs(t.clientY-s);r.setSharedVar("x",l),r.setSharedVar("y",f),r.setSharedVar("width",h),r.setSharedVar("height",m);let g=[l,l+h].map(o.invert),_=[f+m,f].map(c.invert),x=r.services.find("SelectionService");x.setSharedVar("extentX",g),x.setSharedVar("extentY",_),console.log(x),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("x"),s=r.getSharedVar("y"),a=r.getSharedVar("width"),i=r.getSharedVar("height");r.transformers.find("TransientRectangleTransformer").setSharedVars({x:n,y:s,width:a,height:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:async(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("scaleY"),s=t.getSharedVar("attrNameX"),a=t.getSharedVar("extentX")??[0,0],i=a.map(r),o=t.getSharedVar("attrNameY"),c=t.getSharedVar("extentY")??[0,0],l=a.map(n).reverse(),f=t.services.add("Quantitative2DSelectionService",{layer:e});f.setSharedVar("attrNameX",s),f.setSharedVar("extentX",a),f.setSharedVar("attrNameY",o),f.setSharedVar("extentY",c),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:i[0],y:l[0],width:i[1]-i[0],height:l[1]-l[0],fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}}),await Promise.all(t.services.results)}});A.register("DataBrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.services.find("QuantitativeSelectionService"),a=We(t,e.getGraphic())[0];r.setSharedVar("layerOffsetX",t.clientX-a),r.setSharedVar("startx",t.clientX),r.setSharedVar("startLayerPosX",a);let i=[a,a+1].map(n.invert);s.setSharedVar("extent",i),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:1})}],drag:[ne.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("layerOffsetX"),a=r.getSharedVar("scaleX"),i=Math.min(n,t.clientX),o=Math.abs(t.clientX-n),c=[i-s,i-s+o].map(a.invert),l=r.services.find("QuantitativeSelectionService");r.setSharedVar("extent",c),l.setSharedVar("extent",c),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("startLayerPosX"),s=We(t,e.getGraphic())[0];console.log(n,s);let a=Math.min(n,s),i=Math.abs(s-n);r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("height")??e._height,s=t.getSharedVar("y")??0,a=t.getSharedVar("attrNameX"),i=t.getSharedVar("extentX")??[0,0],o=i.map(r),c=t.services.add("QuantitativeSelectionService",{layer:e});c.setSharedVar("attrName",a),c.setSharedVar("extent",i),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:o[0],y:s,width:o[1]-o[0],height:n,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}})}});A.register("DragInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.setSharedVars({x:e.clientX,y:e.clientY,startx:e.clientX,starty:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,offset:{x:0,y:0},skipPicking:!1},{layer:t})}],drag:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t}),r.services.setSharedVars({x:e.clientX,y:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,offset:{x:n,y:s},skipPicking:!0},{layer:t})}],dragend:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.services.setSharedVars({x:0,y:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY,offsetx:0,offsety:0,offset:{x:0,y:0},skipPicking:!1},{layer:t}),r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t})},ne.initialize("Log",{execute(){}})],dragabort:[t=>{let{layer:e,event:r,instrument:n}=t;r.changedTouches&&(r=r.changedTouches[0]),n.services.setSharedVars({x:0,y:0,currentx:r.clientX,currenty:r.clientY,endx:0,endy:0,offsetx:0,offsety:0,skipPicking:!1},{layer:e}),n.emit("dragconfirm",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone")}})}});A.register("SpeechInstrument",{constructor:A,interactors:["SpeechControlInteractor"]});A.register("KeyboardHelperBarInstrument",{constructor:A,interactors:["KeyboardPositionInteractor"],on:{begin:[()=>console.log("begin")],left:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]-n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}],right:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]+n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}]},preAttach:function(t,e){e.getGraphic().setAttribute("tabindex",0),e.getGraphic().focus();let r=e._height,n=t.getSharedVar("startPos"),s=e.getLayerFromQueue("transientLayer"),a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",n),a.setAttribute("y1","0"),a.setAttribute("x2",n),a.setAttribute("y2",r),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1px"),s.getGraphic().append(a)}});A.register("PanInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY);let n=r.transformers;n.length||(n=vr.findTransformerByLayer(t)),n.forEach(s=>{let a=s.getSharedVar("scaleX"),i=s.getSharedVar("scaleY");a&&s.setSharedVar("$$scaleX",a.copy()),i&&s.setSharedVar("$$scaleY",i.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers;s.length||(s=vr.findTransformerByLayer(t));let a=r.getSharedVar("startx"),i=r.getSharedVar("starty"),o=r.getSharedVar("fixRange")??!1;s.forEach(c=>{let l=c.getSharedVar("scaleX"),f=c.getSharedVar("scaleY");if(o){if(l){let h=c.getSharedVar("$$scaleX"),_=h.range().map((x,w)=>x-e.clientX+a).map(x=>h.invert(x));l.domain(_),c.setSharedVar("scaleX",l)}if(f){let h=c.getSharedVar("$$scaleY"),_=h.range().map((x,w)=>x-e.clientY+i).map(x=>h.invert(x));f.domain(_),c.setSharedVar("scaleY",f)}}else{if(l){let m=c.getSharedVar("$$scaleX").range().map((g,_)=>g+e.clientX-a);l.range(m),c.setSharedVar("scaleX",l)}if(f){let m=c.getSharedVar("$$scaleY").range().map((g,_)=>g+e.clientY-i);f.range(m),c.setSharedVar("scaleY",f)}}})}],dragend:[ne.initialize("Log",{execute(){}})],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("PanXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.transformers.forEach(s=>{let a=s.getSharedVar("scaleX");a&&s.setSharedVar("$$scaleX",a.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers,a=r.getSharedVar("startx"),i=r.getSharedVar("fixRange")??!1;s.forEach(o=>{let c=o.getSharedVar("scaleX");if(i){if(c){let l=o.getSharedVar("$$scaleX"),m=l.range().map((g,_)=>g-e.clientX+a).map(g=>l.invert(g));c.domain(m),o.setSharedVar("scaleX",c)}}else if(c){let f=o.getSharedVar("$$scaleX").range().map((h,m)=>h+e.clientX-a);c.range(f),o.setSharedVar("scaleX",c)}})}],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("GeometricZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=X(n),a=e.transformers;a.length||(a=vr.findTransformerByLayer(t)),e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=We(r,n),f=e.getSharedVar("centroidX")||c,h=e.getSharedVar("centroidY")||l,m=e.getSharedVar("fixRange")??!1;a.forEach(g=>{let _=g.getSharedVar("scaleX"),x=g.getSharedVar("scaleY");if(m){if(_){if(_.type==="time"){let w=_.invert(f);_.domain(_.domain().map(V=>new Date(V.getTime()-w.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+w.getTime())))}else{let w=_.invert(f);_.domain(_.domain().map(V=>V-w).map(V=>V*Math.exp(-i)).map(V=>V+w))}a.forEach(w=>w.setSharedVar("scaleX",_))}if(x){if(x.type==="time"){let w=x.invert(h);x.domain(x.domain().map(V=>new Date(V.getTime()-w.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+w.getTime())))}else{let w=x.invert(h);x.domain(x.domain().map(V=>V-w).map(V=>V*Math.exp(-i)).map(V=>V+w))}a.forEach(w=>w.setSharedVar("scaleY",x))}}else{if(_){let w=_.range().map(V=>(V-f)*Math.exp(i)+f);_.range(w),g.setSharedVar("scaleX",_)}if(x){let w=x.range().map(V=>(V-h)*Math.exp(i)+h);x.range(w),g.setSharedVar("scaleY",x)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("SemanticZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],sharedVar:{currentLevel:0},on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=X(n),a=e.transformers;a.length||(a=vr.findTransformerByLayer(t));let i=e.getSharedVar("scaleLevels"),o=e.getSharedVar("currentLevel");if(o+=Math.sign(r.deltaY),e.setSharedVar("currentLevel",o),typeof i=="object"){let x=Object.keys(i).reduce(function(w,V){return Math.abs(parseInt(V)-o)<Math.abs(parseInt(w)-o)?V:w});a.forEach(w=>w.setSharedVars(i[x]))}e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let c=r.deltaY;e.setSharedVar("delta",c);let l=e.getSharedVar("cumulativeDelta",{defaultValue:0});l+=c,e.setSharedVar("cumulativeDelta",l),c/=1e3;let[f,h]=We(r,n),m=e.getSharedVar("centroidX")||f,g=e.getSharedVar("centroidY")||h,_=e.getSharedVar("fixRange")??!1;a.forEach(x=>{let w=x.getSharedVar("scaleX"),V=x.getSharedVar("scaleY");if(_){if(w){if(w.type==="time"){let E=w.invert(m);w.domain(w.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=w.invert(m);w.domain(w.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleX",w))}if(V){if(V.type==="time"){let E=V.invert(g);V.domain(V.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=V.invert(g);V.domain(V.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleY",V))}}else{if(w){let E=w.range().map(j=>(j-m)*Math.exp(c)+m);w.range(E),x.setSharedVar("scaleX",w)}if(V){let E=V.range().map(j=>(j-g)*Math.exp(c)+g);V.range(E),x.setSharedVar("scaleY",V)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]},postUse(t,e){let r=t.getSharedVar("scaleLevels"),n=t.transformers,s=t.getSharedVar("currentLevel");if(typeof r=="object"){let a=Object.keys(r).reduce(function(i,o){return Math.abs(parseInt(o)-s)<Math.abs(parseInt(i)-s)?o:i});n.setSharedVars(r[a])}}});A.register("ZoomXInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=X(n),a=e.transformers;e.setSharedVar("currentx",r.offsetX);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=We(r,n),f=e.getSharedVar("centroidX")||c,h=e.getSharedVar("fixRange")??!1;a.forEach(m=>{let g=m.getSharedVar("scaleX");if(h){if(g){let _=g.invert(f);g.domain(g.domain().map(x=>x-_).map(x=>x*Math.exp(-i)).map(x=>x+_)),a.forEach(x=>x.setSharedVar("scaleX",g))}}else if(g){let _=g.range().map(x=>(x-f)*Math.exp(i)+f);g.range(_),m.setSharedVar("scaleX",g)}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}})});var da,ma,Cn=d(()=>{Nt();Nt();cu();da=wt,ma=A});var pa={};Cu(pa,{createHistoryTrrack:()=>Mn,tryGetHistoryTrrackInstance:()=>lu,tryRegisterDynamicInstance:()=>hp});async function Mn(){let t=null,e=null,r=!1,n={traceStructure:(s=t)=>({recordList:[...s.record.keys()],children:s.children.map(a=>n.traceStructure(a)),current:s===e}),commit:async s=>{if(r)return;let a=new Map;for(let{component:o,fields:c}of[{list:Js,fields:["_state","_modalities"]},{list:da,fields:["_sharedVar"]},{list:Ws,fields:["_sharedVar"]},{list:Qs,fields:["_sharedVar"]}].flatMap(({list:l,fields:f})=>l.filter(h=>lu(h)===n).map(h=>({component:h,fields:f}))))await o.results,a.set(o,Object.fromEntries(c.map(l=>[l,se(o[l])])));if(s&&s!="Log"){let o=c=>c.name==="Log"&&c.prev&&c.prev.children.length==1?(c.prev.children=[],o(c.prev)):c.name==="Log"&&c.prev?(c.prev.children.splice(c.prev.children.indexOf(c),1),o(c.prev)):c;e=o(e)}let i={name:s,record:a,prev:e,next:null,children:[]};e&&e.children.push(i),e=i},async undo(){if(e&&e.prev){e.prev.next=e;let s=e.prev.record;r=!0;for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=se(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.prev,r=!1}},async redo(){if(e&&e.children.length===1&&!e.next&&(e.next=e.children[0]),e&&e.next){let s=e.next.record;r=!0;try{for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=se(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.next}catch(a){console.error("Fail to redo history!",a);let i=e.record;for(let[o,c]of i.entries())Object.entries(c).forEach(([l,f])=>o[l]=se(f)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async jump(s=[]){let a=s.reduce((i,o)=>i?.children[o],t);if(a){let i=a.record;r=!0;try{for(let[o,c]of i.entries()){let l=null;"_sharedVar"in o&&o._sharedVar.layer&&(l=o._sharedVar.layer),Object.entries(c).forEach(([f,h])=>o[f]=se(h)),l&&"_sharedVar"in o&&!o._sharedVar.layer&&(o._sharedVar.layer=l),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=a}catch(o){console.error("Fail to jump history!",o);let c=e.record;for(let[l,f]of c.entries())Object.entries(f).forEach(([h,m])=>l[h]=se(m)),"_sharedVar"in f&&await l.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}else console.error(`History path [${s.join(", ")}] does not exist!`)}};return[Ws,Qs,fu,da,Js].flatMap(s=>s).forEach(s=>{Mr.has(s)||Mr.set(s,n)}),await n.commit(),t=e,n}function lu(t){let e=Mr.get(t);return e||{traceStructure(){return null},async commit(){},async undo(){},async redo(){}}}function hp(t,e){let r=Mr.get(t);r&&Mr.set(e,r)}var Mr,Rr=d(()=>{Lt();Ge();qt();Cn();br();ge();Mr=new Map});function ve(t,e,r,n,s){return new Proxy(t,{get(a,i){if(i==="find")return function(o,c){if("initialize"in e){let l=a.filter(f=>f.isInstanceOf(o));if(l.length<=0&&c){let f=e.initialize(c);r(f),l.push(f),ga(s,f)}return ve(l,e,r,n,s)}else{let l=a.slice();return l.forEach(f=>{f.find(...arguments)}),ve(l,e,r,n,s)}};if(i==="add")return(...o)=>{let c=a.slice();if("initialize"in e){let l=e.initialize(...o);return r(l),c.push(l),ga(s,l),ve(c,e,r,n,s)}else return c.forEach(l=>{l.add(...o)}),ve(c,e,r,n,s)};if(i==="remove")return o=>{if(e===Rn){let c=a.slice();return c.forEach(l=>{l.remove(o)}),ve(c,e,r,n,s)}else{let c=a.slice();return c.filter(f=>f.isInstanceOf(o)).forEach(f=>{n(f),c.splice(c.indexOf(f),1)}),ve(c,e,r,n,s)}};if(i in a&&i!=="join"&&i!=="filter")return a[i];if(a.length)return a[0][i]instanceof Function?function(){return ve(a.map(o=>o[i].apply(o,arguments)),Rn,()=>{},()=>{},s)}:ve(a.map(o=>o[i]),Rn,()=>{},()=>{},s);{let o=()=>{};return o[Symbol.iterator]=function*(){},o}}})}function ha(t){try{return t.getAttribute("transform").split("(")[1].split(")")[0].split(",").map(r=>parseFloat(r))}catch(e){return[0,0]}}function Vn(t){return mu(t.trim()).map(ya)}function wp(t){return vp.hasOwnProperty(t)}function kr(t,e,r,n,s){let a=0,i,o=t.length;for(;e<o;++e){if(i=t[e],!a&&i===r)return e;s&&s.indexOf(i)>=0?--a:n&&n.indexOf(i)>=0&&++a}return e}function mu(t){let e=[],r=t.length,n=0,s=0;for(;s<r;)s=kr(t,s,du,kn+uu,On+hu),e.push(t.substring(n,s).trim()),n=++s;if(e.length===0)throw"Empty event selector: "+t;return e}function ya(t){return t[0]==="["?Sp(t):bp(t)}function Sp(t){let e=t.length,r=1,n,s;if(r=kr(t,r,On,kn,On),r===e)throw"Empty between selector: "+t;if(n=mu(t.substring(1,r)),n.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(r+1).trim(),t[0]!==gp)throw"Expected '>' after between selector: "+t;let a=n.map(ya);return s=ya(t.slice(1).trim()),s.between?{between:a,stream:s}:(s.between=a,s)}function bp(t){let e={source:xp,type:""},r=[],n=[0,0],s=0,a=0,i=t.length,o=0,c,l;if(t[i-1]===hu){if(o=t.lastIndexOf(uu),o>=0){try{n=Vp(t.substring(o+1,i-1))}catch(f){throw"Invalid throttle specification: "+t}t=t.slice(0,o).trim(),i=t.length}else throw"Unmatched right brace: "+t;o=0}if(!i)throw t;if(t[0]===pp&&(s=++o),c=kr(t,o,mp),c<i&&(r.push(t.substring(a,c).trim()),a=o=++c),o=kr(t,o,kn),o===i)r.push(t.substring(a,i).trim());else if(r.push(t.substring(a,o).trim()),l=[],a=++o,a===i)throw"Unmatched left bracket: "+t;for(;o<i;){if(o=kr(t,o,On),o===i)throw"Unmatched left bracket: "+t;if(l.push(t.substring(a,o).trim()),o<i-1&&t[++o]!==kn)throw"Expected left bracket: "+t;a=++o}if(!(i=r.length)||yp.test(r[i-1]))throw"Invalid event selector: "+t;return i>1?(e.type=r[1],s?e.markname=r[0].slice(1):wp(r[0])?e.marktype=r[0]:e.source=r[0]):e.type=r[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),l!=null&&(e.filter=l),n[0]&&(e.throttle=n[0]),n[1]&&(e.debounce=n[1]),e}function Vp(t){let e=t.split(du);if(!t.length||e.length>2)throw t;return e.map(function(r){let n=+r;if(n!==n)throw t;return n})}function se(t){if(t&&t instanceof Object&&"copy"in t&&t.copy instanceof Function){let r=t.copy();for(let n in Object.getOwnPropertyDescriptors(t))n in r||(r[n]=t[n]);return r}if(t instanceof Array)return t.map(se);if(["string","number","boolean","undefined","bigint","symbol","function"].includes(typeof t))return t;if(t===null)return null;if(_e in t&&t[_e])return t;if(t instanceof Node){let r=t.cloneNode(!0);return Object.assign(r,t),r}let e=Object.fromEntries(Object.entries(t).map(([r,n])=>[r,se(n)]));return Object.assign(Object.create(Object.getPrototypeOf(t)),e)}var _e,te,U,tt,Rn,ga,dp,kn,On,uu,hu,mp,du,pp,gp,yp,xp,_p,vp,Pa,ge=d(()=>{_e=Symbol("Libra");(function(t){t[t.Shape=0]="Shape",t[t.Data=1]="Data",t[t.Attr=2]="Attr"})(te||(te={}));(function(t){t[t.SurfacePoint=0]="SurfacePoint",t[t.Point=1]="Point",t[t.Circle=2]="Circle",t[t.Rect=3]="Rect",t[t.Polygon=4]="Polygon"})(U||(U={}));(function(t){t[t.Quantitative=0]="Quantitative",t[t.Nominal=1]="Nominal",t[t.Temporal=2]="Temporal"})(tt||(tt={}));Rn=class{},ga=(...t)=>{};dp="view",kn="[",On="]",uu="{",hu="}",mp=":",du=",",pp="@",gp=">",yp=/[[\]{}]/,xp=dp,_p={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},vp=_p;Pa={stopTransient:!1};Promise.resolve().then(()=>(Rr(),pa)).then(t=>{ga=t.tryRegisterDynamicInstance})});var pu,gu,xa,Ln,ne,jp,MV,Tp,Ip,An=d(()=>{ge();xa={},Ln=[],ne=class{constructor(e,r){this[pu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._feedback=r.feedback??[],this._undo=r.undo??null,this._redo=r.redo??null,this._execute=r.execute??null,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preExecute=r.preExecute??null,this._postExecute=r.postExecute??null,r.postInitialize&&r.postInitialize.call(this,this)}undo(){this._undo&&this._undo.call(this)}redo(){this._redo&&this._redo.call(this)}async execute(e){try{this.preExecute(),this._execute&&await this._execute.call(this,e),this.postExecute();for(let r of this._feedback)await r.call(this,e);await gu(this).commit(this._name)}catch(r){console.error(r)}}preExecute(){this._preExecute&&this._preExecute.call(this,this)}postExecute(){this._postExecute&&this._postExecute.call(this,this)}isInstanceOf(e){return this._baseName===e||this._name===e}static register(e,r){xa[e]=r}static unregister(e){return delete xa[e],!0}static initialize(e,r){let n=Object.assign({constructor:ne},xa[e]??{},r??{}),s=new n.constructor(e,n);return Ln.push(s),s}static findCommand(e){return Ln.filter(r=>r.isInstanceOf(e))}};pu=_e;jp=ne.register,MV=ne.unregister,Tp=ne.initialize,Ip=ne.findCommand;Promise.resolve().then(()=>(Rr(),pa)).then(t=>{gu=t.tryGetHistoryTrrackInstance})});var fu,ze,qt=d(()=>{An();An();fu=Ln,ze=ne});qt();Cn();br();Ar();Lt();Rr();Ge();Nt();Nt();Ar();Lt();Ge();Sr();Hs();ge();qt();var Or={},Gt=class{static build(e){if(!(e.inherit in Xe)&&!(e.inherit in Or))throw new Error(`Interaction ${e.inherit} is not registered, please register it first`);let r;if(e.inherit in Xe){let a=Object.assign({constructor:A},Xe[e.inherit],{sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},Xe[e.inherit].sharedVar??{},e.sharedVar??{})});e.layers&&(a.layers=e.layers),r=new a.constructor(e.inherit,a),wt.push(r)}else{let a=Object.assign({},Or[e.inherit],e,{inherit:Or[e.inherit].inherit,sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},Or[e.inherit].sharedVar??{},e.sharedVar??{})});r=Gt.build(a),wt.push(r)}if(e.name&&(Or[e.name]=e,!e.layers||!e.layers.length))return;let n=(a,i)=>{if(a instanceof A){let o=a._serviceInstances.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a._serviceInstances){let f=n(l,i);if(f)return f}}else{let o=a._services.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a.services){let f=n(l,i);if(f)return f}}return[void 0,void 0]},s=(a,i)=>{if(a.isInstanceOf(i))return a;if(a instanceof A){let o=a._serviceInstances.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a._serviceInstances){let l=s(c,i);if(l)return l}}else{let o=a._services.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a.services){let l=s(c,i);if(l)return l}}};if(e.remove)for(let a of e.remove)for(;;){let[i,o]=n(r,a.find);if(!i)break;let c=o instanceof A?o._serviceInstances:o._services;a.cascade?i instanceof Z?c.splice(c.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1):i instanceof Z?(c.splice(c.indexOf(i),1,...i._services),o._transformers.push(...i._transformers)):o._transformers.splice(o._transformers.indexOf(i),1)}if(e.override)for(let a of e.override)if(a.find.endsWith("Interactor")){let i=[...r._layerInteractors.values()],o=i.map(c=>c.filter(l=>l.isInstanceOf(a.find)));a.comp?o.forEach((c,l)=>{c.forEach(f=>{let h=z.initialize(a.comp);h&&i[l].splice(i[l].indexOf(f),1,h)})}):a.actions&&o.forEach(c=>{c.forEach(l=>{l._actions=se(a.actions).map(Ks)})})}else{let[i,o]=n(r,a.find);if(!i)continue;let c;if(a.comp.includes("Transformer")){let f;a.name&&H.findTransformer(a.name).length>0&&(f=H.findTransformer(a.name)[0]),f||(f=H.initialize(a.comp,{name:a.name,sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),c=f}else if(a.comp.includes("Service")){let f;a.name&&Z.findService(a.name).length>0&&(f=Z.findService(a.name)[0]),f||(f=Z.initialize(a.comp,{...a,services:[...a.services||[],...i instanceof Z?i._services:[]],transformers:[...a.transformers||[],...i instanceof Z?i._transformers:[]],sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),a.dimension&&f.isInstanceOf("SelectionService")&&(f=f.dimension(a.dimension),a.layers&&(f._layerInstances=a.layers.slice(0)),a.sharedVar&&f.setSharedVars(a.sharedVar)),c=f}let l=o instanceof A?o._serviceInstances:o._services;i instanceof Z?l.splice(l.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1),a.comp.includes("Transformer")?o._transformers.push(c):l.push(c)}if(e.insert)for(let a of e.insert){let i=s(r,a.find);if(!i)continue;let o=null,c=null;for(let l=a.flow.length-1;l>=0;l--){let f=a.flow[l];if(f instanceof Function){let h=[],m=null;for(let g=0;g<e.layers?.length;g++){let _=e.layers[g],x=f(_,g);if(x.comp.includes("Transformer")){let w;x.name&&H.findTransformer(x.name).length>0&&(w=H.findTransformer(x.name)[0]),w||(w=H.initialize(x.comp,{...x,sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),h.push(w),m="Transformer"}else if(x.comp.includes("Service")){let w;x.name&&Z.findService(x.name).length>0&&(w=Z.findService(x.name)[0]),w||(w=Z.initialize(x.comp,{...x,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),x.dimension&&w instanceof Ve&&(w=w.dimension(x.dimension),x.layers&&(w._layerInstances=x.layers.slice(0)),x.sharedVar&&w.setSharedVars(x.sharedVar)),h.push(w),m="Service"}}o=h,c=m}else if(f instanceof Array){let h=[],m=null;for(let g=0;g<f.length;g++){let _=f[g];if(_ instanceof H)h.push(_),m="Transformer";else if(_ instanceof Z)c=="Transformer"?_._transformers.push(...o instanceof Array?o:[o]):_._services.push(...o instanceof Array?o:[o]),h.push(_),m="Service";else if(_.comp.includes("Transformer")){let x;_.name&&H.findTransformer(_.name).length>0&&(x=H.findTransformer(_.name)[0]),x||(x=H.initialize(_.comp,{..._,sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),h.push(x),m="Transformer"}else if(_.comp.includes("Service")){let x;_.name&&Z.findService(_.name).length>0&&(x=Z.findService(_.name)[0]),x||(x=Z.initialize(_.comp,{..._,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),_.dimension&&x instanceof Ve&&(x=x.dimension(_.dimension),_.layers&&(x._layerInstances=_.layers.slice(0)),_.sharedVar&&x.setSharedVars(_.sharedVar)),h.push(x),m="Service"}}o=h,c=m}else if(f instanceof H)o=f,c="Transformer";else if(f instanceof Z)c=="Transformer"?f._transformers.push(...o instanceof Array?o:[o]):f._services.push(...o instanceof Array?o:[o]),o=f,c="Service";else if(f instanceof ze)c=="Service"&&(o instanceof Array?o.forEach(h=>h._command.push(f)):o._command.push(f));else if(f.comp.includes("Transformer")){let h;f.name&&H.findTransformer(f.name).length>0&&(h=H.findTransformer(f.name)[0]),h||(h=H.initialize(f.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof Ye?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...f,sharedVar:{...e.sharedVar||{},...f.sharedVar||{}}})),o=h,c="Transformer"}else if(f.comp.includes("Service")){let h;f.name&&Z.findService(f.name).length>0&&(h=Z.findService(f.name)[0]),h||(h=Z.initialize(f.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof Ye?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...f,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...f.sharedVar||{}}})),f.dimension&&h.isInstanceOf("SelectionService")&&(h=h.dimension(f.dimension),f.layers&&(h._layerInstances=f.layers.slice(0)),f.sharedVar&&h.setSharedVars(f.sharedVar)),o=h,c="Service"}}o&&(c=="Transformer"?o instanceof Array?i._transformers.push(...o):i._transformers.push(o):i instanceof A?o instanceof Array?i._serviceInstances.push(...o):i._serviceInstances.push(o):o instanceof Array?i._services.push(...o):i._services.push(o))}return r}};qt();Cn();br();Ar();Lt();Rr();Ge();var ej={Command:ze,Instrument:ma,Interactor:Ue,Layer:Ye,Service:Z,createHistoryTrrack:Mn,GraphicalTransformer:H,Interaction:Gt};export{ze as Command,H as GraphicalTransformer,ma as Instrument,Gt as Interaction,Ue as Interactor,Ye as Layer,Z as Service,Mn as createHistoryTrrack,ej as default};
