var Oa=Object.defineProperty;var If=e=>Oa(e,"__esModule",{value:!0});var d=(e,t)=>()=>(e&&(t=e(e=0)),t);var Cf=(e,t)=>{If(e);for(var r in t)Oa(e,r,{get:t[r],enumerable:!0})};var ka,Lr,jt,Wn,Da,K,Mf,Ym,Rf,Of,Yr=d(()=>{ge();Lr={},jt=[],Wn=[],Da=()=>{let e;for(;e=Wn.pop();)try{e.remove()}catch(t){}La.stopTransient||jt.filter(t=>t._transient).forEach(t=>t.redraw()),requestAnimationFrame(Da)};requestAnimationFrame(Da);K=class{constructor(t,r){this[ka]=!0,this._baseName=t,this._userOptions=r,this._name=r.name??this._baseName,this._sharedVar=r.sharedVar??{},this._redraw=r.redraw??(()=>{}),this._layer=r.layer,this._transient=r.transient??!1,this.redraw()}getSharedVar(t){return this._sharedVar[t]}setSharedVar(t,r){this._sharedVar[t]=r,this.redraw()}setSharedVars(t){Object.entries(t).forEach(([r,n])=>this._sharedVar[r]=n),this.redraw()}redraw(t=!1){if(!this._layer&&!this.getSharedVar("layer"))return;let r=this._layer||this.getSharedVar("layer");t=t||this._transient;let n=[],s=[],a=new Set([r]);t&&(n=r.getVisualElements(),r._getLayerFromQueue||(r._getLayerFromQueue=r.getLayerFromQueue,r.getLayerFromQueue=function(){let i=r._getLayerFromQueue(...arguments);return n=n.concat(i.getVisualElements()),a.add(i),i})),this._redraw({layer:r,transformer:this}),t&&(r.getLayerFromQueue=r._getLayerFromQueue,delete r._getLayerFromQueue,a.forEach(i=>{s=s.concat(Array.prototype.slice.call(i.getGraphic()?.childNodes??[]));let o=s.filter(c=>!n.includes(c));Wn=Wn.concat(o)}))}isInstanceOf(t){return this._baseName===t||this._name===t||(this._userOptions.className??[]).includes(t)}static register(t,r){Lr[t]=r}static unregister(t){return delete Lr[t],!0}static initialize(t,r){let n=Object.assign({constructor:K},Lr[t]??{},r??{},{sharedVar:Object.assign({},(Lr[t]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(t,n);return jt.push(s),s}static findTransformer(t){return jt.filter(r=>r.isInstanceOf(t))}static findTransformerByLayer(t){return jt.filter(r=>r._layer===t||r.getSharedVar("layer")===t)}};ka=me;Mf=K.register,Ym=K.unregister,Rf=K.initialize,Of=K.findTransformer});var Ya=d(()=>{});var Xa=d(()=>{});var Pa=d(()=>{});function Na(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Xr(r)}function Xr(e){this._=e}function Df(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function Lf(e,t){for(var r=0,n=e.length,s;r<n;++r)if((s=e[r]).name===t)return s.value}function za(e,t,r){for(var n=0,s=e.length;n<s;++n)if(e[n].name===t){e[n]=kf,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var kf,Zn,Fa=d(()=>{kf={value:()=>{}};Xr.prototype=Na.prototype={constructor:Xr,on:function(e,t){var r=this._,n=Df(e+"",r),s,a=-1,i=n.length;if(arguments.length<2){for(;++a<i;)if((s=(e=n[a]).type)&&(s=Lf(r[s],e.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(s=(e=n[a]).type)r[s]=za(r[s],e.name,t);else if(t==null)for(s in r)r[s]=za(r[s],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Xr(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,a;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,s=a.length;n<s;++n)a[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],s=0,a=n.length;s<a;++s)n[s].value.apply(t,r)}};Zn=Na});var Kn=d(()=>{Fa()});var Pr,Jn,es=d(()=>{Pr="http://www.w3.org/1999/xhtml",Jn={svg:"http://www.w3.org/2000/svg",xhtml:Pr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function Pe(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Jn.hasOwnProperty(t)?{space:Jn[t],local:e}:e}var Nr=d(()=>{es()});function Yf(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===Pr&&t.documentElement.namespaceURI===Pr?t.createElement(e):t.createElementNS(r,e)}}function Xf(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function zr(e){var t=Pe(e);return(t.local?Xf:Yf)(t)}var ts=d(()=>{Nr();es()});function Pf(){}function st(e){return e==null?Pf:function(){return this.querySelector(e)}}var Fr=d(()=>{});function Ga(e){typeof e!="function"&&(e=st(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var a=t[s],i=a.length,o=n[s]=new Array(i),c,l,u=0;u<i;++u)(c=a[u])&&(l=e.call(c,c.__data__,u,a))&&("__data__"in c&&(l.__data__=c.__data__),o[u]=l);return new Q(n,this._parents)}var Ua=d(()=>{be();Fr()});function Vt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}var Gr=d(()=>{});function Nf(){return[]}function Gt(e){return e==null?Nf:function(){return this.querySelectorAll(e)}}var rs=d(()=>{});function zf(e){return function(){var t=e.apply(this,arguments);return t==null?[]:Vt(t)}}function qa(e){typeof e=="function"?e=zf(e):e=Gt(e);for(var t=this._groups,r=t.length,n=[],s=[],a=0;a<r;++a)for(var i=t[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&(n.push(e.call(c,c.__data__,l,i)),s.push(c));return new Q(n,s)}var $a=d(()=>{be();Gr();rs()});function Ut(e){return function(){return this.matches(e)}}function Ur(e){return function(t){return t.matches(e)}}var qt=d(()=>{});function Gf(e){return function(){return Ff.call(this.children,e)}}function Uf(){return this.firstElementChild}function Ba(e){return this.select(e==null?Uf:Gf(typeof e=="function"?e:Ur(e)))}var Ff,Qa=d(()=>{qt();Ff=Array.prototype.find});function $f(){return this.children}function Bf(e){return function(){return qf.call(this.children,e)}}function Ha(e){return this.selectAll(e==null?$f:Bf(typeof e=="function"?e:Ur(e)))}var qf,Wa=d(()=>{qt();qf=Array.prototype.filter});function Za(e){typeof e!="function"&&(e=Ut(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var a=t[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&e.call(c,c.__data__,l,a)&&o.push(c);return new Q(n,this._parents)}var Ka=d(()=>{be();qt()});function qr(e){return new Array(e.length)}var ns=d(()=>{});function Ja(){return new Q(this._enter||this._groups.map(qr),this._parents)}function $t(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}var ss=d(()=>{ns();be();$t.prototype={constructor:$t,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}}});function ei(e){return function(){return e}}var ti=d(()=>{});function Qf(e,t,r,n,s,a){for(var i=0,o,c=t.length,l=a.length;i<l;++i)(o=t[i])?(o.__data__=a[i],n[i]=o):r[i]=new $t(e,a[i]);for(;i<c;++i)(o=t[i])&&(s[i]=o)}function Hf(e,t,r,n,s,a,i){var o,c,l=new Map,u=t.length,h=a.length,p=new Array(u),m;for(o=0;o<u;++o)(c=t[o])&&(p[o]=m=i.call(c,c.__data__,o,t)+"",l.has(m)?s[o]=c:l.set(m,c));for(o=0;o<h;++o)m=i.call(e,a[o],o,a)+"",(c=l.get(m))?(n[o]=c,c.__data__=a[o],l.delete(m)):r[o]=new $t(e,a[o]);for(o=0;o<u;++o)(c=t[o])&&l.get(p[o])===c&&(s[o]=c)}function Wf(e){return e.__data__}function ri(e,t){if(!arguments.length)return Array.from(this,Wf);var r=t?Hf:Qf,n=this._parents,s=this._groups;typeof e!="function"&&(e=ei(e));for(var a=s.length,i=new Array(a),o=new Array(a),c=new Array(a),l=0;l<a;++l){var u=n[l],h=s[l],p=h.length,m=Vt(e.call(u,u&&u.__data__,l,n)),_=m.length,x=o[l]=new Array(_),w=i[l]=new Array(_),j=c[l]=new Array(p);r(u,h,x,w,j,m,t);for(var I=0,V=0,Y,X;I<_;++I)if(Y=x[I]){for(I>=V&&(V=I+1);!(X=w[V])&&++V<_;);Y._next=X||null}}return i=new Q(i,n),i._enter=o,i._exit=c,i}var ni=d(()=>{be();ss();Gr();ti()});function si(){return new Q(this._exit||this._groups.map(qr),this._parents)}var ai=d(()=>{ns();be()});function ii(e,t,r){var n=this.enter(),s=this,a=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(s=t(s)),r==null?a.remove():r(a),n&&s?n.merge(s).order():s}var oi=d(()=>{});function ci(e){if(!(e instanceof Q))throw new Error("invalid merge");for(var t=this._groups,r=e._groups,n=t.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=t[o],l=r[o],u=c.length,h=i[o]=new Array(u),p,m=0;m<u;++m)(p=c[m]||l[m])&&(h[m]=p);for(;o<n;++o)i[o]=t[o];return new Q(i,this._parents)}var li=d(()=>{be()});function ui(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],s=n.length-1,a=n[s],i;--s>=0;)(i=n[s])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}var fi=d(()=>{});function hi(e){e||(e=Zf);function t(h,p){return h&&p?e(h.__data__,p.__data__):!h-!p}for(var r=this._groups,n=r.length,s=new Array(n),a=0;a<n;++a){for(var i=r[a],o=i.length,c=s[a]=new Array(o),l,u=0;u<o;++u)(l=i[u])&&(c[u]=l);c.sort(t)}return new Q(s,this._parents).order()}function Zf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var di=d(()=>{be()});function pi(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}var mi=d(()=>{});function gi(){return Array.from(this)}var yi=d(()=>{});function xi(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],s=0,a=n.length;s<a;++s){var i=n[s];if(i)return i}return null}var _i=d(()=>{});function vi(){let e=0;for(let t of this)++e;return e}var wi=d(()=>{});function Si(){return!this.node()}var bi=d(()=>{});function ji(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var s=t[r],a=0,i=s.length,o;a<i;++a)(o=s[a])&&e.call(o,o.__data__,a,s);return this}var Vi=d(()=>{});function Kf(e){return function(){this.removeAttribute(e)}}function Jf(e){return function(){this.removeAttributeNS(e.space,e.local)}}function eh(e,t){return function(){this.setAttribute(e,t)}}function th(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function rh(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function nh(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Ti(e,t){var r=Pe(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Jf:Kf:typeof t=="function"?r.local?nh:rh:r.local?th:eh)(r,t))}var Ei=d(()=>{Nr()});function $r(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}var as=d(()=>{});function sh(e){return function(){this.style.removeProperty(e)}}function ah(e,t,r){return function(){this.style.setProperty(e,t,r)}}function ih(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function Ai(e,t,r){return arguments.length>1?this.each((t==null?sh:typeof t=="function"?ih:ah)(e,t,r??"")):Qe(this.node(),e)}function Qe(e,t){return e.style.getPropertyValue(t)||$r(e).getComputedStyle(e,null).getPropertyValue(t)}var is=d(()=>{as()});function oh(e){return function(){delete this[e]}}function ch(e,t){return function(){this[e]=t}}function lh(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function Ii(e,t){return arguments.length>1?this.each((t==null?oh:typeof t=="function"?lh:ch)(e,t)):this.node()[e]}var Ci=d(()=>{});function Mi(e){return e.trim().split(/^|\s+/)}function os(e){return e.classList||new Ri(e)}function Ri(e){this._node=e,this._names=Mi(e.getAttribute("class")||"")}function Oi(e,t){for(var r=os(e),n=-1,s=t.length;++n<s;)r.add(t[n])}function ki(e,t){for(var r=os(e),n=-1,s=t.length;++n<s;)r.remove(t[n])}function uh(e){return function(){Oi(this,e)}}function fh(e){return function(){ki(this,e)}}function hh(e,t){return function(){(t.apply(this,arguments)?Oi:ki)(this,e)}}function Di(e,t){var r=Mi(e+"");if(arguments.length<2){for(var n=os(this.node()),s=-1,a=r.length;++s<a;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof t=="function"?hh:t?uh:fh)(r,t))}var Li=d(()=>{Ri.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}}});function dh(){this.textContent=""}function ph(e){return function(){this.textContent=e}}function mh(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Yi(e){return arguments.length?this.each(e==null?dh:(typeof e=="function"?mh:ph)(e)):this.node().textContent}var Xi=d(()=>{});function gh(){this.innerHTML=""}function yh(e){return function(){this.innerHTML=e}}function xh(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Pi(e){return arguments.length?this.each(e==null?gh:(typeof e=="function"?xh:yh)(e)):this.node().innerHTML}var Ni=d(()=>{});function _h(){this.nextSibling&&this.parentNode.appendChild(this)}function zi(){return this.each(_h)}var Fi=d(()=>{});function vh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Gi(){return this.each(vh)}var Ui=d(()=>{});function qi(e){var t=typeof e=="function"?e:zr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}var $i=d(()=>{ts()});function wh(){return null}function Bi(e,t){var r=typeof e=="function"?e:zr(e),n=t==null?wh:typeof t=="function"?t:st(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var Qi=d(()=>{ts();Fr()});function Sh(){var e=this.parentNode;e&&e.removeChild(this)}function Hi(){return this.each(Sh)}var Wi=d(()=>{});function bh(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function jh(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Zi(e){return this.select(e?jh:bh)}var Ki=d(()=>{});function Ji(e){return arguments.length?this.property("__data__",e):this.node().__data__}var eo=d(()=>{});function Vh(e){return function(t){e.call(this,t,this.__data__)}}function Th(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function Eh(e){return function(){var t=this.__on;if(!!t){for(var r=0,n=-1,s=t.length,a;r<s;++r)a=t[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++n]=a;++n?t.length=n:delete this.__on}}}function Ah(e,t,r){return function(){var n=this.__on,s,a=Vh(t);if(n){for(var i=0,o=n.length;i<o;++i)if((s=n[i]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=r),s.value=t;return}}this.addEventListener(e.type,a,r),s={type:e.type,name:e.name,value:t,listener:a,options:r},n?n.push(s):this.__on=[s]}}function to(e,t,r){var n=Th(e+""),s,a=n.length,i;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,l=o.length,u;c<l;++c)for(s=0,u=o[c];s<a;++s)if((i=n[s]).type===u.type&&i.name===u.name)return u.value}return}for(o=t?Ah:Eh,s=0;s<a;++s)this.each(o(n[s],t,r));return this}var ro=d(()=>{});function no(e,t,r){var n=$r(e),s=n.CustomEvent;typeof s=="function"?s=new s(t,r):(s=n.document.createEvent("Event"),r?(s.initEvent(t,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function Ih(e,t){return function(){return no(this,e,t)}}function Ch(e,t){return function(){return no(this,e,t.apply(this,arguments))}}function so(e,t){return this.each((typeof t=="function"?Ch:Ih)(e,t))}var ao=d(()=>{as()});function*io(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],s=0,a=n.length,i;s<a;++s)(i=n[s])&&(yield i)}var oo=d(()=>{});function Q(e,t){this._groups=e,this._parents=t}function co(){return new Q([[document.documentElement]],Bt)}function Mh(){return this}var Bt,Ne,be=d(()=>{Ua();$a();Qa();Wa();Ka();ni();ss();ai();oi();li();fi();di();mi();yi();_i();wi();bi();Vi();Ei();is();Ci();Li();Xi();Ni();Fi();Ui();$i();Qi();Wi();Ki();eo();ro();ao();oo();Bt=[null];Q.prototype=co.prototype={constructor:Q,select:Ga,selectAll:qa,selectChild:Ba,selectChildren:Ha,filter:Za,data:ri,enter:Ja,exit:si,join:ii,merge:ci,selection:Mh,order:ui,sort:hi,call:pi,nodes:gi,node:xi,size:vi,empty:Si,each:ji,attr:Ti,style:Ai,property:Ii,classed:Di,text:Yi,html:Pi,raise:zi,lower:Gi,append:qi,insert:Bi,remove:Hi,clone:Zi,datum:Ji,on:to,dispatch:so,[Symbol.iterator]:io};Ne=co});function $(e){return typeof e=="string"?new Q([[document.querySelector(e)]],[document.documentElement]):new Q([[e]],Bt)}var lo=d(()=>{be()});function uo(e){let t;for(;t=e.sourceEvent;)e=t;return e}var fo=d(()=>{});function He(e,t){if(e=uo(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}var ho=d(()=>{fo()});function je(e){return typeof e=="string"?new Q([document.querySelectorAll(e)],[document.documentElement]):new Q([e==null?[]:Vt(e)],Bt)}var po=d(()=>{Gr();be()});var Ae=d(()=>{qt();Nr();ho();lo();po();be();Fr();rs();is()});var mo=d(()=>{});function Br(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function cs(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}var go=d(()=>{});function Qt(){}function xo(){return this.rgb().formatHex()}function Ph(){return jo(this).formatHsl()}function _o(){return this.rgb().formatRgb()}function We(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Rh.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?vo(t):r===3?new ve(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Hr(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Hr(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Oh.exec(e))?new ve(t[1],t[2],t[3],1):(t=kh.exec(e))?new ve(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Dh.exec(e))?Hr(t[1],t[2],t[3],t[4]):(t=Lh.exec(e))?Hr(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Yh.exec(e))?bo(t[1],t[2]/100,t[3]/100,1):(t=Xh.exec(e))?bo(t[1],t[2]/100,t[3]/100,t[4]):yo.hasOwnProperty(e)?vo(yo[e]):e==="transparent"?new ve(NaN,NaN,NaN,0):null}function vo(e){return new ve(e>>16&255,e>>8&255,e&255,1)}function Hr(e,t,r,n){return n<=0&&(e=t=r=NaN),new ve(e,t,r,n)}function Nh(e){return e instanceof Qt||(e=We(e)),e?(e=e.rgb(),new ve(e.r,e.g,e.b,e.opacity)):new ve}function Et(e,t,r,n){return arguments.length===1?Nh(e):new ve(e,t,r,n??1)}function ve(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function wo(){return"#"+ls(this.r)+ls(this.g)+ls(this.b)}function So(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function ls(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function bo(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new De(e,t,r,n)}function jo(e){if(e instanceof De)return new De(e.h,e.s,e.l,e.opacity);if(e instanceof Qt||(e=We(e)),!e)return new De;if(e instanceof De)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),a=Math.max(t,r,n),i=NaN,o=a-s,c=(a+s)/2;return o?(t===a?i=(r-n)/o+(r<n)*6:r===a?i=(n-t)/o+2:i=(t-r)/o+4,o/=c<.5?a+s:2-a-s,i*=60):o=c>0&&c<1?0:i,new De(i,o,c,e.opacity)}function Vo(e,t,r,n){return arguments.length===1?jo(e):new De(e,t,r,n??1)}function De(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function us(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var Ht,Qr,Tt,Wt,ke,Rh,Oh,kh,Dh,Lh,Yh,Xh,yo,To=d(()=>{go();Ht=.7,Qr=1/Ht,Tt="\\s*([+-]?\\d+)\\s*",Wt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ke="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Rh=/^#([0-9a-f]{3,8})$/,Oh=new RegExp("^rgb\\("+[Tt,Tt,Tt]+"\\)$"),kh=new RegExp("^rgb\\("+[ke,ke,ke]+"\\)$"),Dh=new RegExp("^rgba\\("+[Tt,Tt,Tt,Wt]+"\\)$"),Lh=new RegExp("^rgba\\("+[ke,ke,ke,Wt]+"\\)$"),Yh=new RegExp("^hsl\\("+[Wt,ke,ke]+"\\)$"),Xh=new RegExp("^hsla\\("+[Wt,ke,ke,Wt]+"\\)$"),yo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Br(Qt,We,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:xo,formatHex:xo,formatHsl:Ph,formatRgb:_o,toString:_o});Br(ve,Et,cs(Qt,{brighter:function(e){return e=e==null?Qr:Math.pow(Qr,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Ht:Math.pow(Ht,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wo,formatHex:wo,formatRgb:So,toString:So}));Br(De,Vo,cs(Qt,{brighter:function(e){return e=e==null?Qr:Math.pow(Qr,e),new De(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ht:Math.pow(Ht,e),new De(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new ve(us(e>=240?e-240:e+120,s,n),us(e,s,n),us(e<120?e+240:e-120,s,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}))});var Wr=d(()=>{To()});function fs(e,t,r,n,s){var a=e*e,i=a*e;return((1-3*e+3*a-i)*t+(4-6*a+3*i)*r+(1+3*e+3*a-3*i)*n+i*s)/6}function Eo(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),s=e[n],a=e[n+1],i=n>0?e[n-1]:2*s-a,o=n<t-1?e[n+2]:2*a-s;return fs((r-n/t)*t,i,s,a,o)}}var hs=d(()=>{});function Ao(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),s=e[(n+t-1)%t],a=e[n%t],i=e[(n+1)%t],o=e[(n+2)%t];return fs((r-n/t)*t,s,a,i,o)}}var Io=d(()=>{hs()});var ds,Co=d(()=>{ds=e=>()=>e});function zh(e,t){return function(r){return e+r*t}}function Fh(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Mo(e){return(e=+e)==1?Zr:function(t,r){return r-t?Fh(t,r,e):ds(isNaN(t)?r:t)}}function Zr(e,t){var r=t-e;return r?zh(e,r):ds(isNaN(e)?t:e)}var Ro=d(()=>{Co()});function Oo(e){return function(t){var r=t.length,n=new Array(r),s=new Array(r),a=new Array(r),i,o;for(i=0;i<r;++i)o=Et(t[i]),n[i]=o.r||0,s[i]=o.g||0,a[i]=o.b||0;return n=e(n),s=e(s),a=e(a),o.opacity=1,function(c){return o.r=n(c),o.g=s(c),o.b=a(c),o+""}}}var Kr,Gh,Uh,ko=d(()=>{Wr();hs();Io();Ro();Kr=function e(t){var r=Mo(t);function n(s,a){var i=r((s=Et(s)).r,(a=Et(a)).r),o=r(s.g,a.g),c=r(s.b,a.b),l=Zr(s.opacity,a.opacity);return function(u){return s.r=i(u),s.g=o(u),s.b=c(u),s.opacity=l(u),s+""}}return n.gamma=e,n}(1);Gh=Oo(Eo),Uh=Oo(Ao)});function Ve(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var Jr=d(()=>{});function qh(e){return function(){return e}}function $h(e){return function(t){return e(t)+""}}function gs(e,t){var r=ps.lastIndex=ms.lastIndex=0,n,s,a,i=-1,o=[],c=[];for(e=e+"",t=t+"";(n=ps.exec(e))&&(s=ms.exec(t));)(a=s.index)>r&&(a=t.slice(r,a),o[i]?o[i]+=a:o[++i]=a),(n=n[0])===(s=s[0])?o[i]?o[i]+=s:o[++i]=s:(o[++i]=null,c.push({i,x:Ve(n,s)})),r=ms.lastIndex;return r<t.length&&(a=t.slice(r),o[i]?o[i]+=a:o[++i]=a),o.length<2?c[0]?$h(c[0].x):qh(t):(t=c.length,function(l){for(var u=0,h;u<t;++u)o[(h=c[u]).i]=h.x(l);return o.join("")})}var ps,ms,Do=d(()=>{Jr();ps=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ms=new RegExp(ps.source,"g")});function ys(e,t,r,n,s,a){var i,o,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*r+t*n)&&(r-=e*c,n-=t*c),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,c/=o),e*n<t*r&&(e=-e,t=-t,c=-c,i=-i),{translateX:s,translateY:a,rotate:Math.atan2(t,e)*Lo,skewX:Math.atan(c)*Lo,scaleX:i,scaleY:o}}var Lo,en,Yo=d(()=>{Lo=180/Math.PI,en={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function Xo(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?en:ys(t.a,t.b,t.c,t.d,t.e,t.f)}function Po(e){return e==null?en:(tn||(tn=document.createElementNS("http://www.w3.org/2000/svg","g")),tn.setAttribute("transform",e),(e=tn.transform.baseVal.consolidate())?(e=e.matrix,ys(e.a,e.b,e.c,e.d,e.e,e.f)):en)}var tn,No=d(()=>{Yo()});function zo(e,t,r,n){function s(l){return l.length?l.pop()+" ":""}function a(l,u,h,p,m,_){if(l!==h||u!==p){var x=m.push("translate(",null,t,null,r);_.push({i:x-4,x:Ve(l,h)},{i:x-2,x:Ve(u,p)})}else(h||p)&&m.push("translate("+h+t+p+r)}function i(l,u,h,p){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),p.push({i:h.push(s(h)+"rotate(",null,n)-2,x:Ve(l,u)})):u&&h.push(s(h)+"rotate("+u+n)}function o(l,u,h,p){l!==u?p.push({i:h.push(s(h)+"skewX(",null,n)-2,x:Ve(l,u)}):u&&h.push(s(h)+"skewX("+u+n)}function c(l,u,h,p,m,_){if(l!==h||u!==p){var x=m.push(s(m)+"scale(",null,",",null,")");_.push({i:x-4,x:Ve(l,h)},{i:x-2,x:Ve(u,p)})}else(h!==1||p!==1)&&m.push(s(m)+"scale("+h+","+p+")")}return function(l,u){var h=[],p=[];return l=e(l),u=e(u),a(l.translateX,l.translateY,u.translateX,u.translateY,h,p),i(l.rotate,u.rotate,h,p),o(l.skewX,u.skewX,h,p),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,h,p),l=u=null,function(m){for(var _=-1,x=p.length,w;++_<x;)h[(w=p[_]).i]=w.x(m);return h.join("")}}}var xs,_s,Fo=d(()=>{Jr();No();xs=zo(Xo,"px, ","px)","deg)"),_s=zo(Po,", ",")",")")});var Zt=d(()=>{Jr();Do();Fo();ko()});function rr(){return at||(Uo(Bh),at=tr.now()+sn)}function Bh(){at=0}function nr(){this._call=this._time=this._next=null}function an(e,t,r){var n=new nr;return n.restart(e,t,r),n}function qo(){rr(),++At;for(var e=rn,t;e;)(t=at-e._time)>=0&&e._call.call(null,t),e=e._next;--At}function $o(){at=(nn=tr.now())+sn,At=Kt=0;try{qo()}finally{At=0,Hh(),at=0}}function Qh(){var e=tr.now(),t=e-nn;t>Go&&(sn-=t,nn=e)}function Hh(){for(var e,t=rn,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:rn=r);er=e,vs(n)}function vs(e){if(!At){Kt&&(Kt=clearTimeout(Kt));var t=e-at;t>24?(e<1/0&&(Kt=setTimeout($o,e-tr.now()-sn)),Jt&&(Jt=clearInterval(Jt))):(Jt||(nn=tr.now(),Jt=setInterval(Qh,Go)),At=1,Uo($o))}}var At,Kt,Jt,Go,rn,er,nn,at,sn,tr,Uo,ws=d(()=>{At=0,Kt=0,Jt=0,Go=1e3,nn=0,at=0,sn=0,tr=typeof performance=="object"&&performance.now?performance:Date,Uo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};nr.prototype=an.prototype={constructor:nr,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?rr():+r)+(t==null?0:+t),!this._next&&er!==this&&(er?er._next=this:rn=this,er=this),this._call=e,this._time=r,vs()},stop:function(){this._call&&(this._call=null,this._time=1/0,vs())}}});function on(e,t,r){var n=new nr;return t=t==null?0:+t,n.restart(s=>{n.stop(),e(s+t)},t,r),n}var Bo=d(()=>{ws()});var cn=d(()=>{ws();Bo()});function Ze(e,t,r,n,s,a){var i=e.__transition;if(!i)e.__transition={};else if(r in i)return;Kh(e,r,{name:t,index:n,group:s,on:Wh,tween:Zh,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Qo})}function ar(e,t){var r=re(e,t);if(r.state>Qo)throw new Error("too late; already scheduled");return r}function ae(e,t){var r=re(e,t);if(r.state>un)throw new Error("too late; already running");return r}function re(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Kh(e,t,r){var n=e.__transition,s;n[t]=r,r.timer=an(a,0,r.time);function a(l){r.state=Ss,r.timer.restart(i,r.delay,r.time),r.delay<=l&&i(l-r.delay)}function i(l){var u,h,p,m;if(r.state!==Ss)return c();for(u in n)if(m=n[u],m.name===r.name){if(m.state===un)return on(i);m.state===Ho?(m.state=sr,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete n[u]):+u<t&&(m.state=sr,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete n[u])}if(on(function(){r.state===un&&(r.state=Ho,r.timer.restart(o,r.delay,r.time),o(l))}),r.state=ln,r.on.call("start",e,e.__data__,r.index,r.group),r.state===ln){for(r.state=un,s=new Array(p=r.tween.length),u=0,h=-1;u<p;++u)(m=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(s[++h]=m);s.length=h+1}}function o(l){for(var u=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(c),r.state=fn,1),h=-1,p=s.length;++h<p;)s[h].call(e,u);r.state===fn&&(r.on.call("end",e,e.__data__,r.index,r.group),c())}function c(){r.state=sr,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}var Wh,Zh,Qo,Ss,ln,un,Ho,fn,sr,de=d(()=>{Kn();cn();Wh=Zn("start","end","cancel","interrupt"),Zh=[],Qo=0,Ss=1,ln=2,un=3,Ho=4,fn=5,sr=6});function ir(e,t){var r=e.__transition,n,s,a=!0,i;if(!!r){t=t==null?null:t+"";for(i in r){if((n=r[i]).name!==t){a=!1;continue}s=n.state>ln&&n.state<fn,n.state=sr,n.timer.stop(),n.on.call(s?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[i]}a&&delete e.__transition}}var bs=d(()=>{de()});function Wo(e){return this.each(function(){ir(this,e)})}var Zo=d(()=>{bs()});function Jh(e,t){var r,n;return function(){var s=ae(this,e),a=s.tween;if(a!==r){n=r=a;for(var i=0,o=n.length;i<o;++i)if(n[i].name===t){n=n.slice(),n.splice(i,1);break}}s.tween=n}}function ed(e,t,r){var n,s;if(typeof r!="function")throw new Error;return function(){var a=ae(this,e),i=a.tween;if(i!==n){s=(n=i).slice();for(var o={name:t,value:r},c=0,l=s.length;c<l;++c)if(s[c].name===t){s[c]=o;break}c===l&&s.push(o)}a.tween=s}}function Ko(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=re(this.node(),r).tween,s=0,a=n.length,i;s<a;++s)if((i=n[s]).name===e)return i.value;return null}return this.each((t==null?Jh:ed)(r,e,t))}function It(e,t,r){var n=e._id;return e.each(function(){var s=ae(this,n);(s.value||(s.value={}))[t]=r.apply(this,arguments)}),function(s){return re(s,n).value[t]}}var or=d(()=>{de()});function hn(e,t){var r;return(typeof t=="number"?Ve:t instanceof We?Kr:(r=We(t))?(t=r,Kr):gs)(e,t)}var js=d(()=>{Wr();Zt()});function td(e){return function(){this.removeAttribute(e)}}function rd(e){return function(){this.removeAttributeNS(e.space,e.local)}}function nd(e,t,r){var n,s=r+"",a;return function(){var i=this.getAttribute(e);return i===s?null:i===n?a:a=t(n=i,r)}}function sd(e,t,r){var n,s=r+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===s?null:i===n?a:a=t(n=i,r)}}function ad(e,t,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=t(n=i,o)))}}function id(e,t,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=t(n=i,o)))}}function Jo(e,t){var r=Pe(e),n=r==="transform"?_s:hn;return this.attrTween(e,typeof t=="function"?(r.local?id:ad)(r,n,It(this,"attr."+e,t)):t==null?(r.local?rd:td)(r):(r.local?sd:nd)(r,n,t))}var ec=d(()=>{Zt();Ae();or();js()});function od(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function cd(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function ld(e,t){var r,n;function s(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&cd(e,a)),r}return s._value=t,s}function ud(e,t){var r,n;function s(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&od(e,a)),r}return s._value=t,s}function tc(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Pe(e);return this.tween(r,(n.local?ld:ud)(n,t))}var rc=d(()=>{Ae()});function fd(e,t){return function(){ar(this,e).delay=+t.apply(this,arguments)}}function hd(e,t){return t=+t,function(){ar(this,e).delay=t}}function nc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?fd:hd)(t,e)):re(this.node(),t).delay}var sc=d(()=>{de()});function dd(e,t){return function(){ae(this,e).duration=+t.apply(this,arguments)}}function pd(e,t){return t=+t,function(){ae(this,e).duration=t}}function ac(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?dd:pd)(t,e)):re(this.node(),t).duration}var ic=d(()=>{de()});function md(e,t){if(typeof t!="function")throw new Error;return function(){ae(this,e).ease=t}}function oc(e){var t=this._id;return arguments.length?this.each(md(t,e)):re(this.node(),t).ease}var cc=d(()=>{de()});function gd(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;ae(this,e).ease=r}}function lc(e){if(typeof e!="function")throw new Error;return this.each(gd(this._id,e))}var uc=d(()=>{de()});function fc(e){typeof e!="function"&&(e=Ut(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var a=t[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&e.call(c,c.__data__,l,a)&&o.push(c);return new ce(n,this._parents,this._name,this._id)}var hc=d(()=>{Ae();ze()});function dc(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=t[o],l=r[o],u=c.length,h=i[o]=new Array(u),p,m=0;m<u;++m)(p=c[m]||l[m])&&(h[m]=p);for(;o<n;++o)i[o]=t[o];return new ce(i,this._parents,this._name,this._id)}var pc=d(()=>{ze()});function yd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function xd(e,t,r){var n,s,a=yd(t)?ar:ae;return function(){var i=a(this,e),o=i.on;o!==n&&(s=(n=o).copy()).on(t,r),i.on=s}}function mc(e,t){var r=this._id;return arguments.length<2?re(this.node(),r).on.on(e):this.each(xd(r,e,t))}var gc=d(()=>{de()});function _d(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function yc(){return this.on("end.remove",_d(this._id))}var xc=d(()=>{});function _c(e){var t=this._name,r=this._id;typeof e!="function"&&(e=st(e));for(var n=this._groups,s=n.length,a=new Array(s),i=0;i<s;++i)for(var o=n[i],c=o.length,l=a[i]=new Array(c),u,h,p=0;p<c;++p)(u=o[p])&&(h=e.call(u,u.__data__,p,o))&&("__data__"in u&&(h.__data__=u.__data__),l[p]=h,Ze(l[p],t,r,p,l,re(u,r)));return new ce(a,this._parents,t,r)}var vc=d(()=>{Ae();ze();de()});function wc(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Gt(e));for(var n=this._groups,s=n.length,a=[],i=[],o=0;o<s;++o)for(var c=n[o],l=c.length,u,h=0;h<l;++h)if(u=c[h]){for(var p=e.call(u,u.__data__,h,c),m,_=re(u,r),x=0,w=p.length;x<w;++x)(m=p[x])&&Ze(m,t,r,x,p,_);a.push(p),i.push(u)}return new ce(a,i,t,r)}var Sc=d(()=>{Ae();ze();de()});function bc(){return new vd(this._groups,this._parents)}var vd,jc=d(()=>{Ae();vd=Ne.prototype.constructor});function wd(e,t){var r,n,s;return function(){var a=Qe(this,e),i=(this.style.removeProperty(e),Qe(this,e));return a===i?null:a===r&&i===n?s:s=t(r=a,n=i)}}function Vc(e){return function(){this.style.removeProperty(e)}}function Sd(e,t,r){var n,s=r+"",a;return function(){var i=Qe(this,e);return i===s?null:i===n?a:a=t(n=i,r)}}function bd(e,t,r){var n,s,a;return function(){var i=Qe(this,e),o=r(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(e),Qe(this,e))),i===c?null:i===n&&c===s?a:(s=c,a=t(n=i,o))}}function jd(e,t){var r,n,s,a="style."+t,i="end."+a,o;return function(){var c=ae(this,e),l=c.on,u=c.value[a]==null?o||(o=Vc(t)):void 0;(l!==r||s!==u)&&(n=(r=l).copy()).on(i,s=u),c.on=n}}function Tc(e,t,r){var n=(e+="")==="transform"?xs:hn;return t==null?this.styleTween(e,wd(e,n)).on("end.style."+e,Vc(e)):typeof t=="function"?this.styleTween(e,bd(e,n,It(this,"style."+e,t))).each(jd(this._id,e)):this.styleTween(e,Sd(e,n,t),r).on("end.style."+e,null)}var Ec=d(()=>{Zt();Ae();de();or();js()});function Vd(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function Td(e,t,r){var n,s;function a(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&Vd(e,i,r)),n}return a._value=t,a}function Ac(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Td(e,t,r??""))}var Ic=d(()=>{});function Ed(e){return function(){this.textContent=e}}function Ad(e){return function(){var t=e(this);this.textContent=t??""}}function Cc(e){return this.tween("text",typeof e=="function"?Ad(It(this,"text",e)):Ed(e==null?"":e+""))}var Mc=d(()=>{or()});function Id(e){return function(t){this.textContent=e.call(this,t)}}function Cd(e){var t,r;function n(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&Id(s)),t}return n._value=e,n}function Rc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Cd(e))}var Oc=d(()=>{});function kc(){for(var e=this._name,t=this._id,r=dn(),n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)if(c=i[l]){var u=re(c,t);Ze(c,e,r,l,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ce(n,this._parents,e,r)}var Dc=d(()=>{ze();de()});function Lc(){var e,t,r=this,n=r._id,s=r.size();return new Promise(function(a,i){var o={value:i},c={value:function(){--s==0&&a()}};r.each(function(){var l=ae(this,n),u=l.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(c)),l.on=t}),s===0&&a()})}var Yc=d(()=>{de()});function ce(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function Vs(e){return Ne().transition(e)}function dn(){return++Md}var Md,it,ze=d(()=>{Ae();ec();rc();sc();ic();cc();uc();hc();pc();gc();xc();vc();Sc();jc();Ec();Ic();Mc();Oc();Dc();or();Yc();Md=0;it=Ne.prototype;ce.prototype=Vs.prototype={constructor:ce,select:_c,selectAll:wc,filter:fc,merge:dc,selection:bc,transition:kc,call:it.call,nodes:it.nodes,node:it.node,size:it.size,empty:it.empty,each:it.each,on:mc,attr:Jo,attrTween:tc,style:Tc,styleTween:Ac,text:Cc,textTween:Rc,remove:yc,tween:Ko,delay:nc,duration:ac,ease:oc,easeVarying:lc,end:Lc,[Symbol.iterator]:it[Symbol.iterator]}});function pn(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Xc=d(()=>{});var Ts=d(()=>{Xc()});function Od(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function Pc(e){var t,r;e instanceof ce?(t=e._id,e=e._name):(t=dn(),(r=Rd).time=rr(),e=e==null?null:e+"");for(var n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&Ze(c,e,t,l,i,r||Od(c,t));return new ce(n,this._parents,e,t)}var Rd,Nc=d(()=>{ze();de();Ts();cn();Rd={time:null,delay:0,duration:250,ease:pn}});var zc=d(()=>{Ae();Zo();Nc();Ne.prototype.interrupt=Wo;Ne.prototype.transition=Pc});var Fc=d(()=>{ze();de()});var mn=d(()=>{zc();ze();Fc();bs()});var Gc=d(()=>{});var Uc=d(()=>{});var qc=d(()=>{});function $c(e){return[+e[0],+e[1]]}function kd(e){return[$c(e[0]),$c(e[1])]}function Es(e){return{type:e}}var J_,ev,tv,Bc=d(()=>{mn();Gc();Uc();qc();J_={name:"x",handles:["w","e"].map(Es),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},ev={name:"y",handles:["n","s"].map(Es),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},tv={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Es),input:function(e){return e==null?null:kd(e)},output:function(e){return e}}});var Qc=d(()=>{Bc()});var Hc=d(()=>{});var Wc=d(()=>{});var Zc=d(()=>{});var Kc=d(()=>{});var Jc=d(()=>{});var el=d(()=>{});var tl=d(()=>{});var rl=d(()=>{});function nl(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ot(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}var cr=d(()=>{});function sl(e){return e=ot(Math.abs(e)),e?e[1]:NaN}var al=d(()=>{cr()});function il(e,t){return function(r,n){for(var s=r.length,a=[],i=0,o=e[0],c=0;s>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),a.push(r.substring(s-=o,s+o)),!((c+=o+1)>n));)o=e[i=(i+1)%e.length];return a.reverse().join(t)}}var ol=d(()=>{});function cl(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var ll=d(()=>{});function lr(e){if(!(t=Dd.exec(e)))throw new Error("invalid format: "+e);var t;return new As({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function As(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}var Dd,ul=d(()=>{Dd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;lr.prototype=As.prototype;As.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function fl(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var hl=d(()=>{});function dl(e,t){var r=ot(e,t);if(!r)return e+"";var n=r[0],s=r[1],a=s-(Is=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return a===i?n:a>i?n+new Array(a-i+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+ot(e,Math.max(0,t+a-1))[0]}var Is,Cs=d(()=>{cr()});function Ms(e,t){var r=ot(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}var pl=d(()=>{cr()});var Rs,ml=d(()=>{cr();Cs();pl();Rs={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:nl,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ms(e*100,t),r:Ms,s:dl,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)}});function Os(e){return e}var gl=d(()=>{});function _l(e){var t=e.grouping===void 0||e.thousands===void 0?Os:il(yl.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Os:cl(yl.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"\u2212":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(h){h=lr(h);var p=h.fill,m=h.align,_=h.sign,x=h.symbol,w=h.zero,j=h.width,I=h.comma,V=h.precision,Y=h.trim,X=h.type;X==="n"?(I=!0,X="g"):Rs[X]||(V===void 0&&(V=12),Y=!0,X="g"),(w||p==="0"&&m==="=")&&(w=!0,p="0",m="=");var J=x==="$"?r:x==="#"&&/[boxX]/.test(X)?"0"+X.toLowerCase():"",Se=x==="$"?n:/[%p]/.test(X)?i:"",ue=Rs[X],Ce=/[defgprs%]/.test(X);V=V===void 0?6:/[gprs]/.test(X)?Math.max(1,Math.min(21,V)):Math.max(0,Math.min(20,V));function Ue(R){var Te=J,ie=Se,Ee,St,qe;if(X==="c")ie=ue(R)+ie,R="";else{R=+R;var $e=R<0||1/R<0;if(R=isNaN(R)?c:ue(Math.abs(R),V),Y&&(R=fl(R)),$e&&+R==0&&_!=="+"&&($e=!1),Te=($e?_==="("?_:o:_==="-"||_==="("?"":_)+Te,ie=(X==="s"?xl[8+Is/3]:"")+ie+($e&&_==="("?")":""),Ce){for(Ee=-1,St=R.length;++Ee<St;)if(qe=R.charCodeAt(Ee),48>qe||qe>57){ie=(qe===46?s+R.slice(Ee+1):R.slice(Ee))+ie,R=R.slice(0,Ee);break}}}I&&!w&&(R=t(R,1/0));var Be=Te.length+R.length+ie.length,_e=Be<j?new Array(j-Be+1).join(p):"";switch(I&&w&&(R=t(_e+R,_e.length?j-ie.length:1/0),_e=""),m){case"<":R=Te+R+ie+_e;break;case"=":R=Te+_e+R+ie;break;case"^":R=_e.slice(0,Be=_e.length>>1)+Te+R+ie+_e.slice(Be);break;default:R=_e+Te+R+ie;break}return a(R)}return Ue.toString=function(){return h+""},Ue}function u(h,p){var m=l((h=lr(h),h.type="f",h)),_=Math.max(-8,Math.min(8,Math.floor(sl(p)/3)))*3,x=Math.pow(10,-_),w=xl[8+_/3];return function(j){return m(x*j)+w}}return{format:l,formatPrefix:u}}var yl,xl,vl=d(()=>{al();ol();ll();ul();hl();ml();Cs();gl();yl=Array.prototype.map,xl=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function ks(e){return gn=_l(e),wl=gn.format,Sl=gn.formatPrefix,gn}var gn,wl,Sl,bl=d(()=>{vl();ks({thousands:",",grouping:[3],currency:["$",""]})});var jl=d(()=>{bl()});var Vl=d(()=>{});var Tl=d(()=>{});var El=d(()=>{});var Al=d(()=>{});function le(e,t,r,n){function s(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return s.floor=function(a){return e(a=new Date(+a)),a},s.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},s.round=function(a){var i=s(a),o=s.ceil(a);return a-i<o-a?i:o},s.offset=function(a,i){return t(a=new Date(+a),i==null?1:Math.floor(i)),a},s.range=function(a,i,o){var c=[],l;if(a=s.ceil(a),o=o==null?1:Math.floor(o),!(a<i)||!(o>0))return c;do c.push(l=new Date(+a)),t(a,o),e(a);while(l<a&&a<i);return c},s.filter=function(a){return le(function(i){if(i>=i)for(;e(i),!a(i);)i.setTime(i-1)},function(i,o){if(i>=i)if(o<0)for(;++o<=0;)for(;t(i,-1),!a(i););else for(;--o>=0;)for(;t(i,1),!a(i););})},r&&(s.count=function(a,i){return Ds.setTime(+a),Ls.setTime(+i),e(Ds),e(Ls),Math.floor(r(Ds,Ls))},s.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?s.filter(n?function(i){return n(i)%a==0}:function(i){return s.count(0,i)%a==0}):s}),s}var Ds,Ls,ct=d(()=>{Ds=new Date,Ls=new Date});var Ld,ur,Yd,lt,yn,Zv,Kv,fr=d(()=>{Ld=1e3,ur=Ld*60,Yd=ur*60,lt=Yd*24,yn=lt*7,Zv=lt*30,Kv=lt*365});var Il,xn,Xd,Cl=d(()=>{ct();fr();Il=le(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ur)/lt,e=>e.getDate()-1),xn=Il,Xd=Il.range});function ut(e){return le(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*ur)/yn})}var hr,Ct,Ml,Rl,Ke,Ol,kl,Dl,Pd,Nd,zd,Fd,Gd,Ud,Ll=d(()=>{ct();fr();hr=ut(0),Ct=ut(1),Ml=ut(2),Rl=ut(3),Ke=ut(4),Ol=ut(5),kl=ut(6),Dl=hr.range,Pd=Ct.range,Nd=Ml.range,zd=Rl.range,Fd=Ke.range,Gd=Ol.range,Ud=kl.range});var Ys,ft,qd,Yl=d(()=>{ct();Ys=le(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ys.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:le(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};ft=Ys,qd=Ys.range});var Xl,_n,$d,Pl=d(()=>{ct();fr();Xl=le(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/lt},function(e){return e.getUTCDate()-1}),_n=Xl,$d=Xl.range});function ht(e){return le(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/yn})}var dr,Mt,Nl,zl,Je,Fl,Gl,Ul,Bd,Qd,Hd,Wd,Zd,Kd,ql=d(()=>{ct();fr();dr=ht(0),Mt=ht(1),Nl=ht(2),zl=ht(3),Je=ht(4),Fl=ht(5),Gl=ht(6),Ul=dr.range,Bd=Mt.range,Qd=Nl.range,Hd=zl.range,Wd=Je.range,Zd=Fl.range,Kd=Gl.range});var Xs,dt,Jd,$l=d(()=>{ct();Xs=le(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Xs.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:le(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};dt=Xs,Jd=Xs.range});var Ps=d(()=>{Cl();Ll();Yl();Pl();ql();$l()});function Ns(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function zs(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function pr(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function Fs(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,a=e.days,i=e.shortDays,o=e.months,c=e.shortMonths,l=mr(s),u=gr(s),h=mr(a),p=gr(a),m=mr(i),_=gr(i),x=mr(o),w=gr(o),j=mr(c),I=gr(c),V={a:$e,A:Be,b:_e,B:Dn,c:null,d:Kl,e:Kl,f:Sp,g:Rp,G:kp,H:_p,I:vp,j:wp,L:Jl,m:bp,M:jp,p:Ln,q:Yn,Q:au,s:iu,S:Vp,u:Tp,U:Ep,V:Ap,w:Ip,W:Cp,x:null,X:null,y:Mp,Y:Op,Z:Dp,"%":su},Y={a:Xn,A:Pn,b:Nn,B:zn,c:null,d:tu,e:tu,f:Pp,g:Hp,G:Zp,H:Lp,I:Yp,j:Xp,L:ru,m:Np,M:zp,p:Fn,q:Gn,Q:au,s:iu,S:Fp,u:Gp,U:Up,V:qp,w:$p,W:Bp,x:null,X:null,y:Qp,Y:Wp,Z:Kp,"%":su},X={a:Ue,A:R,b:Te,B:ie,c:Ee,d:Wl,e:Wl,f:mp,g:Hl,G:Ql,H:Zl,I:Zl,j:fp,L:pp,m:up,M:hp,p:Ce,q:lp,Q:yp,s:xp,S:dp,u:sp,U:ap,V:ip,w:np,W:op,x:St,X:qe,y:Hl,Y:Ql,Z:cp,"%":gp};V.x=J(r,V),V.X=J(n,V),V.c=J(t,V),Y.x=J(r,Y),Y.X=J(n,Y),Y.c=J(t,Y);function J(T,M){return function(k){var S=[],oe=-1,N=0,fe=T.length,he,y,z;for(k instanceof Date||(k=new Date(+k));++oe<fe;)T.charCodeAt(oe)===37&&(S.push(T.slice(N,oe)),(y=Bl[he=T.charAt(++oe)])!=null?he=T.charAt(++oe):y=he==="e"?" ":"0",(z=M[he])&&(he=z(k,y)),S.push(he),N=oe+1);return S.push(T.slice(N,oe)),S.join("")}}function Se(T,M){return function(k){var S=pr(1900,void 0,1),oe=ue(S,T,k+="",0),N,fe;if(oe!=k.length)return null;if("Q"in S)return new Date(S.Q);if("s"in S)return new Date(S.s*1e3+("L"in S?S.L:0));if(M&&!("Z"in S)&&(S.Z=0),"p"in S&&(S.H=S.H%12+S.p*12),S.m===void 0&&(S.m="q"in S?S.q:0),"V"in S){if(S.V<1||S.V>53)return null;"w"in S||(S.w=1),"Z"in S?(N=zs(pr(S.y,0,1)),fe=N.getUTCDay(),N=fe>4||fe===0?Mt.ceil(N):Mt(N),N=_n.offset(N,(S.V-1)*7),S.y=N.getUTCFullYear(),S.m=N.getUTCMonth(),S.d=N.getUTCDate()+(S.w+6)%7):(N=Ns(pr(S.y,0,1)),fe=N.getDay(),N=fe>4||fe===0?Ct.ceil(N):Ct(N),N=xn.offset(N,(S.V-1)*7),S.y=N.getFullYear(),S.m=N.getMonth(),S.d=N.getDate()+(S.w+6)%7)}else("W"in S||"U"in S)&&("w"in S||(S.w="u"in S?S.u%7:"W"in S?1:0),fe="Z"in S?zs(pr(S.y,0,1)).getUTCDay():Ns(pr(S.y,0,1)).getDay(),S.m=0,S.d="W"in S?(S.w+6)%7+S.W*7-(fe+5)%7:S.w+S.U*7-(fe+6)%7);return"Z"in S?(S.H+=S.Z/100|0,S.M+=S.Z%100,zs(S)):Ns(S)}}function ue(T,M,k,S){for(var oe=0,N=M.length,fe=k.length,he,y;oe<N;){if(S>=fe)return-1;if(he=M.charCodeAt(oe++),he===37){if(he=M.charAt(oe++),y=X[he in Bl?M.charAt(oe++):he],!y||(S=y(T,k,S))<0)return-1}else if(he!=k.charCodeAt(S++))return-1}return S}function Ce(T,M,k){var S=l.exec(M.slice(k));return S?(T.p=u.get(S[0].toLowerCase()),k+S[0].length):-1}function Ue(T,M,k){var S=m.exec(M.slice(k));return S?(T.w=_.get(S[0].toLowerCase()),k+S[0].length):-1}function R(T,M,k){var S=h.exec(M.slice(k));return S?(T.w=p.get(S[0].toLowerCase()),k+S[0].length):-1}function Te(T,M,k){var S=j.exec(M.slice(k));return S?(T.m=I.get(S[0].toLowerCase()),k+S[0].length):-1}function ie(T,M,k){var S=x.exec(M.slice(k));return S?(T.m=w.get(S[0].toLowerCase()),k+S[0].length):-1}function Ee(T,M,k){return ue(T,t,M,k)}function St(T,M,k){return ue(T,r,M,k)}function qe(T,M,k){return ue(T,n,M,k)}function $e(T){return i[T.getDay()]}function Be(T){return a[T.getDay()]}function _e(T){return c[T.getMonth()]}function Dn(T){return o[T.getMonth()]}function Ln(T){return s[+(T.getHours()>=12)]}function Yn(T){return 1+~~(T.getMonth()/3)}function Xn(T){return i[T.getUTCDay()]}function Pn(T){return a[T.getUTCDay()]}function Nn(T){return c[T.getUTCMonth()]}function zn(T){return o[T.getUTCMonth()]}function Fn(T){return s[+(T.getUTCHours()>=12)]}function Gn(T){return 1+~~(T.getUTCMonth()/3)}return{format:function(T){var M=J(T+="",V);return M.toString=function(){return T},M},parse:function(T){var M=Se(T+="",!1);return M.toString=function(){return T},M},utcFormat:function(T){var M=J(T+="",Y);return M.toString=function(){return T},M},utcParse:function(T){var M=Se(T+="",!0);return M.toString=function(){return T},M}}}function L(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",a=s.length;return n+(a<r?new Array(r-a+1).join(t)+s:s)}function rp(e){return e.replace(tp,"\\$&")}function mr(e){return new RegExp("^(?:"+e.map(rp).join("|")+")","i")}function gr(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function np(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function sp(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function ap(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function ip(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function op(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Ql(e,t,r){var n=ne.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Hl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function cp(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function lp(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function up(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Wl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function fp(e,t,r){var n=ne.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Zl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function hp(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function dp(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function pp(e,t,r){var n=ne.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function mp(e,t,r){var n=ne.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function gp(e,t,r){var n=ep.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function yp(e,t,r){var n=ne.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function xp(e,t,r){var n=ne.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Kl(e,t){return L(e.getDate(),t,2)}function _p(e,t){return L(e.getHours(),t,2)}function vp(e,t){return L(e.getHours()%12||12,t,2)}function wp(e,t){return L(1+xn.count(ft(e),e),t,3)}function Jl(e,t){return L(e.getMilliseconds(),t,3)}function Sp(e,t){return Jl(e,t)+"000"}function bp(e,t){return L(e.getMonth()+1,t,2)}function jp(e,t){return L(e.getMinutes(),t,2)}function Vp(e,t){return L(e.getSeconds(),t,2)}function Tp(e){var t=e.getDay();return t===0?7:t}function Ep(e,t){return L(hr.count(ft(e)-1,e),t,2)}function eu(e){var t=e.getDay();return t>=4||t===0?Ke(e):Ke.ceil(e)}function Ap(e,t){return e=eu(e),L(Ke.count(ft(e),e)+(ft(e).getDay()===4),t,2)}function Ip(e){return e.getDay()}function Cp(e,t){return L(Ct.count(ft(e)-1,e),t,2)}function Mp(e,t){return L(e.getFullYear()%100,t,2)}function Rp(e,t){return e=eu(e),L(e.getFullYear()%100,t,2)}function Op(e,t){return L(e.getFullYear()%1e4,t,4)}function kp(e,t){var r=e.getDay();return e=r>=4||r===0?Ke(e):Ke.ceil(e),L(e.getFullYear()%1e4,t,4)}function Dp(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+L(t/60|0,"0",2)+L(t%60,"0",2)}function tu(e,t){return L(e.getUTCDate(),t,2)}function Lp(e,t){return L(e.getUTCHours(),t,2)}function Yp(e,t){return L(e.getUTCHours()%12||12,t,2)}function Xp(e,t){return L(1+_n.count(dt(e),e),t,3)}function ru(e,t){return L(e.getUTCMilliseconds(),t,3)}function Pp(e,t){return ru(e,t)+"000"}function Np(e,t){return L(e.getUTCMonth()+1,t,2)}function zp(e,t){return L(e.getUTCMinutes(),t,2)}function Fp(e,t){return L(e.getUTCSeconds(),t,2)}function Gp(e){var t=e.getUTCDay();return t===0?7:t}function Up(e,t){return L(dr.count(dt(e)-1,e),t,2)}function nu(e){var t=e.getUTCDay();return t>=4||t===0?Je(e):Je.ceil(e)}function qp(e,t){return e=nu(e),L(Je.count(dt(e),e)+(dt(e).getUTCDay()===4),t,2)}function $p(e){return e.getUTCDay()}function Bp(e,t){return L(Mt.count(dt(e)-1,e),t,2)}function Qp(e,t){return L(e.getUTCFullYear()%100,t,2)}function Hp(e,t){return e=nu(e),L(e.getUTCFullYear()%100,t,2)}function Wp(e,t){return L(e.getUTCFullYear()%1e4,t,4)}function Zp(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Je(e):Je.ceil(e),L(e.getUTCFullYear()%1e4,t,4)}function Kp(){return"+0000"}function su(){return"%"}function au(e){return+e}function iu(e){return Math.floor(+e/1e3)}var Bl,ne,ep,tp,ou=d(()=>{Ps();Bl={"-":"",_:" ","0":"0"},ne=/^\s*\d+/,ep=/^%/,tp=/[\\^$*+?|[\]().{}]/g});function Gs(e){return Rt=Fs(e),cu=Rt.format,lu=Rt.parse,uu=Rt.utcFormat,fu=Rt.utcParse,Rt}var Rt,cu,lu,uu,fu,hu=d(()=>{ou();Gs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});var du=d(()=>{hu()});var pu=d(()=>{});var mu=d(()=>{});var gu=d(()=>{});var yu=d(()=>{});var xu=d(()=>{});function pt(e,t,r){this.k=e,this.x=t,this.y=r}function qs(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Us;return e.__zoom}var Us,$s=d(()=>{pt.prototype={constructor:pt,scale:function(e){return e===1?this:new pt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new pt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Us=new pt(1,0,0);qs.prototype=pt.prototype});var _u=d(()=>{});var vu=d(()=>{mn();yu();xu();$s();_u()});var wu=d(()=>{vu();$s()});var mt=d(()=>{Ya();Xa();Pa();Qc();Wc();Wr();Zc();Kc();Kn();mo();Jc();Ts();el();rl();jl();Vl();Tl();Zt();Hc();El();tl();Al();pu();mu();Ae();gu();Ps();du();cn();mn();wu()});var Su=d(()=>{Yr();mt();K.register("SliderTransformer",{constructor:K,redraw:({layer:e,transformer:t})=>{$(e.getGraphic()).selectAll(":not(.ig-layer-background)").remove();let r=t.getSharedVar("x1")??0,n=t.getSharedVar("x2")??0,s=t.getSharedVar("height")??0,a=t.getSharedVar("fill")??"#000000",i=t.getSharedVar("opacity")??.3;$(e.getGraphic()).append("rect").attr("x1",r).attr("x2",n).attr("width",n-r).attr("height",s).attr("fill",a).attr("opacity",i)}});K.register("HighlightSelection",{constructor:K,redraw({layer:e,transformer:t}){let r=$(e.getGraphic()).selectAll(t.getSharedVar("selector")||"*");Object.entries(t.getSharedVar("highlightAttrValues")).forEach(([s,a])=>{r.attr(s,a)})}});K.register("TransientRectangleTransformer",{constructor:K,className:["draw-shape","transient-shape","rectangle-shape"],redraw:({layer:e,transformer:t})=>{$(e.getGraphic()).selectAll(":not(.ig-layer-background)").remove(),$(e.getGraphic()).append("rect").attr("x",t.getSharedVar("x")).attr("y",t.getSharedVar("y")).attr("width",t.getSharedVar("width")).attr("height",t.getSharedVar("height")).attr("fill",t.getSharedVar("fillColor")).attr("opacity",t.getSharedVar("opacity"))}});K.register("SelectionTransformer",{constructor:K,redraw:({layer:e,transformer:t})=>{t.getSharedVar("result").forEach(s=>{e.getGraphic().appendChild(s)});let r=t.getSharedVar("highlightColor"),n=Object.entries(t.getSharedVar("highlightAttrValues")||{});if(r||n.length){let s=je(t.getSharedVar("result"));r&&s.attr("fill",r).attr("stroke",r),n.forEach(([a,i])=>{s.attr(a,i)})}}});K.register("HelperLineTransformer",{constructor:K,transient:!0,sharedVar:{orientation:["horizontal","vertical"],style:{}},redraw({layer:e,transformer:t}){let r=e.getLayerFromQueue("mainLayer"),n=t.getSharedVar("orientation"),s=t.getSharedVar("style"),a=t.getSharedVar("x"),i=t.getSharedVar("y"),o=t.getSharedVar("tooltip"),c=t.getSharedVar("scaleX"),l=t.getSharedVar("scaleY"),u=[],h=0,p=0;o&&(typeof o=="object"&&o.prefix&&u.push(o.prefix),c&&c.invert&&typeof a=="number"&&u.push(c.invert(a-(e._offset?.x??0))),l&&l.invert&&typeof i=="number"&&u.push(l.invert(i-(e._offset?.y??0))),typeof o=="object"&&o.suffix&&u.push(o.suffix),typeof o=="object"&&o.offset&&(typeof o.offset.x=="number"&&(h=o.offset.x),typeof o.offset.y=="number"&&(p=o.offset.y),typeof o.offset.x=="function"&&typeof a=="number"&&(h=o.offset.x(a-(e._offset?.x??0))),typeof o.offset.y=="function"&&typeof i=="number"&&(p=o.offset.y(i-(e._offset?.y??0)))));let m=u.join(" ");if(n.includes("horizontal")&&typeof i=="number"){let _=$(e.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",i-(e._offset?.y??0)).attr("y2",i-(e._offset?.y??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}if(n.includes("vertical")&&typeof a=="number"){let _=$(e.getGraphic()).append("line").attr("y1",0).attr("y2",r.getGraphic().getBoundingClientRect().height).attr("x1",a-(e._offset?.x??0)).attr("x2",a-(e._offset?.x??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}m&&$(e.getGraphic()).append("text").attr("x",a-(e._offset?.x??0)).attr("y",i-(e._offset?.y??0)).text(m)}});K.register("TextTransformer",{constructor:K,transient:!0,sharedVar:{style:{},content:"",field:null},redraw({layer:e,transformer:t}){let r=t.getSharedVar("style"),n=t.getSharedVar("offsetx")||t.getSharedVar("x"),s=t.getSharedVar("offsety")||t.getSharedVar("y"),a=t.getSharedVar("content"),i=t.getSharedVar("field"),o=t.getSharedVar("result"),c=t.getSharedVar("position"),l=a,u=n,h=s;if(i){let p=e.getDatum(o);if(p)if(l=p?.[i]??"",c instanceof Function){let{x:m,y:_}=c(p);u=m??u,h=_??h}else u=c?.x??u,h=c?.y??h;else l=""}$(e.getGraphic()).append("text").attr("x",u).attr("y",h).text(l).call(p=>{r&&Object.entries(r).forEach(([m,_])=>{p.style(m,_)})})}})});var yr,Bs,H,Fe=d(()=>{Yr();Yr();Su();yr=K,Bs=jt,H=K});var bu,Ot,vn,D,Jp,XS,em,ju,kt=d(()=>{ge();Fe();Ot={},vn=[],D=class{constructor(t,r){this.joining=!1,this._linkCache={},this._transformers=[],this._joinTransformers=[],this._services=[],this._joinServices=[],this._initializing=null,this._nextTick=0,this._computing=null,this._result=null,this._oldResult=null,this[bu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._sharedVar={},this._transformers=r.transformers??[],this._joinTransformers=r.joinTransformers??[],this._services=r.services??[],this._joinServices=r.joinServices??[],this._layerInstances=[],this._resultAlias=r.resultAlias??"result",this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._initializing=Promise.all(Object.entries(r.sharedVar||{}).map(n=>this.setSharedVar(n[0],n[1]))).then(async()=>{r.postUpdate&&r.postUpdate.call(this,this),this._postUpdate=r.postUpdate??null,this._initializing=null}),r.layer&&this._layerInstances.push(r.layer),vn.push(this),r.postInitialize&&r.postInitialize.call(this,this)}getSharedVar(t,r){if(!(r&&r.layer&&this._layerInstances.length&&!this._layerInstances.includes(r.layer)))return!(t in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(t,r.defaultValue,r),this._sharedVar[t]}async setSharedVar(t,r,n){if(this.preUpdate(),this._sharedVar[t]=r,this._userOptions.evaluate&&this._resultAlias){if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._oldResult=this._result;try{this._computing=this._userOptions.evaluate({self:this,...this._userOptions.params??{},...this._sharedVar}),this._result=await this._computing,this._computing=null,this._services.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})}),this._transformers.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})})}catch(s){console.error(s),this._result=void 0,this._computing=null}this._nextTick=0,this.postUpdate()})}else this.postUpdate()}async setSharedVars(t,r){Object.entries(t).forEach(([n,s])=>{this._sharedVar[n]=s}),Object.keys(t).length>0&&await this.setSharedVar(...Object.entries(t)[0],r)}async join(){if(this._resultAlias){this.joining=!0,Object.keys(this._sharedVar).length&&this.setSharedVar(...Object.entries(this._sharedVar)[0]);let t=await this._internalResults;this._joinServices&&this._joinServices.length?await Promise.all(this._joinServices.map(async r=>(await r.setSharedVar(this._resultAlias,t),r.results))):this._initializing||await Promise.all(this._services.map(async r=>(await r.setSharedVar(this._resultAlias,t),r.results))),this._joinTransformers&&this._joinTransformers.length?await Promise.all(this._joinTransformers.map(r=>r.setSharedVar(this._resultAlias,t))):this._initializing||await Promise.all(this._transformers.map(r=>r.setSharedVar(this._resultAlias,t)))}}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}preAttach(t){this._preAttach&&this._preAttach.call(this,this,t)}postUse(t){this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return this._baseName===t||this._name===t}get transformers(){return ye(this._transformers.slice(0),H,t=>this._transformers.push(t),t=>{t.setSharedVars({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}),this._transformers.splice(this._transformers.indexOf(t),1)},this)}get services(){return ye(this._services.slice(0),D,t=>this._services.push(t),t=>{Object.entries({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}).forEach(([r,n])=>{t.setSharedVar(r,n)}),this._services.splice(this._services.indexOf(t),1)},this)}get _internalResults(){return this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing?t(await this._computing):t(this._result)})}):this._computing||this._result}get results(){return this._initializing?this._initializing.then(()=>this._internalResults):this._internalResults}get oldResults(){return this._initializing?this._initializing.then(()=>this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,t(this._oldResult)})}):this._oldResult):this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,t(this._oldResult)})}):this._oldResult}static register(t,r){Ot[t]=r}static unregister(t){return delete Ot[t],!0}static initialize(t,r){let n=Object.assign({constructor:D},Ot[t]??{},r??{},{on:Object.assign({},(Ot[t]??{}).on??{},r?.on??{}),sharedVar:Object.assign({},(Ot[t]??{}).sharedVar??{},r?.sharedVar??{}),params:Object.assign({},(Ot[t]??{}).params??{},r?.params??{})});return new n.constructor(t,n)}static findService(t){return vn.filter(r=>r.isInstanceOf(t))}};bu=me;Jp=D.register,XS=D.unregister,em=D.initialize,ju=D.findService});var we,Qs=d(()=>{kt();ge();Fe();we=class extends D{constructor(t,r){super(t,{...r,resultAlias:r?.resultAlias??"result"});this._currentDimension=[],this._transformers.push(H.initialize("SelectionTransformer",{transient:!0,sharedVar:{[this._resultAlias]:[],layer:null,highlightColor:r?.sharedVar?.highlightColor,highlightAttrValues:r?.sharedVar?.highlightAttrValues}})),this._selectionMapping=new Map,Object.entries({...this._userOptions?.query?.attrName?typeof this._userOptions.query.attrName=="string"?{[this._userOptions.query.attrName]:this._userOptions?.query?.extent??[]}:Object.fromEntries(this._userOptions.query.attrName.map((n,s)=>[n,this._userOptions?.query?.extent?.[s]??[]])):{},...this._sharedVar?.attrName?typeof this._sharedVar.attrName=="string"?{[this._sharedVar.attrName]:this._sharedVar?.extent??[]}:Object.fromEntries(this._sharedVar.attrName.map((n,s)=>[n,this._sharedVar?.extent?.[s]??[]])):{}}).filter(([n,s])=>s instanceof Array).forEach(([n,s])=>this._selectionMapping.set(n,s))}async setSharedVar(t,r,n){if(!(n&&n.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(n.layer)))if(this.preUpdate(),this._sharedVar[t]=r,this._transformers.filter(s=>s.isInstanceOf("draw-shape")).forEach(s=>{let a=n?.layer||this._layerInstances[0];if(!a)return;let i=a.getGraphic().getBoundingClientRect();if(a._width&&i.width>a._width||a._height&&i.height>a._height){let h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width",a._width.toString()),h.setAttribute("height",a._height.toString()),h.setAttribute("opacity","0"),a.getGraphic().appendChild(h),i=h.getBoundingClientRect(),a.getGraphic().removeChild(h)}let o=this._sharedVar.x??i.left,c=this._sharedVar.y??i.top,l=this._sharedVar.width??a._width??0,u=this._sharedVar.height??a._height??0;(this._sharedVar.width!==void 0||this._sharedVar.height!==void 0)&&s.setSharedVars({layer:a.getLayerFromQueue("transientLayer"),x:o-i.left,y:c-i.top,width:l,height:u})}),(n?.layer||this._layerInstances.length==1)&&this._userOptions.query){let s=n?.layer||this._layerInstances[0];if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._evaluate(s)})}else this.postUpdate()}_evaluate(t){if(!t)return;this._sharedVar.skipPicking||(this._oldResult=this._result,this._result=t.picking({...this._userOptions.query,...this._sharedVar}));let r=t.getLayerFromQueue("selectionLayer").getGraphic();for(;r?.firstChild;)r.removeChild(r.lastChild);if(this._sharedVar.deepClone){let n=[],s=[];this._result.forEach(a=>{if(a!==t.getGraphic()){let i=s.length;for(let o=0;o<i;o++){let c=s[o],l=n[o];a.contains(c)&&(s.splice(o,1),n.splice(o,1),l.remove(),o--,i--)}n.push(t.cloneVisualElements(a,!0)),s.push(a)}}),this._services.forEach(a=>{a.setSharedVars({...this._sharedVar,[this._resultAlias]:n})}),this._transformers.filter(a=>!a.isInstanceOf("draw-shape")).forEach(a=>{a.setSharedVars({...this._sharedVar,layer:t.getLayerFromQueue("selectionLayer"),[this._resultAlias]:n})})}else this._services.forEach(n=>{n.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result?this._result.map(s=>t.cloneVisualElements(s,!1)):[]})}),this._transformers.filter(n=>!n.isInstanceOf("draw-shape")).forEach(n=>{n.setSharedVars({...this._sharedVar,layer:t.getLayerFromQueue("selectionLayer"),[this._resultAlias]:this._result?this._result.map(s=>t.cloneVisualElements(s,!1)):[]})});if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert&&this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.offsety,a=this._sharedVar.width,i=this._sharedVar.height,o=t._offset?.x??0,c=t._offset?.y??0,l=[n-o,n-o+a].map(this._sharedVar.scaleX.invert),u=[s-c,s-c+i].map(this._sharedVar.scaleY.invert);this.filter([l,u],{passive:!0})}else if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.width,a=t._offset?.x??0,i=[n-a,n-a+s].map(this._sharedVar.scaleX.invert);this.filter(i,{passive:!0})}else if(this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsety,s=this._sharedVar.height,a=t._offset?.y??0,i=[n-a,n-a+s].map(this._sharedVar.scaleY.invert);this.filter(i,{passive:!0})}this._nextTick=0,this.postUpdate()}isInstanceOf(t){return t==="SelectionService"||this._baseName===t||this._name===t}dimension(t,r){let n=[],s=[];typeof t=="string"?(n=[t],s=[r??(c=>c)]):(n=se(t),s=r??n.map(()=>c=>c));let a=n.map((c,l)=>[c,s[l]]),i={},o=[];return this._currentDimension=a,new Proxy(this,{get(c,l,u){return l==="dimension"?c.dimension.bind(c):l==="_currentDimension"?a:l==="_scopeMode"?!0:l==="_sharedVar"?Object.keys(i).length?new Proxy({...c._sharedVar,scaleX:void 0,scaleY:void 0,...i},{set:(h,p,m)=>(i[p]=m,!0)}):new Proxy(c._sharedVar,{set:(h,p,m)=>(i[p]=m,!0)}):l==="_layerInstances"?o.length?o:c._layerInstances:c[l]instanceof Function?c[l].bind(u):c[l]},set(c,l,u){return l==="_layerInstances"?(o=u,!0):(c[l]=u,!0)}})}filter(t,r){if(r&&r.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(r.layer))return this;let n=r?.layer||this._layerInstances[0];return this._currentDimension.length===0&&t instanceof Array&&t.length>0?(this._sharedVar.attrName&&(this._userOptions.query.attrName=this._sharedVar.attrName),this._userOptions.query.attrName&&this.dimension(this._userOptions.query.attrName).filter(t)):this._currentDimension.length===1&&t instanceof Array&&t.length>0&&!(t[0]instanceof Array)?(this._selectionMapping.set(this._currentDimension[0][0],this._currentDimension[0][1](t).sort((s,a)=>typeof s=="number"?s-a:s<a?-1:s==a?0:1)),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})):this._currentDimension.length===t.length&&t.every(s=>s instanceof Array)&&(this._currentDimension.forEach((s,a)=>{this._selectionMapping.set(s[0],s[1](t[a]).sort((i,o)=>typeof i=="number"?i-o:i<o?-1:i==o?0:1))}),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})),this}get extents(){return Object.fromEntries(this._selectionMapping.entries())}};D.SelectionService=we;D.register("SelectionService",{constructor:we});D.register("SurfacePointSelectionService",{constructor:we,query:{baseOn:te.Shape,type:U.SurfacePoint,x:0,y:0}});D.register("PointSelectionService",{constructor:we,query:{baseOn:te.Shape,type:U.Point,x:0,y:0}});D.register("RectSelectionService",{constructor:we,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Shape,type:U.Rect,x:0,y:0,width:1,height:1}});D.register("CircleSelectionService",{constructor:we,query:{baseOn:te.Shape,type:U.Circle,x:0,y:0,r:1}});D.register("PolygonSelectionService",{constructor:we,query:{baseOn:te.Shape,type:U.Polygon,points:[]}});D.register("QuantitativeSelectionService",{constructor:we,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Data,type:et.Quantitative,attrName:"",extent:[0,0]}})});var xr,Vu=d(()=>{kt();xr=class extends D{constructor(t,r){super(t,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(t){return t==="LayoutService"||this._baseName===t||this._name===t}};D.LayoutService=xr;D.register("LayoutService",{constructor:xr});D.register("ScaleService",{constructor:xr,evaluate({offsetx:e,width:t,offsety:r,height:n,scaleX:s,scaleY:a,layer:i,self:o}){let c=i;if(!c&&o._layerInstances&&o._layerInstances.length==1&&(c=o._layerInstances[0]),s&&s.invert&&!a){if(t<=0||isNaN(t))return s;let l=s.copy(),u=l.invert(e-(c?._offset?.x??0)),h=l.invert(e+t-(c?._offset?.x??0));return l.domain([u,h]),l.clamp(!0),l}if(!s&&a&&a.invert){if(n<=0||isNaN(n))return a;let l=a.copy(),u=l.invert(r-(c?._offset?.y??0)),h=l.invert(r+n-(c?._offset?.y??0));return l.domain([u,h]),l.clamp(!0),l}if(s&&a&&s.invert&&a.invert){if(t<=0||isNaN(t)||n<=0||isNaN(n))return{scaleX:s,scaleY:a};let l=s.copy(),u=a.copy(),h=l.invert(e-(c?._offset?.x??0)),p=l.invert(e+t-(c?._offset?.x??0)),m=u.invert(r-(c?._offset?.y??0)),_=u.invert(r+n-(c?._offset?.y??0));return l.domain([h,p]),u.domain([m,_]),l.clamp(!0),u.clamp(!0),{scaleX:l,scaleY:u}}return{scaleX:s,scaleY:a}}})});var gt,Tu=d(()=>{kt();mt();gt=class extends D{constructor(t,r){super(t,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(t){return t==="AnalysisService"||this._baseName===t||this._name===t}};D.AnalysisService=gt;D.register("AnalysisService",{constructor:gt});D.register("FilterService",{constructor:gt,evaluate({data:e,extents:t,result:r,fields:n,self:s}){if(!t&&(!r||!r.length||!n||!n.length))return t?e:[];if(t)Object.entries(t).forEach(([a,i])=>{i[0]>=i[1]||isNaN(i[0])||isNaN(i[1])||(e=e.filter(o=>o[a]>=i[0]&&o[a]<=i[1]))});else{let a=s._layerInstances,i=je(r).datum();a&&a.length>0&&(i=a[0].getDatum(r[0])),i&&n.forEach(o=>{e=e.filter(c=>c[o]==i[o])})}return e}});D.register("InterpolationService",{constructor:gt,evaluate({result:e,field:t,data:r,formula:n}){if(!e)return null;let{data:s,interpolatedNum:a}=e;if(!s||a===void 0||isNaN(a))return null;let i=Math.floor(a),o=s[i][t],c=r.filter(l=>l[t]===o);if(a>i){let l=i+1,u=a-i;c=c.map(h=>{let p=r.find(m=>m[t]===s[l][t]&&!Object.entries(h).find(([_,x])=>typeof x!="number"&&m[_]!==x));return Object.fromEntries(Object.entries(h).map(([m,_])=>typeof _=="number"?[m,_*(1-u)+p[m]*u]:[m,_]))})}return c.map(l=>(n&&Object.entries(n).forEach(([u,h])=>{l[u]=h(l)}),l))}});D.register("AggregateService",{constructor:gt,evaluate({result:e}){return e instanceof Array?e.length:0}})});var Eu,Hs,W,Dt=d(()=>{kt();kt();Qs();Vu();Tu();Eu=ju,Hs=vn,W=D});var Au,Iu=d(()=>{Au=`#JSGF V1.0;

grammar actions;

public <action> = start | stop | pause | resume | play | delete | add | insert | create | remove | drag | move | drag | brush;`});function Zs(e){let t=e.events.map(r=>{if(typeof r=="string")return Sn(r)[0];{let n=Sn("*")[0];n.filterFuncs=[r]}});return{...e,eventStreams:t.map(r=>nm(r))}}function nm(e){return e.filter?{...e,filterFuncs:e.filter?e.filter.map(t=>new Function("event",`return ${t}`)):[]}:{...e}}var Cu,tm,rm,Ws,wn,P,sb,ab,ib,ob,_r=d(()=>{ge();Iu();tm=window.SpeechRecognition||window.webkitSpeechRecognition,rm=window.SpeechGrammarList||window.webkitSpeechGrammarList,Ws={},wn=[],P=class{constructor(t,r){this[Cu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._state=r.state,this._actions=se(r.actions??[]).map(Zs),this._modalities={},this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUse=r.preUse??null,this._postUse=r.postUse??null,r.postInitialize&&r.postInitialize.call(this,this)}enableModality(t){switch(t){case"speech":if(this._modalities.speech)break;let r=new tm;this._modalities.speech=r;let n=new rm;n.addFromString(Au),r.grammars=n,r.lang="en-US";break}}disableModality(t){switch(t){case"speech":this._modalities.speech&&(this._modalities.speech.onresult=null,this._modalities.speech.onend=null,this._modalities.speech.abort(),this._modalities.speech=null);break}}getActions(){return this._actions.slice(0)}setActions(t){let r=t.concat(this._actions);this._actions=r.filter((n,s)=>s===r.findIndex(a=>a.action===n.action))}_parseEvent(t){let r=n=>"stream"in n?n.between.concat(n.stream).flatMap(r):"between"in n?n.between.concat([{type:n.type}]).flatMap(r):n.type;return Sn(t).flatMap(r)}getAcceptEvents(){return[...new Set(this._actions.flatMap(t=>t.eventStreams.flatMap(r=>r.type)).concat(["contextmenu"]))]}async dispatch(t,r){let n=this._actions.find(s=>{let a=s.eventStreams.map(o=>o.type),i=!1;return a.includes("*")&&(i=!0),t instanceof Event?i=s.eventStreams.filter(o=>o.type===t.type).some(o=>o.filterFuncs?o.filterFuncs.every(c=>c(t)):!0):a.includes(t)&&(i=!0),i&&(!s.transition||s.transition.find(o=>o[0]===this._state||o[0]==="*"))});if(n){let s=n.transition&&n.transition.find(a=>a[0]===this._state||a[0]==="*");if(s){if(this._state=s[1],this._state.startsWith("speech:")){this.enableModality("speech");try{this._modalities.speech.start()}catch{}this._modalities.speech.onresult=a=>{let i=a.results[a.resultIndex][0];this.dispatch(i.transcript,r)},this._modalities.speech.onend=a=>{this._modalities.speech.start()}}else this.disableModality("speech");if(n.sideEffect)try{await n.sideEffect({self:this,layer:r,instrument:null,interactor:this,event:t})}catch(a){console.error(a)}return!0}}return!1}preUse(t){this._preUse&&this._preUse.call(this,this,t)}postUse(t){this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return t=="Interactor"||this._baseName===t||this._name===t}static register(t,r){Ws[t]=r}static unregister(t){return delete Ws[t],!0}static initialize(t,r){let n=Object.assign({constructor:P},Ws[t]??{},r??{}),s=new n.constructor(t,n);return wn.push(s),s}static findInteractor(t){return wn.filter(r=>r.isInstanceOf(t))}};Cu=me;sb=P.register,ab=P.unregister,ib=P.initialize,ob=P.findInteractor});var Mu=d(()=>{_r();P.register("MousePositionInteractor",{constructor:P,state:"start",actions:[{action:"hover",events:["mousemove"],transition:[["start","start"]]}]});P.register("TouchPositionInteractor",{constructor:P,state:"start",actions:[{action:"enter",events:["touchstart"],transition:[["start","running"]]},{action:"hover",events:["touchmove"],transition:[["running","running"]]},{action:"leave",events:["touchend"],transition:[["running","start"],["start","start"]]}]});P.register("MouseTraceInteractor",{constructor:P,state:"start",actions:[{action:"dragabort",events:["mousedown[event.button==2]","mouseup[event.button==2]"],transition:[["drag","start"]]},{action:"dragstart",events:["mousedown"],transition:[["start","drag"]]},{action:"drag",events:["mousemove"],transition:[["drag","drag"]]},{action:"dragend",events:["mouseup[event.button==0]"],transition:[["drag","start"]]}]});P.register("TouchTraceInteractor",{constructor:P,state:"start",actions:[{action:"dragstart",events:["touchstart"],transition:[["start","drag"]]},{action:"drag",events:["touchmove"],transition:[["drag","drag"]]},{action:"dragend",events:["touchend"],transition:[["drag","start"]]}]});P.register("SpeechControlInteractor",{constructor:P,state:"start",actions:[{action:"enableSpeech",events:["click"],transition:[["*","speech:ready"]]},{action:"disableSpeech",events:["mouseup[event.button==2]"],transition:[["*","start"]]},{action:"speech",events:["*"],transition:[["*","speech:ready"]]}]});P.register("KeyboardPositionInteractor",{constructor:P,state:"start",actions:[{action:"begin",events:["keydown[event.key===' ']"],transition:[["start","running"]]},{action:"up",events:["keypress[event.key==='w' || event.key==='W']","keydown[event.key==='ArrowUp']{100}"],transition:[["running","running"]]},{action:"left",events:["keypress[event.key==='a' || event.key==='A']","keydown[event.key==='ArrowLeft']{100}"],transition:[["running","running"]]},{action:"down",events:["keypress[event.key==='s' || event.key==='S']","keydown[event.key==='ArrowDown']{100}"],transition:[["running","running"]]},{action:"right",events:["keypress[event.key==='d' || event.key==='D']","keydown[event.key==='ArrowRight']{100}"],transition:[["running","running"]]}]});P.register("MouseWheelInteractor",{constructor:P,state:"start",actions:[{action:"enter",events:["mouseenter"],transition:[["start","running"]]},{action:"wheel",events:["wheel","mousewheel"],transition:[["running","running"]]},{action:"leave",events:["mouseleave"],transition:[["running","start"],["start","start"]]},{action:"abort",events:["mouseup[event.button==2]"],transition:[["running","running"],["start","start"]]}]})});var pb,mb,gb,Ks,Ge,vr=d(()=>{_r();_r();Mu();pb=P.register,mb=P.initialize,gb=P.findInteractor,Ks=wn,Ge=P});function Du(e,t){Ou[e]=t}function Lu(e,t){let r=Object.assign({constructor:Z},Ou[e]??{},t??{},{});return new r.constructor(e,r)}function Yu(e){return ku.filter(t=>t.isInstanceOf(e))}var Ru,Ou,ku,Lt,tt,Z,Yt=d(()=>{ge();Ou={},ku=[],Lt=new Map,tt=new Map,Z=class{constructor(t,r){this._nextTick=0,this[Ru]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._container=r.container,this._order=0,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._postUpdate=r.postUpdate??null,ku.push(this),this._postInitialize&&this._postInitialize.call(this,this)}getGraphic(){return this._graphic}getContainerGraphic(){return this._container}getVisualElements(){return[]}cloneVisualElements(t,r=!1){let n=t.cloneNode(r);return document.createDocumentFragment().append(n),n.__libra__screenElement=t,n}getDatum(t){return null}join(t,r){return[]}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}picking(t){return[]}getLayerFromQueue(t){Lt.has(this)||Lt.set(this,{[this._name]:this}),tt.has(this)||tt.set(this,{[this._name]:0});let r=Lt.get(this);if(!(t in r)){let n=Z.initialize(this._baseName,{...this._userOptions,name:t,group:"",redraw(){}});r[t]=n,Lt.set(n,r);let s=r[t].getGraphic();s&&s.style&&(s.style.pointerEvents="none")}return t in tt.get(this)||(tt.get(this)[t]=0),r[t]}setLayersOrder(t){Lt.has(this)||Lt.set(this,{[this._name]:this}),tt.has(this)||tt.set(this,{[this._name]:0});let r=tt.get(this),n=document.createDocumentFragment();Object.entries(t).forEach(([s,a])=>{r[s]=a}),Object.entries(r).sort((s,a)=>s[1]-a[1]).forEach(([s,a])=>{if(r[s]=a,tt.set(this.getLayerFromQueue(s),r),a>=0){let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="initial")}else{let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="none")}this.getLayerFromQueue(s)._order=a,n.append(this.getLayerFromQueue(s).getGraphic(!0))}),this.getContainerGraphic().appendChild(n)}isInstanceOf(t){return this._baseName===t||this._name===t}};Ru=me;Z.register=Du;Z.initialize=Lu;Z.findLayer=Yu});var Xu,bn,wr,Pu=d(()=>{Yt();mt();ge();Xu="D3Layer",bn="ig-layer-background",wr=class extends Z{constructor(t,r){super(t,r);this._width=r.width,this._height=r.height,this._offset=r.offset,this._name=r.name,this._graphic=$(r.container).append("g").call(s=>{this._name&&s.attr("className",this._name)}).call(s=>{this._offset&&s.attr("transform",`translate(${this._offset.x||0}, ${this._offset.y||0})`)}).node(),$(this._graphic).append("rect").attr("class",bn).attr("width",this._width).attr("height",this._height).attr("opacity",0);let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}getDatum(t){return!t||t instanceof Array&&t.length==0?null:t instanceof Array?je(t).datum():$(t).datum()}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${bn})`)]}cloneVisualElements(t,r=!1){let n=$(t).clone(r).node();return document.createDocumentFragment().append(n),n.__libra__screenElement=t,n}select(t){return this._graphic.querySelectorAll(t)}picking(t){return t.baseOn===te.Shape?this._shapeQuery(t):t.baseOn===te.Data?this._dataQuery(t):t.baseOn===te.Attr?this._attrQuery(t):[]}_isElementInLayer(t){return this._graphic.contains(t)&&!t.classList.contains(bn)}_shapeQuery(t){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(t.type===U.SurfacePoint){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(this._isElementInLayer.bind(this)),r.length>=1&&(r=[r[0]])}else if(t.type===U.Point){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(this._isElementInLayer.bind(this))}else if(t.type===U.Circle){let i=t.x-n.left,o=t.y-n.top,c=t.r,l=Math.floor(c*Math.sin(Math.PI/4))<<1,u=i-(l>>>1),h=o-(l>>>1),p=new Set,m=this._svg.createSVGRect();m.x=u,m.y=h,m.width=l,m.height=l,this._svg.getIntersectionList(m,this._graphic).forEach(Y=>p.add(Y));let _=c,x=i-c,w=o-c,j=new Set,I=this._svg.createSVGRect();I.x=x,I.y=w,I.width=_*2,I.height=_*2,this._svg.getIntersectionList(I,this._graphic).forEach(Y=>j.add(Y));let V=1;for(;;){for(let Ce of j)p.has(Ce)&&j.delete(Ce);if(!j.size||V*2+l>=c*2)break;let Y=Math.sqrt(c*c-Math.pow(l/2+V,2)),X=this._svg.createSVGRect();X.x=i-Y,X.y=h-V,X.width=Y*2,X.height=1;let J=this._svg.createSVGRect();J.x=i-Y,J.y=h+l+V-1,J.width=Y*2,J.height=1;let Se=this._svg.createSVGRect();Se.x=u-V,Se.y=o-Y,Se.width=1,Se.height=Y*2;let ue=this._svg.createSVGRect();ue.x=u+l+V-1,ue.y=o-Y,ue.width=1,ue.height=Y*2,[X,J,Se,ue].forEach(Ce=>{this._svg.getIntersectionList(Ce,this._graphic).forEach(Ue=>p.add(Ue))}),V++}r=[...p].filter(this._isElementInLayer.bind(this))}else if(t.type===U.Rect){let{x:i,y:o,width:c,height:l}=t,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=m,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(x=>!x.classList.contains(bn))}else t.type===U.Polygon;let a=[];for(;r.length>0;){let i=r.shift();a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement)}return a}_dataQuery(t){let r=[],n=je(this.getVisualElements());if(t.type===et.Quantitative){let{attrName:s,extent:a}=t;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(u=>u&&u[o]!==void 0&&l[0]<u[o]&&u[o]<l[1])}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a[0]<i[s]&&i[s]<a[1]).nodes()}else if(t.type===et.Nominal){let{attrName:s,extent:a}=t;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(u=>u&&u[o]!==void 0&&l.findIndex(u[o])>=0)}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a.findIndex(i[s])>=0).nodes()}else if(t.type===et.Temporal){let{attrName:s,extent:a}=t;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c],u=t.dateParser?.[c]??(h=>h);i=i.filter(h=>h&&h[o]!==void 0&&l[0].getTime()<u(h[o]).getTime()&&u(h[o]).getTime()<l[1].getTime())}),r=i.nodes()}else{let i=t.dateParser||(o=>o);r=n.filter(o=>o&&o[s]!==void 0&&a[0].getTime()<i(o[s]).getTime()&&i(o[s]).getTime()<a[1].getTime()).nodes()}}return r}_attrQuery(t){let{attrName:r,value:n}=t;return $(this._graphic).filter(a=>a[r]===n).nodes()}};Z.D3Layer=wr;Z.register(Xu,{constructor:wr});Z.register(Xu,{constructor:wr})});var Js=d(()=>{});function Nu(e){return{a:parseFloat(e.a),b:parseFloat(e.b),c:parseFloat(e.c),d:parseFloat(e.d),e:parseFloat(e.e),f:parseFloat(e.f)}}var ea=d(()=>{});var zu=d(()=>{});var Fu=d(()=>{});var ta=d(()=>{});function yt(e){return typeof e=="undefined"}var jn=d(()=>{});var Gu=d(()=>{jn()});function Le(e,t=0){return{a:1,c:0,e,b:0,d:1,f:t}}var Xt=d(()=>{});function xt(...e){e=Array.isArray(e[0])?e[0]:e;let t=(r,n)=>({a:r.a*n.a+r.c*n.b,c:r.a*n.c+r.c*n.d,e:r.a*n.e+r.c*n.f+r.e,b:r.b*n.a+r.d*n.b,d:r.b*n.c+r.d*n.d,f:r.b*n.e+r.d*n.f+r.f});switch(e.length){case 0:throw new Error("no matrices provided");case 1:return e[0];case 2:return t(e[0],e[1]);default:{let[r,n,...s]=e,a=t(r,n);return xt(a,...s)}}}function Pt(...e){return xt(...e)}var _t=d(()=>{});function Uu(e,t,r){let n=sm(e),s=am(e),a={a:n,c:-s,e:0,b:s,d:n,f:0};return yt(t)||yt(r)?a:xt([Le(t,r),a,Le(-t,-r)])}function ra(e,t=void 0,r=void 0){return Uu(e*im/180,t,r)}var sm,am,im,Vn=d(()=>{jn();Xt();_t();({cos:sm,sin:am,PI:im}=Math)});function Sr(e,t=void 0,r=void 0,n=void 0){yt(t)&&(t=e);let s={a:e,c:0,e:0,b:0,d:t,f:0};return yt(r)||yt(n)?s:xt([Le(r,n),s,Le(-r,-n)])}var br=d(()=>{jn();Xt();_t()});function qu(e,t){return{a:1,c:e,e:0,b:t,d:1,f:0}}var na=d(()=>{});function om(e,t){return{a:1,c:$u(e),e:0,b:$u(t),d:1,f:0}}function sa(e,t){return om(e*Math.PI/180,t*Math.PI/180)}var $u,aa=d(()=>{({tan:$u}=Math)});var Bu=d(()=>{});var ia=d(()=>{});var Qu=d(()=>{ta();_t();ia()});function Tn(e){return Array.isArray(e)?e.map(t):t(e);function t(r){switch(r.type){case"matrix":if("a"in r&&"b"in r&&"c"in r&&"d"in r&&"e"in r&&"f"in r)return Nu(r);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in r?Le(r.tx,r.ty):Le(r.tx);case"scale":if(!("sx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in r?Sr(r.sx,r.sy):Sr(r.sx);case"rotate":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in r&&"cy"in r?ra(r.angle,r.cx,r.cy):ra(r.angle);case"skewX":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return sa(r.angle,0);case"skewY":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return sa(0,r.angle);case"shear":if(!("shx"in r&&"shy"in r))throw new Error("MISSING_MANDATORY_PARAM");return qu(r.shx,r.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR")}}}var Hu=d(()=>{ea();Xt();br();Vn();aa();na()});function cm(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function vt(e,t,r,n){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,vt.prototype),s.expected=t,s.found=r,s.location=n,s.name="SyntaxError",s}function oa(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,r+=r.repeat(t),e+r.slice(0,t))}function Wu(e,t){t=t!==void 0?t:{};var r={},n=t.grammarSource,s={transformList:Sa},a=Sa,i="matrix",o="(",c=")",l="translate",u="scale",h="rotate",p="skewX",m="skewY",_=",",x=".",w=/^[eE]/,j=/^[+\-]/,I=/^[0-9]/,V=/^[ \t\r\n]/,Y=Re("matrix",!1),X=Re("(",!1),J=Re(")",!1),Se=Re("translate",!1),ue=Re("scale",!1),Ce=Re("rotate",!1),Ue=Re("skewX",!1),R=Re("skewY",!1),Te=Re(",",!1),ie=_a("fractionalConstant"),Ee=Re(".",!1),St=Dr(["e","E"],!1,!1),qe=Dr(["+","-"],!1,!1),$e=Dr([["0","9"]],!1,!1),Be=Dr([" ","	","\r",`
`],!1,!1),_e=function(f){return f},Dn=function(f,g){return f.concat(g)},Ln=function(f,g,v,b,O,E){return[{type:"matrix",a:f,b:g,c:v,d:b,e:O,f:E}]},Yn=function(f,g){var v={type:"translate",tx:f};return g&&(v.ty=g),[v]},Xn=function(f,g){var v={type:"scale",sx:f};return g&&(v.sy=g),[v]},Pn=function(f,g){var v={type:"rotate",angle:f};return g&&(v.cx=g[0],v.cy=g[1]),[v]},Nn=function(f){return[{type:"skewX",angle:f}]},zn=function(f){return[{type:"skewY",angle:f}]},Fn=function(f){return parseFloat(f.join(""))},Gn=function(f){return parseInt(f.join(""))},T=function(f){return f},M=function(f,g){return[f,g]},k=function(f){return f.join("")},S=function(f,g){return[f,g||null].join("")},oe=function(f,g){return[f,g].join("")},N=function(f,g){return[f?f.join(""):null,".",g.join("")].join("")},fe=function(f){return f.join("")},he=function(f,g){return["e",f,g.join("")].join("")},y=0,z=0,Or=[{line:1,column:1}],Me=0,Un=[],F=0,kr;if("startRule"in t){if(!(t.startRule in s))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');a=s[t.startRule]}function Am(){return e.substring(z,y)}function Im(){return z}function Cm(){return{source:n,start:z,end:y}}function Mm(){return Ft(z,y)}function Rm(f,g){throw g=g!==void 0?g:Ft(z,y),wa([_a(f)],e.substring(z,y),g)}function Om(f,g){throw g=g!==void 0?g:Ft(z,y),xf(f,g)}function Re(f,g){return{type:"literal",text:f,ignoreCase:g}}function Dr(f,g,v){return{type:"class",parts:f,inverted:g,ignoreCase:v}}function km(){return{type:"any"}}function yf(){return{type:"end"}}function _a(f){return{type:"other",description:f}}function va(f){var g=Or[f],v;if(g)return g;for(v=f-1;!Or[v];)v--;for(g=Or[v],g={line:g.line,column:g.column};v<f;)e.charCodeAt(v)===10?(g.line++,g.column=1):g.column++,v++;return Or[f]=g,g}function Ft(f,g,v){var b=va(f),O=va(g),E={source:n,start:{offset:f,line:b.line,column:b.column},end:{offset:g,line:O.line,column:O.column}};return v&&n&&typeof n.offset=="function"&&(E.start=n.offset(E.start),E.end=n.offset(E.end)),E}function q(f){y<Me||(y>Me&&(Me=y,Un=[]),Un.push(f))}function xf(f,g){return new vt(f,null,null,g)}function wa(f,g,v){return new vt(vt.buildMessage(f,g),f,g,v)}function Sa(){var f,g,v,b,O;for(f=y,g=[],v=C();v!==r;)g.push(v),v=C();for(v=ba(),v===r&&(v=null),b=[],O=C();O!==r;)b.push(O),O=C();return z=f,f=_e(v),f}function ba(){var f,g,v,b;if(f=y,g=ja(),g!==r){if(v=[],b=Oe(),b!==r)for(;b!==r;)v.push(b),b=Oe();else v=r;v!==r?(b=ba(),b!==r?(z=f,f=Dn(g,b)):(y=f,f=r)):(y=f,f=r)}else y=f,f=r;return f===r&&(f=ja()),f}function ja(){var f;return f=_f(),f===r&&(f=vf(),f===r&&(f=wf(),f===r&&(f=Sf(),f===r&&(f=bf(),f===r&&(f=jf()))))),f}function _f(){var f,g,v,b,O,E,ee,G,B,$n,Ia,Bn,Ca,Qn,Ma,Hn,Ra,nt;if(f=y,e.substr(y,6)===i?(g=i,y+=6):(g=r,F===0&&q(Y)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r)if(ee=Oe(),ee!==r)if(G=pe(),G!==r)if(B=Oe(),B!==r)if($n=pe(),$n!==r)if(Ia=Oe(),Ia!==r)if(Bn=pe(),Bn!==r)if(Ca=Oe(),Ca!==r)if(Qn=pe(),Qn!==r)if(Ma=Oe(),Ma!==r)if(Hn=pe(),Hn!==r){for(Ra=[],nt=C();nt!==r;)Ra.push(nt),nt=C();e.charCodeAt(y)===41?(nt=c,y++):(nt=r,F===0&&q(J)),nt!==r?(z=f,f=Ln(E,G,$n,Bn,Qn,Hn)):(y=f,f=r)}else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function vf(){var f,g,v,b,O,E,ee,G,B;if(f=y,e.substr(y,9)===l?(g=l,y+=9):(g=r,F===0&&q(Se)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r){for(ee=Va(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();e.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&q(J)),B!==r?(z=f,f=Yn(E,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function wf(){var f,g,v,b,O,E,ee,G,B;if(f=y,e.substr(y,5)===u?(g=u,y+=5):(g=r,F===0&&q(ue)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r){for(ee=Va(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();e.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&q(J)),B!==r?(z=f,f=Xn(E,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function Sf(){var f,g,v,b,O,E,ee,G,B;if(f=y,e.substr(y,6)===h?(g=h,y+=6):(g=r,F===0&&q(Ce)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r){for(ee=Vf(),ee===r&&(ee=null),G=[],B=C();B!==r;)G.push(B),B=C();e.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&q(J)),B!==r?(z=f,f=Pn(E,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function bf(){var f,g,v,b,O,E,ee,G;if(f=y,e.substr(y,5)===p?(g=p,y+=5):(g=r,F===0&&q(Ue)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();e.charCodeAt(y)===41?(G=c,y++):(G=r,F===0&&q(J)),G!==r?(z=f,f=Nn(E)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function jf(){var f,g,v,b,O,E,ee,G;if(f=y,e.substr(y,5)===m?(g=m,y+=5):(g=r,F===0&&q(R)),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(e.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&q(X)),b!==r){for(O=[],E=C();E!==r;)O.push(E),E=C();if(E=pe(),E!==r){for(ee=[],G=C();G!==r;)ee.push(G),G=C();e.charCodeAt(y)===41?(G=c,y++):(G=r,F===0&&q(J)),G!==r?(z=f,f=zn(E)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function pe(){var f,g,v,b;return f=y,g=y,v=qn(),v===r&&(v=null),b=Ef(),b!==r?(v=[v,b],g=v):(y=g,g=r),g!==r&&(z=f,g=Fn(g)),f=g,f===r&&(f=y,g=y,v=qn(),v===r&&(v=null),b=Tf(),b!==r?(v=[v,b],g=v):(y=g,g=r),g!==r&&(z=f,g=Gn(g)),f=g),f}function Va(){var f,g,v;return f=y,g=Oe(),g!==r?(v=pe(),v!==r?(z=f,f=T(v)):(y=f,f=r)):(y=f,f=r),f}function Vf(){var f,g,v,b,O;return f=y,g=Oe(),g!==r?(v=pe(),v!==r?(b=Oe(),b!==r?(O=pe(),O!==r?(z=f,f=M(v,O)):(y=f,f=r)):(y=f,f=r)):(y=f,f=r)):(y=f,f=r),f}function Oe(){var f,g,v,b,O;if(f=y,g=[],v=C(),v!==r)for(;v!==r;)g.push(v),v=C();else g=r;if(g!==r){for(v=Ta(),v===r&&(v=null),b=[],O=C();O!==r;)b.push(O),O=C();g=[g,v,b],f=g}else y=f,f=r;if(f===r)if(f=y,g=Ta(),g!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();g=[g,v],f=g}else y=f,f=r;return f}function Ta(){var f;return e.charCodeAt(y)===44?(f=_,y++):(f=r,F===0&&q(Te)),f}function Tf(){var f,g;return f=y,g=bt(),g!==r&&(z=f,g=k(g)),f=g,f}function Ef(){var f,g,v;return f=y,g=Af(),g!==r?(v=Ea(),v===r&&(v=null),z=f,f=S(g,v)):(y=f,f=r),f===r&&(f=y,g=bt(),g!==r?(v=Ea(),v!==r?(z=f,f=oe(g,v)):(y=f,f=r)):(y=f,f=r)),f}function Af(){var f,g,v,b;return F++,f=y,g=bt(),g===r&&(g=null),e.charCodeAt(y)===46?(v=x,y++):(v=r,F===0&&q(Ee)),v!==r?(b=bt(),b!==r?(z=f,f=N(g,b)):(y=f,f=r)):(y=f,f=r),f===r&&(f=y,g=bt(),g!==r?(e.charCodeAt(y)===46?(v=x,y++):(v=r,F===0&&q(Ee)),v!==r?(z=f,f=fe(g)):(y=f,f=r)):(y=f,f=r)),F--,f===r&&(g=r,F===0&&q(ie)),f}function Ea(){var f,g,v,b;return f=y,w.test(e.charAt(y))?(g=e.charAt(y),y++):(g=r,F===0&&q(St)),g!==r?(v=qn(),v===r&&(v=null),b=bt(),b!==r?(z=f,f=he(v,b)):(y=f,f=r)):(y=f,f=r),f}function qn(){var f;return j.test(e.charAt(y))?(f=e.charAt(y),y++):(f=r,F===0&&q(qe)),f}function bt(){var f,g;if(f=[],g=Aa(),g!==r)for(;g!==r;)f.push(g),g=Aa();else f=r;return f}function Aa(){var f;return I.test(e.charAt(y))?(f=e.charAt(y),y++):(f=r,F===0&&q($e)),f}function C(){var f;return V.test(e.charAt(y))?(f=e.charAt(y),y++):(f=r,F===0&&q(Be)),f}if(kr=a(),kr!==r&&y===e.length)return kr;throw kr!==r&&y<e.length&&q(yf()),wa(Un,Me<e.length?e.charAt(Me):null,Me<e.length?Ft(Me,Me+1):Ft(Me,Me))}var Zu=d(()=>{cm(vt,Error);vt.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){r=e[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,i=this.location.source+":"+a.line+":"+a.column;if(r){var o=this.location.end,c=oa("",a.line.toString().length," "),l=r[s.line-1],u=s.line===o.line?o.column:l.length+1,h=u-s.column||1;t+=`
 --> `+i+`
`+c+` |
`+a.line+" | "+l+`
`+c+" | "+oa("",s.column-1," ")+oa("",h,"^")}else t+=`
 at `+i}return t};vt.buildMessage=function(e,t){var r={literal:function(l){return'"'+s(l.text)+'"'},class:function(l){var u=l.parts.map(function(h){return Array.isArray(h)?a(h[0])+"-"+a(h[1]):a(h)});return"["+(l.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function s(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function a(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function i(l){return r[l.type](l)}function o(l){var u=l.map(i),h,p;if(u.sort(),u.length>0){for(h=1,p=1;h<u.length;h++)u[h-1]!==u[h]&&(u[p]=u[h],p++);u.length=p}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function c(l){return l?'"'+s(l)+'"':"end of input"}return"Expected "+o(e)+" but "+c(t)+" found."}});function En(e){return Wu(e)}var Ku=d(()=>{Zu()});var Ju=d(()=>{br();_t()});var ef=d(()=>{});var tf=d(()=>{Xt();Js();Vn();br();_t()});var ca=d(()=>{Js();ea();zu();Fu();ta();Gu();Vn();br();na();aa();Bu();_t();Xt();Qu();ia();Hu();Ku();Ju();ef();tf()});var rf,la,jr,nf=d(()=>{Yt();mt();ge();ca();rf="VegaLayer",la="background",jr=class extends Z{constructor(t,r){super(t,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`.${r.group}`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let t="translate(0, 0)";if([...this._container.children].includes(this._graphic))t=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(t+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=Pt(Tn(En(t??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${la})`)]}getGraphic(t=!1){return this._userOptions.group?t?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(t){return!t||t instanceof Array&&t.length==0?null:t instanceof Array?je(t).datum()?.datum:$(t).datum()?.datum}cloneVisualElements(t,r=!1){let n=$(t).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform")||"";for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=t,n}select(t){return this._graphic.querySelectorAll(t)}picking(t){return t.baseOn===te.Shape?this._shapeQuery(t):t.baseOn===te.Data?this._dataQuery(t):t.baseOn===te.Attr?this._attrQuery(t):[]}_isElementInLayer(t){return this._graphic.contains(t)&&!t.classList.contains(la)}_shapeQuery(t){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(t.type===U.SurfacePoint){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(t.type===U.Point){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(t.type===U.Circle){let i=t.x,o=t.y,c=t.x-n.left,l=t.y-n.top,u=t.r,h=u,p=c-u,m=l-u,_=new Set,x=this._svg.createSVGRect();x.x=p,x.y=m,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let j=w.getBoundingClientRect(),I=Math.abs(i-j.left),V=Math.abs(o-j.top);return I>j.width/2+u||V>j.height/2+u?!1:I<=j.width/2||V<=j.height/2?!0:Math.pow(I-j.width/2,2)+Math.pow(V-j.height/2,2)<=u*u})}else if(t.type===U.Rect){let{x:i,y:o,width:c,height:l}=t,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=m,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(x=>{if(!this._isElementInLayer(x))return!1;let w=x.getBoundingClientRect();return!(w.right<u+n.left||w.left>u+p+n.left||w.bottom<h+n.top||w.top>h+m+n.top)})}else if(t.type===U.Polygon){let{points:i}=t,o=Math.min(...i.map(p=>p.x))-n.left,c=Math.min(...i.map(p=>p.y))-n.top,l=Math.max(...i.map(p=>p.x))-n.left,u=Math.max(...i.map(p=>p.y))-n.top,h=this._svg.createSVGRect();h.x=o,h.y=c,h.width=l-o,h.height=u-c,r=[...this._svg.getIntersectionList(h,this._graphic)].filter(p=>{if(!this._isElementInLayer(p))return!1;let m=p.getBoundingClientRect();return!(m.right<o+n.left||m.left>l+n.left||m.bottom<c+n.top||m.top>u+n.top)})}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(la)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(t){return[]}_attrQuery(t){let{attrName:r,value:n}=t;return[]}};Z.VegaLayer=jr;Z.register(rf,{constructor:jr});Z.register(rf,{constructor:jr})});var sf,ua,Vr,af=d(()=>{Yt();mt();ge();ca();sf="PlotLayer",ua="background",Vr=class extends Z{constructor(t,r){super(t,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`*[aria-label="${r.group}"]`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let t="translate(0, 0)";if([...this._container.children].includes(this._graphic))t=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(t+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=Pt(Tn(En(t??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${ua})`)]}getGraphic(t=!1){return this._userOptions.group?t?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(t){return!t||t instanceof Array&&t.length==0?null:t instanceof Array?je(t).datum()?.datum:$(t).datum()?.datum}cloneVisualElements(t,r=!1){let n=$(t).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform");for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=t,n}select(t){return this._graphic.querySelectorAll(t)}picking(t){return t.baseOn===te.Shape?this._shapeQuery(t):t.baseOn===te.Data?this._dataQuery(t):t.baseOn===te.Attr?this._attrQuery(t):[]}_isElementInLayer(t){return this._graphic.contains(t)&&!t.classList.contains(ua)}_shapeQuery(t){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(t.type===U.SurfacePoint){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(t.type===U.Point){let{x:i,y:o}=t;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(t.type===U.Circle){let i=t.x,o=t.y,c=t.x-n.left,l=t.y-n.top,u=t.r,h=u,p=c-u,m=l-u,_=new Set,x=this._svg.createSVGRect();x.x=p,x.y=m,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let j=w.getBoundingClientRect(),I=Math.abs(i-j.left),V=Math.abs(o-j.top);return I>j.width/2+u||V>j.height/2+u?!1:I<=j.width/2||V<=j.height/2?!0:Math.pow(I-j.width/2,2)+Math.pow(V-j.height/2,2)<=u*u})}else if(t.type===U.Rect){let{x:i,y:o,width:c,height:l}=t,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),m=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=m,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(x=>{if(!this._isElementInLayer(x))return!1;let w=x.getBoundingClientRect();return!(w.right<u+n.left||w.left>u+p+n.left||w.bottom<h+n.top||w.top>h+m+n.top)})}else if(t.type===U.Polygon){let{points:i}=t,o=Math.min(...i.map(p=>p.x))-n.left,c=Math.min(...i.map(p=>p.y))-n.top,l=Math.max(...i.map(p=>p.x))-n.left,u=Math.max(...i.map(p=>p.y))-n.top,h=this._svg.createSVGRect();h.x=o,h.y=c,h.width=l-o,h.height=u-c,r=[...this._svg.getIntersectionList(h,this._graphic)].filter(p=>{if(!this._isElementInLayer(p))return!1;let m=p.getBoundingClientRect();return!(m.right<o+n.left||m.left>l+n.left||m.bottom<c+n.top||m.top>u+n.top)})}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(ua)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(t){return[]}_attrQuery(t){let{attrName:r,value:n}=t;return[]}};Z.PlotLayer=Vr;Z.register(sf,{constructor:Vr});Z.register(sf,{constructor:Vr})});var Ye,Tr=d(()=>{Yt();Yt();Pu();nf();af();Ye=Z});var of,Xe,wt,Ie,Er,fa,A,lm,uj,um,fm,Nt=d(()=>{vr();ge();Ar();Tr();Dt();Fe();Xe={},wt=[],Ie=new Map,Er=[],fa=!1,A=class{constructor(t,r){this._transformers=[],this._linkCache={},this[of]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._baseName=t,this._userOptions=r,this._name=r.name??t,this._on=Object.assign({},r.on??{}),this._interactors=[],this._layers=[],this._layerInteractors=new Map,this._services=r.services??[],this._serviceInstances=[],this._sharedVar=r.sharedVar??{},this._transformers=r.transformers??[],r.interactors&&r.interactors.forEach(n=>{typeof n=="string"?this.useInteractor(Ge.initialize(n)):"options"in n?typeof n.interactor=="string"?this.useInteractor(Ge.initialize(n.interactor,n.options)):this.useInteractor(n.interactor,n.options):this.useInteractor(n)}),this._services.forEach(n=>{typeof n=="string"||!("options"in n)?this.useService(n):this.useService(n.service,n.options)}),r.layers&&r.layers.forEach(n=>{"options"in n?this.attach(n.layer,n.options):this.attach(n)}),r.postInitialize&&r.postInitialize.call(this,this)}emit(t,r){this._on[t]&&this._on[t].forEach(n=>{n instanceof rt?n.execute(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{})):n(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{}))})}on(t,r){return t instanceof Array?t.forEach(n=>{this._on[n]||(this._on[n]=[]),this._on[n].push(r)}):(this._on[t]||(this._on[t]=[]),this._on[t].push(r)),this}off(t,r){if(!!this._on[t])return this._on[t].includes(r)&&this._on[t].splice(this._on[t].indexOf(r),1),this}_use(t,r){t.preAttach(this),this._serviceInstances.push(t),t.postUse(this)}useService(t,r){typeof t!="string"&&this._serviceInstances.includes(t)||(arguments.length>=2?this._services.push({service:t,options:r}):this._services.push(t),typeof t=="string"?Eu(t).forEach(s=>this._use(s,r)):this._use(t,r))}useInteractor(t,r){t.preUse(this),arguments.length>=2?this._interactors.push({interactor:t,options:r}):this._interactors.push(t),this._layers.forEach(n=>{let s;n instanceof Ye?s=n:s=n.layer,this._layerInteractors.has(s)||this._layerInteractors.set(s,[]);let a=Ge.initialize(t._baseName,t._userOptions);this._layerInteractors.get(s).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof rt?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Ie.has(s.getContainerGraphic())||Ie.set(s.getContainerGraphic(),new Map),Ie.get(s.getContainerGraphic()).has(i)||(s.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,s,i)),Ie.get(s.getContainerGraphic()).set(i,[])),Ie.get(s.getContainerGraphic()).get(i).push([a,s,n instanceof Ye?null:n.options,this])})}),t.postUse(this)}attach(t,r){this._layers.find(n=>n instanceof Ye?n===t:n.layer===t)||(this.preAttach(t,r??null),arguments.length>=2?this._layers.push({layer:t,options:r}):this._layers.push(t),this.postUse(t))}getSharedVar(t,r){return!(t in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(t,r.defaultValue,r),this._sharedVar[t]}setSharedVar(t,r,n){this._sharedVar[t]=r,this._on[`update:${t}`]&&this._on[`update:${t}`].forEach(a=>{a instanceof rt?a.execute({self:this,layer:null,instrument:this,interactor:null}):a({self:this,layer:null,instrument:this,interactor:null})})}watchSharedVar(t,r){this.on(`update:${t}`,r)}preAttach(t,r){this._preAttach&&this._preAttach.call(this,this,t),this._interactors.forEach(n=>{let s;n instanceof Ge?s=n:s=n.interactor,this._layerInteractors.has(t)||this._layerInteractors.set(t,[]);let a=Ge.initialize(s._baseName,s._userOptions);this._layerInteractors.get(t).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof rt?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Ie.has(t.getContainerGraphic())||Ie.set(t.getContainerGraphic(),new Map),Ie.get(t.getContainerGraphic()).has(i)||(t.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,t,i)),Ie.get(t.getContainerGraphic()).set(i,[])),Ie.get(t.getContainerGraphic()).get(i).push([a,t,r,this])})})}async _dispatch(t,r,n){if(t._baseName!=="Layer"&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()),fa){let i=Er.findIndex(o=>o.instrument===this&&o.layer===t&&o.eventType===r);i>=0&&Er.splice(i,1),Er.push({instrument:this,layer:t,eventType:r,event:n});return}fa=!0;let s=Ie.get(t.getContainerGraphic()).get(r).filter(([i,o])=>o._order>=0);s.sort((i,o)=>o[1]._order-i[1]._order);let a=!1;for(let[i,o,c,l]of s){if(n instanceof MouseEvent&&!(o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="backgroundlayer"||o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="bglayer"||c&&c.pointerEvents==="all"))if(!c||c.pointerEvents==="viewport"){let u=o;if(u._offset&&u._width&&u._height&&(n.offsetX<u._offset.x||n.offsetX>u._offset.x+u._width||n.offsetY<u._offset.y||n.offsetY>u._offset.y+u._height))continue}else{if(o.picking({baseOn:te.Shape,type:U.Point,x:n.clientX,y:n.clientY}).length<=0&&i._state==="start")continue;let h=o;if(h._offset&&h._width&&h._height&&(n.offsetX<h._offset.x||n.offsetX>h._offset.x+h._width||n.offsetY<h._offset.y||n.offsetY>h._offset.y+h._height))continue}try{if(await i.dispatch(n,o)&&n instanceof MouseEvent&&c&&c.pointerEvents==="visiblePainted"){a=!0;break}}catch(u){console.error(u);break}}if(fa=!1,Er.length){let i=Er.shift();i.instrument._dispatch(i.layer,i.eventType,i.event)}}postUse(t){let r=t.getGraphic();r&&r.style&&(r.style.pointerEvents="auto"),this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return this._baseName===t||this._name===t}get services(){return ye(this._serviceInstances.slice(0),W,this.useService.bind(this),()=>{throw new Error("Do not support dynamic change service yet")},this)}get transformers(){return ye(this._transformers.slice(0),H,t=>this._transformers.push(t),t=>this._transformers.splice(this._transformers.indexOf(t),1),this)}static register(t,r){Xe[t]=r}static unregister(t){return delete Xe[t],!0}static initialize(t,r){let n=Object.assign({constructor:A},Xe[t]??{},r??{},{on:se(Object.assign({},(Xe[t]??{}).on??{},r?.on??{})),sharedVar:Object.assign({},(Xe[t]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(t,n);return wt.push(s),s}static findInstrument(t){return wt.filter(r=>r.isInstanceOf(t))}};of=me;lm=A.register,uj=A.unregister,um=A.initialize,fm=A.findInstrument});var cf=d(()=>{Nt();Fe();ge();mt();An();A.register("HoverInstrument",{constructor:A,interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.find("SelectionService").setSharedVars({event:e,x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY},{layer:t}),r.transformers.setSharedVars({cx:e.clientX,cy:e.clientY})}]},postInitialize:e=>{e.services.add("SurfacePointSelectionService",{sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});A.register("ClickInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.setSharedVar("x",t.clientX),n.setSharedVar("y",t.clientY),n.services.find("SelectionService").setSharedVars({x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY},{layer:r}),n.emit("clickstart",{...e,self:e.instrument})}],dragend:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:r}),t.clientX===n.getSharedVar("x")&&t.clientY===n.getSharedVar("y")?(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("click",{...e,self:e.instrument})):(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("clickabort",{...e,self:e.instrument}))}],dragabort:[e=>{e.event.changedTouches&&(e.event=e.event.changedTouches[0]),e.instrument.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:e.layer}),e.instrument.emit("clickabort",{...e,self:e.instrument})}]},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});A.register("BrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.find("RectSelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,width:1,height:1,startx:e.clientX,starty:e.clientY,startoffsetx:e.offsetX,startoffsety:e.offsetY,currentx:e.clientX,currenty:e.clientY},{layer:t});let s=e.offsetX,a=e.offsetY,i=0,o=0,c=t._offset?.x??0,l=t._offset?.y??0,u=r.getSharedVar("scaleX"),h=r.getSharedVar("scaleY");if(u&&u.invert&&h&&h.invert){let p=[s-c,s-c+i].map(u.invert),m=[a-l,a-l+o].map(h.invert);r.setSharedVar("extent",[p,m],{layer:t}),r.services.find("SelectionService").filter([p,m])}else r.services.find("SelectionService").filter([[s-c,s-c+i],[a-l,a-l+o]]);r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY),r.setSharedVar("startoffsetx",e.offsetX),r.setSharedVar("startoffsety",e.offsetY)}],drag:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("starty"),i=n.getSharedVar("startoffsetx"),o=n.getSharedVar("startoffsety"),c=Math.min(s,t.clientX),l=Math.min(a,t.clientY),u=Math.min(i,t.offsetX),h=Math.min(o,t.offsetY),p=Math.abs(t.clientX-s),m=Math.abs(t.clientY-a);n.services.find("SelectionService").setSharedVars({x:c,y:l,offsetx:u,offsety:h,width:p,height:m,currentx:t.clientX,currenty:t.clientY},{layer:r})}],dragabort:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0,width:0,height:0,currentx:t.clientX,currenty:t.clientY,endx:t.clientX,endy:t.clientY},{layer:r}),n.emit("brushabort",e)}]},preAttach:(e,t)=>{t.getLayerFromQueue("selectionLayer"),e.services.add("RectSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});A.register("BrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.setSharedVars({x:e.clientX,offsetx:e.offsetX,width:0,startx:e.clientX,startoffsetx:e.offsetX,currentx:e.clientX},{layer:t}),r.setSharedVar("startx",e.clientX),r.setSharedVar("startoffsetx",e.offsetX)}],drag:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("startoffsetx"),i=Math.min(s,t.clientX),o=Math.min(a,t.offsetX),c=Math.abs(t.clientX-s);n.services.find("SelectionService").setSharedVars({x:i,offsetx:o,width:c,currentx:t.clientX},{layer:r}),n.setSharedVar("currentx",t.clientX),n.setSharedVar("currentoffsetx",t.offsetX),n.emit("brush",e)}],dragabort:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.setSharedVars({x:0,offsetx:0,width:0,currentx:t.clientX},{layer:r}),n.emit("brushabort",e)}]},preAttach:(e,t)=>{e.services.add("RectSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});A.register("BrushYInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("RectSelectionService");n.setSharedVar("y",e.clientY,{layer:t}),n.setSharedVar("height",1,{layer:t}),n.setSharedVar("starty",e.clientY,{layer:t}),n.setSharedVar("currenty",e.clientY,{layer:t}),r.setSharedVar("starty",e.clientY),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("starty"),s=Math.min(n,e.clientY),a=Math.abs(e.clientY-n),i=r.services.find("SelectionService");i.setSharedVar("y",s,{layer:t}),i.setSharedVar("height",a,{layer:t}),i.setSharedVar("currenty",e.clientY,{layer:t}),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("starty"),s=Math.min(n,e.clientY),a=Math.abs(e.clientY-n),i=(t.getGraphic().querySelector(".ig-layer-background")||t.getGraphic()).getBoundingClientRect();r.transformers.find("TransientRectangleTransformer").setSharedVars({y:s-i.top,height:a})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("y",0,{layer:t}),n.setSharedVar("height",0,{layer:t}),n.setSharedVar("currenty",e.clientY,{layer:t}),n.setSharedVar("endy",e.clientY,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:0})}]},preAttach:(e,t)=>{let r=e.getSharedVar("x")??0,n=e.getSharedVar("width")??t._width,s=e.services.add("RectSelectionService",{layer:t}),a=t.getGraphic().getBoundingClientRect();s.setSharedVar("x",a.x+r),s.setSharedVar("width",n),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:0,y:0,width:n,height:0,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:{}}})}});A.register("HelperLineInstrument",{constructor:A,sharedVar:{orientation:["horizontal"]},interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.transformers.setSharedVars({x:e.offsetX,y:e.offsetY}),r.setSharedVar("x",e.offsetX,{}),r.setSharedVar("y",e.offsetY,{})}]},preAttach:function(e,t){e.transformers.add("HelperLineTransformer",{layer:t.getLayerFromQueue("transientLayer"),sharedVar:{orientation:e.getSharedVar("orientation"),style:e.getSharedVar("style")||{},tooltip:e.getSharedVar("tooltip"),scaleX:e.getSharedVar("scaleX"),scaleY:e.getSharedVar("scaleY")}})}});A.register("DataBrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.getSharedVar("scaleY"),a=r.services.find("Quantitative2DSelectionService"),i=He(e,t.getGraphic());r.setSharedVar("layerOffsetX",e.clientX-i[0]),r.setSharedVar("layerOffsetY",e.clientY-i[1]),r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY);let o=[i[0],i[0]+1].map(n.invert);a.setSharedVar("extentX",o);let c=[i[1],i[1]+1].map(s.invert);a.setSharedVar("extentX",c),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,y:0,width:1,height:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("starty"),a=r.getSharedVar("layerOffsetX"),i=r.getSharedVar("layerOffsetY"),o=r.getSharedVar("scaleX"),c=r.getSharedVar("scaleY"),l=Math.min(n,e.clientX)-a,u=Math.min(s,e.clientY)-i,h=Math.abs(e.clientX-n),p=Math.abs(e.clientY-s);r.setSharedVar("x",l),r.setSharedVar("y",u),r.setSharedVar("width",h),r.setSharedVar("height",p);let m=[l,l+h].map(o.invert),_=[u+p,u].map(c.invert),x=r.services.find("SelectionService");x.setSharedVar("extentX",m),x.setSharedVar("extentY",_),console.log(x),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("x"),s=r.getSharedVar("y"),a=r.getSharedVar("width"),i=r.getSharedVar("height");r.transformers.find("TransientRectangleTransformer").setSharedVars({x:n,y:s,width:a,height:i})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:t}),n.setSharedVar("width",0,{layer:t}),n.setSharedVar("currentx",e.clientX,{layer:t}),n.setSharedVar("endx",e.clientX,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:async(e,t)=>{let r=e.getSharedVar("scaleX"),n=e.getSharedVar("scaleY"),s=e.getSharedVar("attrNameX"),a=e.getSharedVar("extentX")??[0,0],i=a.map(r),o=e.getSharedVar("attrNameY"),c=e.getSharedVar("extentY")??[0,0],l=a.map(n).reverse(),u=e.services.add("Quantitative2DSelectionService",{layer:t});u.setSharedVar("attrNameX",s),u.setSharedVar("extentX",a),u.setSharedVar("attrNameY",o),u.setSharedVar("extentY",c),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:i[0],y:l[0],width:i[1]-i[0],height:l[1]-l[0],fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}}}),await Promise.all(e.services.results)}});A.register("DataBrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.services.find("QuantitativeSelectionService"),a=He(e,t.getGraphic())[0];r.setSharedVar("layerOffsetX",e.clientX-a),r.setSharedVar("startx",e.clientX),r.setSharedVar("startLayerPosX",a);let i=[a,a+1].map(n.invert);s.setSharedVar("extent",i),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("layerOffsetX"),a=r.getSharedVar("scaleX"),i=Math.min(n,e.clientX),o=Math.abs(e.clientX-n),c=[i-s,i-s+o].map(a.invert),l=r.services.find("QuantitativeSelectionService");r.setSharedVar("extent",c),l.setSharedVar("extent",c),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("startLayerPosX"),s=He(e,t.getGraphic())[0];console.log(n,s);let a=Math.min(n,s),i=Math.abs(s-n);r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:i})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:t}),n.setSharedVar("width",0,{layer:t}),n.setSharedVar("currentx",e.clientX,{layer:t}),n.setSharedVar("endx",e.clientX,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:(e,t)=>{let r=e.getSharedVar("scaleX"),n=e.getSharedVar("height")??t._height,s=e.getSharedVar("y")??0,a=e.getSharedVar("attrNameX"),i=e.getSharedVar("extentX")??[0,0],o=i.map(r),c=e.services.add("QuantitativeSelectionService",{layer:t});c.setSharedVar("attrName",a),c.setSharedVar("extent",i),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:o[0],y:s,width:o[1]-o[0],height:n,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}}})}});A.register("DragInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.setSharedVars({x:t.clientX,y:t.clientY,startx:t.clientX,starty:t.clientY,currentx:t.clientX,currenty:t.clientY,offsetx:t.offsetX,offsety:t.offsetY,skipPicking:!1},{layer:e})}],drag:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=t.clientX-r.services.getSharedVar("x",{layer:e})[0],s=t.clientY-r.services.getSharedVar("y",{layer:e})[0];r.setSharedVar("offsetx",n,{layer:e}),r.setSharedVar("offsety",s,{layer:e}),r.services.setSharedVars({x:t.clientX,y:t.clientY,currentx:t.clientX,currenty:t.clientY,offsetx:t.offsetX,offsety:t.offsetY,skipPicking:!0},{layer:e})}],dragend:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=t.clientX-r.services.getSharedVar("x",{layer:e})[0],s=t.clientY-r.services.getSharedVar("y",{layer:e})[0];r.services.setSharedVars({x:0,y:0,currentx:t.clientX,currenty:t.clientY,endx:t.clientX,endy:t.clientY,offsetx:0,offsety:0,skipPicking:!1},{layer:e}),r.setSharedVar("offsetx",n,{layer:e}),r.setSharedVar("offsety",s,{layer:e})}],dragabort:[e=>{let{layer:t,event:r,instrument:n}=e;r.changedTouches&&(r=r.changedTouches[0]),n.services.setSharedVars({x:0,y:0,currentx:r.clientX,currenty:r.clientY,endx:0,endy:0,offsetx:0,offsety:0,skipPicking:!1},{layer:t}),n.emit("dragconfirm",{...e,self:e.instrument})}]},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone")}})}});A.register("SpeechInstrument",{constructor:A,interactors:["SpeechControlInteractor"]});A.register("KeyboardHelperBarInstrument",{constructor:A,interactors:["KeyboardPositionInteractor"],on:{begin:[()=>console.log("begin")],left:[({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=t.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]-n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}],right:[({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=t.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]+n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}]},preAttach:function(e,t){t.getGraphic().setAttribute("tabindex",0),t.getGraphic().focus();let r=t._height,n=e.getSharedVar("startPos"),s=t.getLayerFromQueue("transientLayer"),a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",n),a.setAttribute("y1","0"),a.setAttribute("x2",n),a.setAttribute("y2",r),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1px"),s.getGraphic().append(a)}});A.register("PanInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY);let n=r.transformers;n.length||(n=yr.findTransformerByLayer(e)),n.forEach(s=>{let a=s.getSharedVar("scaleX"),i=s.getSharedVar("scaleY");a&&s.setSharedVar("$$scaleX",a.copy()),i&&s.setSharedVar("$$scaleY",i.copy())})}],drag:[async({layer:e,event:t,instrument:r,transformer:n})=>{t.changedTouches&&(t=t.changedTouches[0]);let s=r.transformers;s.length||(s=yr.findTransformerByLayer(e));let a=r.getSharedVar("startx"),i=r.getSharedVar("starty"),o=r.getSharedVar("fixRange")??!1;s.forEach(c=>{let l=c.getSharedVar("scaleX"),u=c.getSharedVar("scaleY");if(o){if(l){let h=c.getSharedVar("$$scaleX"),_=h.range().map((x,w)=>x-t.clientX+a).map(x=>h.invert(x));l.domain(_),c.setSharedVar("scaleX",l)}if(u){let h=c.getSharedVar("$$scaleY"),_=h.range().map((x,w)=>x-t.clientY+i).map(x=>h.invert(x));u.domain(_),c.setSharedVar("scaleY",u)}}else{if(l){let p=c.getSharedVar("$$scaleX").range().map((m,_)=>m+t.clientX-a);l.range(p),c.setSharedVar("scaleX",l)}if(u){let p=c.getSharedVar("$$scaleY").range().map((m,_)=>m+t.clientY-i);u.range(p),c.setSharedVar("scaleY",u)}}})}],dragabort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});A.register("PanXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.setSharedVar("startx",t.clientX),r.transformers.forEach(s=>{let a=s.getSharedVar("scaleX");a&&s.setSharedVar("$$scaleX",a.copy())})}],drag:[async({layer:e,event:t,instrument:r,transformer:n})=>{t.changedTouches&&(t=t.changedTouches[0]);let s=r.transformers,a=r.getSharedVar("startx"),i=r.getSharedVar("fixRange")??!1;s.forEach(o=>{let c=o.getSharedVar("scaleX");if(i){if(c){let l=o.getSharedVar("$$scaleX"),p=l.range().map((m,_)=>m-t.clientX+a).map(m=>l.invert(m));c.domain(p),o.setSharedVar("scaleX",c)}}else if(c){let u=o.getSharedVar("$$scaleX").range().map((h,p)=>h+t.clientX-a);c.range(u),o.setSharedVar("scaleX",c)}})}],dragabort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});A.register("GeometricZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=$(n),a=t.transformers;a.length||(a=yr.findTransformerByLayer(e)),t.setSharedVar("currentx",r.offsetX),t.setSharedVar("currenty",r.offsetY);let i=r.deltaY;t.setSharedVar("delta",i);let o=t.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,t.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=He(r,n),u=t.getSharedVar("centroidX")||c,h=t.getSharedVar("centroidY")||l,p=t.getSharedVar("fixRange")??!1;a.forEach(m=>{let _=m.getSharedVar("scaleX"),x=m.getSharedVar("scaleY");if(p){if(_){if(_.type==="time"){let w=_.invert(u);_.domain(_.domain().map(j=>new Date(j.getTime()-w.getTime())).map(j=>new Date(j.getTime()*Math.exp(-i))).map(j=>new Date(j.getTime()+w.getTime())))}else{let w=_.invert(u);_.domain(_.domain().map(j=>j-w).map(j=>j*Math.exp(-i)).map(j=>j+w))}a.forEach(w=>w.setSharedVar("scaleX",_))}if(x){if(x.type==="time"){let w=x.invert(h);x.domain(x.domain().map(j=>new Date(j.getTime()-w.getTime())).map(j=>new Date(j.getTime()*Math.exp(-i))).map(j=>new Date(j.getTime()+w.getTime())))}else{let w=x.invert(h);x.domain(x.domain().map(j=>j-w).map(j=>j*Math.exp(-i)).map(j=>j+w))}a.forEach(w=>w.setSharedVar("scaleY",x))}}else{if(_){let w=_.range().map(j=>(j-u)*Math.exp(i)+u);_.range(w),m.setSharedVar("scaleX",_)}if(x){let w=x.range().map(j=>(j-h)*Math.exp(i)+h);x.range(w),m.setSharedVar("scaleY",x)}}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});A.register("SemanticZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],sharedVar:{currentLevel:0},on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=$(n),a=t.transformers;a.length||(a=yr.findTransformerByLayer(e));let i=t.getSharedVar("scaleLevels"),o=t.getSharedVar("currentLevel");if(o+=Math.sign(r.deltaY),t.setSharedVar("currentLevel",o),typeof i=="object"){let x=Object.keys(i).reduce(function(w,j){return Math.abs(parseInt(j)-o)<Math.abs(parseInt(w)-o)?j:w});a.forEach(w=>w.setSharedVars(i[x]))}t.setSharedVar("currentx",r.offsetX),t.setSharedVar("currenty",r.offsetY);let c=r.deltaY;t.setSharedVar("delta",c);let l=t.getSharedVar("cumulativeDelta",{defaultValue:0});l+=c,t.setSharedVar("cumulativeDelta",l),c/=1e3;let[u,h]=He(r,n),p=t.getSharedVar("centroidX")||u,m=t.getSharedVar("centroidY")||h,_=t.getSharedVar("fixRange")??!1;a.forEach(x=>{let w=x.getSharedVar("scaleX"),j=x.getSharedVar("scaleY");if(_){if(w){if(w.type==="time"){let I=w.invert(p);w.domain(w.domain().map(V=>new Date(V.getTime()-I.getTime())).map(V=>new Date(V.getTime()*Math.exp(-c))).map(V=>new Date(V.getTime()+I.getTime())))}else{let I=w.invert(p);w.domain(w.domain().map(V=>V-I).map(V=>V*Math.exp(-c)).map(V=>V+I))}a.forEach(I=>I.setSharedVar("scaleX",w))}if(j){if(j.type==="time"){let I=j.invert(m);j.domain(j.domain().map(V=>new Date(V.getTime()-I.getTime())).map(V=>new Date(V.getTime()*Math.exp(-c))).map(V=>new Date(V.getTime()+I.getTime())))}else{let I=j.invert(m);j.domain(j.domain().map(V=>V-I).map(V=>V*Math.exp(-c)).map(V=>V+I))}a.forEach(I=>I.setSharedVar("scaleY",j))}}else{if(w){let I=w.range().map(V=>(V-p)*Math.exp(c)+p);w.range(I),x.setSharedVar("scaleX",w)}if(j){let I=j.range().map(V=>(V-m)*Math.exp(c)+m);j.range(I),x.setSharedVar("scaleY",j)}}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]},postUse(e,t){let r=e.getSharedVar("scaleLevels"),n=e.transformers,s=e.getSharedVar("currentLevel");if(typeof r=="object"){let a=Object.keys(r).reduce(function(i,o){return Math.abs(parseInt(o)-s)<Math.abs(parseInt(i)-s)?o:i});n.setSharedVars(r[a])}}});A.register("ZoomXInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=$(n),a=t.transformers;t.setSharedVar("currentx",r.offsetX);let i=r.deltaY;t.setSharedVar("delta",i);let o=t.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,t.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=He(r,n),u=t.getSharedVar("centroidX")||c,h=t.getSharedVar("fixRange")??!1;a.forEach(p=>{let m=p.getSharedVar("scaleX");if(h){if(m){let _=m.invert(u);m.domain(m.domain().map(x=>x-_).map(x=>x*Math.exp(-i)).map(x=>x+_)),a.forEach(x=>x.setSharedVar("scaleX",m))}}else if(m){let _=m.range().map(x=>(x-u)*Math.exp(i)+u);m.range(_),p.setSharedVar("scaleX",m)}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}})});var da,pa,In=d(()=>{Nt();Nt();cf();da=wt,pa=A});var ma={};Cf(ma,{createHistoryTrrack:()=>Cn,tryGetHistoryTrrackInstance:()=>lf,tryRegisterDynamicInstance:()=>hm});async function Cn(){let e=null,t=null,r=!1,n={traceStructure:(s=e)=>({recordList:[...s.record.keys()],children:s.children.map(a=>n.traceStructure(a)),current:s===t}),commit:async()=>{if(r)return;let s=new Map;for(let{component:i,fields:o}of[{list:Ks,fields:["_state","_modalities"]},{list:da,fields:["_sharedVar"]},{list:Hs,fields:["_sharedVar"]},{list:Bs,fields:["_sharedVar"]}].flatMap(({list:c,fields:l})=>c.filter(u=>lf(u)===n).map(u=>({component:u,fields:l}))))await i.results,s.set(i,Object.fromEntries(o.map(c=>[c,se(i[c])])));let a={record:s,prev:t,next:null,children:[]};t&&t.children.push(a),t=a},async undo(){if(t&&t.prev){t.prev.next=t;let s=t.prev.record;r=!0;try{for(let[a,i]of s.entries())Object.entries(i).forEach(([o,c])=>a[o]=se(c)),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=t.prev}catch(a){console.error("Fail to undo history!",a);let i=t.record;for(let[o,c]of i.entries())Object.entries(c).forEach(([l,u])=>o[l]=se(u)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async redo(){if(t&&t.children.length===1&&!t.next&&(t.next=t.children[0]),t&&t.next){let s=t.next.record;r=!0;try{for(let[a,i]of s.entries())Object.entries(i).forEach(([o,c])=>a[o]=se(c)),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=t.next}catch(a){console.error("Fail to redo history!",a);let i=t.record;for(let[o,c]of i.entries())Object.entries(c).forEach(([l,u])=>o[l]=se(u)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async jump(s=[]){let a=s.reduce((i,o)=>i?.children[o],e);if(a){let i=a.record;r=!0;try{for(let[o,c]of i.entries())Object.entries(c).forEach(([l,u])=>o[l]=se(u)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=a}catch(o){console.error("Fail to jump history!",o);let c=t.record;for(let[l,u]of c.entries())Object.entries(u).forEach(([h,p])=>l[h]=se(p)),"_sharedVar"in u&&await l.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}else console.error(`History path [${s.join(", ")}] does not exist!`)}};return[Hs,Bs,uf,da,Ks].flatMap(s=>s).forEach(s=>{Ir.has(s)||Ir.set(s,n)}),await n.commit(),e=t,n}function lf(e){let t=Ir.get(e);return t||{traceStructure(){return null},async commit(){},async undo(){},async redo(){}}}function hm(e,t){let r=Ir.get(e);r&&Ir.set(t,r)}var Ir,Cr=d(()=>{Dt();Fe();Ar();In();vr();ge();Ir=new Map});function ye(e,t,r,n,s){return new Proxy(e,{get(a,i){if(i==="find")return function(o,c){if("initialize"in t){let l=a.filter(u=>u.isInstanceOf(o));if(l.length<=0&&c){let u=t.initialize(c);r(u),l.push(u),ga(s,u)}return ye(l,t,r,n,s)}else{let l=a.slice();return l.forEach(u=>{u.find(...arguments)}),ye(l,t,r,n,s)}};if(i==="add")return(...o)=>{let c=a.slice();if("initialize"in t){let l=t.initialize(...o);return r(l),c.push(l),ga(s,l),ye(c,t,r,n,s)}else return c.forEach(l=>{l.add(...o)}),ye(c,t,r,n,s)};if(i==="remove")return o=>{if(t===Mn){let c=a.slice();return c.forEach(l=>{l.remove(o)}),ye(c,t,r,n,s)}else{let c=a.slice();return c.filter(u=>u.isInstanceOf(o)).forEach(u=>{n(u),c.splice(c.indexOf(u),1)}),ye(c,t,r,n,s)}};if(i in a&&i!=="join"&&i!=="filter")return a[i];if(a.length)return a[0][i]instanceof Function?function(){return ye(a.map(o=>o[i].apply(o,arguments)),Mn,()=>{},()=>{},s)}:ye(a.map(o=>o[i]),Mn,()=>{},()=>{},s);{let o=()=>{};return o[Symbol.iterator]=function*(){},o}}})}function ha(e){try{return e.getAttribute("transform").split("(")[1].split(")")[0].split(",").map(r=>parseFloat(r))}catch(t){return[0,0]}}function Sn(e){return pf(e.trim()).map(ya)}function wm(e){return vm.hasOwnProperty(e)}function Mr(e,t,r,n,s){let a=0,i,o=e.length;for(;t<o;++t){if(i=e[t],!a&&i===r)return t;s&&s.indexOf(i)>=0?--a:n&&n.indexOf(i)>=0&&++a}return t}function pf(e){let t=[],r=e.length,n=0,s=0;for(;s<r;)s=Mr(e,s,df,Rn+ff,On+hf),t.push(e.substring(n,s).trim()),n=++s;if(t.length===0)throw"Empty event selector: "+e;return t}function ya(e){return e[0]==="["?Sm(e):bm(e)}function Sm(e){let t=e.length,r=1,n,s;if(r=Mr(e,r,On,Rn,On),r===t)throw"Empty between selector: "+e;if(n=pf(e.substring(1,r)),n.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(r+1).trim(),e[0]!==gm)throw"Expected '>' after between selector: "+e;let a=n.map(ya);return s=ya(e.slice(1).trim()),s.between?{between:a,stream:s}:(s.between=a,s)}function bm(e){let t={source:xm,type:""},r=[],n=[0,0],s=0,a=0,i=e.length,o=0,c,l;if(e[i-1]===hf){if(o=e.lastIndexOf(ff),o>=0){try{n=jm(e.substring(o+1,i-1))}catch(u){throw"Invalid throttle specification: "+e}e=e.slice(0,o).trim(),i=e.length}else throw"Unmatched right brace: "+e;o=0}if(!i)throw e;if(e[0]===mm&&(s=++o),c=Mr(e,o,pm),c<i&&(r.push(e.substring(a,c).trim()),a=o=++c),o=Mr(e,o,Rn),o===i)r.push(e.substring(a,i).trim());else if(r.push(e.substring(a,o).trim()),l=[],a=++o,a===i)throw"Unmatched left bracket: "+e;for(;o<i;){if(o=Mr(e,o,On),o===i)throw"Unmatched left bracket: "+e;if(l.push(e.substring(a,o).trim()),o<i-1&&e[++o]!==Rn)throw"Expected left bracket: "+e;a=++o}if(!(i=r.length)||ym.test(r[i-1]))throw"Invalid event selector: "+e;return i>1?(t.type=r[1],s?t.markname=r[0].slice(1):wm(r[0])?t.marktype=r[0]:t.source=r[0]):t.type=r[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),n[0]&&(t.throttle=n[0]),n[1]&&(t.debounce=n[1]),t}function jm(e){let t=e.split(df);if(!e.length||t.length>2)throw e;return t.map(function(r){let n=+r;if(n!==n)throw e;return n})}function se(e){if(e instanceof Array)return e.map(se);if(["string","number","boolean","undefined","bigint","symbol","function"].includes(typeof e))return e;if(e===null)return null;if(me in e&&e[me])return e;let t=Object.fromEntries(Object.entries(e).map(([r,n])=>[r,se(n)]));return Object.assign(Object.create(Object.getPrototypeOf(e)),t)}var me,te,U,et,Mn,ga,dm,Rn,On,ff,hf,pm,df,mm,gm,ym,xm,_m,vm,La,ge=d(()=>{me=Symbol("Libra");(function(e){e[e.Shape=0]="Shape",e[e.Data=1]="Data",e[e.Attr=2]="Attr"})(te||(te={}));(function(e){e[e.SurfacePoint=0]="SurfacePoint",e[e.Point=1]="Point",e[e.Circle=2]="Circle",e[e.Rect=3]="Rect",e[e.Polygon=4]="Polygon"})(U||(U={}));(function(e){e[e.Quantitative=0]="Quantitative",e[e.Nominal=1]="Nominal",e[e.Temporal=2]="Temporal"})(et||(et={}));Mn=class{},ga=(...e)=>{};dm="view",Rn="[",On="]",ff="{",hf="}",pm=":",df=",",mm="@",gm=">",ym=/[[\]{}]/,xm=dm,_m={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},vm=_m;La={stopTransient:!1};Promise.resolve().then(()=>(Cr(),ma)).then(e=>{ga=e.tryRegisterDynamicInstance})});var mf,gf,xa,kn,xe,Vm,Cj,Tm,Em,An=d(()=>{ge();xa={},kn=[],xe=class{constructor(t,r){this[mf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._feedback=r.feedback??[],this._undo=r.undo??null,this._redo=r.redo??null,this._execute=r.execute??null,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preExecute=r.preExecute??null,this._postExecute=r.postExecute??null,r.postInitialize&&r.postInitialize.call(this,this)}undo(){this._undo&&this._undo.call(this)}redo(){this._redo&&this._redo.call(this)}async execute(t){try{this.preExecute(),this._execute&&await this._execute.call(this,t),this.postExecute();for(let r of this._feedback)await r.call(this,t);await gf(this).commit()}catch(r){console.error(r)}}preExecute(){this._preExecute&&this._preExecute.call(this,this)}postExecute(){this._postExecute&&this._postExecute.call(this,this)}isInstanceOf(t){return this._baseName===t||this._name===t}static register(t,r){xa[t]=r}static unregister(t){return delete xa[t],!0}static initialize(t,r){let n=Object.assign({constructor:xe},xa[t]??{},r??{}),s=new n.constructor(t,n);return kn.push(s),s}static findCommand(t){return kn.filter(r=>r.isInstanceOf(t))}};mf=me;Vm=xe.register,Cj=xe.unregister,Tm=xe.initialize,Em=xe.findCommand;Promise.resolve().then(()=>(Cr(),ma)).then(e=>{gf=e.tryGetHistoryTrrackInstance})});var uf,rt,Ar=d(()=>{An();An();uf=kn,rt=xe});Ar();In();vr();Tr();Dt();Cr();Fe();Nt();Nt();Tr();Dt();Fe();_r();Qs();ge();var Rr={},zt=class{static build(t){if(!(t.inherit in Xe)&&!(t.inherit in Rr))throw new Error(`Interaction ${t.inherit} is not registered, please register it first`);let r;if(t.inherit in Xe){let a=Object.assign({constructor:A},Xe[t.inherit],{sharedVar:Object.assign({},{layers:t.layers??[],layer:t.layers?.length==1?t.layers[0]:void 0},Xe[t.inherit].sharedVar??{},t.sharedVar??{})});t.layers&&(a.layers=t.layers),r=new a.constructor(t.inherit,a),wt.push(r)}else{let a=Object.assign({},Rr[t.inherit],t,{inherit:Rr[t.inherit].inherit,sharedVar:Object.assign({},{layers:t.layers??[],layer:t.layers?.length==1?t.layers[0]:void 0},Rr[t.inherit].sharedVar??{},t.sharedVar??{})});r=zt.build(a),wt.push(r)}if(t.name&&(Rr[t.name]=t,!t.layers||!t.layers.length))return;let n=(a,i)=>{if(a instanceof A){let o=a._serviceInstances.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a._serviceInstances){let u=n(l,i);if(u)return u}}else{let o=a._services.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a.services){let u=n(l,i);if(u)return u}}return[void 0,void 0]},s=(a,i)=>{if(a.isInstanceOf(i))return a;if(a instanceof A){let o=a._serviceInstances.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a._serviceInstances){let l=s(c,i);if(l)return l}}else{let o=a._services.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a.services){let l=s(c,i);if(l)return l}}};if(t.remove)for(let a of t.remove){let[i,o]=n(r,a.find);if(!i)continue;let c=o instanceof A?o._serviceInstances:o._services;a.cascade?i instanceof W?c.splice(c.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1):i instanceof W?(c.splice(c.indexOf(i),1,...i._services),o._transformers.push(...i._transformers)):o._transformers.splice(o._transformers.indexOf(i),1)}if(t.override)for(let a of t.override)if(a.find.endsWith("Interactor")){let i=[...r._layerInteractors.values()],o=i.map(c=>c.filter(l=>l.isInstanceOf(a.find)));a.comp?o.forEach((c,l)=>{c.forEach(u=>{let h=P.initialize(a.comp);h&&i[l].splice(i[l].indexOf(u),1,h)})}):a.actions&&o.forEach(c=>{c.forEach(l=>{l._actions=se(a.actions).map(Zs)})})}else{let[i,o]=n(r,a.find);if(!i)continue;let c;if(a.comp.includes("Transformer")){let u;a.name&&H.findTransformer(a.name).length>0&&(u=H.findTransformer(a.name)[0]),u||(u=H.initialize(a.comp,{name:a.name,sharedVar:{...t.sharedVar||{},...a.sharedVar||{}}})),c=u}else if(a.comp.includes("Service")){let u;a.name&&W.findService(a.name).length>0&&(u=W.findService(a.name)[0]),u||(u=W.initialize(a.comp,{...a,services:[...a.services||[],...i instanceof W?i._services:[]],transformers:[...a.transformers||[],...i instanceof W?i._transformers:[]],sharedVar:{...t.sharedVar||{},...a.sharedVar||{}}})),a.dimension&&u.isInstanceOf("SelectionService")&&(u=u.dimension(a.dimension),a.layers&&(u._layerInstances=a.layers.slice(0)),a.sharedVar&&u.setSharedVars(a.sharedVar)),c=u}let l=o instanceof A?o._serviceInstances:o._services;i instanceof W?l.splice(l.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1),a.comp.includes("Transformer")?o._transformers.push(c):l.push(c)}if(t.insert)for(let a of t.insert){let i=s(r,a.find);if(!i)continue;let o=null,c=null;for(let l=a.flow.length-1;l>=0;l--){let u=a.flow[l];if(u instanceof Function){let h=[],p=null;for(let m=0;m<t.layers?.length;m++){let _=t.layers[m],x=u(_,m);if(x.comp.includes("Transformer")){let w;x.name&&H.findTransformer(x.name).length>0&&(w=H.findTransformer(x.name)[0]),w||(w=H.initialize(x.comp,{...x,sharedVar:{...t.sharedVar||{},...x.sharedVar||{}}})),h.push(w),p="Transformer"}else if(x.comp.includes("Service")){let w;x.name&&W.findService(x.name).length>0&&(w=W.findService(x.name)[0]),w||(w=W.initialize(x.comp,{...x,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...t.sharedVar||{},...x.sharedVar||{}}})),x.dimension&&w instanceof we&&(w=w.dimension(x.dimension),x.layers&&(w._layerInstances=x.layers.slice(0)),x.sharedVar&&w.setSharedVars(x.sharedVar)),h.push(w),p="Service"}}o=h,c=p}else if(u instanceof Array){let h=[],p=null;for(let m=0;m<u.length;m++){let _=u[m];if(_ instanceof H)h.push(_),p="Transformer";else if(_ instanceof W)c=="Transformer"?_._transformers.push(...o instanceof Array?o:[o]):_._services.push(...o instanceof Array?o:[o]),h.push(_),p="Service";else if(_.comp.includes("Transformer")){let x;_.name&&H.findTransformer(_.name).length>0&&(x=H.findTransformer(_.name)[0]),x||(x=H.initialize(_.comp,{..._,sharedVar:{...t.sharedVar||{},..._.sharedVar||{}}})),h.push(x),p="Transformer"}else if(_.comp.includes("Service")){let x;_.name&&W.findService(_.name).length>0&&(x=W.findService(_.name)[0]),x||(x=W.initialize(_.comp,{..._,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...t.sharedVar||{},..._.sharedVar||{}}})),_.dimension&&x instanceof we&&(x=x.dimension(_.dimension),_.layers&&(x._layerInstances=_.layers.slice(0)),_.sharedVar&&x.setSharedVars(_.sharedVar)),h.push(x),p="Service"}}o=h,c=p}else if(u instanceof H)o=u,c="Transformer";else if(u instanceof W)c=="Transformer"?u._transformers.push(...o instanceof Array?o:[o]):u._services.push(...o instanceof Array?o:[o]),o=u,c="Service";else if(u.comp.includes("Transformer")){let h;u.name&&H.findTransformer(u.name).length>0&&(h=H.findTransformer(u.name)[0]),h||(h=H.initialize(u.comp,{...t.layers&&t.layers.length==1?t.layers[0]instanceof Ye?{layer:t.layers[0]}:{layer:t.layers[0].layer}:{},...u,sharedVar:{...t.sharedVar||{},...u.sharedVar||{}}})),o=h,c="Transformer"}else if(u.comp.includes("Service")){let h;u.name&&W.findService(u.name).length>0&&(h=W.findService(u.name)[0]),h||(h=W.initialize(u.comp,{...t.layers&&t.layers.length==1?t.layers[0]instanceof Ye?{layer:t.layers[0]}:{layer:t.layers[0].layer}:{},...u,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...t.sharedVar||{},...u.sharedVar||{}}})),u.dimension&&h.isInstanceOf("SelectionService")&&(h=h.dimension(u.dimension),u.layers&&(h._layerInstances=u.layers.slice(0)),u.sharedVar&&h.setSharedVars(u.sharedVar)),o=h,c="Service"}}o&&(c=="Transformer"?o instanceof Array?i._transformers.push(...o):i._transformers.push(o):i instanceof A?o instanceof Array?i._serviceInstances.push(...o):i._serviceInstances.push(o):o instanceof Array?i._services.push(...o):i._services.push(o))}return r}};Ar();In();vr();Tr();Dt();Cr();Fe();var Kj={Command:rt,Instrument:pa,Interactor:Ge,Layer:Ye,Service:W,createHistoryTrrack:Cn,GraphicalTransformer:H,Interaction:zt};export{rt as Command,H as GraphicalTransformer,pa as Instrument,zt as Interaction,Ge as Interactor,Ye as Layer,W as Service,Cn as createHistoryTrrack,Kj as default};
