var ja=Object.defineProperty;var wf=e=>ja(e,"__esModule",{value:!0});var h=(e,t)=>()=>(e&&(t=e(e=0)),t);var Sf=(e,t)=>{wf(e);for(var r in t)ja(e,r,{get:t[r],enumerable:!0})};var Va,Tr,kt,Un,Ta,K,bf,Im,jf,Vf,Ar=h(()=>{Se();Tr={},kt=[],Un=[],Ta=()=>{let e;for(;e=Un.pop();)try{e.remove()}catch(t){}Aa.stopTransient||kt.filter(t=>t._transient).forEach(t=>t.redraw()),requestAnimationFrame(Ta)};requestAnimationFrame(Ta);K=class{constructor(t,r){this[Va]=!0,this._baseName=t,this._userOptions=r,this._name=r.name??this._baseName,this._sharedVar=r.sharedVar??{},this._redraw=r.redraw??(()=>{}),this._layer=r.layer,this._transient=r.transient??!1,this.redraw()}getSharedVar(t){return this._sharedVar[t]}setSharedVar(t,r){this._sharedVar[t]=r,this.redraw()}setSharedVars(t){Object.entries(t).forEach(([r,n])=>this._sharedVar[r]=n),this.redraw()}redraw(t=!1){if(!this._layer&&!this.getSharedVar("layer"))return;let r=this._layer||this.getSharedVar("layer");t=t||this._transient;let n=[],s=[],i=new Set([r]);t&&(n=r.getVisualElements(),r._getLayerFromQueue||(r._getLayerFromQueue=r.getLayerFromQueue,r.getLayerFromQueue=function(){let a=r._getLayerFromQueue(...arguments);return n=n.concat(a.getVisualElements()),i.add(a),a})),this._redraw({layer:r,transformer:this}),t&&(r.getLayerFromQueue=r._getLayerFromQueue,delete r._getLayerFromQueue,i.forEach(a=>{s=s.concat(Array.prototype.slice.call(a.getGraphic().childNodes));let o=s.filter(c=>!n.includes(c));Un=Un.concat(o)}))}isInstanceOf(t){return this._baseName===t||this._name===t||(this._userOptions.className??[]).includes(t)}static register(t,r){Tr[t]=r}static unregister(t){return delete Tr[t],!0}static initialize(t,r){let n=Object.assign({constructor:K},Tr[t]??{},r??{},{sharedVar:Object.assign({},(Tr[t]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(t,n);return kt.push(s),s}static findTransformer(t){return kt.filter(r=>r.isInstanceOf(t))}};Va=me;bf=K.register,Im=K.unregister,jf=K.initialize,Vf=K.findTransformer});var Ea=h(()=>{});var Ma=h(()=>{});var Ia=h(()=>{});function Ca(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Er(r)}function Er(e){this._=e}function Af(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function Ef(e,t){for(var r=0,n=e.length,s;r<n;++r)if((s=e[r]).name===t)return s.value}function Ra(e,t,r){for(var n=0,s=e.length;n<s;++n)if(e[n].name===t){e[n]=Tf,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var Tf,qn,ka=h(()=>{Tf={value:()=>{}};Er.prototype=Ca.prototype={constructor:Er,on:function(e,t){var r=this._,n=Af(e+"",r),s,i=-1,a=n.length;if(arguments.length<2){for(;++i<a;)if((s=(e=n[i]).type)&&(s=Ef(r[s],e.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<a;)if(s=(e=n[i]).type)r[s]=Ra(r[s],e.name,t);else if(t==null)for(s in r)r[s]=Ra(r[s],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Er(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,i;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],n=0,s=i.length;n<s;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],s=0,i=n.length;s<i;++s)n[s].value.apply(t,r)}};qn=Ca});var Gn=h(()=>{ka()});var Mr,$n,Bn=h(()=>{Mr="http://www.w3.org/1999/xhtml",$n={svg:"http://www.w3.org/2000/svg",xhtml:Mr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function Ye(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),$n.hasOwnProperty(t)?{space:$n[t],local:e}:e}var Ir=h(()=>{Bn()});function Mf(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===Mr&&t.documentElement.namespaceURI===Mr?t.createElement(e):t.createElementNS(r,e)}}function If(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Cr(e){var t=Ye(e);return(t.local?If:Mf)(t)}var Hn=h(()=>{Ir();Bn()});function Cf(){}function tt(e){return e==null?Cf:function(){return this.querySelector(e)}}var Rr=h(()=>{});function Oa(e){typeof e!="function"&&(e=tt(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var i=t[s],a=i.length,o=n[s]=new Array(a),c,l,f=0;f<a;++f)(c=i[f])&&(l=e.call(c,c.__data__,f,i))&&("__data__"in c&&(l.__data__=c.__data__),o[f]=l);return new $(n,this._parents)}var Da=h(()=>{be();Rr()});function _t(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}var kr=h(()=>{});function Rf(){return[]}function Ot(e){return e==null?Rf:function(){return this.querySelectorAll(e)}}var Qn=h(()=>{});function kf(e){return function(){var t=e.apply(this,arguments);return t==null?[]:_t(t)}}function Ya(e){typeof e=="function"?e=kf(e):e=Ot(e);for(var t=this._groups,r=t.length,n=[],s=[],i=0;i<r;++i)for(var a=t[i],o=a.length,c,l=0;l<o;++l)(c=a[l])&&(n.push(e.call(c,c.__data__,l,a)),s.push(c));return new $(n,s)}var La=h(()=>{be();kr();Qn()});function Dt(e){return function(){return this.matches(e)}}function Or(e){return function(t){return t.matches(e)}}var Yt=h(()=>{});function Df(e){return function(){return Of.call(this.children,e)}}function Yf(){return this.firstElementChild}function Xa(e){return this.select(e==null?Yf:Df(typeof e=="function"?e:Or(e)))}var Of,Pa=h(()=>{Yt();Of=Array.prototype.find});function Xf(){return this.children}function Pf(e){return function(){return Lf.call(this.children,e)}}function za(e){return this.selectAll(e==null?Xf:Pf(typeof e=="function"?e:Or(e)))}var Lf,Fa=h(()=>{Yt();Lf=Array.prototype.filter});function Na(e){typeof e!="function"&&(e=Dt(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var i=t[s],a=i.length,o=n[s]=[],c,l=0;l<a;++l)(c=i[l])&&e.call(c,c.__data__,l,i)&&o.push(c);return new $(n,this._parents)}var Ua=h(()=>{be();Yt()});function Dr(e){return new Array(e.length)}var Wn=h(()=>{});function qa(){return new $(this._enter||this._groups.map(Dr),this._parents)}function Lt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}var Zn=h(()=>{Wn();be();Lt.prototype={constructor:Lt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}}});function Ga(e){return function(){return e}}var $a=h(()=>{});function zf(e,t,r,n,s,i){for(var a=0,o,c=t.length,l=i.length;a<l;++a)(o=t[a])?(o.__data__=i[a],n[a]=o):r[a]=new Lt(e,i[a]);for(;a<c;++a)(o=t[a])&&(s[a]=o)}function Ff(e,t,r,n,s,i,a){var o,c,l=new Map,f=t.length,d=i.length,m=new Array(f),x;for(o=0;o<f;++o)(c=t[o])&&(m[o]=x=a.call(c,c.__data__,o,t)+"",l.has(x)?s[o]=c:l.set(x,c));for(o=0;o<d;++o)x=a.call(e,i[o],o,i)+"",(c=l.get(x))?(n[o]=c,c.__data__=i[o],l.delete(x)):r[o]=new Lt(e,i[o]);for(o=0;o<f;++o)(c=t[o])&&l.get(m[o])===c&&(s[o]=c)}function Nf(e){return e.__data__}function Ba(e,t){if(!arguments.length)return Array.from(this,Nf);var r=t?Ff:zf,n=this._parents,s=this._groups;typeof e!="function"&&(e=Ga(e));for(var i=s.length,a=new Array(i),o=new Array(i),c=new Array(i),l=0;l<i;++l){var f=n[l],d=s[l],m=d.length,x=_t(e.call(f,f&&f.__data__,l,n)),b=x.length,y=o[l]=new Array(b),_=a[l]=new Array(b),j=c[l]=new Array(m);r(f,d,y,_,j,x,t);for(var O=0,A=0,L,Y;O<b;++O)if(L=y[O]){for(O>=A&&(A=O+1);!(Y=_[A])&&++A<b;);L._next=Y||null}}return a=new $(a,n),a._enter=o,a._exit=c,a}var Ha=h(()=>{be();Zn();kr();$a()});function Qa(){return new $(this._exit||this._groups.map(Dr),this._parents)}var Wa=h(()=>{Wn();be()});function Za(e,t,r){var n=this.enter(),s=this,i=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(s=t(s)),r==null?i.remove():r(i),n&&s?n.merge(s).order():s}var Ka=h(()=>{});function Ja(e){if(!(e instanceof $))throw new Error("invalid merge");for(var t=this._groups,r=e._groups,n=t.length,s=r.length,i=Math.min(n,s),a=new Array(n),o=0;o<i;++o)for(var c=t[o],l=r[o],f=c.length,d=a[o]=new Array(f),m,x=0;x<f;++x)(m=c[x]||l[x])&&(d[x]=m);for(;o<n;++o)a[o]=t[o];return new $(a,this._parents)}var ei=h(()=>{be()});function ti(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],s=n.length-1,i=n[s],a;--s>=0;)(a=n[s])&&(i&&a.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(a,i),i=a);return this}var ri=h(()=>{});function ni(e){e||(e=Uf);function t(d,m){return d&&m?e(d.__data__,m.__data__):!d-!m}for(var r=this._groups,n=r.length,s=new Array(n),i=0;i<n;++i){for(var a=r[i],o=a.length,c=s[i]=new Array(o),l,f=0;f<o;++f)(l=a[f])&&(c[f]=l);c.sort(t)}return new $(s,this._parents).order()}function Uf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var si=h(()=>{be()});function ai(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}var ii=h(()=>{});function oi(){return Array.from(this)}var ci=h(()=>{});function li(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],s=0,i=n.length;s<i;++s){var a=n[s];if(a)return a}return null}var ui=h(()=>{});function fi(){let e=0;for(let t of this)++e;return e}var hi=h(()=>{});function di(){return!this.node()}var pi=h(()=>{});function mi(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var s=t[r],i=0,a=s.length,o;i<a;++i)(o=s[i])&&e.call(o,o.__data__,i,s);return this}var gi=h(()=>{});function qf(e){return function(){this.removeAttribute(e)}}function Gf(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $f(e,t){return function(){this.setAttribute(e,t)}}function Bf(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Hf(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Qf(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function xi(e,t){var r=Ye(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Gf:qf:typeof t=="function"?r.local?Qf:Hf:r.local?Bf:$f)(r,t))}var yi=h(()=>{Ir()});function Yr(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}var Kn=h(()=>{});function Wf(e){return function(){this.style.removeProperty(e)}}function Zf(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Kf(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function vi(e,t,r){return arguments.length>1?this.each((t==null?Wf:typeof t=="function"?Kf:Zf)(e,t,r??"")):qe(this.node(),e)}function qe(e,t){return e.style.getPropertyValue(t)||Yr(e).getComputedStyle(e,null).getPropertyValue(t)}var Jn=h(()=>{Kn()});function Jf(e){return function(){delete this[e]}}function eh(e,t){return function(){this[e]=t}}function th(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function _i(e,t){return arguments.length>1?this.each((t==null?Jf:typeof t=="function"?th:eh)(e,t)):this.node()[e]}var wi=h(()=>{});function Si(e){return e.trim().split(/^|\s+/)}function es(e){return e.classList||new bi(e)}function bi(e){this._node=e,this._names=Si(e.getAttribute("class")||"")}function ji(e,t){for(var r=es(e),n=-1,s=t.length;++n<s;)r.add(t[n])}function Vi(e,t){for(var r=es(e),n=-1,s=t.length;++n<s;)r.remove(t[n])}function rh(e){return function(){ji(this,e)}}function nh(e){return function(){Vi(this,e)}}function sh(e,t){return function(){(t.apply(this,arguments)?ji:Vi)(this,e)}}function Ti(e,t){var r=Si(e+"");if(arguments.length<2){for(var n=es(this.node()),s=-1,i=r.length;++s<i;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof t=="function"?sh:t?rh:nh)(r,t))}var Ai=h(()=>{bi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}}});function ah(){this.textContent=""}function ih(e){return function(){this.textContent=e}}function oh(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Ei(e){return arguments.length?this.each(e==null?ah:(typeof e=="function"?oh:ih)(e)):this.node().textContent}var Mi=h(()=>{});function ch(){this.innerHTML=""}function lh(e){return function(){this.innerHTML=e}}function uh(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Ii(e){return arguments.length?this.each(e==null?ch:(typeof e=="function"?uh:lh)(e)):this.node().innerHTML}var Ci=h(()=>{});function fh(){this.nextSibling&&this.parentNode.appendChild(this)}function Ri(){return this.each(fh)}var ki=h(()=>{});function hh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Oi(){return this.each(hh)}var Di=h(()=>{});function Yi(e){var t=typeof e=="function"?e:Cr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}var Li=h(()=>{Hn()});function dh(){return null}function Xi(e,t){var r=typeof e=="function"?e:Cr(e),n=t==null?dh:typeof t=="function"?t:tt(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var Pi=h(()=>{Hn();Rr()});function ph(){var e=this.parentNode;e&&e.removeChild(this)}function zi(){return this.each(ph)}var Fi=h(()=>{});function mh(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function gh(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ni(e){return this.select(e?gh:mh)}var Ui=h(()=>{});function qi(e){return arguments.length?this.property("__data__",e):this.node().__data__}var Gi=h(()=>{});function xh(e){return function(t){e.call(this,t,this.__data__)}}function yh(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function vh(e){return function(){var t=this.__on;if(!!t){for(var r=0,n=-1,s=t.length,i;r<s;++r)i=t[r],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++n]=i;++n?t.length=n:delete this.__on}}}function _h(e,t,r){return function(){var n=this.__on,s,i=xh(t);if(n){for(var a=0,o=n.length;a<o;++a)if((s=n[a]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=r),s.value=t;return}}this.addEventListener(e.type,i,r),s={type:e.type,name:e.name,value:t,listener:i,options:r},n?n.push(s):this.__on=[s]}}function $i(e,t,r){var n=yh(e+""),s,i=n.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,l=o.length,f;c<l;++c)for(s=0,f=o[c];s<i;++s)if((a=n[s]).type===f.type&&a.name===f.name)return f.value}return}for(o=t?_h:vh,s=0;s<i;++s)this.each(o(n[s],t,r));return this}var Bi=h(()=>{});function Hi(e,t,r){var n=Yr(e),s=n.CustomEvent;typeof s=="function"?s=new s(t,r):(s=n.document.createEvent("Event"),r?(s.initEvent(t,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function wh(e,t){return function(){return Hi(this,e,t)}}function Sh(e,t){return function(){return Hi(this,e,t.apply(this,arguments))}}function Qi(e,t){return this.each((typeof t=="function"?Sh:wh)(e,t))}var Wi=h(()=>{Kn()});function*Zi(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],s=0,i=n.length,a;s<i;++s)(a=n[s])&&(yield a)}var Ki=h(()=>{});function $(e,t){this._groups=e,this._parents=t}function Ji(){return new $([[document.documentElement]],Xt)}function bh(){return this}var Xt,Le,be=h(()=>{Da();La();Pa();Fa();Ua();Ha();Zn();Wa();Ka();ei();ri();si();ii();ci();ui();hi();pi();gi();yi();Jn();wi();Ai();Mi();Ci();ki();Di();Li();Pi();Fi();Ui();Gi();Bi();Wi();Ki();Xt=[null];$.prototype=Ji.prototype={constructor:$,select:Oa,selectAll:Ya,selectChild:Xa,selectChildren:za,filter:Na,data:Ba,enter:qa,exit:Qa,join:Za,merge:Ja,selection:bh,order:ti,sort:ni,call:ai,nodes:oi,node:li,size:fi,empty:di,each:mi,attr:xi,style:vi,property:_i,classed:Ti,text:Ei,html:Ii,raise:Ri,lower:Oi,append:Yi,insert:Xi,remove:zi,clone:Ni,datum:qi,on:$i,dispatch:Qi,[Symbol.iterator]:Zi};Le=Ji});function J(e){return typeof e=="string"?new $([[document.querySelector(e)]],[document.documentElement]):new $([[e]],Xt)}var eo=h(()=>{be()});function to(e){let t;for(;t=e.sourceEvent;)e=t;return e}var ro=h(()=>{});function Ge(e,t){if(e=to(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}var no=h(()=>{ro()});function Pt(e){return typeof e=="string"?new $([document.querySelectorAll(e)],[document.documentElement]):new $([e==null?[]:_t(e)],Xt)}var so=h(()=>{kr();be()});var Ae=h(()=>{Yt();Ir();no();eo();so();be();Rr();Qn();Jn()});var ao=h(()=>{});function Lr(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function ts(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}var io=h(()=>{});function zt(){}function co(){return this.rgb().formatHex()}function Ch(){return mo(this).formatHsl()}function lo(){return this.rgb().formatRgb()}function $e(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=jh.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?uo(t):r===3?new ve(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Pr(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Pr(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Vh.exec(e))?new ve(t[1],t[2],t[3],1):(t=Th.exec(e))?new ve(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ah.exec(e))?Pr(t[1],t[2],t[3],t[4]):(t=Eh.exec(e))?Pr(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Mh.exec(e))?po(t[1],t[2]/100,t[3]/100,1):(t=Ih.exec(e))?po(t[1],t[2]/100,t[3]/100,t[4]):oo.hasOwnProperty(e)?uo(oo[e]):e==="transparent"?new ve(NaN,NaN,NaN,0):null}function uo(e){return new ve(e>>16&255,e>>8&255,e&255,1)}function Pr(e,t,r,n){return n<=0&&(e=t=r=NaN),new ve(e,t,r,n)}function Rh(e){return e instanceof zt||(e=$e(e)),e?(e=e.rgb(),new ve(e.r,e.g,e.b,e.opacity)):new ve}function St(e,t,r,n){return arguments.length===1?Rh(e):new ve(e,t,r,n??1)}function ve(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function fo(){return"#"+rs(this.r)+rs(this.g)+rs(this.b)}function ho(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function rs(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function po(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Oe(e,t,r,n)}function mo(e){if(e instanceof Oe)return new Oe(e.h,e.s,e.l,e.opacity);if(e instanceof zt||(e=$e(e)),!e)return new Oe;if(e instanceof Oe)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),i=Math.max(t,r,n),a=NaN,o=i-s,c=(i+s)/2;return o?(t===i?a=(r-n)/o+(r<n)*6:r===i?a=(n-t)/o+2:a=(t-r)/o+4,o/=c<.5?i+s:2-i-s,a*=60):o=c>0&&c<1?0:a,new Oe(a,o,c,e.opacity)}function go(e,t,r,n){return arguments.length===1?mo(e):new Oe(e,t,r,n??1)}function Oe(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function ns(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var Ft,Xr,wt,Nt,ke,jh,Vh,Th,Ah,Eh,Mh,Ih,oo,xo=h(()=>{io();Ft=.7,Xr=1/Ft,wt="\\s*([+-]?\\d+)\\s*",Nt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ke="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jh=/^#([0-9a-f]{3,8})$/,Vh=new RegExp("^rgb\\("+[wt,wt,wt]+"\\)$"),Th=new RegExp("^rgb\\("+[ke,ke,ke]+"\\)$"),Ah=new RegExp("^rgba\\("+[wt,wt,wt,Nt]+"\\)$"),Eh=new RegExp("^rgba\\("+[ke,ke,ke,Nt]+"\\)$"),Mh=new RegExp("^hsl\\("+[Nt,ke,ke]+"\\)$"),Ih=new RegExp("^hsla\\("+[Nt,ke,ke,Nt]+"\\)$"),oo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Lr(zt,$e,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:co,formatHex:co,formatHsl:Ch,formatRgb:lo,toString:lo});Lr(ve,St,ts(zt,{brighter:function(e){return e=e==null?Xr:Math.pow(Xr,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Ft:Math.pow(Ft,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fo,formatHex:fo,formatRgb:ho,toString:ho}));Lr(Oe,go,ts(zt,{brighter:function(e){return e=e==null?Xr:Math.pow(Xr,e),new Oe(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ft:Math.pow(Ft,e),new Oe(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new ve(ns(e>=240?e-240:e+120,s,n),ns(e,s,n),ns(e<120?e+240:e-120,s,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}))});var zr=h(()=>{xo()});function ss(e,t,r,n,s){var i=e*e,a=i*e;return((1-3*e+3*i-a)*t+(4-6*i+3*a)*r+(1+3*e+3*i-3*a)*n+a*s)/6}function yo(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),s=e[n],i=e[n+1],a=n>0?e[n-1]:2*s-i,o=n<t-1?e[n+2]:2*i-s;return ss((r-n/t)*t,a,s,i,o)}}var as=h(()=>{});function vo(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),s=e[(n+t-1)%t],i=e[n%t],a=e[(n+1)%t],o=e[(n+2)%t];return ss((r-n/t)*t,s,i,a,o)}}var _o=h(()=>{as()});var is,wo=h(()=>{is=e=>()=>e});function kh(e,t){return function(r){return e+r*t}}function Oh(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function So(e){return(e=+e)==1?Fr:function(t,r){return r-t?Oh(t,r,e):is(isNaN(t)?r:t)}}function Fr(e,t){var r=t-e;return r?kh(e,r):is(isNaN(e)?t:e)}var bo=h(()=>{wo()});function jo(e){return function(t){var r=t.length,n=new Array(r),s=new Array(r),i=new Array(r),a,o;for(a=0;a<r;++a)o=St(t[a]),n[a]=o.r||0,s[a]=o.g||0,i[a]=o.b||0;return n=e(n),s=e(s),i=e(i),o.opacity=1,function(c){return o.r=n(c),o.g=s(c),o.b=i(c),o+""}}}var Nr,Dh,Yh,Vo=h(()=>{zr();as();_o();bo();Nr=function e(t){var r=So(t);function n(s,i){var a=r((s=St(s)).r,(i=St(i)).r),o=r(s.g,i.g),c=r(s.b,i.b),l=Fr(s.opacity,i.opacity);return function(f){return s.r=a(f),s.g=o(f),s.b=c(f),s.opacity=l(f),s+""}}return n.gamma=e,n}(1);Dh=jo(yo),Yh=jo(vo)});function je(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var Ur=h(()=>{});function Lh(e){return function(){return e}}function Xh(e){return function(t){return e(t)+""}}function ls(e,t){var r=os.lastIndex=cs.lastIndex=0,n,s,i,a=-1,o=[],c=[];for(e=e+"",t=t+"";(n=os.exec(e))&&(s=cs.exec(t));)(i=s.index)>r&&(i=t.slice(r,i),o[a]?o[a]+=i:o[++a]=i),(n=n[0])===(s=s[0])?o[a]?o[a]+=s:o[++a]=s:(o[++a]=null,c.push({i:a,x:je(n,s)})),r=cs.lastIndex;return r<t.length&&(i=t.slice(r),o[a]?o[a]+=i:o[++a]=i),o.length<2?c[0]?Xh(c[0].x):Lh(t):(t=c.length,function(l){for(var f=0,d;f<t;++f)o[(d=c[f]).i]=d.x(l);return o.join("")})}var os,cs,To=h(()=>{Ur();os=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cs=new RegExp(os.source,"g")});function us(e,t,r,n,s,i){var a,o,c;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(c=e*r+t*n)&&(r-=e*c,n-=t*c),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,c/=o),e*n<t*r&&(e=-e,t=-t,c=-c,a=-a),{translateX:s,translateY:i,rotate:Math.atan2(t,e)*Ao,skewX:Math.atan(c)*Ao,scaleX:a,scaleY:o}}var Ao,qr,Eo=h(()=>{Ao=180/Math.PI,qr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function Mo(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?qr:us(t.a,t.b,t.c,t.d,t.e,t.f)}function Io(e){return e==null?qr:(Gr||(Gr=document.createElementNS("http://www.w3.org/2000/svg","g")),Gr.setAttribute("transform",e),(e=Gr.transform.baseVal.consolidate())?(e=e.matrix,us(e.a,e.b,e.c,e.d,e.e,e.f)):qr)}var Gr,Co=h(()=>{Eo()});function Ro(e,t,r,n){function s(l){return l.length?l.pop()+" ":""}function i(l,f,d,m,x,b){if(l!==d||f!==m){var y=x.push("translate(",null,t,null,r);b.push({i:y-4,x:je(l,d)},{i:y-2,x:je(f,m)})}else(d||m)&&x.push("translate("+d+t+m+r)}function a(l,f,d,m){l!==f?(l-f>180?f+=360:f-l>180&&(l+=360),m.push({i:d.push(s(d)+"rotate(",null,n)-2,x:je(l,f)})):f&&d.push(s(d)+"rotate("+f+n)}function o(l,f,d,m){l!==f?m.push({i:d.push(s(d)+"skewX(",null,n)-2,x:je(l,f)}):f&&d.push(s(d)+"skewX("+f+n)}function c(l,f,d,m,x,b){if(l!==d||f!==m){var y=x.push(s(x)+"scale(",null,",",null,")");b.push({i:y-4,x:je(l,d)},{i:y-2,x:je(f,m)})}else(d!==1||m!==1)&&x.push(s(x)+"scale("+d+","+m+")")}return function(l,f){var d=[],m=[];return l=e(l),f=e(f),i(l.translateX,l.translateY,f.translateX,f.translateY,d,m),a(l.rotate,f.rotate,d,m),o(l.skewX,f.skewX,d,m),c(l.scaleX,l.scaleY,f.scaleX,f.scaleY,d,m),l=f=null,function(x){for(var b=-1,y=m.length,_;++b<y;)d[(_=m[b]).i]=_.x(x);return d.join("")}}}var fs,hs,ko=h(()=>{Ur();Co();fs=Ro(Mo,"px, ","px)","deg)"),hs=Ro(Io,", ",")",")")});var Ut=h(()=>{Ur();To();ko();Vo()});function Ht(){return rt||(Do(Ph),rt=Bt.now()+Hr)}function Ph(){rt=0}function Qt(){this._call=this._time=this._next=null}function Qr(e,t,r){var n=new Qt;return n.restart(e,t,r),n}function Yo(){Ht(),++bt;for(var e=$r,t;e;)(t=rt-e._time)>=0&&e._call.call(null,t),e=e._next;--bt}function Lo(){rt=(Br=Bt.now())+Hr,bt=qt=0;try{Yo()}finally{bt=0,Fh(),rt=0}}function zh(){var e=Bt.now(),t=e-Br;t>Oo&&(Hr-=t,Br=e)}function Fh(){for(var e,t=$r,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:$r=r);$t=e,ds(n)}function ds(e){if(!bt){qt&&(qt=clearTimeout(qt));var t=e-rt;t>24?(e<1/0&&(qt=setTimeout(Lo,e-Bt.now()-Hr)),Gt&&(Gt=clearInterval(Gt))):(Gt||(Br=Bt.now(),Gt=setInterval(zh,Oo)),bt=1,Do(Lo))}}var bt,qt,Gt,Oo,$r,$t,Br,rt,Hr,Bt,Do,ps=h(()=>{bt=0,qt=0,Gt=0,Oo=1e3,Br=0,rt=0,Hr=0,Bt=typeof performance=="object"&&performance.now?performance:Date,Do=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};Qt.prototype=Qr.prototype={constructor:Qt,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Ht():+r)+(t==null?0:+t),!this._next&&$t!==this&&($t?$t._next=this:$r=this,$t=this),this._call=e,this._time=r,ds()},stop:function(){this._call&&(this._call=null,this._time=1/0,ds())}}});function Wr(e,t,r){var n=new Qt;return t=t==null?0:+t,n.restart(s=>{n.stop(),e(s+t)},t,r),n}var Xo=h(()=>{ps()});var Zr=h(()=>{ps();Xo()});function Be(e,t,r,n,s,i){var a=e.__transition;if(!a)e.__transition={};else if(r in a)return;qh(e,r,{name:t,index:n,group:s,on:Nh,tween:Uh,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Po})}function Zt(e,t){var r=te(e,t);if(r.state>Po)throw new Error("too late; already scheduled");return r}function se(e,t){var r=te(e,t);if(r.state>Jr)throw new Error("too late; already running");return r}function te(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function qh(e,t,r){var n=e.__transition,s;n[t]=r,r.timer=Qr(i,0,r.time);function i(l){r.state=ms,r.timer.restart(a,r.delay,r.time),r.delay<=l&&a(l-r.delay)}function a(l){var f,d,m,x;if(r.state!==ms)return c();for(f in n)if(x=n[f],x.name===r.name){if(x.state===Jr)return Wr(a);x.state===zo?(x.state=Wt,x.timer.stop(),x.on.call("interrupt",e,e.__data__,x.index,x.group),delete n[f]):+f<t&&(x.state=Wt,x.timer.stop(),x.on.call("cancel",e,e.__data__,x.index,x.group),delete n[f])}if(Wr(function(){r.state===Jr&&(r.state=zo,r.timer.restart(o,r.delay,r.time),o(l))}),r.state=Kr,r.on.call("start",e,e.__data__,r.index,r.group),r.state===Kr){for(r.state=Jr,s=new Array(m=r.tween.length),f=0,d=-1;f<m;++f)(x=r.tween[f].value.call(e,e.__data__,r.index,r.group))&&(s[++d]=x);s.length=d+1}}function o(l){for(var f=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(c),r.state=en,1),d=-1,m=s.length;++d<m;)s[d].call(e,f);r.state===en&&(r.on.call("end",e,e.__data__,r.index,r.group),c())}function c(){r.state=Wt,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}var Nh,Uh,Po,ms,Kr,Jr,zo,en,Wt,de=h(()=>{Gn();Zr();Nh=qn("start","end","cancel","interrupt"),Uh=[],Po=0,ms=1,Kr=2,Jr=3,zo=4,en=5,Wt=6});function Kt(e,t){var r=e.__transition,n,s,i=!0,a;if(!!r){t=t==null?null:t+"";for(a in r){if((n=r[a]).name!==t){i=!1;continue}s=n.state>Kr&&n.state<en,n.state=Wt,n.timer.stop(),n.on.call(s?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[a]}i&&delete e.__transition}}var gs=h(()=>{de()});function Fo(e){return this.each(function(){Kt(this,e)})}var No=h(()=>{gs()});function Gh(e,t){var r,n;return function(){var s=se(this,e),i=s.tween;if(i!==r){n=r=i;for(var a=0,o=n.length;a<o;++a)if(n[a].name===t){n=n.slice(),n.splice(a,1);break}}s.tween=n}}function $h(e,t,r){var n,s;if(typeof r!="function")throw new Error;return function(){var i=se(this,e),a=i.tween;if(a!==n){s=(n=a).slice();for(var o={name:t,value:r},c=0,l=s.length;c<l;++c)if(s[c].name===t){s[c]=o;break}c===l&&s.push(o)}i.tween=s}}function Uo(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=te(this.node(),r).tween,s=0,i=n.length,a;s<i;++s)if((a=n[s]).name===e)return a.value;return null}return this.each((t==null?Gh:$h)(r,e,t))}function jt(e,t,r){var n=e._id;return e.each(function(){var s=se(this,n);(s.value||(s.value={}))[t]=r.apply(this,arguments)}),function(s){return te(s,n).value[t]}}var Jt=h(()=>{de()});function tn(e,t){var r;return(typeof t=="number"?je:t instanceof $e?Nr:(r=$e(t))?(t=r,Nr):ls)(e,t)}var xs=h(()=>{zr();Ut()});function Bh(e){return function(){this.removeAttribute(e)}}function Hh(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qh(e,t,r){var n,s=r+"",i;return function(){var a=this.getAttribute(e);return a===s?null:a===n?i:i=t(n=a,r)}}function Wh(e,t,r){var n,s=r+"",i;return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===n?i:i=t(n=a,r)}}function Zh(e,t,r){var n,s,i;return function(){var a,o=r(this),c;return o==null?void this.removeAttribute(e):(a=this.getAttribute(e),c=o+"",a===c?null:a===n&&c===s?i:(s=c,i=t(n=a,o)))}}function Kh(e,t,r){var n,s,i;return function(){var a,o=r(this),c;return o==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),c=o+"",a===c?null:a===n&&c===s?i:(s=c,i=t(n=a,o)))}}function qo(e,t){var r=Ye(e),n=r==="transform"?hs:tn;return this.attrTween(e,typeof t=="function"?(r.local?Kh:Zh)(r,n,jt(this,"attr."+e,t)):t==null?(r.local?Hh:Bh)(r):(r.local?Wh:Qh)(r,n,t))}var Go=h(()=>{Ut();Ae();Jt();xs()});function Jh(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function ed(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function td(e,t){var r,n;function s(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&ed(e,i)),r}return s._value=t,s}function rd(e,t){var r,n;function s(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&Jh(e,i)),r}return s._value=t,s}function $o(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Ye(e);return this.tween(r,(n.local?td:rd)(n,t))}var Bo=h(()=>{Ae()});function nd(e,t){return function(){Zt(this,e).delay=+t.apply(this,arguments)}}function sd(e,t){return t=+t,function(){Zt(this,e).delay=t}}function Ho(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?nd:sd)(t,e)):te(this.node(),t).delay}var Qo=h(()=>{de()});function ad(e,t){return function(){se(this,e).duration=+t.apply(this,arguments)}}function id(e,t){return t=+t,function(){se(this,e).duration=t}}function Wo(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ad:id)(t,e)):te(this.node(),t).duration}var Zo=h(()=>{de()});function od(e,t){if(typeof t!="function")throw new Error;return function(){se(this,e).ease=t}}function Ko(e){var t=this._id;return arguments.length?this.each(od(t,e)):te(this.node(),t).ease}var Jo=h(()=>{de()});function cd(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;se(this,e).ease=r}}function ec(e){if(typeof e!="function")throw new Error;return this.each(cd(this._id,e))}var tc=h(()=>{de()});function rc(e){typeof e!="function"&&(e=Dt(e));for(var t=this._groups,r=t.length,n=new Array(r),s=0;s<r;++s)for(var i=t[s],a=i.length,o=n[s]=[],c,l=0;l<a;++l)(c=i[l])&&e.call(c,c.__data__,l,i)&&o.push(c);return new oe(n,this._parents,this._name,this._id)}var nc=h(()=>{Ae();Xe()});function sc(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,s=r.length,i=Math.min(n,s),a=new Array(n),o=0;o<i;++o)for(var c=t[o],l=r[o],f=c.length,d=a[o]=new Array(f),m,x=0;x<f;++x)(m=c[x]||l[x])&&(d[x]=m);for(;o<n;++o)a[o]=t[o];return new oe(a,this._parents,this._name,this._id)}var ac=h(()=>{Xe()});function ld(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function ud(e,t,r){var n,s,i=ld(t)?Zt:se;return function(){var a=i(this,e),o=a.on;o!==n&&(s=(n=o).copy()).on(t,r),a.on=s}}function ic(e,t){var r=this._id;return arguments.length<2?te(this.node(),r).on.on(e):this.each(ud(r,e,t))}var oc=h(()=>{de()});function fd(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function cc(){return this.on("end.remove",fd(this._id))}var lc=h(()=>{});function uc(e){var t=this._name,r=this._id;typeof e!="function"&&(e=tt(e));for(var n=this._groups,s=n.length,i=new Array(s),a=0;a<s;++a)for(var o=n[a],c=o.length,l=i[a]=new Array(c),f,d,m=0;m<c;++m)(f=o[m])&&(d=e.call(f,f.__data__,m,o))&&("__data__"in f&&(d.__data__=f.__data__),l[m]=d,Be(l[m],t,r,m,l,te(f,r)));return new oe(i,this._parents,t,r)}var fc=h(()=>{Ae();Xe();de()});function hc(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Ot(e));for(var n=this._groups,s=n.length,i=[],a=[],o=0;o<s;++o)for(var c=n[o],l=c.length,f,d=0;d<l;++d)if(f=c[d]){for(var m=e.call(f,f.__data__,d,c),x,b=te(f,r),y=0,_=m.length;y<_;++y)(x=m[y])&&Be(x,t,r,y,m,b);i.push(m),a.push(f)}return new oe(i,a,t,r)}var dc=h(()=>{Ae();Xe();de()});function pc(){return new hd(this._groups,this._parents)}var hd,mc=h(()=>{Ae();hd=Le.prototype.constructor});function dd(e,t){var r,n,s;return function(){var i=qe(this,e),a=(this.style.removeProperty(e),qe(this,e));return i===a?null:i===r&&a===n?s:s=t(r=i,n=a)}}function gc(e){return function(){this.style.removeProperty(e)}}function pd(e,t,r){var n,s=r+"",i;return function(){var a=qe(this,e);return a===s?null:a===n?i:i=t(n=a,r)}}function md(e,t,r){var n,s,i;return function(){var a=qe(this,e),o=r(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(e),qe(this,e))),a===c?null:a===n&&c===s?i:(s=c,i=t(n=a,o))}}function gd(e,t){var r,n,s,i="style."+t,a="end."+i,o;return function(){var c=se(this,e),l=c.on,f=c.value[i]==null?o||(o=gc(t)):void 0;(l!==r||s!==f)&&(n=(r=l).copy()).on(a,s=f),c.on=n}}function xc(e,t,r){var n=(e+="")==="transform"?fs:tn;return t==null?this.styleTween(e,dd(e,n)).on("end.style."+e,gc(e)):typeof t=="function"?this.styleTween(e,md(e,n,jt(this,"style."+e,t))).each(gd(this._id,e)):this.styleTween(e,pd(e,n,t),r).on("end.style."+e,null)}var yc=h(()=>{Ut();Ae();de();Jt();xs()});function xd(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function yd(e,t,r){var n,s;function i(){var a=t.apply(this,arguments);return a!==s&&(n=(s=a)&&xd(e,a,r)),n}return i._value=t,i}function vc(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,yd(e,t,r??""))}var _c=h(()=>{});function vd(e){return function(){this.textContent=e}}function _d(e){return function(){var t=e(this);this.textContent=t??""}}function wc(e){return this.tween("text",typeof e=="function"?_d(jt(this,"text",e)):vd(e==null?"":e+""))}var Sc=h(()=>{Jt()});function wd(e){return function(t){this.textContent=e.call(this,t)}}function Sd(e){var t,r;function n(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&wd(s)),t}return n._value=e,n}function bc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Sd(e))}var jc=h(()=>{});function Vc(){for(var e=this._name,t=this._id,r=rn(),n=this._groups,s=n.length,i=0;i<s;++i)for(var a=n[i],o=a.length,c,l=0;l<o;++l)if(c=a[l]){var f=te(c,t);Be(c,e,r,l,a,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new oe(n,this._parents,e,r)}var Tc=h(()=>{Xe();de()});function Ac(){var e,t,r=this,n=r._id,s=r.size();return new Promise(function(i,a){var o={value:a},c={value:function(){--s==0&&i()}};r.each(function(){var l=se(this,n),f=l.on;f!==e&&(t=(e=f).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(c)),l.on=t}),s===0&&i()})}var Ec=h(()=>{de()});function oe(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function ys(e){return Le().transition(e)}function rn(){return++bd}var bd,nt,Xe=h(()=>{Ae();Go();Bo();Qo();Zo();Jo();tc();nc();ac();oc();lc();fc();dc();mc();yc();_c();Sc();jc();Tc();Jt();Ec();bd=0;nt=Le.prototype;oe.prototype=ys.prototype={constructor:oe,select:uc,selectAll:hc,filter:rc,merge:sc,selection:pc,transition:Vc,call:nt.call,nodes:nt.nodes,node:nt.node,size:nt.size,empty:nt.empty,each:nt.each,on:ic,attr:qo,attrTween:$o,style:xc,styleTween:vc,text:wc,textTween:bc,remove:cc,tween:Uo,delay:Ho,duration:Wo,ease:Ko,easeVarying:ec,end:Ac,[Symbol.iterator]:nt[Symbol.iterator]}});function nn(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Mc=h(()=>{});var vs=h(()=>{Mc()});function Vd(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function Ic(e){var t,r;e instanceof oe?(t=e._id,e=e._name):(t=rn(),(r=jd).time=Ht(),e=e==null?null:e+"");for(var n=this._groups,s=n.length,i=0;i<s;++i)for(var a=n[i],o=a.length,c,l=0;l<o;++l)(c=a[l])&&Be(c,e,t,l,a,r||Vd(c,t));return new oe(n,this._parents,e,t)}var jd,Cc=h(()=>{Xe();de();vs();Zr();jd={time:null,delay:0,duration:250,ease:nn}});var Rc=h(()=>{Ae();No();Cc();Le.prototype.interrupt=Fo;Le.prototype.transition=Ic});var kc=h(()=>{Xe();de()});var sn=h(()=>{Rc();Xe();kc();gs()});var Oc=h(()=>{});var Dc=h(()=>{});var Yc=h(()=>{});function Lc(e){return[+e[0],+e[1]]}function Td(e){return[Lc(e[0]),Lc(e[1])]}function _s(e){return{type:e}}var $v,Bv,Hv,Xc=h(()=>{sn();Oc();Dc();Yc();$v={name:"x",handles:["w","e"].map(_s),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Bv={name:"y",handles:["n","s"].map(_s),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Hv={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(_s),input:function(e){return e==null?null:Td(e)},output:function(e){return e}}});var Pc=h(()=>{Xc()});var zc=h(()=>{});var Fc=h(()=>{});var Nc=h(()=>{});var Uc=h(()=>{});var qc=h(()=>{});var Gc=h(()=>{});var $c=h(()=>{});var Bc=h(()=>{});function Hc(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function st(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}var er=h(()=>{});function Qc(e){return e=st(Math.abs(e)),e?e[1]:NaN}var Wc=h(()=>{er()});function Zc(e,t){return function(r,n){for(var s=r.length,i=[],a=0,o=e[0],c=0;s>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),i.push(r.substring(s-=o,s+o)),!((c+=o+1)>n));)o=e[a=(a+1)%e.length];return i.reverse().join(t)}}var Kc=h(()=>{});function Jc(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var el=h(()=>{});function tr(e){if(!(t=Ad.exec(e)))throw new Error("invalid format: "+e);var t;return new ws({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ws(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}var Ad,tl=h(()=>{Ad=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;tr.prototype=ws.prototype;ws.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function rl(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var nl=h(()=>{});function sl(e,t){var r=st(e,t);if(!r)return e+"";var n=r[0],s=r[1],i=s-(Ss=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=n.length;return i===a?n:i>a?n+new Array(i-a+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+st(e,Math.max(0,t+i-1))[0]}var Ss,bs=h(()=>{er()});function js(e,t){var r=st(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}var al=h(()=>{er()});var Vs,il=h(()=>{er();bs();al();Vs={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Hc,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>js(e*100,t),r:js,s:sl,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)}});function Ts(e){return e}var ol=h(()=>{});function ul(e){var t=e.grouping===void 0||e.thousands===void 0?Ts:Zc(cl.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?Ts:Jc(cl.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"\u2212":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(d){d=tr(d);var m=d.fill,x=d.align,b=d.sign,y=d.symbol,_=d.zero,j=d.width,O=d.comma,A=d.precision,L=d.trim,Y=d.type;Y==="n"?(O=!0,Y="g"):Vs[Y]||(A===void 0&&(A=12),L=!0,Y="g"),(_||m==="0"&&x==="=")&&(_=!0,m="0",x="=");var Q=y==="$"?r:y==="#"&&/[boxX]/.test(Y)?"0"+Y.toLowerCase():"",we=y==="$"?n:/[%p]/.test(Y)?a:"",ue=Vs[Y],Me=/[defgprs%]/.test(Y);A=A===void 0?6:/[gprs]/.test(Y)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function ze(C){var Ve=Q,ae=we,Te,yt,Fe;if(Y==="c")ae=ue(C)+ae,C="";else{C=+C;var Ne=C<0||1/C<0;if(C=isNaN(C)?c:ue(Math.abs(C),A),L&&(C=rl(C)),Ne&&+C==0&&b!=="+"&&(Ne=!1),Ve=(Ne?b==="("?b:o:b==="-"||b==="("?"":b)+Ve,ae=(Y==="s"?ll[8+Ss/3]:"")+ae+(Ne&&b==="("?")":""),Me){for(Te=-1,yt=C.length;++Te<yt;)if(Fe=C.charCodeAt(Te),48>Fe||Fe>57){ae=(Fe===46?s+C.slice(Te+1):C.slice(Te))+ae,C=C.slice(0,Te);break}}}O&&!_&&(C=t(C,1/0));var Ue=Ve.length+C.length+ae.length,ye=Ue<j?new Array(j-Ue+1).join(m):"";switch(O&&_&&(C=t(ye+C,ye.length?j-ae.length:1/0),ye=""),x){case"<":C=Ve+C+ae+ye;break;case"=":C=Ve+ye+C+ae;break;case"^":C=ye.slice(0,Ue=ye.length>>1)+Ve+C+ae+ye.slice(Ue);break;default:C=ye+Ve+C+ae;break}return i(C)}return ze.toString=function(){return d+""},ze}function f(d,m){var x=l((d=tr(d),d.type="f",d)),b=Math.max(-8,Math.min(8,Math.floor(Qc(m)/3)))*3,y=Math.pow(10,-b),_=ll[8+b/3];return function(j){return x(y*j)+_}}return{format:l,formatPrefix:f}}var cl,ll,fl=h(()=>{Wc();Kc();el();tl();nl();il();bs();ol();cl=Array.prototype.map,ll=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function As(e){return an=ul(e),hl=an.format,dl=an.formatPrefix,an}var an,hl,dl,pl=h(()=>{fl();As({thousands:",",grouping:[3],currency:["$",""]})});var ml=h(()=>{pl()});var gl=h(()=>{});var xl=h(()=>{});var yl=h(()=>{});var vl=h(()=>{});function ce(e,t,r,n){function s(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return s.floor=function(i){return e(i=new Date(+i)),i},s.ceil=function(i){return e(i=new Date(i-1)),t(i,1),e(i),i},s.round=function(i){var a=s(i),o=s.ceil(i);return i-a<o-i?a:o},s.offset=function(i,a){return t(i=new Date(+i),a==null?1:Math.floor(a)),i},s.range=function(i,a,o){var c=[],l;if(i=s.ceil(i),o=o==null?1:Math.floor(o),!(i<a)||!(o>0))return c;do c.push(l=new Date(+i)),t(i,o),e(i);while(l<i&&i<a);return c},s.filter=function(i){return ce(function(a){if(a>=a)for(;e(a),!i(a);)a.setTime(a-1)},function(a,o){if(a>=a)if(o<0)for(;++o<=0;)for(;t(a,-1),!i(a););else for(;--o>=0;)for(;t(a,1),!i(a););})},r&&(s.count=function(i,a){return Es.setTime(+i),Ms.setTime(+a),e(Es),e(Ms),Math.floor(r(Es,Ms))},s.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?s.filter(n?function(a){return n(a)%i==0}:function(a){return s.count(0,a)%i==0}):s}),s}var Es,Ms,at=h(()=>{Es=new Date,Ms=new Date});var Ed,rr,Md,it,on,q_,G_,nr=h(()=>{Ed=1e3,rr=Ed*60,Md=rr*60,it=Md*24,on=it*7,q_=it*30,G_=it*365});var _l,cn,Id,wl=h(()=>{at();nr();_l=ce(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*rr)/it,e=>e.getDate()-1),cn=_l,Id=_l.range});function ot(e){return ce(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*rr)/on})}var sr,Vt,Sl,bl,He,jl,Vl,Tl,Cd,Rd,kd,Od,Dd,Yd,Al=h(()=>{at();nr();sr=ot(0),Vt=ot(1),Sl=ot(2),bl=ot(3),He=ot(4),jl=ot(5),Vl=ot(6),Tl=sr.range,Cd=Vt.range,Rd=Sl.range,kd=bl.range,Od=He.range,Dd=jl.range,Yd=Vl.range});var Is,ct,Ld,El=h(()=>{at();Is=ce(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Is.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ce(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};ct=Is,Ld=Is.range});var Ml,ln,Xd,Il=h(()=>{at();nr();Ml=ce(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/it},function(e){return e.getUTCDate()-1}),ln=Ml,Xd=Ml.range});function lt(e){return ce(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/on})}var ar,Tt,Cl,Rl,Qe,kl,Ol,Dl,Pd,zd,Fd,Nd,Ud,qd,Yl=h(()=>{at();nr();ar=lt(0),Tt=lt(1),Cl=lt(2),Rl=lt(3),Qe=lt(4),kl=lt(5),Ol=lt(6),Dl=ar.range,Pd=Tt.range,zd=Cl.range,Fd=Rl.range,Nd=Qe.range,Ud=kl.range,qd=Ol.range});var Cs,ut,Gd,Ll=h(()=>{at();Cs=ce(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Cs.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ce(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};ut=Cs,Gd=Cs.range});var Rs=h(()=>{wl();Al();El();Il();Yl();Ll()});function ks(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Os(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ir(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function Ds(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,i=e.days,a=e.shortDays,o=e.months,c=e.shortMonths,l=or(s),f=cr(s),d=or(i),m=cr(i),x=or(a),b=cr(a),y=or(o),_=cr(o),j=or(c),O=cr(c),A={a:Ne,A:Ue,b:ye,B:En,c:null,d:Ul,e:Ul,f:pp,g:jp,G:Tp,H:fp,I:hp,j:dp,L:ql,m:mp,M:gp,p:Mn,q:In,Q:Wl,s:Zl,S:xp,u:yp,U:vp,V:_p,w:wp,W:Sp,x:null,X:null,y:bp,Y:Vp,Z:Ap,"%":Ql},L={a:Cn,A:Rn,b:kn,B:On,c:null,d:$l,e:$l,f:Cp,g:Fp,G:Up,H:Ep,I:Mp,j:Ip,L:Bl,m:Rp,M:kp,p:Dn,q:Yn,Q:Wl,s:Zl,S:Op,u:Dp,U:Yp,V:Lp,w:Xp,W:Pp,x:null,X:null,y:zp,Y:Np,Z:qp,"%":Ql},Y={a:ze,A:C,b:Ve,B:ae,c:Te,d:Fl,e:Fl,f:op,g:zl,G:Pl,H:Nl,I:Nl,j:np,L:ip,m:rp,M:sp,p:Me,q:tp,Q:lp,s:up,S:ap,u:Wd,U:Zd,V:Kd,w:Qd,W:Jd,x:yt,X:Fe,y:zl,Y:Pl,Z:ep,"%":cp};A.x=Q(r,A),A.X=Q(n,A),A.c=Q(t,A),L.x=Q(r,L),L.X=Q(n,L),L.c=Q(t,L);function Q(V,I){return function(k){var w=[],ie=-1,P=0,fe=V.length,he,g,z;for(k instanceof Date||(k=new Date(+k));++ie<fe;)V.charCodeAt(ie)===37&&(w.push(V.slice(P,ie)),(g=Xl[he=V.charAt(++ie)])!=null?he=V.charAt(++ie):g=he==="e"?" ":"0",(z=I[he])&&(he=z(k,g)),w.push(he),P=ie+1);return w.push(V.slice(P,ie)),w.join("")}}function we(V,I){return function(k){var w=ir(1900,void 0,1),ie=ue(w,V,k+="",0),P,fe;if(ie!=k.length)return null;if("Q"in w)return new Date(w.Q);if("s"in w)return new Date(w.s*1e3+("L"in w?w.L:0));if(I&&!("Z"in w)&&(w.Z=0),"p"in w&&(w.H=w.H%12+w.p*12),w.m===void 0&&(w.m="q"in w?w.q:0),"V"in w){if(w.V<1||w.V>53)return null;"w"in w||(w.w=1),"Z"in w?(P=Os(ir(w.y,0,1)),fe=P.getUTCDay(),P=fe>4||fe===0?Tt.ceil(P):Tt(P),P=ln.offset(P,(w.V-1)*7),w.y=P.getUTCFullYear(),w.m=P.getUTCMonth(),w.d=P.getUTCDate()+(w.w+6)%7):(P=ks(ir(w.y,0,1)),fe=P.getDay(),P=fe>4||fe===0?Vt.ceil(P):Vt(P),P=cn.offset(P,(w.V-1)*7),w.y=P.getFullYear(),w.m=P.getMonth(),w.d=P.getDate()+(w.w+6)%7)}else("W"in w||"U"in w)&&("w"in w||(w.w="u"in w?w.u%7:"W"in w?1:0),fe="Z"in w?Os(ir(w.y,0,1)).getUTCDay():ks(ir(w.y,0,1)).getDay(),w.m=0,w.d="W"in w?(w.w+6)%7+w.W*7-(fe+5)%7:w.w+w.U*7-(fe+6)%7);return"Z"in w?(w.H+=w.Z/100|0,w.M+=w.Z%100,Os(w)):ks(w)}}function ue(V,I,k,w){for(var ie=0,P=I.length,fe=k.length,he,g;ie<P;){if(w>=fe)return-1;if(he=I.charCodeAt(ie++),he===37){if(he=I.charAt(ie++),g=Y[he in Xl?I.charAt(ie++):he],!g||(w=g(V,k,w))<0)return-1}else if(he!=k.charCodeAt(w++))return-1}return w}function Me(V,I,k){var w=l.exec(I.slice(k));return w?(V.p=f.get(w[0].toLowerCase()),k+w[0].length):-1}function ze(V,I,k){var w=x.exec(I.slice(k));return w?(V.w=b.get(w[0].toLowerCase()),k+w[0].length):-1}function C(V,I,k){var w=d.exec(I.slice(k));return w?(V.w=m.get(w[0].toLowerCase()),k+w[0].length):-1}function Ve(V,I,k){var w=j.exec(I.slice(k));return w?(V.m=O.get(w[0].toLowerCase()),k+w[0].length):-1}function ae(V,I,k){var w=y.exec(I.slice(k));return w?(V.m=_.get(w[0].toLowerCase()),k+w[0].length):-1}function Te(V,I,k){return ue(V,t,I,k)}function yt(V,I,k){return ue(V,r,I,k)}function Fe(V,I,k){return ue(V,n,I,k)}function Ne(V){return a[V.getDay()]}function Ue(V){return i[V.getDay()]}function ye(V){return c[V.getMonth()]}function En(V){return o[V.getMonth()]}function Mn(V){return s[+(V.getHours()>=12)]}function In(V){return 1+~~(V.getMonth()/3)}function Cn(V){return a[V.getUTCDay()]}function Rn(V){return i[V.getUTCDay()]}function kn(V){return c[V.getUTCMonth()]}function On(V){return o[V.getUTCMonth()]}function Dn(V){return s[+(V.getUTCHours()>=12)]}function Yn(V){return 1+~~(V.getUTCMonth()/3)}return{format:function(V){var I=Q(V+="",A);return I.toString=function(){return V},I},parse:function(V){var I=we(V+="",!1);return I.toString=function(){return V},I},utcFormat:function(V){var I=Q(V+="",L);return I.toString=function(){return V},I},utcParse:function(V){var I=we(V+="",!0);return I.toString=function(){return V},I}}}function D(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",i=s.length;return n+(i<r?new Array(r-i+1).join(t)+s:s)}function Hd(e){return e.replace(Bd,"\\$&")}function or(e){return new RegExp("^(?:"+e.map(Hd).join("|")+")","i")}function cr(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function Qd(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Wd(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function Zd(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Kd(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Jd(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Pl(e,t,r){var n=ne.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function zl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function ep(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function tp(e,t,r){var n=ne.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function rp(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Fl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function np(e,t,r){var n=ne.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Nl(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function sp(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function ap(e,t,r){var n=ne.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function ip(e,t,r){var n=ne.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function op(e,t,r){var n=ne.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function cp(e,t,r){var n=$d.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function lp(e,t,r){var n=ne.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function up(e,t,r){var n=ne.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Ul(e,t){return D(e.getDate(),t,2)}function fp(e,t){return D(e.getHours(),t,2)}function hp(e,t){return D(e.getHours()%12||12,t,2)}function dp(e,t){return D(1+cn.count(ct(e),e),t,3)}function ql(e,t){return D(e.getMilliseconds(),t,3)}function pp(e,t){return ql(e,t)+"000"}function mp(e,t){return D(e.getMonth()+1,t,2)}function gp(e,t){return D(e.getMinutes(),t,2)}function xp(e,t){return D(e.getSeconds(),t,2)}function yp(e){var t=e.getDay();return t===0?7:t}function vp(e,t){return D(sr.count(ct(e)-1,e),t,2)}function Gl(e){var t=e.getDay();return t>=4||t===0?He(e):He.ceil(e)}function _p(e,t){return e=Gl(e),D(He.count(ct(e),e)+(ct(e).getDay()===4),t,2)}function wp(e){return e.getDay()}function Sp(e,t){return D(Vt.count(ct(e)-1,e),t,2)}function bp(e,t){return D(e.getFullYear()%100,t,2)}function jp(e,t){return e=Gl(e),D(e.getFullYear()%100,t,2)}function Vp(e,t){return D(e.getFullYear()%1e4,t,4)}function Tp(e,t){var r=e.getDay();return e=r>=4||r===0?He(e):He.ceil(e),D(e.getFullYear()%1e4,t,4)}function Ap(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+D(t/60|0,"0",2)+D(t%60,"0",2)}function $l(e,t){return D(e.getUTCDate(),t,2)}function Ep(e,t){return D(e.getUTCHours(),t,2)}function Mp(e,t){return D(e.getUTCHours()%12||12,t,2)}function Ip(e,t){return D(1+ln.count(ut(e),e),t,3)}function Bl(e,t){return D(e.getUTCMilliseconds(),t,3)}function Cp(e,t){return Bl(e,t)+"000"}function Rp(e,t){return D(e.getUTCMonth()+1,t,2)}function kp(e,t){return D(e.getUTCMinutes(),t,2)}function Op(e,t){return D(e.getUTCSeconds(),t,2)}function Dp(e){var t=e.getUTCDay();return t===0?7:t}function Yp(e,t){return D(ar.count(ut(e)-1,e),t,2)}function Hl(e){var t=e.getUTCDay();return t>=4||t===0?Qe(e):Qe.ceil(e)}function Lp(e,t){return e=Hl(e),D(Qe.count(ut(e),e)+(ut(e).getUTCDay()===4),t,2)}function Xp(e){return e.getUTCDay()}function Pp(e,t){return D(Tt.count(ut(e)-1,e),t,2)}function zp(e,t){return D(e.getUTCFullYear()%100,t,2)}function Fp(e,t){return e=Hl(e),D(e.getUTCFullYear()%100,t,2)}function Np(e,t){return D(e.getUTCFullYear()%1e4,t,4)}function Up(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Qe(e):Qe.ceil(e),D(e.getUTCFullYear()%1e4,t,4)}function qp(){return"+0000"}function Ql(){return"%"}function Wl(e){return+e}function Zl(e){return Math.floor(+e/1e3)}var Xl,ne,$d,Bd,Kl=h(()=>{Rs();Xl={"-":"",_:" ","0":"0"},ne=/^\s*\d+/,$d=/^%/,Bd=/[\\^$*+?|[\]().{}]/g});function Ys(e){return At=Ds(e),Jl=At.format,eu=At.parse,tu=At.utcFormat,ru=At.utcParse,At}var At,Jl,eu,tu,ru,nu=h(()=>{Kl();Ys({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});var su=h(()=>{nu()});var au=h(()=>{});var iu=h(()=>{});var ou=h(()=>{});var cu=h(()=>{});var lu=h(()=>{});function ft(e,t,r){this.k=e,this.x=t,this.y=r}function Xs(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Ls;return e.__zoom}var Ls,Ps=h(()=>{ft.prototype={constructor:ft,scale:function(e){return e===1?this:new ft(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ft(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ls=new ft(1,0,0);Xs.prototype=ft.prototype});var uu=h(()=>{});var fu=h(()=>{sn();cu();lu();Ps();uu()});var hu=h(()=>{fu();Ps()});var lr=h(()=>{Ea();Ma();Ia();Pc();Fc();zr();Nc();Uc();Gn();ao();qc();vs();Gc();Bc();ml();gl();xl();Ut();zc();yl();$c();vl();au();iu();Ae();ou();Rs();su();Zr();sn();hu()});var du=h(()=>{Ar();lr();K.register("SliderTransformer",{constructor:K,redraw:({layer:e,transformer:t})=>{J(e.getGraphic()).selectAll(":not(.ig-layer-background)").remove();let r=t.getSharedVar("x1")??0,n=t.getSharedVar("x2")??0,s=t.getSharedVar("height")??0,i=t.getSharedVar("fill")??"#000000",a=t.getSharedVar("opacity")??.3;J(e.getGraphic()).append("rect").attr("x1",r).attr("x2",n).attr("width",n-r).attr("height",s).attr("fill",i).attr("opacity",a)}});K.register("HighlightSelection",{constructor:K,redraw({layer:e,transformer:t}){let r=J(e.getGraphic()).selectAll(t.getSharedVar("selector")||"*");Object.entries(t.getSharedVar("highlightAttrValues")).forEach(([s,i])=>{r.attr(s,i)})}});K.register("TransientRectangleTransformer",{constructor:K,className:["draw-shape","transient-shape","rectangle-shape"],redraw:({layer:e,transformer:t})=>{J(e.getGraphic()).selectAll(":not(.ig-layer-background)").remove(),J(e.getGraphic()).append("rect").attr("x",t.getSharedVar("x")).attr("y",t.getSharedVar("y")).attr("width",t.getSharedVar("width")).attr("height",t.getSharedVar("height")).attr("fill",t.getSharedVar("fillColor")).attr("opacity",t.getSharedVar("opacity"))}});K.register("SelectionTransformer",{constructor:K,redraw:({layer:e,transformer:t})=>{t.getSharedVar("selectionResult").forEach(s=>{e.getGraphic().appendChild(s)});let r=t.getSharedVar("highlightColor"),n=Object.entries(t.getSharedVar("highlightAttrValues")||{});if(r||n.length){let s=Pt(t.getSharedVar("selectionResult"));r&&s.attr("fill",r).attr("stroke",r),n.forEach(([i,a])=>{s.attr(i,a)})}}});K.register("HelperLineTransformer",{constructor:K,transient:!0,sharedVar:{orientation:["horizontal","vertical"],style:{}},redraw({layer:e,transformer:t}){let r=e.getLayerFromQueue("mainLayer"),n=t.getSharedVar("orientation"),s=t.getSharedVar("style"),i=t.getSharedVar("x"),a=t.getSharedVar("y"),o=t.getSharedVar("tooltip"),c=t.getSharedVar("scaleX"),l=t.getSharedVar("scaleY"),f=[],d=0,m=0;o&&(typeof o=="object"&&o.prefix&&f.push(o.prefix),c&&c.invert&&typeof i=="number"&&f.push(c.invert(i-(e._offset?.x??0))),l&&l.invert&&typeof a=="number"&&f.push(l.invert(a-(e._offset?.y??0))),typeof o=="object"&&o.suffix&&f.push(o.suffix),typeof o=="object"&&o.offset&&(typeof o.offset.x=="number"&&(d=o.offset.x),typeof o.offset.y=="number"&&(m=o.offset.y),typeof o.offset.x=="function"&&typeof i=="number"&&(d=o.offset.x(i-(e._offset?.x??0))),typeof o.offset.y=="function"&&typeof a=="number"&&(m=o.offset.y(a-(e._offset?.y??0)))));let x=f.join(" ");if(n.includes("horizontal")&&typeof a=="number"){let b=J(e.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",a-(e._offset?.y??0)).attr("y2",a-(e._offset?.y??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([y,_])=>{b.attr(y,_)})}if(n.includes("vertical")&&typeof i=="number"){let b=J(e.getGraphic()).append("line").attr("y1",0).attr("y2",r.getGraphic().getBoundingClientRect().height).attr("x1",i-(e._offset?.x??0)).attr("x2",i-(e._offset?.x??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([y,_])=>{b.attr(y,_)})}x&&J(e.getGraphic()).append("text").attr("x",i-(e._offset?.x??0)).attr("y",a-(e._offset?.y??0)).text(x)}})});var zs,B,ht=h(()=>{Ar();Ar();du();zs=kt,B=K});var pu,Et,un,X,Gp,CS,$p,mu,Mt=h(()=>{Se();ht();Et={},un=[],X=class{constructor(t,r){this._linkCache={},this._transformers=[],this._joinTransformers=[],this._services=[],this._joinServices=[],this._initializing=null,this._nextTick=0,this._computing=null,this._result=null,this._oldResult=null,this[pu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._sharedVar={},this._transformers=r.transformers??[],this._joinTransformers=r.joinTransformers??[],this._services=r.services??[],this._joinServices=r.joinServices??[],this._layerInstances=[],this._resultAlias=r.resultAlias,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._initializing=Promise.all(Object.entries(r.sharedVar||{}).map(n=>this.setSharedVar(n[0],n[1]))).then(async()=>{r.postUpdate&&r.postUpdate.call(this,this),this._postUpdate=r.postUpdate??null,this._initializing=null}),r.layer&&this._layerInstances.push(r.layer),un.push(this),r.postInitialize&&r.postInitialize.call(this,this)}getSharedVar(t,r){if(!(r&&r.layer&&this._layerInstances.length&&!this._layerInstances.includes(r.layer)))return!(t in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(t,r.defaultValue,r),this._sharedVar[t]}async setSharedVar(t,r,n){if(this.preUpdate(),this._sharedVar[t]=r,this._userOptions.evaluate&&this._resultAlias){if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._oldResult=this._result;try{this._computing=this._userOptions.evaluate({self:this,...this._userOptions.params??{},...this._sharedVar}),this._result=await this._computing,this._computing=null,this._services.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})}),this._transformers.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})})}catch(s){console.error(s),this._result=void 0,this._computing=null}this._nextTick=0,this.postUpdate()})}else this.postUpdate()}async setSharedVars(t,r){Object.entries(t).forEach(([n,s])=>{this._sharedVar[n]=s}),Object.keys(t).length>0&&await this.setSharedVar(...Object.entries(t)[0],r)}async join(){if(this._resultAlias){let t=await this._internalResults;this._joinServices&&this._joinServices.length?await Promise.all(this._joinServices.map(async r=>(await r.setSharedVar(this._resultAlias,t),r.results))):this._initializing||await Promise.all(this._services.map(async r=>(await r.setSharedVar(this._resultAlias,t),r.results))),this._joinTransformers&&this._joinTransformers.length?await Promise.all(this._joinTransformers.map(r=>r.setSharedVar(this._resultAlias,t))):this._initializing||await Promise.all(this._transformers.map(r=>r.setSharedVar(this._resultAlias,t)))}}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}preAttach(t){this._preAttach&&this._preAttach.call(this,this,t)}postUse(t){this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return this._baseName===t||this._name===t}get transformers(){return ge(this._transformers.slice(0),B,t=>this._transformers.push(t),t=>{t.setSharedVars({...this._resultAlias?{[this._resultAlias]:null}:{},selectionResult:[],layoutResult:null,result:null}),this._transformers.splice(this._transformers.indexOf(t),1)},this)}get services(){return ge(this._services.slice(0),X,t=>this._services.push(t),t=>{Object.entries({...this._resultAlias?{[this._resultAlias]:null}:{},selectionResult:[],layoutResult:null,result:null}).forEach(([r,n])=>{t.setSharedVar(r,n)}),this._services.splice(this._services.indexOf(t),1)},this)}get _internalResults(){return this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing?t(await this._computing):t(this._result)})}):this._computing||this._result}get results(){return this._initializing?this._initializing.then(()=>this._internalResults):this._internalResults}get oldResults(){return this._initializing?this._initializing.then(()=>this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,t(this._oldResult)})}):this._oldResult):this._nextTick?new Promise(t=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,t(this._oldResult)})}):this._oldResult}static register(t,r){Et[t]=r}static unregister(t){return delete Et[t],!0}static initialize(t,r){let n=Object.assign({constructor:X},Et[t]??{},r??{},{on:Object.assign({},(Et[t]??{}).on??{},r?.on??{}),sharedVar:Object.assign({},(Et[t]??{}).sharedVar??{},r?.sharedVar??{}),params:Object.assign({},(Et[t]??{}).params??{},r?.params??{})});return new n.constructor(t,n)}static findService(t){return un.filter(r=>r.isInstanceOf(t))}};pu=me;Gp=X.register,CS=X.unregister,$p=X.initialize,mu=X.findService});var _e,Fs=h(()=>{Mt();Se();ht();_e=class extends X{constructor(t,r){super(t,{...r,resultAlias:r?.resultAlias??"selectionResult"});this._currentDimension=[],this._transformers.push(B.initialize("SelectionTransformer",{transient:!0,sharedVar:{[this._resultAlias]:[],layer:null,highlightColor:r?.sharedVar?.highlightColor,highlightAttrValues:r?.sharedVar?.highlightAttrValues}})),this._selectionMapping=new Map,Object.entries({...this._userOptions?.query?.attrName?typeof this._userOptions.query.attrName=="string"?{[this._userOptions.query.attrName]:this._userOptions?.query?.extent??[]}:Object.fromEntries(this._userOptions.query.attrName.map((n,s)=>[n,this._userOptions?.query?.extent?.[s]??[]])):{},...this._sharedVar?.attrName?typeof this._sharedVar.attrName=="string"?{[this._sharedVar.attrName]:this._sharedVar?.extent??[]}:Object.fromEntries(this._sharedVar.attrName.map((n,s)=>[n,this._sharedVar?.extent?.[s]??[]])):{}}).filter(([n,s])=>s instanceof Array).forEach(([n,s])=>this._selectionMapping.set(n,s))}async setSharedVar(t,r,n){if(!(n&&n.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(n.layer)))if(this.preUpdate(),this._sharedVar[t]=r,this._transformers.filter(s=>s.isInstanceOf("draw-shape")).forEach(s=>{let i=n?.layer||this._layerInstances[0];if(!i)return;let a=this._sharedVar.x??i.getGraphic().getBoundingClientRect().left,o=this._sharedVar.y??i.getGraphic().getBoundingClientRect().top,c=this._sharedVar.width??i._width??0,l=this._sharedVar.height??i._height??0;(this._sharedVar.width!==void 0||this._sharedVar.height!==void 0)&&s.setSharedVars({layer:i.getLayerFromQueue("transientLayer"),x:a-i.getGraphic().getBoundingClientRect().left,y:o-i.getGraphic().getBoundingClientRect().top,width:c,height:l})}),(n?.layer||this._layerInstances.length==1)&&this._userOptions.query){let s=n?.layer||this._layerInstances[0];if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._evaluate(s)})}else this.postUpdate()}_evaluate(t){if(!t)return;this._oldResult=this._result,this._result=t.picking({...this._userOptions.query,...this._sharedVar});let r=t.getLayerFromQueue("selectionLayer").getGraphic();for(;r.firstChild;)r.removeChild(r.lastChild);if(this._sharedVar.deepClone){let n=[],s=[];this._result.forEach(i=>{if(i!==t.getGraphic()){let a=s.length;for(let o=0;o<a;o++){let c=s[o],l=n[o];i.contains(c)&&(s.splice(o,1),n.splice(o,1),l.remove(),o--,a--)}n.push(t.cloneVisualElements(i,!0)),s.push(i)}}),this._services.forEach(i=>{i.setSharedVar(this._resultAlias,n)}),this._transformers.forEach(i=>{i.setSharedVars({layer:t.getLayerFromQueue("selectionLayer"),[this._resultAlias]:n})})}else this._services.forEach(n=>{n.setSharedVar(this._resultAlias,this._result.map(s=>t.cloneVisualElements(s,!1)))}),this._transformers.forEach(n=>{n.setSharedVars({layer:t.getLayerFromQueue("selectionLayer"),[this._resultAlias]:this._result.map(s=>t.cloneVisualElements(s,!1))})});if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert&&this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.offsety,i=this._sharedVar.width,a=this._sharedVar.height,o=t._offset?.x??0,c=t._offset?.y??0,l=[n-o,n-o+i].map(this._sharedVar.scaleX.invert),f=[s-c,s-c+a].map(this._sharedVar.scaleY.invert);this.filter([l,f],{passive:!0})}else if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.width,i=t._offset?.x??0,a=[n-i,n-i+s].map(this._sharedVar.scaleX.invert);this.filter(a,{passive:!0})}else if(this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsety,s=this._sharedVar.height,i=t._offset?.y??0,a=[n-i,n-i+s].map(this._sharedVar.scaleY.invert);this.filter(a,{passive:!0})}this._nextTick=0,this.postUpdate()}isInstanceOf(t){return t==="SelectionService"||this._baseName===t||this._name===t}dimension(t,r){let n=[],s=[];typeof t=="string"?(n=[t],s=[r??(c=>c)]):(n=le(t),s=r??n.map(()=>c=>c));let i=n.map((c,l)=>[c,s[l]]),a={},o=[];return this._currentDimension=i,new Proxy(this,{get(c,l,f){return l==="dimension"?c.dimension.bind(c):l==="_currentDimension"?i:l==="_scopeMode"?!0:l==="_sharedVar"?Object.keys(a).length?new Proxy({...c._sharedVar,scaleX:void 0,scaleY:void 0,...a},{set:(d,m,x)=>(a[m]=x,!0)}):new Proxy(c._sharedVar,{set:(d,m,x)=>(a[m]=x,!0)}):l==="_layerInstances"?o.length?o:c._layerInstances:c[l]instanceof Function?c[l].bind(f):c[l]},set(c,l,f){return l==="_layerInstances"?(o=f,!0):(c[l]=f,!0)}})}filter(t,r){if(r&&r.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(r.layer))return this;let n=r?.layer||this._layerInstances[0];return this._currentDimension.length===0&&t instanceof Array&&t.length>0?(this._sharedVar.attrName&&(this._userOptions.query.attrName=this._sharedVar.attrName),this._userOptions.query.attrName&&this.dimension(this._userOptions.query.attrName).filter(t)):this._currentDimension.length===1&&t instanceof Array&&t.length>0&&!(t[0]instanceof Array)?(this._selectionMapping.set(this._currentDimension[0][0],this._currentDimension[0][1](t).sort((s,i)=>typeof s=="number"?s-i:s<i?-1:s==i?0:1)),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})):this._currentDimension.length===t.length&&t.every(s=>s instanceof Array)&&(this._currentDimension.forEach((s,i)=>{this._selectionMapping.set(s[0],s[1](t[i]).sort((a,o)=>typeof a=="number"?a-o:a<o?-1:a==o?0:1))}),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})),this}get extents(){return Object.fromEntries(this._selectionMapping.entries())}};X.SelectionService=_e;X.register("SelectionService",{constructor:_e});X.register("SurfacePointSelectionService",{constructor:_e,query:{baseOn:re.Shape,type:Z.SurfacePoint,x:0,y:0}});X.register("PointSelectionService",{constructor:_e,query:{baseOn:re.Shape,type:Z.Point,x:0,y:0}});X.register("RectSelectionService",{constructor:_e,query:{baseOn:re.Shape,type:Z.Rect,x:0,y:0,width:1,height:1}});X.register("CircleSelectionService",{constructor:_e,query:{baseOn:re.Shape,type:Z.Circle,x:0,y:0,r:1}});X.register("PolygonSelectionService",{constructor:_e,query:{baseOn:re.Shape,type:Z.Polygon,points:[]}});X.register("QuantitativeSelectionService",{constructor:_e,transformers:[B.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:re.Data,type:We.Quantitative,attrName:"",extent:[0,0]}})});var fn,gu=h(()=>{Mt();fn=class extends X{constructor(t,r){super(t,{...r,resultAlias:r.resultAlias??"layoutResult"})}isInstanceOf(t){return t==="LayoutService"||this._baseName===t||this._name===t}};X.LayoutService=fn;X.register("LayoutService",{constructor:fn})});var hn,xu=h(()=>{Mt();hn=class extends X{constructor(t,r){super(t,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(t){return t==="AnalysisService"||this._baseName===t||this._name===t}};X.AnalysisService=hn;X.register("AnalysisService",{constructor:hn})});var yu,Ns,H,ur=h(()=>{Mt();Mt();Fs();gu();xu();yu=mu,Ns=un,H=X});var vu,_u=h(()=>{vu=`#JSGF V1.0;

grammar actions;

public <action> = start | stop | pause | resume | play | delete | add | insert | create | remove | drag | move | drag | brush;`});function Qp(e){let t=e.events.map(r=>qs(r)[0]);return{...e,eventStreams:t.map(r=>Wp(r))}}function Wp(e){return e.filter?{...e,filterFuncs:e.filter?e.filter.map(t=>new Function("event",`return ${t}`)):[]}:{...e}}var wu,Bp,Hp,Us,dn,U,WS,ZS,KS,JS,pn=h(()=>{Se();_u();Bp=window.SpeechRecognition||window.webkitSpeechRecognition,Hp=window.SpeechGrammarList||window.webkitSpeechGrammarList,Us={},dn=[],U=class{constructor(t,r){this[wu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._state=r.state,this._actions=le(r.actions??[]).map(Qp),this._modalities={},this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUse=r.preUse??null,this._postUse=r.postUse??null,r.postInitialize&&r.postInitialize.call(this,this)}enableModality(t){switch(t){case"speech":if(this._modalities.speech)break;let r=new Bp;this._modalities.speech=r;let n=new Hp;n.addFromString(vu),r.grammars=n,r.lang="en-US";break}}disableModality(t){switch(t){case"speech":this._modalities.speech&&(this._modalities.speech.onresult=null,this._modalities.speech.onend=null,this._modalities.speech.abort(),this._modalities.speech=null);break}}getActions(){return this._actions.slice(0)}setActions(t){let r=t.concat(this._actions);this._actions=r.filter((n,s)=>s===r.findIndex(i=>i.action===n.action))}_parseEvent(t){let r=n=>"stream"in n?n.between.concat(n.stream).flatMap(r):"between"in n?n.between.concat([{type:n.type}]).flatMap(r):n.type;return qs(t).flatMap(r)}getAcceptEvents(){return[...new Set(this._actions.flatMap(t=>t.eventStreams.flatMap(r=>r.type)).concat(["contextmenu"]))]}async dispatch(t,r){let n=this._actions.find(s=>{let i=s.eventStreams.map(o=>o.type),a=!1;return i.includes("*")&&(a=!0),t instanceof Event?a=s.eventStreams.filter(o=>o.type===t.type).some(o=>o.filterFuncs?o.filterFuncs.every(c=>c(t)):!0):i.includes(t)&&(a=!0),a&&(!s.transition||s.transition.find(o=>o[0]===this._state||o[0]==="*"))});if(n){t instanceof Event&&(t.preventDefault(),t.stopPropagation());let s=n.transition&&n.transition.find(i=>i[0]===this._state||i[0]==="*");if(s){if(this._state=s[1],this._state.startsWith("speech:")){this.enableModality("speech");try{this._modalities.speech.start()}catch{}this._modalities.speech.onresult=i=>{let a=i.results[i.resultIndex][0];this.dispatch(a.transcript,r)},this._modalities.speech.onend=i=>{this._modalities.speech.start()}}else this.disableModality("speech");if(n.sideEffect)try{await n.sideEffect({self:this,layer:r,instrument:null,interactor:this,event:t})}catch(i){console.error(i)}return!0}}return!1}preUse(t){this._preUse&&this._preUse.call(this,this,t)}postUse(t){this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return this._baseName===t||this._name===t}static register(t,r){Us[t]=r}static unregister(t){return delete Us[t],!0}static initialize(t,r){let n=Object.assign({constructor:U},Us[t]??{},r??{}),s=new n.constructor(t,n);return dn.push(s),s}static findInteractor(t){return dn.filter(r=>r.isInstanceOf(t))}};wu=me;WS=U.register,ZS=U.unregister,KS=U.initialize,JS=U.findInteractor});var Su=h(()=>{pn();U.register("MousePositionInteractor",{constructor:U,state:"start",actions:[{action:"hover",events:["mousemove"],transition:[["start","start"]]}]});U.register("TouchPositionInteractor",{constructor:U,state:"start",actions:[{action:"enter",events:["touchstart"],transition:[["start","running"]]},{action:"hover",events:["touchmove"],transition:[["running","running"]]},{action:"leave",events:["touchend"],transition:[["running","start"],["start","start"]]}]});U.register("MouseTraceInteractor",{constructor:U,state:"start",actions:[{action:"dragstart",events:["mousedown"],transition:[["start","drag"]]},{action:"drag",events:["mousemove"],transition:[["drag","drag"]]},{action:"dragend",events:["mouseup[event.button==0]"],transition:[["drag","start"]]},{action:"dragabort",events:["mouseup[event.button==2]"],transition:[["drag","start"],["start","start"]]}]});U.register("TouchTraceInteractor",{constructor:U,state:"start",actions:[{action:"dragstart",events:["touchstart"],transition:[["start","drag"]]},{action:"drag",events:["touchmove"],transition:[["drag","drag"]]},{action:"dragend",events:["touchend"],transition:[["drag","start"]]}]});U.register("SpeechControlInteractor",{constructor:U,state:"start",actions:[{action:"enableSpeech",events:["click"],transition:[["*","speech:ready"]]},{action:"disableSpeech",events:["mouseup[event.button==2]"],transition:[["*","start"]]},{action:"speech",events:["*"],transition:[["*","speech:ready"]]}]});U.register("KeyboardPositionInteractor",{constructor:U,state:"start",actions:[{action:"begin",events:["keydown[event.key===' ']"],transition:[["start","running"]]},{action:"up",events:["keypress[event.key==='w' || event.key==='W']","keydown[event.key==='ArrowUp']{100}"],transition:[["running","running"]]},{action:"left",events:["keypress[event.key==='a' || event.key==='A']","keydown[event.key==='ArrowLeft']{100}"],transition:[["running","running"]]},{action:"down",events:["keypress[event.key==='s' || event.key==='S']","keydown[event.key==='ArrowDown']{100}"],transition:[["running","running"]]},{action:"right",events:["keypress[event.key==='d' || event.key==='D']","keydown[event.key==='ArrowRight']{100}"],transition:[["running","running"]]}]});U.register("MouseWheelInteractor",{constructor:U,state:"start",actions:[{action:"enter",events:["mouseenter"],transition:[["start","running"]]},{action:"wheel",events:["wheel","mousewheel"],transition:[["running","running"]]},{action:"leave",events:["mouseleave"],transition:[["running","start"],["start","start"]]},{action:"abort",events:["mouseup[event.button==2]"],transition:[["running","running"],["start","start"]]}]})});var i1,o1,c1,Gs,Pe,fr=h(()=>{pn();pn();Su();i1=U.register,o1=U.initialize,c1=U.findInteractor,Gs=dn,Pe=U});function Tu(e,t){ju[e]=t}function Au(e,t){let r=Object.assign({constructor:ee},ju[e]??{},t??{},{});return new r.constructor(e,r)}function Eu(e){return Vu.filter(t=>t.isInstanceOf(e))}var bu,ju,Vu,It,Ze,ee,hr=h(()=>{Se();ju={},Vu=[],It=new Map,Ze=new Map,ee=class{constructor(t,r){this._nextTick=0,this[bu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._container=r.container,this._order=0,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._postUpdate=r.postUpdate??null,Vu.push(this),this._postInitialize&&this._postInitialize.call(this,this)}getGraphic(){return this._graphic}getContainerGraphic(){return this._container}getVisualElements(){return[]}cloneVisualElements(t,r=!1){let n=t.cloneNode(r);return document.createDocumentFragment().append(n),n}join(t,r){return[]}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}picking(t){return[]}getLayerFromQueue(t){It.has(this)||It.set(this,{[this._name]:this}),Ze.has(this)||Ze.set(this,{[this._name]:0});let r=It.get(this);if(!(t in r)){let n=ee.initialize(this._baseName,{...this._userOptions,name:t,group:"",redraw(){}});r[t]=n,It.set(n,r);let s=r[t].getGraphic();s&&s.style&&(s.style.pointerEvents="none")}return t in Ze.get(this)||(Ze.get(this)[t]=0),r[t]}setLayersOrder(t){It.has(this)||It.set(this,{[this._name]:this}),Ze.has(this)||Ze.set(this,{[this._name]:0});let r=Ze.get(this),n=document.createDocumentFragment();Object.entries(t).forEach(([s,i])=>{r[s]=i}),Object.entries(r).sort((s,i)=>s[1]-i[1]).forEach(([s,i])=>{if(r[s]=i,Ze.set(this.getLayerFromQueue(s),r),i>=0){let a=this.getLayerFromQueue(s).getGraphic(!0);a&&a.style&&(a.style.display="initial")}else{let a=this.getLayerFromQueue(s).getGraphic(!0);a&&a.style&&(a.style.display="none")}this.getLayerFromQueue(s)._order=i,n.append(this.getLayerFromQueue(s).getGraphic(!0))}),this.getContainerGraphic().appendChild(n)}isInstanceOf(t){return this._baseName===t||this._name===t}};bu=me;ee.register=Tu;ee.initialize=Au;ee.findLayer=Eu});var Mu,mn,dr,Iu=h(()=>{hr();lr();Se();Mu="D3Layer",mn="ig-layer-background",dr=class extends ee{constructor(t,r){super(t,r);this._width=r.width,this._height=r.height,this._offset=r.offset,this._name=r.name,this._graphic=J(r.container).append("g").call(s=>{this._name&&s.attr("className",this._name)}).call(s=>{this._offset&&s.attr("transform",`translate(${this._offset.x||0}, ${this._offset.y||0})`)}).node(),J(this._graphic).append("rect").attr("class",mn).attr("width",this._width).attr("height",this._height).attr("opacity",0);let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${mn})`)]}cloneVisualElements(t,r=!1){let n=J(t).clone(r).node();return document.createDocumentFragment().append(n),n}select(t){return this._graphic.querySelectorAll(t)}picking(t){return t.baseOn===re.Shape?this._shapeQuery(t):t.baseOn===re.Data?this._dataQuery(t):t.baseOn===re.Attr?this._attrQuery(t):[]}_isElementInLayer(t){return this._graphic.contains(t)&&!t.classList.contains(mn)}_shapeQuery(t){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(t.type===Z.SurfacePoint){let{x:a,y:o}=t;if(!isFinite(a)||!isFinite(o))return[];r=[...document.elementsFromPoint(a,o)].filter(this._isElementInLayer.bind(this)),r.length>=1&&(r=[r[0]])}else if(t.type===Z.Point){let{x:a,y:o}=t;if(!isFinite(a)||!isFinite(o))return[];r=document.elementsFromPoint(a,o).filter(this._isElementInLayer.bind(this))}else if(t.type===Z.Circle){let a=t.x-n.left,o=t.y-n.top,c=t.r,l=Math.floor(c*Math.sin(Math.PI/4))<<1,f=a-(l>>>1),d=o-(l>>>1),m=new Set,x=this._svg.createSVGRect();x.x=f,x.y=d,x.width=l,x.height=l,this._svg.getIntersectionList(x,this._graphic).forEach(L=>m.add(L));let b=c,y=a-c,_=o-c,j=new Set,O=this._svg.createSVGRect();O.x=y,O.y=_,O.width=b*2,O.height=b*2,this._svg.getIntersectionList(O,this._graphic).forEach(L=>j.add(L));let A=1;for(;;){for(let Me of j)m.has(Me)&&j.delete(Me);if(!j.size||A*2+l>=c*2)break;let L=Math.sqrt(c*c-Math.pow(l/2+A,2)),Y=this._svg.createSVGRect();Y.x=a-L,Y.y=d-A,Y.width=L*2,Y.height=1;let Q=this._svg.createSVGRect();Q.x=a-L,Q.y=d+l+A-1,Q.width=L*2,Q.height=1;let we=this._svg.createSVGRect();we.x=f-A,we.y=o-L,we.width=1,we.height=L*2;let ue=this._svg.createSVGRect();ue.x=f+l+A-1,ue.y=o-L,ue.width=1,ue.height=L*2,[Y,Q,we,ue].forEach(Me=>{this._svg.getIntersectionList(Me,this._graphic).forEach(ze=>m.add(ze))}),A++}r=[...m].filter(this._isElementInLayer.bind(this))}else if(t.type===Z.Rect){let{x:a,y:o,width:c,height:l}=t,f=Math.min(a,a+c)-n.left,d=Math.min(o,o+l)-n.top,m=Math.abs(c),x=Math.abs(l),b=this._svg.createSVGRect();b.x=f,b.y=d,b.width=m,b.height=x,r=[...this._svg.getIntersectionList(b,this._graphic)].filter(y=>!y.classList.contains(mn))}else t.type===Z.Polygon;let i=[];for(;r.length>0;){let a=r.shift();i.push(a),a.parentElement.tagName==="g"&&this._graphic.contains(a.parentElement)&&this._graphic!==a.parentElement&&r.push(a.parentElement)}return i}_dataQuery(t){let r=[],n=Pt(this.getVisualElements());if(t.type===We.Quantitative){let{attrName:s,extent:i}=t;if(s instanceof Array){let a=n;s.forEach((o,c)=>{let l=i[c];a=a.filter(f=>f&&f[o]!==void 0&&l[0]<f[o]&&f[o]<l[1])}),r=a.nodes()}else r=n.filter(a=>a&&a[s]!==void 0&&i[0]<a[s]&&a[s]<i[1]).nodes()}else if(t.type===We.Nominal){let{attrName:s,extent:i}=t;if(s instanceof Array){let a=n;s.forEach((o,c)=>{let l=i[c];a=a.filter(f=>f&&f[o]!==void 0&&l.findIndex(f[o])>=0)}),r=a.nodes()}else r=n.filter(a=>a&&a[s]!==void 0&&i.findIndex(a[s])>=0).nodes()}else if(t.type===We.Temporal){let{attrName:s,extent:i}=t;if(s instanceof Array){let a=n;s.forEach((o,c)=>{let l=i[c],f=t.dateParser?.[c]??(d=>d);a=a.filter(d=>d&&d[o]!==void 0&&l[0].getTime()<f(d[o]).getTime()&&f(d[o]).getTime()<l[1].getTime())}),r=a.nodes()}else{let a=t.dateParser||(o=>o);r=n.filter(o=>o&&o[s]!==void 0&&i[0].getTime()<a(o[s]).getTime()&&a(o[s]).getTime()<i[1].getTime()).nodes()}}return r}_attrQuery(t){let{attrName:r,value:n}=t;return J(this._graphic).filter(i=>i[r]===n).nodes()}};ee.D3Layer=dr;ee.register(Mu,{constructor:dr});ee.register(Mu,{constructor:dr})});var $s=h(()=>{});function Cu(e){return{a:parseFloat(e.a),b:parseFloat(e.b),c:parseFloat(e.c),d:parseFloat(e.d),e:parseFloat(e.e),f:parseFloat(e.f)}}var Bs=h(()=>{});var Ru=h(()=>{});var ku=h(()=>{});var Hs=h(()=>{});function dt(e){return typeof e=="undefined"}var gn=h(()=>{});var Ou=h(()=>{gn()});function De(e,t=0){return{a:1,c:0,e,b:0,d:1,f:t}}var Ct=h(()=>{});function pt(...e){e=Array.isArray(e[0])?e[0]:e;let t=(r,n)=>({a:r.a*n.a+r.c*n.b,c:r.a*n.c+r.c*n.d,e:r.a*n.e+r.c*n.f+r.e,b:r.b*n.a+r.d*n.b,d:r.b*n.c+r.d*n.d,f:r.b*n.e+r.d*n.f+r.f});switch(e.length){case 0:throw new Error("no matrices provided");case 1:return e[0];case 2:return t(e[0],e[1]);default:{let[r,n,...s]=e,i=t(r,n);return pt(i,...s)}}}function xn(...e){return pt(...e)}var mt=h(()=>{});function Du(e,t,r){let n=Zp(e),s=Kp(e),i={a:n,c:-s,e:0,b:s,d:n,f:0};return dt(t)||dt(r)?i:pt([De(t,r),i,De(-t,-r)])}function Qs(e,t=void 0,r=void 0){return Du(e*Jp/180,t,r)}var Zp,Kp,Jp,yn=h(()=>{gn();Ct();mt();({cos:Zp,sin:Kp,PI:Jp}=Math)});function pr(e,t=void 0,r=void 0,n=void 0){dt(t)&&(t=e);let s={a:e,c:0,e:0,b:0,d:t,f:0};return dt(r)||dt(n)?s:pt([De(r,n),s,De(-r,-n)])}var mr=h(()=>{gn();Ct();mt()});function Yu(e,t){return{a:1,c:e,e:0,b:t,d:1,f:0}}var Ws=h(()=>{});function em(e,t){return{a:1,c:Lu(e),e:0,b:Lu(t),d:1,f:0}}function Zs(e,t){return em(e*Math.PI/180,t*Math.PI/180)}var Lu,Ks=h(()=>{({tan:Lu}=Math)});var Xu=h(()=>{});var Js=h(()=>{});var Pu=h(()=>{Hs();mt();Js()});function zu(e){return Array.isArray(e)?e.map(t):t(e);function t(r){switch(r.type){case"matrix":if("a"in r&&"b"in r&&"c"in r&&"d"in r&&"e"in r&&"f"in r)return Cu(r);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in r?De(r.tx,r.ty):De(r.tx);case"scale":if(!("sx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in r?pr(r.sx,r.sy):pr(r.sx);case"rotate":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in r&&"cy"in r?Qs(r.angle,r.cx,r.cy):Qs(r.angle);case"skewX":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return Zs(r.angle,0);case"skewY":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return Zs(0,r.angle);case"shear":if(!("shx"in r&&"shy"in r))throw new Error("MISSING_MANDATORY_PARAM");return Yu(r.shx,r.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR")}}}var Fu=h(()=>{Bs();Ct();mr();yn();Ks();Ws()});function tm(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function gt(e,t,r,n){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,gt.prototype),s.expected=t,s.found=r,s.location=n,s.name="SyntaxError",s}function ea(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,r+=r.repeat(t),e+r.slice(0,t))}function Nu(e,t){t=t!==void 0?t:{};var r={},n=t.grammarSource,s={transformList:da},i=da,a="matrix",o="(",c=")",l="translate",f="scale",d="rotate",m="skewX",x="skewY",b=",",y=".",_=/^[eE]/,j=/^[+\-]/,O=/^[0-9]/,A=/^[ \t\r\n]/,L=Ce("matrix",!1),Y=Ce("(",!1),Q=Ce(")",!1),we=Ce("translate",!1),ue=Ce("scale",!1),Me=Ce("rotate",!1),ze=Ce("skewX",!1),C=Ce("skewY",!1),Ve=Ce(",",!1),ae=ua("fractionalConstant"),Te=Ce(".",!1),yt=Vr(["e","E"],!1,!1),Fe=Vr(["+","-"],!1,!1),Ne=Vr([["0","9"]],!1,!1),Ue=Vr([" ","	","\r",`
`],!1,!1),ye=function(u){return u},En=function(u,p){return u.concat(p)},Mn=function(u,p,v,S,R,T){return[{type:"matrix",a:u,b:p,c:v,d:S,e:R,f:T}]},In=function(u,p){var v={type:"translate",tx:u};return p&&(v.ty=p),[v]},Cn=function(u,p){var v={type:"scale",sx:u};return p&&(v.sy=p),[v]},Rn=function(u,p){var v={type:"rotate",angle:u};return p&&(v.cx=p[0],v.cy=p[1]),[v]},kn=function(u){return[{type:"skewX",angle:u}]},On=function(u){return[{type:"skewY",angle:u}]},Dn=function(u){return parseFloat(u.join(""))},Yn=function(u){return parseInt(u.join(""))},V=function(u){return u},I=function(u,p){return[u,p]},k=function(u){return u.join("")},w=function(u,p){return[u,p||null].join("")},ie=function(u,p){return[u,p].join("")},P=function(u,p){return[u?u.join(""):null,".",p.join("")].join("")},fe=function(u){return u.join("")},he=function(u,p){return["e",u,p.join("")].join("")},g=0,z=0,br=[{line:1,column:1}],Ie=0,Ln=[],F=0,jr;if("startRule"in t){if(!(t.startRule in s))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');i=s[t.startRule]}function wm(){return e.substring(z,g)}function Sm(){return z}function bm(){return{source:n,start:z,end:g}}function jm(){return Rt(z,g)}function Vm(u,p){throw p=p!==void 0?p:Rt(z,g),ha([ua(u)],e.substring(z,g),p)}function Tm(u,p){throw p=p!==void 0?p:Rt(z,g),uf(u,p)}function Ce(u,p){return{type:"literal",text:u,ignoreCase:p}}function Vr(u,p,v){return{type:"class",parts:u,inverted:p,ignoreCase:v}}function Am(){return{type:"any"}}function lf(){return{type:"end"}}function ua(u){return{type:"other",description:u}}function fa(u){var p=br[u],v;if(p)return p;for(v=u-1;!br[v];)v--;for(p=br[v],p={line:p.line,column:p.column};v<u;)e.charCodeAt(v)===10?(p.line++,p.column=1):p.column++,v++;return br[u]=p,p}function Rt(u,p,v){var S=fa(u),R=fa(p),T={source:n,start:{offset:u,line:S.line,column:S.column},end:{offset:p,line:R.line,column:R.column}};return v&&n&&typeof n.offset=="function"&&(T.start=n.offset(T.start),T.end=n.offset(T.end)),T}function q(u){g<Ie||(g>Ie&&(Ie=g,Ln=[]),Ln.push(u))}function uf(u,p){return new gt(u,null,null,p)}function ha(u,p,v){return new gt(gt.buildMessage(u,p),u,p,v)}function da(){var u,p,v,S,R;for(u=g,p=[],v=E();v!==r;)p.push(v),v=E();for(v=pa(),v===r&&(v=null),S=[],R=E();R!==r;)S.push(R),R=E();return z=u,u=ye(v),u}function pa(){var u,p,v,S;if(u=g,p=ma(),p!==r){if(v=[],S=Re(),S!==r)for(;S!==r;)v.push(S),S=Re();else v=r;v!==r?(S=pa(),S!==r?(z=u,u=En(p,S)):(g=u,u=r)):(g=u,u=r)}else g=u,u=r;return u===r&&(u=ma()),u}function ma(){var u;return u=ff(),u===r&&(u=hf(),u===r&&(u=df(),u===r&&(u=pf(),u===r&&(u=mf(),u===r&&(u=gf()))))),u}function ff(){var u,p,v,S,R,T,W,N,G,Pn,_a,zn,wa,Fn,Sa,Nn,ba,et;if(u=g,e.substr(g,6)===a?(p=a,g+=6):(p=r,F===0&&q(L)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r)if(W=Re(),W!==r)if(N=pe(),N!==r)if(G=Re(),G!==r)if(Pn=pe(),Pn!==r)if(_a=Re(),_a!==r)if(zn=pe(),zn!==r)if(wa=Re(),wa!==r)if(Fn=pe(),Fn!==r)if(Sa=Re(),Sa!==r)if(Nn=pe(),Nn!==r){for(ba=[],et=E();et!==r;)ba.push(et),et=E();e.charCodeAt(g)===41?(et=c,g++):(et=r,F===0&&q(Q)),et!==r?(z=u,u=Mn(T,N,Pn,zn,Fn,Nn)):(g=u,u=r)}else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r;else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function hf(){var u,p,v,S,R,T,W,N,G;if(u=g,e.substr(g,9)===l?(p=l,g+=9):(p=r,F===0&&q(we)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r){for(W=ga(),W===r&&(W=null),N=[],G=E();G!==r;)N.push(G),G=E();e.charCodeAt(g)===41?(G=c,g++):(G=r,F===0&&q(Q)),G!==r?(z=u,u=In(T,W)):(g=u,u=r)}else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function df(){var u,p,v,S,R,T,W,N,G;if(u=g,e.substr(g,5)===f?(p=f,g+=5):(p=r,F===0&&q(ue)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r){for(W=ga(),W===r&&(W=null),N=[],G=E();G!==r;)N.push(G),G=E();e.charCodeAt(g)===41?(G=c,g++):(G=r,F===0&&q(Q)),G!==r?(z=u,u=Cn(T,W)):(g=u,u=r)}else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function pf(){var u,p,v,S,R,T,W,N,G;if(u=g,e.substr(g,6)===d?(p=d,g+=6):(p=r,F===0&&q(Me)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r){for(W=xf(),W===r&&(W=null),N=[],G=E();G!==r;)N.push(G),G=E();e.charCodeAt(g)===41?(G=c,g++):(G=r,F===0&&q(Q)),G!==r?(z=u,u=Rn(T,W)):(g=u,u=r)}else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function mf(){var u,p,v,S,R,T,W,N;if(u=g,e.substr(g,5)===m?(p=m,g+=5):(p=r,F===0&&q(ze)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r){for(W=[],N=E();N!==r;)W.push(N),N=E();e.charCodeAt(g)===41?(N=c,g++):(N=r,F===0&&q(Q)),N!==r?(z=u,u=kn(T)):(g=u,u=r)}else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function gf(){var u,p,v,S,R,T,W,N;if(u=g,e.substr(g,5)===x?(p=x,g+=5):(p=r,F===0&&q(C)),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();if(e.charCodeAt(g)===40?(S=o,g++):(S=r,F===0&&q(Y)),S!==r){for(R=[],T=E();T!==r;)R.push(T),T=E();if(T=pe(),T!==r){for(W=[],N=E();N!==r;)W.push(N),N=E();e.charCodeAt(g)===41?(N=c,g++):(N=r,F===0&&q(Q)),N!==r?(z=u,u=On(T)):(g=u,u=r)}else g=u,u=r}else g=u,u=r}else g=u,u=r;return u}function pe(){var u,p,v,S;return u=g,p=g,v=Xn(),v===r&&(v=null),S=vf(),S!==r?(v=[v,S],p=v):(g=p,p=r),p!==r&&(z=u,p=Dn(p)),u=p,u===r&&(u=g,p=g,v=Xn(),v===r&&(v=null),S=yf(),S!==r?(v=[v,S],p=v):(g=p,p=r),p!==r&&(z=u,p=Yn(p)),u=p),u}function ga(){var u,p,v;return u=g,p=Re(),p!==r?(v=pe(),v!==r?(z=u,u=V(v)):(g=u,u=r)):(g=u,u=r),u}function xf(){var u,p,v,S,R;return u=g,p=Re(),p!==r?(v=pe(),v!==r?(S=Re(),S!==r?(R=pe(),R!==r?(z=u,u=I(v,R)):(g=u,u=r)):(g=u,u=r)):(g=u,u=r)):(g=u,u=r),u}function Re(){var u,p,v,S,R;if(u=g,p=[],v=E(),v!==r)for(;v!==r;)p.push(v),v=E();else p=r;if(p!==r){for(v=xa(),v===r&&(v=null),S=[],R=E();R!==r;)S.push(R),R=E();p=[p,v,S],u=p}else g=u,u=r;if(u===r)if(u=g,p=xa(),p!==r){for(v=[],S=E();S!==r;)v.push(S),S=E();p=[p,v],u=p}else g=u,u=r;return u}function xa(){var u;return e.charCodeAt(g)===44?(u=b,g++):(u=r,F===0&&q(Ve)),u}function yf(){var u,p;return u=g,p=vt(),p!==r&&(z=u,p=k(p)),u=p,u}function vf(){var u,p,v;return u=g,p=_f(),p!==r?(v=ya(),v===r&&(v=null),z=u,u=w(p,v)):(g=u,u=r),u===r&&(u=g,p=vt(),p!==r?(v=ya(),v!==r?(z=u,u=ie(p,v)):(g=u,u=r)):(g=u,u=r)),u}function _f(){var u,p,v,S;return F++,u=g,p=vt(),p===r&&(p=null),e.charCodeAt(g)===46?(v=y,g++):(v=r,F===0&&q(Te)),v!==r?(S=vt(),S!==r?(z=u,u=P(p,S)):(g=u,u=r)):(g=u,u=r),u===r&&(u=g,p=vt(),p!==r?(e.charCodeAt(g)===46?(v=y,g++):(v=r,F===0&&q(Te)),v!==r?(z=u,u=fe(p)):(g=u,u=r)):(g=u,u=r)),F--,u===r&&(p=r,F===0&&q(ae)),u}function ya(){var u,p,v,S;return u=g,_.test(e.charAt(g))?(p=e.charAt(g),g++):(p=r,F===0&&q(yt)),p!==r?(v=Xn(),v===r&&(v=null),S=vt(),S!==r?(z=u,u=he(v,S)):(g=u,u=r)):(g=u,u=r),u}function Xn(){var u;return j.test(e.charAt(g))?(u=e.charAt(g),g++):(u=r,F===0&&q(Fe)),u}function vt(){var u,p;if(u=[],p=va(),p!==r)for(;p!==r;)u.push(p),p=va();else u=r;return u}function va(){var u;return O.test(e.charAt(g))?(u=e.charAt(g),g++):(u=r,F===0&&q(Ne)),u}function E(){var u;return A.test(e.charAt(g))?(u=e.charAt(g),g++):(u=r,F===0&&q(Ue)),u}if(jr=i(),jr!==r&&g===e.length)return jr;throw jr!==r&&g<e.length&&q(lf()),ha(Ln,Ie<e.length?e.charAt(Ie):null,Ie<e.length?Rt(Ie,Ie+1):Rt(Ie,Ie))}var Uu=h(()=>{tm(gt,Error);gt.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){r=e[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,i=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,a=this.location.source+":"+i.line+":"+i.column;if(r){var o=this.location.end,c=ea("",i.line.toString().length," "),l=r[s.line-1],f=s.line===o.line?o.column:l.length+1,d=f-s.column||1;t+=`
 --> `+a+`
`+c+` |
`+i.line+" | "+l+`
`+c+" | "+ea("",s.column-1," ")+ea("",d,"^")}else t+=`
 at `+a}return t};gt.buildMessage=function(e,t){var r={literal:function(l){return'"'+s(l.text)+'"'},class:function(l){var f=l.parts.map(function(d){return Array.isArray(d)?i(d[0])+"-"+i(d[1]):i(d)});return"["+(l.inverted?"^":"")+f.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function s(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function i(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+n(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+n(f)})}function a(l){return r[l.type](l)}function o(l){var f=l.map(a),d,m;if(f.sort(),f.length>0){for(d=1,m=1;d<f.length;d++)f[d-1]!==f[d]&&(f[m]=f[d],m++);f.length=m}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function c(l){return l?'"'+s(l)+'"':"end of input"}return"Expected "+o(e)+" but "+c(t)+" found."}});function qu(e){return Nu(e)}var Gu=h(()=>{Uu()});var $u=h(()=>{mr();mt()});var Bu=h(()=>{});var Hu=h(()=>{Ct();$s();yn();mr();mt()});var Qu=h(()=>{$s();Bs();Ru();ku();Hs();Ou();yn();mr();Ws();Ks();Xu();mt();Ct();Pu();Js();Fu();Gu();$u();Bu();Hu()});var Wu,ta,gr,Zu=h(()=>{hr();lr();Se();Qu();Wu="VegaLayer",ta="background",gr=class extends ee{constructor(t,r){super(t,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`.${r.group}`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let t="translate(0, 0)";if([...this._container.children].includes(this._graphic))t=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(t+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=xn(zu(qu(t??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${ta})`)]}getGraphic(t=!1){return this._userOptions.group?t?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}cloneVisualElements(t,r=!1){let n=J(t).clone(r).node(),s=n.parentElement,i=n.getAttribute("transform");for(;s&&s!=this._container;)s.getAttribute("transform")&&(i+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",i),document.createDocumentFragment().append(n),n}select(t){return this._graphic.querySelectorAll(t)}picking(t){return t.baseOn===re.Shape?this._shapeQuery(t):t.baseOn===re.Data?this._dataQuery(t):t.baseOn===re.Attr?this._attrQuery(t):[]}_isElementInLayer(t){return this._graphic.contains(t)&&!t.classList.contains(ta)}_shapeQuery(t){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(t.type===Z.SurfacePoint){let{x:a,y:o}=t;if(!isFinite(a)||!isFinite(o))return[];r=[...document.elementsFromPoint(a,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=a&&l.left<=a&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(t.type===Z.Point){let{x:a,y:o}=t;if(!isFinite(a)||!isFinite(o))return[];r=document.elementsFromPoint(a,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=a&&l.left<=a&&l.bottom>=o&&l.top<=o})}else if(t.type===Z.Circle){let a=t.x,o=t.y,c=t.x-n.left,l=t.y-n.top,f=t.r,d=f,m=c-f,x=l-f,b=new Set,y=this._svg.createSVGRect();y.x=m,y.y=x,y.width=d*2,y.height=d*2,this._svg.getIntersectionList(y,this._graphic).forEach(_=>b.add(_)),r=[...b].filter(_=>{if(!this._isElementInLayer(_))return!1;let j=_.getBoundingClientRect(),O=Math.abs(a-j.left),A=Math.abs(o-j.top);return O>j.width/2+f||A>j.height/2+f?!1:O<=j.width/2||A<=j.height/2?!0:Math.pow(O-j.width/2,2)+Math.pow(A-j.height/2,2)<=f*f})}else if(t.type===Z.Rect){let{x:a,y:o,width:c,height:l}=t,f=Math.min(a,a+c)-n.left,d=Math.min(o,o+l)-n.top,m=Math.abs(c),x=Math.abs(l),b=this._svg.createSVGRect();b.x=f,b.y=d,b.width=m,b.height=x,r=[...this._svg.getIntersectionList(b,this._graphic)].filter(y=>{if(!this._isElementInLayer(y))return!1;let _=y.getBoundingClientRect();return!(_.right<f+n.left||_.left>f+m+n.left||_.bottom<d+n.top||_.top>d+x+n.top)})}else if(t.type===Z.Polygon){let{points:a}=t,o=Math.min(...a.map(m=>m.x))-n.left,c=Math.min(...a.map(m=>m.y))-n.top,l=Math.max(...a.map(m=>m.x))-n.left,f=Math.max(...a.map(m=>m.y))-n.top,d=this._svg.createSVGRect();d.x=o,d.y=c,d.width=l-o,d.height=f-c,r=[...this._svg.getIntersectionList(d,this._graphic)].filter(m=>{if(!this._isElementInLayer(m))return!1;let x=m.getBoundingClientRect();return!(x.right<o+n.left||x.left>l+n.left||x.bottom<c+n.top||x.top>f+n.top)})}let i=[];for(;r.length>0;){let a=r.shift();a.classList.contains(ta)||(i.push(a),a.parentElement.tagName==="g"&&this._graphic.contains(a.parentElement)&&this._graphic!==a.parentElement&&r.push(a.parentElement))}return i}_dataQuery(t){return[]}_attrQuery(t){let{attrName:r,value:n}=t;return[]}};ee.VegaLayer=gr;ee.register(Wu,{constructor:gr});ee.register(Wu,{constructor:gr})});var xt,vn=h(()=>{hr();hr();Iu();Zu();xt=ee});var Ku,Ke,xr,Ee,yr,ra,M,rm,Zb,nm,sm,_n=h(()=>{fr();Se();vr();vn();ur();ht();Fs();Ke={},xr=[],Ee=new Map,yr=[],ra=!1,M=class{constructor(t,r){this._transformers=[],this._linkCache={},this[Ku]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._baseName=t,this._userOptions=r,this._name=r.name??t,this._on=Object.assign({},r.on??{}),this._interactors=[],this._layers=[],this._layerInteractors=new Map,this._services=r.services??[],this._serviceInstances=[],this._sharedVar=r.sharedVar??{},this._transformers=r.transformers??[],r.interactors&&r.interactors.forEach(n=>{typeof n=="string"?this.useInteractor(Pe.initialize(n)):"options"in n?typeof n.interactor=="string"?this.useInteractor(Pe.initialize(n.interactor,n.options)):this.useInteractor(n.interactor,n.options):this.useInteractor(n)}),this._services.forEach(n=>{typeof n=="string"||!("options"in n)?this.useService(n):this.useService(n.service,n.options)}),r.layers&&r.layers.forEach(n=>{"options"in n?this.attach(n.layer,n.options):this.attach(n)}),r.postInitialize&&r.postInitialize.call(this,this)}emit(t,r){this._on[t]&&this._on[t].forEach(n=>{n instanceof Je?n.execute(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{})):n(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{}))})}on(t,r){return t instanceof Array?t.forEach(n=>{this._on[n]||(this._on[n]=[]),this._on[n].push(r)}):(this._on[t]||(this._on[t]=[]),this._on[t].push(r)),this}off(t,r){if(!!this._on[t])return this._on[t].includes(r)&&this._on[t].splice(this._on[t].indexOf(r),1),this}_use(t,r){t.preAttach(this),this._serviceInstances.push(t),t.postUse(this)}useService(t,r){typeof t!="string"&&this._serviceInstances.includes(t)||(arguments.length>=2?this._services.push({service:t,options:r}):this._services.push(t),typeof t=="string"?yu(t).forEach(s=>this._use(s,r)):this._use(t,r))}useInteractor(t,r){t.preUse(this),arguments.length>=2?this._interactors.push({interactor:t,options:r}):this._interactors.push(t),this._layers.forEach(n=>{let s;n instanceof xt?s=n:s=n.layer,this._layerInteractors.has(s)||this._layerInteractors.set(s,[]);let i=Pe.initialize(t._baseName,t._userOptions);this._layerInteractors.get(s).push(i),i.setActions(i.getActions().map(a=>({...a,sideEffect:async o=>{if(a.sideEffect&&a.sideEffect(o),this._on[a.action])for(let c of this._on[a.action])try{c instanceof Je?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),i.getAcceptEvents().forEach(a=>{Ee.has(s.getContainerGraphic())||Ee.set(s.getContainerGraphic(),new Map),Ee.get(s.getContainerGraphic()).has(a)||(s.getContainerGraphic().addEventListener(a,this._dispatch.bind(this,s,a)),Ee.get(s.getContainerGraphic()).set(a,[])),Ee.get(s.getContainerGraphic()).get(a).push([i,s,n instanceof xt?null:n.options,this])})}),t.postUse(this)}attach(t,r){this._layers.find(n=>n instanceof xt?n===t:n.layer===t)||(this.preAttach(t,r??null),arguments.length>=2?this._layers.push({layer:t,options:r}):this._layers.push(t),this.postUse(t))}getSharedVar(t,r){return!(t in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(t,r.defaultValue,r),this._sharedVar[t]}setSharedVar(t,r,n){this._sharedVar[t]=r,this._on[`update:${t}`]&&this._on[`update:${t}`].forEach(i=>{i instanceof Je?i.execute({self:this,layer:null,instrument:this,interactor:null}):i({self:this,layer:null,instrument:this,interactor:null})})}watchSharedVar(t,r){this.on(`update:${t}`,r)}preAttach(t,r){this._preAttach&&this._preAttach.call(this,this,t),this._interactors.forEach(n=>{let s;n instanceof Pe?s=n:s=n.interactor,this._layerInteractors.has(t)||this._layerInteractors.set(t,[]);let i=Pe.initialize(s._baseName,s._userOptions);this._layerInteractors.get(t).push(i),i.setActions(i.getActions().map(a=>({...a,sideEffect:async o=>{if(a.sideEffect&&a.sideEffect(o),this._on[a.action])for(let c of this._on[a.action])try{c instanceof Je?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),i.getAcceptEvents().forEach(a=>{Ee.has(t.getContainerGraphic())||Ee.set(t.getContainerGraphic(),new Map),Ee.get(t.getContainerGraphic()).has(a)||(t.getContainerGraphic().addEventListener(a,this._dispatch.bind(this,t,a)),Ee.get(t.getContainerGraphic()).set(a,[])),Ee.get(t.getContainerGraphic()).get(a).push([i,t,r,this])})})}async _dispatch(t,r,n){if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),ra){let a=yr.findIndex(o=>o.instrument===this&&o.layer===t&&o.eventType===r);a>=0&&yr.splice(a,1),yr.push({instrument:this,layer:t,eventType:r,event:n});return}ra=!0;let s=Ee.get(t.getContainerGraphic()).get(r).filter(([a,o])=>o._order>=0);s.sort((a,o)=>o[1]._order-a[1]._order);let i=!1;for(let[a,o,c,l]of s){if(n instanceof MouseEvent&&!(o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="backgroundlayer"||o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="bglayer"||c&&c.pointerEvents==="all")){if(!c||c.pointerEvents==="viewport"){let f=o;if(f._offset&&f._width&&f._height&&(n.offsetX<f._offset.x||n.offsetX>f._offset.x+f._width||n.offsetY<f._offset.y||n.offsetY>f._offset.y+f._height))continue}else if(o.picking({baseOn:re.Shape,type:Z.Point,x:n.clientX,y:n.clientY}).length<=0)continue}try{let f=await a.dispatch(n,o)}catch(f){console.error(f);break}}if(ra=!1,yr.length){let a=yr.shift();a.instrument._dispatch(a.layer,a.eventType,a.event)}}postUse(t){let r=t.getGraphic();r&&r.style&&(r.style.pointerEvents="auto"),this._postUse&&this._postUse.call(this,this,t)}isInstanceOf(t){return this._baseName===t||this._name===t}get services(){return ge(this._serviceInstances.slice(0),H,this.useService.bind(this),()=>{throw new Error("Do not support dynamic change service yet")},this)}get transformers(){return ge(this._transformers.slice(0),B,t=>this._transformers.push(t),t=>this._transformers.splice(this._transformers.indexOf(t),1),this)}static register(t,r){Ke[t]=r}static unregister(t){return delete Ke[t],!0}static initialize(t,r){let n=Object.assign({constructor:M},Ke[t]??{},r??{},{on:le(Object.assign({},(Ke[t]??{}).on??{},r?.on??{})),sharedVar:Object.assign({},(Ke[t]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(t,n);return xr.push(s),s}static findInstrument(t){return xr.filter(r=>r.isInstanceOf(t))}static build(t){if(!(t.inherit in Ke))throw new Error(`Instrument ${t.inherit} is not registered, please register it first`);let r=Object.assign({constructor:M},Ke[t.inherit],{sharedVar:Object.assign({},Ke[t.inherit].sharedVar??{},t.sharedVar??{})});t.layers&&(r.layers=t.layers);let n=new r.constructor(t.inherit,r);xr.push(n);let s=(a,o)=>{let c=a.services.find(f=>{f.isInstanceOf(o)});if(c)return[c,a];let l=a.transformers.find(f=>{f.isInstanceOf(o)});if(l)return[l,a];for(let f of a.services){let d=s(f,o);if(d)return d}},i=(a,o)=>{if(a.isInstanceOf(o))return a;let c=a.services.find(l=>{l.isInstanceOf(o)});if(c)return c;for(let l of a.services){let f=i(l,o);if(f)return f}};if(t.remove)for(let a of t.remove){let[o,c]=s(n,a.find);a.cascade?o instanceof H?c._services.splice(c._services.indexOf(o),1):c._transformers.splice(c._transformers.indexOf(o),1):o instanceof H?(c._services.splice(c._services.indexOf(o),1,...o._services),c._transformers.push(...o._transformers)):c._transformers.splice(c._transformers.indexOf(o),1)}if(t.override)for(let a of t.override){let[o,c]=s(n,a.find),l;if(a.comp.includes("Transformer")){let f;a.name&&B.findTransformer(a.name).length>0&&(f=B.findTransformer(a.name)[0]),f||(f=B.initialize(a.comp,{name:a.name,sharedVar:{...t.sharedVar||{},...a.sharedVar||{}}})),l=f}else if(a.comp.includes("Service")){let f;a.name&&H.findService(a.name).length>0&&(f=H.findService(a.name)[0]),f||(f=H.initialize(a.comp,{...a,services:[...a.services||[],...o instanceof H?o._services:[]],transformers:[...a.transformers||[],...o instanceof H?o._transformers:[]],sharedVar:{...t.sharedVar||{},...a.sharedVar||{}}})),a.dimension&&f.isInstanceOf("SelectionService")&&(f=f.dimension(a.dimension),a.layers&&(f._layerInstances=a.layers.slice(0)),a.sharedVar&&f.setSharedVars(a.sharedVar)),l=f}o instanceof H?c._services.splice(c._services.indexOf(o),1):c._transformers.splice(c._transformers.indexOf(o),1),a.comp.includes("Transformer")?c._transformers.push(l):c._services.push(l)}if(t.insert)for(let a of t.insert){let o=i(n,a.find),c=null,l=null;for(let f=a.flow.length-1;f>=0;f--){let d=a.flow[f];if(d instanceof Function){let m=[],x=null;for(let b=0;b<r.layers.length;b++){let y=r.layers[b],_=d(y,b);if(_.comp.includes("Transformer")){let j;_.name&&B.findTransformer(_.name).length>0&&(j=B.findTransformer(_.name)[0]),j||(j=B.initialize(_.comp,{name:_.name,sharedVar:{...t.sharedVar||{},..._.sharedVar||{}}})),m.push(j),x="Transformer"}else if(_.comp.includes("Service")){let j;_.name&&H.findService(_.name).length>0&&(j=H.findService(_.name)[0]),j||(j=H.initialize(_.comp,{..._,...c?l=="Transformer"?{transformers:c instanceof Array?c:[c]}:{services:c instanceof Array?c:[c]}:{},sharedVar:{...t.sharedVar||{},..._.sharedVar||{}}})),_.dimension&&j instanceof _e&&(j=j.dimension(_.dimension),_.layers&&(j._layerInstances=_.layers.slice(0)),_.sharedVar&&j.setSharedVars(_.sharedVar)),m.push(j),x="Service"}}c=m,l=x}else if(d instanceof Array){let m=[],x=null;for(let b=0;b<d.length;b++){let y=d[b];if(y instanceof B)m.push(y),x="Transformer";else if(y instanceof H)l=="Transformer"?y._transformers.push(...c instanceof Array?c:[c]):y._services.push(...c instanceof Array?c:[c]),m.push(y),x="Service";else if(y.comp.includes("Transformer")){let _;y.name&&B.findTransformer(y.name).length>0&&(_=B.findTransformer(y.name)[0]),_||(_=B.initialize(y.comp,{name:y.name,sharedVar:{...t.sharedVar||{},...y.sharedVar||{}}})),m.push(_),x="Transformer"}else if(y.comp.includes("Service")){let _;y.name&&H.findService(y.name).length>0&&(_=H.findService(y.name)[0]),_||(_=H.initialize(y.comp,{...y,...c?l=="Transformer"?{transformers:c instanceof Array?c:[c]}:{services:c instanceof Array?c:[c]}:{},sharedVar:{...t.sharedVar||{},...y.sharedVar||{}}})),y.dimension&&_ instanceof _e&&(_=_.dimension(y.dimension),y.layers&&(_._layerInstances=y.layers.slice(0)),y.sharedVar&&_.setSharedVars(y.sharedVar)),m.push(_),x="Service"}}c=m,l=x}else if(d instanceof B)c=d,l="Transformer";else if(d instanceof H)l=="Transformer"?d._transformers.push(...c instanceof Array?c:[c]):d._services.push(...c instanceof Array?c:[c]),c=d,l="Service";else if(d.comp.includes("Transformer")){let m;d.name&&B.findTransformer(d.name).length>0&&(m=B.findTransformer(d.name)[0]),m||(m=B.initialize(d.comp,{name:d.name,sharedVar:{...t.sharedVar||{},...d.sharedVar||{}}})),c=m,l="Transformer"}else if(d.comp.includes("Service")){let m;d.name&&H.findService(d.name).length>0&&(m=H.findService(d.name)[0]),m||(m=H.initialize(d.comp,{...d,...c?l=="Transformer"?{transformers:c instanceof Array?c:[c]}:{services:c instanceof Array?c:[c]}:{},sharedVar:{...t.sharedVar||{},...d.sharedVar||{}}})),d.dimension&&m.isInstanceOf("SelectionService")&&(m=m.dimension(d.dimension),d.layers&&(m._layerInstances=d.layers.slice(0)),d.sharedVar&&m.setSharedVars(d.sharedVar)),c=m,l="Service"}}c&&(l=="Transformer"?c instanceof Array?o._transformers.push(...c):o._transformers.push(c):o instanceof M?c instanceof Array?o._serviceInstances.push(...c):o._serviceInstances.push(c):c instanceof Array?o._services.push(...c):o._services.push(c))}return n}};Ku=me;rm=M.register,Zb=M.unregister,nm=M.initialize,sm=M.findInstrument});var Ju=h(()=>{_n();Se();lr();wn();M.register("HoverInstrument",{constructor:M,interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.find("SelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY},{layer:t})}]},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});M.register("ClickInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.setSharedVar("x",t.clientX),n.setSharedVar("y",t.clientY),n.services.find("SelectionService").setSharedVars({x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY},{layer:r}),n.emit("clickstart",{...e,self:e.instrument})}],dragend:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:r}),t.clientX===n.getSharedVar("x")&&t.clientY===n.getSharedVar("y")?(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("click",{...e,self:e.instrument})):(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("clickabort",{...e,self:e.instrument}))}],dragabort:[e=>{e.event.changedTouches&&(e.event=e.event.changedTouches[0]),e.instrument.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:e.layer}),e.instrument.emit("clickabort",{...e,self:e.instrument})}]},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});M.register("BrushInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.find("RectSelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,width:1,height:1,startx:e.clientX,starty:e.clientY,startoffsetx:e.offsetX,startoffsety:e.offsetY,currentx:e.clientX,currenty:e.clientY},{layer:t});let s=e.offsetX,i=e.offsetY,a=0,o=0,c=t._offset?.x??0,l=t._offset?.y??0,f=r.getSharedVar("scaleX"),d=r.getSharedVar("scaleY");if(f&&f.invert&&d&&d.invert){let m=[s-c,s-c+a].map(f.invert),x=[i-l,i-l+o].map(d.invert);r.setSharedVar("extent",[m,x],{layer:t}),r.services.find("SelectionService").filter([m,x])}else r.services.find("SelectionService").filter([[s-c,s-c+a],[i-l,i-l+o]]);r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY),r.setSharedVar("startoffsetx",e.offsetX),r.setSharedVar("startoffsety",e.offsetY)}],drag:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]);let s=n.getSharedVar("startx"),i=n.getSharedVar("starty"),a=n.getSharedVar("startoffsetx"),o=n.getSharedVar("startoffsety"),c=Math.min(s,t.clientX),l=Math.min(i,t.clientY),f=Math.min(a,t.offsetX),d=Math.min(o,t.offsetY),m=Math.abs(t.clientX-s),x=Math.abs(t.clientY-i);n.services.find("SelectionService").setSharedVars({x:c,y:l,offsetx:f,offsety:d,width:m,height:x,currentx:t.clientX,currenty:t.clientY},{layer:r})}],dragabort:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0,width:0,height:0,currentx:t.clientX,currenty:t.clientY,endx:t.clientX,endy:t.clientY},{layer:r}),n.emit("brushabort",e)}]},preAttach:(e,t)=>{t.getLayerFromQueue("selectionLayer"),e.services.add("RectSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone"),highlightColor:e.getSharedVar("highlightColor"),highlightAttrValues:e.getSharedVar("highlightAttrValues")}})}});M.register("BrushXInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.setSharedVars({x:e.clientX,offsetx:e.offsetX,width:0,startx:e.clientX,startoffsetx:e.offsetX,currentx:e.clientX},{layer:t}),r.setSharedVar("startx",e.clientX),r.setSharedVar("startoffsetx",e.offsetX)}],drag:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]);let s=n.getSharedVar("startx"),i=n.getSharedVar("startoffsetx"),a=Math.min(s,t.clientX),o=Math.min(i,t.offsetX),c=Math.abs(t.clientX-s);n.services.find("SelectionService").setSharedVars({x:a,offsetx:o,width:c,currentx:t.clientX},{layer:r}),n.setSharedVar("currentx",t.clientX),n.setSharedVar("currentoffsetx",t.offsetX),n.emit("brush",e)}],dragabort:[async e=>{let{event:t,layer:r,instrument:n}=e;t.changedTouches&&(t=t.changedTouches[0]),n.services.setSharedVars({x:0,offsetx:0,width:0,currentx:t.clientX},{layer:r}),n.emit("brushabort",e)}]},preAttach:(e,t)=>{e.services.add("RectSelectionService",{layer:t})}});M.register("BrushYInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("RectSelectionService");n.setSharedVar("y",e.clientY,{layer:t}),n.setSharedVar("height",1,{layer:t}),n.setSharedVar("starty",e.clientY,{layer:t}),n.setSharedVar("currenty",e.clientY,{layer:t}),r.setSharedVar("starty",e.clientY),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("starty"),s=Math.min(n,e.clientY),i=Math.abs(e.clientY-n),a=r.services.find("SelectionService");a.setSharedVar("y",s,{layer:t}),a.setSharedVar("height",i,{layer:t}),a.setSharedVar("currenty",e.clientY,{layer:t}),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("starty"),s=Math.min(n,e.clientY),i=Math.abs(e.clientY-n),a=(t.getGraphic().querySelector(".ig-layer-background")||t.getGraphic()).getBoundingClientRect();r.transformers.find("TransientRectangleTransformer").setSharedVars({y:s-a.top,height:i})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("y",0,{layer:t}),n.setSharedVar("height",0,{layer:t}),n.setSharedVar("currenty",e.clientY,{layer:t}),n.setSharedVar("endy",e.clientY,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:0})}]},preAttach:(e,t)=>{let r=e.getSharedVar("x")??0,n=e.getSharedVar("width")??t._width,s=e.services.add("RectSelectionService",{layer:t}),i=t.getGraphic().getBoundingClientRect();s.setSharedVar("x",i.x+r),s.setSharedVar("width",n),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:0,y:0,width:n,height:0,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:{}}})}});M.register("HelperLineInstrument",{constructor:M,sharedVar:{orientation:["horizontal"]},interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.transformers.setSharedVars({x:e.offsetX,y:e.offsetY}),r.setSharedVar("x",e.offsetX,{}),r.setSharedVar("y",e.offsetY,{})}]},preAttach:function(e,t){e.transformers.add("HelperLineTransformer",{layer:t.getLayerFromQueue("transientLayer"),sharedVar:{orientation:e.getSharedVar("orientation"),style:e.getSharedVar("style")||{},tooltip:e.getSharedVar("tooltip"),scaleX:e.getSharedVar("scaleX"),scaleY:e.getSharedVar("scaleY")}})}});M.register("DataBrushInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.getSharedVar("scaleY"),i=r.services.find("Quantitative2DSelectionService"),a=Ge(e,t.getGraphic());r.setSharedVar("layerOffsetX",e.clientX-a[0]),r.setSharedVar("layerOffsetY",e.clientY-a[1]),r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY);let o=[a[0],a[0]+1].map(n.invert);i.setSharedVar("extentX",o);let c=[a[1],a[1]+1].map(s.invert);i.setSharedVar("extentX",c),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,y:0,width:1,height:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("starty"),i=r.getSharedVar("layerOffsetX"),a=r.getSharedVar("layerOffsetY"),o=r.getSharedVar("scaleX"),c=r.getSharedVar("scaleY"),l=Math.min(n,e.clientX)-i,f=Math.min(s,e.clientY)-a,d=Math.abs(e.clientX-n),m=Math.abs(e.clientY-s);r.setSharedVar("x",l),r.setSharedVar("y",f),r.setSharedVar("width",d),r.setSharedVar("height",m);let x=[l,l+d].map(o.invert),b=[f+m,f].map(c.invert),y=r.services.find("SelectionService");y.setSharedVar("extentX",x),y.setSharedVar("extentY",b),console.log(y),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("x"),s=r.getSharedVar("y"),i=r.getSharedVar("width"),a=r.getSharedVar("height");r.transformers.find("TransientRectangleTransformer").setSharedVars({x:n,y:s,width:i,height:a})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:t}),n.setSharedVar("width",0,{layer:t}),n.setSharedVar("currentx",e.clientX,{layer:t}),n.setSharedVar("endx",e.clientX,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:async(e,t)=>{let r=e.getSharedVar("scaleX"),n=e.getSharedVar("scaleY"),s=e.getSharedVar("attrNameX"),i=e.getSharedVar("extentX")??[0,0],a=i.map(r),o=e.getSharedVar("attrNameY"),c=e.getSharedVar("extentY")??[0,0],l=i.map(n).reverse(),f=e.services.add("Quantitative2DSelectionService",{layer:t});f.setSharedVar("attrNameX",s),f.setSharedVar("extentX",i),f.setSharedVar("attrNameY",o),f.setSharedVar("extentY",c),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:a[0],y:l[0],width:a[1]-a[0],height:l[1]-l[0],fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}}}),await Promise.all(e.services.results)}});M.register("DataBrushXInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.services.find("QuantitativeSelectionService"),i=Ge(e,t.getGraphic())[0];r.setSharedVar("layerOffsetX",e.clientX-i),r.setSharedVar("startx",e.clientX),r.setSharedVar("startLayerPosX",i);let a=[i,i+1].map(n.invert);s.setSharedVar("extent",a),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:i,width:1})}],drag:[xe.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("layerOffsetX"),i=r.getSharedVar("scaleX"),a=Math.min(n,e.clientX),o=Math.abs(e.clientX-n),c=[a-s,a-s+o].map(i.invert),l=r.services.find("QuantitativeSelectionService");r.setSharedVar("extent",c),l.setSharedVar("extent",c),await Promise.all(r.services.results)},feedback:[async({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("startLayerPosX"),s=Ge(e,t.getGraphic())[0];console.log(n,s);let i=Math.min(n,s),a=Math.abs(s-n);r.transformers.find("TransientRectangleTransformer").setSharedVars({x:i,width:a})},async({instrument:e})=>{e.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:e,layer:t,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:t}),n.setSharedVar("width",0,{layer:t}),n.setSharedVar("currentx",e.clientX,{layer:t}),n.setSharedVar("endx",e.clientX,{layer:t}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:(e,t)=>{let r=e.getSharedVar("scaleX"),n=e.getSharedVar("height")??t._height,s=e.getSharedVar("y")??0,i=e.getSharedVar("attrNameX"),a=e.getSharedVar("extentX")??[0,0],o=a.map(r),c=e.services.add("QuantitativeSelectionService",{layer:t});c.setSharedVar("attrName",i),c.setSharedVar("extent",a),e.transformers.add("TransientRectangleTransformer",{transient:!0,layer:t.getLayerFromQueue("transientLayer"),sharedVar:{x:o[0],y:s,width:o[1]-o[0],height:n,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:t.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:e.getSharedVar("highlightAttrValues")||{}}})}});M.register("DragInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.setSharedVars({x:t.clientX,y:t.clientY},{layer:e})}],drag:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=t.clientX-r.services.getSharedVar("x",{layer:e})[0],s=t.clientY-r.services.getSharedVar("y",{layer:e})[0];r.setSharedVar("offsetx",n,{layer:e}),r.setSharedVar("offsety",s,{layer:e})}],dragend:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=t.clientX-r.services.getSharedVar("x",{layer:e})[0],s=t.clientY-r.services.getSharedVar("y",{layer:e})[0];r.services.setSharedVars({x:0,y:0},{layer:e}),r.setSharedVar("offsetx",n,{layer:e}),r.setSharedVar("offsety",s,{layer:e})}],dragabort:[e=>{let{layer:t,event:r,instrument:n}=e;r.changedTouches&&(r=r.changedTouches[0]),n.services.setSharedVars({x:0,y:0,currentx:r.clientX,currenty:r.clientY,offsetx:0,offsety:0},{layer:t}),n.emit("dragconfirm",{...e,self:e.instrument})}]},preAttach:(e,t)=>{e.services.add("SurfacePointSelectionService",{layer:t,sharedVar:{deepClone:e.getSharedVar("deepClone")}})}});M.register("SpeechInstrument",{constructor:M,interactors:["SpeechControlInteractor"]});M.register("KeyboardHelperBarInstrument",{constructor:M,interactors:["KeyboardPositionInteractor"],on:{begin:[()=>console.log("begin")],left:[({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("speed")||1,i=t.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=na(i)[0]-n;i.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}],right:[({event:e,layer:t,instrument:r})=>{let n=r.getSharedVar("speed")||1,i=t.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=na(i)[0]+n;i.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}]},preAttach:function(e,t){t.getGraphic().setAttribute("tabindex",0),t.getGraphic().focus();let r=t._height,n=e.getSharedVar("startPos"),s=t.getLayerFromQueue("transientLayer"),i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",n),i.setAttribute("y1","0"),i.setAttribute("x2",n),i.setAttribute("y2",r),i.setAttribute("stroke","black"),i.setAttribute("stroke-width","1px"),s.getGraphic().append(i)}});M.register("PanInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY),r.transformers.forEach(s=>{let i=s.getSharedVar("scaleX"),a=s.getSharedVar("scaleY");i&&s.setSharedVar("$$scaleX",i.copy()),a&&s.setSharedVar("$$scaleY",a.copy())})}],drag:[async({layer:e,event:t,instrument:r,transformer:n})=>{t.changedTouches&&(t=t.changedTouches[0]);let s=r.transformers,i=r.getSharedVar("startx"),a=r.getSharedVar("starty"),o=r.getSharedVar("fixRange")??!1;s.forEach(c=>{let l=c.getSharedVar("scaleX"),f=c.getSharedVar("scaleY");if(o){if(l){let d=c.getSharedVar("$$scaleX"),b=d.range().map((y,_)=>y-t.clientX+i).map(y=>d.invert(y));l.domain(b),c.setSharedVar("scaleX",l)}if(f){let d=c.getSharedVar("$$scaleY"),b=d.range().map((y,_)=>y-t.clientY+a).map(y=>d.invert(y));f.domain(b),c.setSharedVar("scaleY",f)}}else{if(l){let m=c.getSharedVar("$$scaleX").range().map((x,b)=>x+t.clientX-i);l.range(m),c.setSharedVar("scaleX",l)}if(f){let m=c.getSharedVar("$$scaleY").range().map((x,b)=>x+t.clientY-a);f.range(m),c.setSharedVar("scaleY",f)}}})}],dragabort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});M.register("PanXInstrument",{constructor:M,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:e,event:t,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.setSharedVar("startx",t.clientX),r.transformers.forEach(s=>{let i=s.getSharedVar("scaleX");i&&s.setSharedVar("$$scaleX",i.copy())})}],drag:[async({layer:e,event:t,instrument:r,transformer:n})=>{t.changedTouches&&(t=t.changedTouches[0]);let s=r.transformers,i=r.getSharedVar("startx"),a=r.getSharedVar("fixRange")??!1;s.forEach(o=>{let c=o.getSharedVar("scaleX");if(a){if(c){let l=o.getSharedVar("$$scaleX"),m=l.range().map((x,b)=>x-t.clientX+i).map(x=>l.invert(x));c.domain(m),o.setSharedVar("scaleX",c)}}else if(c){let f=o.getSharedVar("$$scaleX").range().map((d,m)=>d+t.clientX-i);c.range(f),o.setSharedVar("scaleX",c)}})}],dragabort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});M.register("GeometricZoomInstrument",{constructor:M,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=J(n),i=t.transformers;t.setSharedVar("currentx",r.offsetX),t.setSharedVar("currenty",r.offsetY);let a=r.deltaY;t.setSharedVar("delta",a);let o=t.getSharedVar("cumulativeDelta",{defaultValue:0});o+=a,t.setSharedVar("cumulativeDelta",o),a/=1e3;let[c,l]=Ge(r,n),f=t.getSharedVar("centroidX")||c,d=t.getSharedVar("centroidY")||l,m=t.getSharedVar("fixRange")??!1;i.forEach(x=>{let b=x.getSharedVar("scaleX"),y=x.getSharedVar("scaleY");if(m){if(b){let _=b.invert(f);b.domain(b.domain().map(j=>j-_).map(j=>j*Math.exp(-a)).map(j=>j+_)),i.forEach(j=>j.setSharedVar("scaleX",b))}if(y){let _=y.invert(d);y.domain(y.domain().map(j=>j-_).map(j=>j*Math.exp(-a)).map(j=>j+_)),i.forEach(j=>j.setSharedVar("scaleY",y))}}else{if(b){let _=b.range().map(j=>(j-f)*Math.exp(a)+f);b.range(_),x.setSharedVar("scaleX",b)}if(y){let _=y.range().map(j=>(j-d)*Math.exp(a)+d);y.range(_),x.setSharedVar("scaleY",y)}}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}});M.register("SemanticZoomInstrument",{constructor:M,interactors:["MouseWheelInteractor"],sharedVar:{currentLevel:0},on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=J(n),i=t.transformers,a=t.getSharedVar("scaleLevels"),o=t.getSharedVar("currentLevel");if(o+=Math.sign(r.deltaY),t.setSharedVar("currentLevel",o),typeof a=="object"){let y=Object.keys(a).reduce(function(_,j){return Math.abs(parseInt(j)-o)<Math.abs(parseInt(_)-o)?j:_});i.setSharedVars(a[y])}t.setSharedVar("currentx",r.offsetX),t.setSharedVar("currenty",r.offsetY);let c=r.deltaY;t.setSharedVar("delta",c);let l=t.getSharedVar("cumulativeDelta",{defaultValue:0});l+=c,t.setSharedVar("cumulativeDelta",l),c/=1e3;let[f,d]=Ge(r,n),m=t.getSharedVar("centroidX")||f,x=t.getSharedVar("centroidY")||d,b=t.getSharedVar("fixRange")??!1;i.forEach(y=>{let _=y.getSharedVar("scaleX"),j=y.getSharedVar("scaleY");if(b){if(_){let O=_.invert(m);_.domain(_.domain().map(A=>A-O).map(A=>A*Math.exp(-c)).map(A=>A+O)),i.forEach(A=>A.setSharedVar("scaleX",_))}if(j){let O=j.invert(x);j.domain(j.domain().map(A=>A-O).map(A=>A*Math.exp(-c)).map(A=>A+O)),i.forEach(A=>A.setSharedVar("scaleY",j))}}else{if(_){let O=_.range().map(A=>(A-m)*Math.exp(c)+m);_.range(O),y.setSharedVar("scaleX",_)}if(j){let O=j.range().map(A=>(A-x)*Math.exp(c)+x);j.range(O),y.setSharedVar("scaleY",j)}}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]},postUse(e,t){let r=e.getSharedVar("scaleLevels"),n=e.transformers,s=e.getSharedVar("currentLevel");if(typeof r=="object"){let i=Object.keys(r).reduce(function(a,o){return Math.abs(parseInt(o)-s)<Math.abs(parseInt(a)-s)?o:a});n.setSharedVars(r[i])}}});M.register("ZoomXInstrument",{constructor:M,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:e,instrument:t,event:r})=>{let n=e.getGraphic(),s=J(n),i=t.transformers;t.setSharedVar("currentx",r.offsetX);let a=r.deltaY;t.setSharedVar("delta",a);let o=t.getSharedVar("cumulativeDelta",{defaultValue:0});o+=a,t.setSharedVar("cumulativeDelta",o),a/=1e3;let[c,l]=Ge(r,n),f=t.getSharedVar("centroidX")||c,d=t.getSharedVar("fixRange")??!1;i.forEach(m=>{let x=m.getSharedVar("scaleX");if(d){if(x){let b=x.invert(f);x.domain(x.domain().map(y=>y-b).map(y=>y*Math.exp(-a)).map(y=>y+b)),i.forEach(y=>y.setSharedVar("scaleX",x))}}else if(x){let b=x.range().map(y=>(y-f)*Math.exp(a)+f);x.range(b),m.setSharedVar("scaleX",x)}})}],abort:[({layer:e,event:t,instrument:r,transformer:n})=>{}]}})});var sa,aa,Sn=h(()=>{_n();_n();Ju();sa=xr,aa=M});var ia={};Sf(ia,{createHistoryTrrack:()=>bn,tryGetHistoryTrrackInstance:()=>ef,tryRegisterDynamicInstance:()=>am});async function bn(){let e=null,t=null,r=!1,n={traceStructure:(s=e)=>({recordList:[...s.record.keys()],children:s.children.map(i=>n.traceStructure(i)),current:s===t}),commit:async()=>{if(r)return;let s=new Map;for(let{component:a,fields:o}of[{list:Gs,fields:["_state","_modalities"]},{list:sa,fields:["_sharedVar"]},{list:Ns,fields:["_sharedVar"]},{list:zs,fields:["_sharedVar"]}].flatMap(({list:c,fields:l})=>c.filter(f=>ef(f)===n).map(f=>({component:f,fields:l}))))await a.results,s.set(a,Object.fromEntries(o.map(c=>[c,le(a[c])])));let i={record:s,prev:t,next:null,children:[]};t&&t.children.push(i),t=i},async undo(){if(t&&t.prev){t.prev.next=t;let s=t.prev.record;r=!0;try{for(let[i,a]of s.entries())Object.entries(a).forEach(([o,c])=>i[o]=le(c)),"_sharedVar"in a&&await i.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=t.prev}catch(i){console.error("Fail to undo history!",i);let a=t.record;for(let[o,c]of a.entries())Object.entries(c).forEach(([l,f])=>o[l]=le(f)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async redo(){if(t&&t.children.length===1&&!t.next&&(t.next=t.children[0]),t&&t.next){let s=t.next.record;r=!0;try{for(let[i,a]of s.entries())Object.entries(a).forEach(([o,c])=>i[o]=le(c)),"_sharedVar"in a&&await i.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=t.next}catch(i){console.error("Fail to redo history!",i);let a=t.record;for(let[o,c]of a.entries())Object.entries(c).forEach(([l,f])=>o[l]=le(f)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async jump(s=[]){let i=s.reduce((a,o)=>a?.children[o],e);if(i){let a=i.record;r=!0;try{for(let[o,c]of a.entries())Object.entries(c).forEach(([l,f])=>o[l]=le(f)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0);t=i}catch(o){console.error("Fail to jump history!",o);let c=t.record;for(let[l,f]of c.entries())Object.entries(f).forEach(([d,m])=>l[d]=le(m)),"_sharedVar"in f&&await l.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}else console.error(`History path [${s.join(", ")}] does not exist!`)}};return[Ns,zs,tf,sa,Gs].flatMap(s=>s).forEach(s=>{_r.has(s)||_r.set(s,n)}),await n.commit(),e=t,n}function ef(e){let t=_r.get(e);return t||{traceStructure(){return null},async commit(){},async undo(){},async redo(){}}}function am(e,t){let r=_r.get(e);r&&_r.set(t,r)}var _r,wr=h(()=>{ur();ht();vr();Sn();fr();Se();_r=new Map});function ge(e,t,r,n,s){return new Proxy(e,{get(i,a){if(a==="find")return function(o,c){if("initialize"in t){let l=i.filter(f=>f.isInstanceOf(o));if(l.length<=0&&c){let f=t.initialize(c);r(f),l.push(f),oa(s,f)}return ge(l,t,r,n,s)}else{let l=i.slice();return l.forEach(f=>{f.find(...arguments)}),ge(l,t,r,n,s)}};if(a==="add")return(...o)=>{let c=i.slice();if("initialize"in t){let l=t.initialize(...o);return r(l),c.push(l),oa(s,l),ge(c,t,r,n,s)}else return c.forEach(l=>{l.add(...o)}),ge(c,t,r,n,s)};if(a==="remove")return o=>{if(t===jn){let c=i.slice();return c.forEach(l=>{l.remove(o)}),ge(c,t,r,n,s)}else{let c=i.slice();return c.filter(f=>f.isInstanceOf(o)).forEach(f=>{n(f),c.splice(c.indexOf(f),1)}),ge(c,t,r,n,s)}};if(a in i&&a!=="join"&&a!=="filter")return i[a];if(i.length)return i[0][a]instanceof Function?function(){return ge(i.map(o=>o[a].apply(o,arguments)),jn,()=>{},()=>{},s)}:ge(i.map(o=>o[a]),jn,()=>{},()=>{},s);{let o=()=>{};return o[Symbol.iterator]=function*(){},o}}})}function na(e){try{return e.getAttribute("transform").split("(")[1].split(")")[0].split(",").map(r=>parseFloat(r))}catch(t){return[0,0]}}function qs(e){return af(e.trim()).map(ca)}function pm(e){return dm.hasOwnProperty(e)}function Sr(e,t,r,n,s){let i=0,a,o=e.length;for(;t<o;++t){if(a=e[t],!i&&a===r)return t;s&&s.indexOf(a)>=0?--i:n&&n.indexOf(a)>=0&&++i}return t}function af(e){let t=[],r=e.length,n=0,s=0;for(;s<r;)s=Sr(e,s,sf,Vn+rf,Tn+nf),t.push(e.substring(n,s).trim()),n=++s;if(t.length===0)throw"Empty event selector: "+e;return t}function ca(e){return e[0]==="["?mm(e):gm(e)}function mm(e){let t=e.length,r=1,n,s;if(r=Sr(e,r,Tn,Vn,Tn),r===t)throw"Empty between selector: "+e;if(n=af(e.substring(1,r)),n.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(r+1).trim(),e[0]!==lm)throw"Expected '>' after between selector: "+e;let i=n.map(ca);return s=ca(e.slice(1).trim()),s.between?{between:i,stream:s}:(s.between=i,s)}function gm(e){let t={source:fm,type:""},r=[],n=[0,0],s=0,i=0,a=e.length,o=0,c,l;if(e[a-1]===nf){if(o=e.lastIndexOf(rf),o>=0){try{n=xm(e.substring(o+1,a-1))}catch(f){throw"Invalid throttle specification: "+e}e=e.slice(0,o).trim(),a=e.length}else throw"Unmatched right brace: "+e;o=0}if(!a)throw e;if(e[0]===cm&&(s=++o),c=Sr(e,o,om),c<a&&(r.push(e.substring(i,c).trim()),i=o=++c),o=Sr(e,o,Vn),o===a)r.push(e.substring(i,a).trim());else if(r.push(e.substring(i,o).trim()),l=[],i=++o,i===a)throw"Unmatched left bracket: "+e;for(;o<a;){if(o=Sr(e,o,Tn),o===a)throw"Unmatched left bracket: "+e;if(l.push(e.substring(i,o).trim()),o<a-1&&e[++o]!==Vn)throw"Expected left bracket: "+e;i=++o}if(!(a=r.length)||um.test(r[a-1]))throw"Invalid event selector: "+e;return a>1?(t.type=r[1],s?t.markname=r[0].slice(1):pm(r[0])?t.marktype=r[0]:t.source=r[0]):t.type=r[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),n[0]&&(t.throttle=n[0]),n[1]&&(t.debounce=n[1]),t}function xm(e){let t=e.split(sf);if(!e.length||t.length>2)throw e;return t.map(function(r){let n=+r;if(n!==n)throw e;return n})}function le(e){if(e instanceof Array)return e.map(le);if(["string","number","boolean","undefined","bigint","symbol","function"].includes(typeof e))return e;if(e===null)return null;if(me in e&&e[me])return e;let t=Object.fromEntries(Object.entries(e).map(([r,n])=>[r,le(n)]));return Object.assign(Object.create(Object.getPrototypeOf(e)),t)}var me,re,Z,We,jn,oa,im,Vn,Tn,rf,nf,om,sf,cm,lm,um,fm,hm,dm,Aa,Se=h(()=>{me=Symbol("Libra");(function(e){e[e.Shape=0]="Shape",e[e.Data=1]="Data",e[e.Attr=2]="Attr"})(re||(re={}));(function(e){e[e.SurfacePoint=0]="SurfacePoint",e[e.Point=1]="Point",e[e.Circle=2]="Circle",e[e.Rect=3]="Rect",e[e.Polygon=4]="Polygon"})(Z||(Z={}));(function(e){e[e.Quantitative=0]="Quantitative",e[e.Nominal=1]="Nominal",e[e.Temporal=2]="Temporal"})(We||(We={}));jn=class{};im="view",Vn="[",Tn="]",rf="{",nf="}",om=":",sf=",",cm="@",lm=">",um=/[[\]{}]/,fm=im,hm={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},dm=hm;Aa={stopTransient:!1};Promise.resolve().then(()=>(wr(),ia)).then(e=>{oa=e.tryRegisterDynamicInstance})});var of,cf,la,An,xe,ym,gj,vm,_m,wn=h(()=>{Se();la={},An=[],xe=class{constructor(t,r){this[of]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=t,this._userOptions=r,this._name=r.name??t,this._feedback=r.feedback??[],this._undo=r.undo??null,this._redo=r.redo??null,this._execute=r.execute??null,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preExecute=r.preExecute??null,this._postExecute=r.postExecute??null,r.postInitialize&&r.postInitialize.call(this,this)}undo(){this._undo&&this._undo.call(this)}redo(){this._redo&&this._redo.call(this)}async execute(t){try{this.preExecute(),this._execute&&await this._execute.call(this,t),this.postExecute();for(let r of this._feedback)await r.call(this,t);await cf(this).commit()}catch(r){console.error(r)}}preExecute(){this._preExecute&&this._preExecute.call(this,this)}postExecute(){this._postExecute&&this._postExecute.call(this,this)}isInstanceOf(t){return this._baseName===t||this._name===t}static register(t,r){la[t]=r}static unregister(t){return delete la[t],!0}static initialize(t,r){let n=Object.assign({constructor:xe},la[t]??{},r??{}),s=new n.constructor(t,n);return An.push(s),s}static findCommand(t){return An.filter(r=>r.isInstanceOf(t))}};of=me;ym=xe.register,gj=xe.unregister,vm=xe.initialize,_m=xe.findCommand;Promise.resolve().then(()=>(wr(),ia)).then(e=>{cf=e.tryGetHistoryTrrackInstance})});var tf,Je,vr=h(()=>{wn();wn();tf=An,Je=xe});vr();Sn();fr();vn();ur();wr();ht();vr();Sn();fr();vn();ur();wr();ht();var Ej={Command:Je,Instrument:aa,Interactor:Pe,Layer:xt,Service:H,createHistoryTrrack:bn,GraphicalTransformer:B};export{Je as Command,B as GraphicalTransformer,aa as Instrument,Pe as Interactor,xt as Layer,H as Service,bn as createHistoryTrrack,Ej as default};
