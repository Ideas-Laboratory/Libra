var Oa=Object.defineProperty;var Af=t=>Oa(t,"__esModule",{value:!0});var d=(t,e)=>()=>(t&&(e=t(t=0)),e);var Cf=(t,e)=>{Af(t);for(var r in e)Oa(t,r,{get:e[r],enumerable:!0})};var ka,Dr,Vt,Zn,Pa,J,Mf,Yp,Rf,Of,Xr=d(()=>{_e();Dr={},Vt=[],Zn=[],Pa=()=>{let t;for(;t=Zn.pop();)try{t.remove()}catch(e){}La.stopTransient||Vt.filter(e=>e._transient).forEach(e=>e.redraw()),requestAnimationFrame(Pa)};requestAnimationFrame(Pa);J=class{constructor(e,r){this[ka]=!0,this._baseName=e,this._userOptions=r,this._name=r.name??this._baseName,this._sharedVar=r.sharedVar??{},this._redraw=r.redraw??(()=>{}),this._layer=r.layer,this._transient=r.transient??!1,this.redraw()}getSharedVar(e){return this._sharedVar[e]}setSharedVar(e,r){this._sharedVar[e]=r,this.redraw()}setSharedVars(e){Object.entries(e).forEach(([r,n])=>this._sharedVar[r]=n),this.redraw()}redraw(e=!1){if(!this._layer&&!this.getSharedVar("layer"))return;let r=this._layer||this.getSharedVar("layer");e=e||this._transient;let n=[],s=[],a=new Set([r]);e&&(n=r.getVisualElements(),r._getLayerFromQueue||(r._getLayerFromQueue=r.getLayerFromQueue,r.getLayerFromQueue=function(){let i=r._getLayerFromQueue(...arguments);return n=n.concat(i.getVisualElements()),a.add(i),i})),this._redraw({layer:r,transformer:this}),e&&(r.getLayerFromQueue=r._getLayerFromQueue,delete r._getLayerFromQueue,a.forEach(i=>{s=s.concat(Array.prototype.slice.call(i.getGraphic()?.childNodes??[]));let o=s.filter(c=>!n.includes(c));Zn=Zn.concat(o)}))}isInstanceOf(e){return this._baseName===e||this._name===e||(this._userOptions.className??[]).includes(e)}static register(e,r){Dr[e]=r}static unregister(e){return delete Dr[e],!0}static initialize(e,r){let n=Object.assign({constructor:J},Dr[e]??{},r??{},{sharedVar:Object.assign({},(Dr[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return Vt.push(s),s}static findTransformer(e){return Vt.filter(r=>r.isInstanceOf(e))}static findTransformerByLayer(e){return Vt.filter(r=>r._layer===e||r.getSharedVar("layer")===e)}};ka=xe;Mf=J.register,Yp=J.unregister,Rf=J.initialize,Of=J.findTransformer});var Ya=d(()=>{});var Da=d(()=>{});var Xa=d(()=>{});function za(){for(var t=0,e=arguments.length,r={},n;t<e;++t){if(!(n=arguments[t]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new zr(r)}function zr(t){this._=t}function Pf(t,e){return t.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function Lf(t,e){for(var r=0,n=t.length,s;r<n;++r)if((s=t[r]).name===e)return s.value}function Na(t,e,r){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=kf,t=t.slice(0,n).concat(t.slice(n+1));break}return r!=null&&t.push({name:e,value:r}),t}var kf,Kn,Fa=d(()=>{kf={value:()=>{}};zr.prototype=za.prototype={constructor:zr,on:function(t,e){var r=this._,n=Pf(t+"",r),s,a=-1,i=n.length;if(arguments.length<2){for(;++a<i;)if((s=(t=n[a]).type)&&(s=Lf(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<i;)if(s=(t=n[a]).type)r[s]=Na(r[s],t.name,e);else if(e==null)for(s in r)r[s]=Na(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new zr(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,a;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,s=a.length;n<s;++n)a[n].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,a=n.length;s<a;++s)n[s].value.apply(e,r)}};Kn=za});var Jn=d(()=>{Fa()});var Nr,es,ts=d(()=>{Nr="http://www.w3.org/1999/xhtml",es={svg:"http://www.w3.org/2000/svg",xhtml:Nr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function ze(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),es.hasOwnProperty(e)?{space:es[e],local:t}:t}var Fr=d(()=>{ts()});function Yf(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===Nr&&e.documentElement.namespaceURI===Nr?e.createElement(t):e.createElementNS(r,t)}}function Df(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function qr(t){var e=ze(t);return(e.local?Df:Yf)(e)}var rs=d(()=>{Fr();ts()});function Xf(){}function st(t){return t==null?Xf:function(){return this.querySelector(t)}}var Gr=d(()=>{});function qa(t){typeof t!="function"&&(t=st(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=new Array(i),c,l,u=0;u<i;++u)(c=a[u])&&(l=t.call(c,c.__data__,u,a))&&("__data__"in c&&(l.__data__=c.__data__),o[u]=l);return new Q(n,this._parents)}var Ga=d(()=>{Te();Gr()});function jt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}var Ur=d(()=>{});function zf(){return[]}function Ut(t){return t==null?zf:function(){return this.querySelectorAll(t)}}var ns=d(()=>{});function Nf(t){return function(){var e=t.apply(this,arguments);return e==null?[]:jt(e)}}function Ua(t){typeof t=="function"?t=Nf(t):t=Ut(t);for(var e=this._groups,r=e.length,n=[],s=[],a=0;a<r;++a)for(var i=e[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&(n.push(t.call(c,c.__data__,l,i)),s.push(c));return new Q(n,s)}var $a=d(()=>{Te();Ur();ns()});function $t(t){return function(){return this.matches(t)}}function $r(t){return function(e){return e.matches(t)}}var Bt=d(()=>{});function qf(t){return function(){return Ff.call(this.children,t)}}function Gf(){return this.firstElementChild}function Ba(t){return this.select(t==null?Gf:qf(typeof t=="function"?t:$r(t)))}var Ff,Qa=d(()=>{Bt();Ff=Array.prototype.find});function $f(){return this.children}function Bf(t){return function(){return Uf.call(this.children,t)}}function Ha(t){return this.selectAll(t==null?$f:Bf(typeof t=="function"?t:$r(t)))}var Uf,Wa=d(()=>{Bt();Uf=Array.prototype.filter});function Za(t){typeof t!="function"&&(t=$t(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new Q(n,this._parents)}var Ka=d(()=>{Te();Bt()});function Br(t){return new Array(t.length)}var ss=d(()=>{});function Ja(){return new Q(this._enter||this._groups.map(Br),this._parents)}function Qt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}var as=d(()=>{ss();Te();Qt.prototype={constructor:Qt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}}});function ei(t){return function(){return t}}var ti=d(()=>{});function Qf(t,e,r,n,s,a){for(var i=0,o,c=e.length,l=a.length;i<l;++i)(o=e[i])?(o.__data__=a[i],n[i]=o):r[i]=new Qt(t,a[i]);for(;i<c;++i)(o=e[i])&&(s[i]=o)}function Hf(t,e,r,n,s,a,i){var o,c,l=new Map,u=e.length,h=a.length,p=new Array(u),g;for(o=0;o<u;++o)(c=e[o])&&(p[o]=g=i.call(c,c.__data__,o,e)+"",l.has(g)?s[o]=c:l.set(g,c));for(o=0;o<h;++o)g=i.call(t,a[o],o,a)+"",(c=l.get(g))?(n[o]=c,c.__data__=a[o],l.delete(g)):r[o]=new Qt(t,a[o]);for(o=0;o<u;++o)(c=e[o])&&l.get(p[o])===c&&(s[o]=c)}function Wf(t){return t.__data__}function ri(t,e){if(!arguments.length)return Array.from(this,Wf);var r=e?Hf:Qf,n=this._parents,s=this._groups;typeof t!="function"&&(t=ei(t));for(var a=s.length,i=new Array(a),o=new Array(a),c=new Array(a),l=0;l<a;++l){var u=n[l],h=s[l],p=h.length,g=jt(t.call(u,u&&u.__data__,l,n)),_=g.length,x=o[l]=new Array(_),w=i[l]=new Array(_),V=c[l]=new Array(p);r(u,h,x,w,V,g,e);for(var E=0,j=0,W,M;E<_;++E)if(W=x[E]){for(E>=j&&(j=E+1);!(M=w[j])&&++j<_;);W._next=M||null}}return i=new Q(i,n),i._enter=o,i._exit=c,i}var ni=d(()=>{Te();as();Ur();ti()});function si(){return new Q(this._exit||this._groups.map(Br),this._parents)}var ai=d(()=>{ss();Te()});function ii(t,e,r){var n=this.enter(),s=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(s=e(s)),r==null?a.remove():r(a),n&&s?n.merge(s).order():s}var oi=d(()=>{});function ci(t){if(!(t instanceof Q))throw new Error("invalid merge");for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],u=c.length,h=i[o]=new Array(u),p,g=0;g<u;++g)(p=c[g]||l[g])&&(h[g]=p);for(;o<n;++o)i[o]=e[o];return new Q(i,this._parents)}var li=d(()=>{Te()});function ui(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var n=t[e],s=n.length-1,a=n[s],i;--s>=0;)(i=n[s])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}var fi=d(()=>{});function hi(t){t||(t=Zf);function e(h,p){return h&&p?t(h.__data__,p.__data__):!h-!p}for(var r=this._groups,n=r.length,s=new Array(n),a=0;a<n;++a){for(var i=r[a],o=i.length,c=s[a]=new Array(o),l,u=0;u<o;++u)(l=i[u])&&(c[u]=l);c.sort(e)}return new Q(s,this._parents).order()}function Zf(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var di=d(()=>{Te()});function mi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}var pi=d(()=>{});function gi(){return Array.from(this)}var yi=d(()=>{});function xi(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length;s<a;++s){var i=n[s];if(i)return i}return null}var _i=d(()=>{});function vi(){let t=0;for(let e of this)++t;return t}var wi=d(()=>{});function Si(){return!this.node()}var bi=d(()=>{});function Vi(t){for(var e=this._groups,r=0,n=e.length;r<n;++r)for(var s=e[r],a=0,i=s.length,o;a<i;++a)(o=s[a])&&t.call(o,o.__data__,a,s);return this}var ji=d(()=>{});function Kf(t){return function(){this.removeAttribute(t)}}function Jf(t){return function(){this.removeAttributeNS(t.space,t.local)}}function eh(t,e){return function(){this.setAttribute(t,e)}}function th(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function rh(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function nh(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function Ti(t,e){var r=ze(t);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((e==null?r.local?Jf:Kf:typeof e=="function"?r.local?nh:rh:r.local?th:eh)(r,e))}var Ii=d(()=>{Fr()});function Qr(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}var is=d(()=>{});function sh(t){return function(){this.style.removeProperty(t)}}function ah(t,e,r){return function(){this.style.setProperty(t,e,r)}}function ih(t,e,r){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,r)}}function Ei(t,e,r){return arguments.length>1?this.each((e==null?sh:typeof e=="function"?ih:ah)(t,e,r??"")):Qe(this.node(),t)}function Qe(t,e){return t.style.getPropertyValue(e)||Qr(t).getComputedStyle(t,null).getPropertyValue(e)}var os=d(()=>{is()});function oh(t){return function(){delete this[t]}}function ch(t,e){return function(){this[t]=e}}function lh(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function Ai(t,e){return arguments.length>1?this.each((e==null?oh:typeof e=="function"?lh:ch)(t,e)):this.node()[t]}var Ci=d(()=>{});function Mi(t){return t.trim().split(/^|\s+/)}function cs(t){return t.classList||new Ri(t)}function Ri(t){this._node=t,this._names=Mi(t.getAttribute("class")||"")}function Oi(t,e){for(var r=cs(t),n=-1,s=e.length;++n<s;)r.add(e[n])}function ki(t,e){for(var r=cs(t),n=-1,s=e.length;++n<s;)r.remove(e[n])}function uh(t){return function(){Oi(this,t)}}function fh(t){return function(){ki(this,t)}}function hh(t,e){return function(){(e.apply(this,arguments)?Oi:ki)(this,t)}}function Pi(t,e){var r=Mi(t+"");if(arguments.length<2){for(var n=cs(this.node()),s=-1,a=r.length;++s<a;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?hh:e?uh:fh)(r,e))}var Li=d(()=>{Ri.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}}});function dh(){this.textContent=""}function mh(t){return function(){this.textContent=t}}function ph(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Yi(t){return arguments.length?this.each(t==null?dh:(typeof t=="function"?ph:mh)(t)):this.node().textContent}var Di=d(()=>{});function gh(){this.innerHTML=""}function yh(t){return function(){this.innerHTML=t}}function xh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Xi(t){return arguments.length?this.each(t==null?gh:(typeof t=="function"?xh:yh)(t)):this.node().innerHTML}var zi=d(()=>{});function _h(){this.nextSibling&&this.parentNode.appendChild(this)}function Ni(){return this.each(_h)}var Fi=d(()=>{});function vh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qi(){return this.each(vh)}var Gi=d(()=>{});function Ui(t){var e=typeof t=="function"?t:qr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}var $i=d(()=>{rs()});function wh(){return null}function Bi(t,e){var r=typeof t=="function"?t:qr(t),n=e==null?wh:typeof e=="function"?e:st(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var Qi=d(()=>{rs();Gr()});function Sh(){var t=this.parentNode;t&&t.removeChild(this)}function Hi(){return this.each(Sh)}var Wi=d(()=>{});function bh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Vh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Zi(t){return this.select(t?Vh:bh)}var Ki=d(()=>{});function Ji(t){return arguments.length?this.property("__data__",t):this.node().__data__}var eo=d(()=>{});function jh(t){return function(e){t.call(this,e,this.__data__)}}function Th(t){return t.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");return n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),{type:e,name:r}})}function Ih(t){return function(){var e=this.__on;if(!!e){for(var r=0,n=-1,s=e.length,a;r<s;++r)a=e[r],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++n]=a;++n?e.length=n:delete this.__on}}}function Eh(t,e,r){return function(){var n=this.__on,s,a=jh(e);if(n){for(var i=0,o=n.length;i<o;++i)if((s=n[i]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=r),s.value=e;return}}this.addEventListener(t.type,a,r),s={type:t.type,name:t.name,value:e,listener:a,options:r},n?n.push(s):this.__on=[s]}}function to(t,e,r){var n=Th(t+""),s,a=n.length,i;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,l=o.length,u;c<l;++c)for(s=0,u=o[c];s<a;++s)if((i=n[s]).type===u.type&&i.name===u.name)return u.value}return}for(o=e?Eh:Ih,s=0;s<a;++s)this.each(o(n[s],e,r));return this}var ro=d(()=>{});function no(t,e,r){var n=Qr(t),s=n.CustomEvent;typeof s=="function"?s=new s(e,r):(s=n.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function Ah(t,e){return function(){return no(this,t,e)}}function Ch(t,e){return function(){return no(this,t,e.apply(this,arguments))}}function so(t,e){return this.each((typeof e=="function"?Ch:Ah)(t,e))}var ao=d(()=>{is()});function*io(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,a=n.length,i;s<a;++s)(i=n[s])&&(yield i)}var oo=d(()=>{});function Q(t,e){this._groups=t,this._parents=e}function co(){return new Q([[document.documentElement]],Ht)}function Mh(){return this}var Ht,Ne,Te=d(()=>{Ga();$a();Qa();Wa();Ka();ni();as();ai();oi();li();fi();di();pi();yi();_i();wi();bi();ji();Ii();os();Ci();Li();Di();zi();Fi();Gi();$i();Qi();Wi();Ki();eo();ro();ao();oo();Ht=[null];Q.prototype=co.prototype={constructor:Q,select:qa,selectAll:Ua,selectChild:Ba,selectChildren:Ha,filter:Za,data:ri,enter:Ja,exit:si,join:ii,merge:ci,selection:Mh,order:ui,sort:hi,call:mi,nodes:gi,node:xi,size:vi,empty:Si,each:Vi,attr:Ti,style:Ei,property:Ai,classed:Pi,text:Yi,html:Xi,raise:Ni,lower:qi,append:Ui,insert:Bi,remove:Hi,clone:Zi,datum:Ji,on:to,dispatch:so,[Symbol.iterator]:io};Ne=co});function $(t){return typeof t=="string"?new Q([[document.querySelector(t)]],[document.documentElement]):new Q([[t]],Ht)}var lo=d(()=>{Te()});function uo(t){let e;for(;e=t.sourceEvent;)t=e;return t}var fo=d(()=>{});function He(t,e){if(t=uo(t),e===void 0&&(e=t.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}var ho=d(()=>{fo()});function Ie(t){return typeof t=="string"?new Q([document.querySelectorAll(t)],[document.documentElement]):new Q([t==null?[]:jt(t)],Ht)}var mo=d(()=>{Ur();Te()});var Ce=d(()=>{Bt();Fr();ho();lo();mo();Te();Gr();ns();os()});var po=d(()=>{});function Hr(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function ls(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}var go=d(()=>{});function Wt(){}function xo(){return this.rgb().formatHex()}function Xh(){return Vo(this).formatHsl()}function _o(){return this.rgb().formatRgb()}function We(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Rh.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?vo(e):r===3?new be(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Zr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Zr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Oh.exec(t))?new be(e[1],e[2],e[3],1):(e=kh.exec(t))?new be(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ph.exec(t))?Zr(e[1],e[2],e[3],e[4]):(e=Lh.exec(t))?Zr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Yh.exec(t))?bo(e[1],e[2]/100,e[3]/100,1):(e=Dh.exec(t))?bo(e[1],e[2]/100,e[3]/100,e[4]):yo.hasOwnProperty(t)?vo(yo[t]):t==="transparent"?new be(NaN,NaN,NaN,0):null}function vo(t){return new be(t>>16&255,t>>8&255,t&255,1)}function Zr(t,e,r,n){return n<=0&&(t=e=r=NaN),new be(t,e,r,n)}function zh(t){return t instanceof Wt||(t=We(t)),t?(t=t.rgb(),new be(t.r,t.g,t.b,t.opacity)):new be}function It(t,e,r,n){return arguments.length===1?zh(t):new be(t,e,r,n??1)}function be(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}function wo(){return"#"+us(this.r)+us(this.g)+us(this.b)}function So(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function us(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function bo(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Le(t,e,r,n)}function Vo(t){if(t instanceof Le)return new Le(t.h,t.s,t.l,t.opacity);if(t instanceof Wt||(t=We(t)),!t)return new Le;if(t instanceof Le)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(e,r,n),a=Math.max(e,r,n),i=NaN,o=a-s,c=(a+s)/2;return o?(e===a?i=(r-n)/o+(r<n)*6:r===a?i=(n-e)/o+2:i=(e-r)/o+4,o/=c<.5?a+s:2-a-s,i*=60):o=c>0&&c<1?0:i,new Le(i,o,c,t.opacity)}function jo(t,e,r,n){return arguments.length===1?Vo(t):new Le(t,e,r,n??1)}function Le(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}function fs(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var Zt,Wr,Tt,Kt,Pe,Rh,Oh,kh,Ph,Lh,Yh,Dh,yo,To=d(()=>{go();Zt=.7,Wr=1/Zt,Tt="\\s*([+-]?\\d+)\\s*",Kt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pe="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Rh=/^#([0-9a-f]{3,8})$/,Oh=new RegExp("^rgb\\("+[Tt,Tt,Tt]+"\\)$"),kh=new RegExp("^rgb\\("+[Pe,Pe,Pe]+"\\)$"),Ph=new RegExp("^rgba\\("+[Tt,Tt,Tt,Kt]+"\\)$"),Lh=new RegExp("^rgba\\("+[Pe,Pe,Pe,Kt]+"\\)$"),Yh=new RegExp("^hsl\\("+[Kt,Pe,Pe]+"\\)$"),Dh=new RegExp("^hsla\\("+[Kt,Pe,Pe,Kt]+"\\)$"),yo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Hr(Wt,We,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:xo,formatHex:xo,formatHsl:Xh,formatRgb:_o,toString:_o});Hr(be,It,ls(Wt,{brighter:function(t){return t=t==null?Wr:Math.pow(Wr,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?Zt:Math.pow(Zt,t),new be(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wo,formatHex:wo,formatRgb:So,toString:So}));Hr(Le,jo,ls(Wt,{brighter:function(t){return t=t==null?Wr:Math.pow(Wr,t),new Le(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?Zt:Math.pow(Zt,t),new Le(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,s=2*r-n;return new be(fs(t>=240?t-240:t+120,s,n),fs(t,s,n),fs(t<120?t+240:t-120,s,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}))});var Kr=d(()=>{To()});function hs(t,e,r,n,s){var a=t*t,i=a*t;return((1-3*t+3*a-i)*e+(4-6*a+3*i)*r+(1+3*t+3*a-3*i)*n+i*s)/6}function Io(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),s=t[n],a=t[n+1],i=n>0?t[n-1]:2*s-a,o=n<e-1?t[n+2]:2*a-s;return hs((r-n/e)*e,i,s,a,o)}}var ds=d(()=>{});function Eo(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),s=t[(n+e-1)%e],a=t[n%e],i=t[(n+1)%e],o=t[(n+2)%e];return hs((r-n/e)*e,s,a,i,o)}}var Ao=d(()=>{ds()});var ms,Co=d(()=>{ms=t=>()=>t});function Nh(t,e){return function(r){return t+r*e}}function Fh(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Mo(t){return(t=+t)==1?Jr:function(e,r){return r-e?Fh(e,r,t):ms(isNaN(e)?r:e)}}function Jr(t,e){var r=e-t;return r?Nh(t,r):ms(isNaN(t)?e:t)}var Ro=d(()=>{Co()});function Oo(t){return function(e){var r=e.length,n=new Array(r),s=new Array(r),a=new Array(r),i,o;for(i=0;i<r;++i)o=It(e[i]),n[i]=o.r||0,s[i]=o.g||0,a[i]=o.b||0;return n=t(n),s=t(s),a=t(a),o.opacity=1,function(c){return o.r=n(c),o.g=s(c),o.b=a(c),o+""}}}var en,qh,Gh,ko=d(()=>{Kr();ds();Ao();Ro();en=function t(e){var r=Mo(e);function n(s,a){var i=r((s=It(s)).r,(a=It(a)).r),o=r(s.g,a.g),c=r(s.b,a.b),l=Jr(s.opacity,a.opacity);return function(u){return s.r=i(u),s.g=o(u),s.b=c(u),s.opacity=l(u),s+""}}return n.gamma=t,n}(1);qh=Oo(Io),Gh=Oo(Eo)});function Ee(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}var tn=d(()=>{});function Uh(t){return function(){return t}}function $h(t){return function(e){return t(e)+""}}function ys(t,e){var r=ps.lastIndex=gs.lastIndex=0,n,s,a,i=-1,o=[],c=[];for(t=t+"",e=e+"";(n=ps.exec(t))&&(s=gs.exec(e));)(a=s.index)>r&&(a=e.slice(r,a),o[i]?o[i]+=a:o[++i]=a),(n=n[0])===(s=s[0])?o[i]?o[i]+=s:o[++i]=s:(o[++i]=null,c.push({i,x:Ee(n,s)})),r=gs.lastIndex;return r<e.length&&(a=e.slice(r),o[i]?o[i]+=a:o[++i]=a),o.length<2?c[0]?$h(c[0].x):Uh(e):(e=c.length,function(l){for(var u=0,h;u<e;++u)o[(h=c[u]).i]=h.x(l);return o.join("")})}var ps,gs,Po=d(()=>{tn();ps=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gs=new RegExp(ps.source,"g")});function xs(t,e,r,n,s,a){var i,o,c;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(c=t*r+e*n)&&(r-=t*c,n-=e*c),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,c/=o),t*n<e*r&&(t=-t,e=-e,c=-c,i=-i),{translateX:s,translateY:a,rotate:Math.atan2(e,t)*Lo,skewX:Math.atan(c)*Lo,scaleX:i,scaleY:o}}var Lo,rn,Yo=d(()=>{Lo=180/Math.PI,rn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function Do(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?rn:xs(e.a,e.b,e.c,e.d,e.e,e.f)}function Xo(t){return t==null?rn:(nn||(nn=document.createElementNS("http://www.w3.org/2000/svg","g")),nn.setAttribute("transform",t),(t=nn.transform.baseVal.consolidate())?(t=t.matrix,xs(t.a,t.b,t.c,t.d,t.e,t.f)):rn)}var nn,zo=d(()=>{Yo()});function No(t,e,r,n){function s(l){return l.length?l.pop()+" ":""}function a(l,u,h,p,g,_){if(l!==h||u!==p){var x=g.push("translate(",null,e,null,r);_.push({i:x-4,x:Ee(l,h)},{i:x-2,x:Ee(u,p)})}else(h||p)&&g.push("translate("+h+e+p+r)}function i(l,u,h,p){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),p.push({i:h.push(s(h)+"rotate(",null,n)-2,x:Ee(l,u)})):u&&h.push(s(h)+"rotate("+u+n)}function o(l,u,h,p){l!==u?p.push({i:h.push(s(h)+"skewX(",null,n)-2,x:Ee(l,u)}):u&&h.push(s(h)+"skewX("+u+n)}function c(l,u,h,p,g,_){if(l!==h||u!==p){var x=g.push(s(g)+"scale(",null,",",null,")");_.push({i:x-4,x:Ee(l,h)},{i:x-2,x:Ee(u,p)})}else(h!==1||p!==1)&&g.push(s(g)+"scale("+h+","+p+")")}return function(l,u){var h=[],p=[];return l=t(l),u=t(u),a(l.translateX,l.translateY,u.translateX,u.translateY,h,p),i(l.rotate,u.rotate,h,p),o(l.skewX,u.skewX,h,p),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,h,p),l=u=null,function(g){for(var _=-1,x=p.length,w;++_<x;)h[(w=p[_]).i]=w.x(g);return h.join("")}}}var _s,vs,Fo=d(()=>{tn();zo();_s=No(Do,"px, ","px)","deg)"),vs=No(Xo,", ",")",")")});var Jt=d(()=>{tn();Po();Fo();ko()});function sr(){return at||(Go(Bh),at=nr.now()+on)}function Bh(){at=0}function ar(){this._call=this._time=this._next=null}function cn(t,e,r){var n=new ar;return n.restart(t,e,r),n}function Uo(){sr(),++Et;for(var t=sn,e;t;)(e=at-t._time)>=0&&t._call.call(null,e),t=t._next;--Et}function $o(){at=(an=nr.now())+on,Et=er=0;try{Uo()}finally{Et=0,Hh(),at=0}}function Qh(){var t=nr.now(),e=t-an;e>qo&&(on-=e,an=t)}function Hh(){for(var t,e=sn,r,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:sn=r);rr=t,ws(n)}function ws(t){if(!Et){er&&(er=clearTimeout(er));var e=t-at;e>24?(t<1/0&&(er=setTimeout($o,t-nr.now()-on)),tr&&(tr=clearInterval(tr))):(tr||(an=nr.now(),tr=setInterval(Qh,qo)),Et=1,Go($o))}}var Et,er,tr,qo,sn,rr,an,at,on,nr,Go,Ss=d(()=>{Et=0,er=0,tr=0,qo=1e3,an=0,at=0,on=0,nr=typeof performance=="object"&&performance.now?performance:Date,Go=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};ar.prototype=cn.prototype={constructor:ar,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?sr():+r)+(e==null?0:+e),!this._next&&rr!==this&&(rr?rr._next=this:sn=this,rr=this),this._call=t,this._time=r,ws()},stop:function(){this._call&&(this._call=null,this._time=1/0,ws())}}});function ln(t,e,r){var n=new ar;return e=e==null?0:+e,n.restart(s=>{n.stop(),t(s+e)},e,r),n}var Bo=d(()=>{Ss()});var un=d(()=>{Ss();Bo()});function Ze(t,e,r,n,s,a){var i=t.__transition;if(!i)t.__transition={};else if(r in i)return;Kh(t,r,{name:e,index:n,group:s,on:Wh,tween:Zh,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Qo})}function or(t,e){var r=ne(t,e);if(r.state>Qo)throw new Error("too late; already scheduled");return r}function ie(t,e){var r=ne(t,e);if(r.state>hn)throw new Error("too late; already running");return r}function ne(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function Kh(t,e,r){var n=t.__transition,s;n[e]=r,r.timer=cn(a,0,r.time);function a(l){r.state=bs,r.timer.restart(i,r.delay,r.time),r.delay<=l&&i(l-r.delay)}function i(l){var u,h,p,g;if(r.state!==bs)return c();for(u in n)if(g=n[u],g.name===r.name){if(g.state===hn)return ln(i);g.state===Ho?(g.state=ir,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete n[u]):+u<e&&(g.state=ir,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete n[u])}if(ln(function(){r.state===hn&&(r.state=Ho,r.timer.restart(o,r.delay,r.time),o(l))}),r.state=fn,r.on.call("start",t,t.__data__,r.index,r.group),r.state===fn){for(r.state=hn,s=new Array(p=r.tween.length),u=0,h=-1;u<p;++u)(g=r.tween[u].value.call(t,t.__data__,r.index,r.group))&&(s[++h]=g);s.length=h+1}}function o(l){for(var u=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(c),r.state=dn,1),h=-1,p=s.length;++h<p;)s[h].call(t,u);r.state===dn&&(r.on.call("end",t,t.__data__,r.index,r.group),c())}function c(){r.state=ir,r.timer.stop(),delete n[e];for(var l in n)return;delete t.__transition}}var Wh,Zh,Qo,bs,fn,hn,Ho,dn,ir,ge=d(()=>{Jn();un();Wh=Kn("start","end","cancel","interrupt"),Zh=[],Qo=0,bs=1,fn=2,hn=3,Ho=4,dn=5,ir=6});function cr(t,e){var r=t.__transition,n,s,a=!0,i;if(!!r){e=e==null?null:e+"";for(i in r){if((n=r[i]).name!==e){a=!1;continue}s=n.state>fn&&n.state<dn,n.state=ir,n.timer.stop(),n.on.call(s?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete r[i]}a&&delete t.__transition}}var Vs=d(()=>{ge()});function Wo(t){return this.each(function(){cr(this,t)})}var Zo=d(()=>{Vs()});function Jh(t,e){var r,n;return function(){var s=ie(this,t),a=s.tween;if(a!==r){n=r=a;for(var i=0,o=n.length;i<o;++i)if(n[i].name===e){n=n.slice(),n.splice(i,1);break}}s.tween=n}}function ed(t,e,r){var n,s;if(typeof r!="function")throw new Error;return function(){var a=ie(this,t),i=a.tween;if(i!==n){s=(n=i).slice();for(var o={name:e,value:r},c=0,l=s.length;c<l;++c)if(s[c].name===e){s[c]=o;break}c===l&&s.push(o)}a.tween=s}}function Ko(t,e){var r=this._id;if(t+="",arguments.length<2){for(var n=ne(this.node(),r).tween,s=0,a=n.length,i;s<a;++s)if((i=n[s]).name===t)return i.value;return null}return this.each((e==null?Jh:ed)(r,t,e))}function At(t,e,r){var n=t._id;return t.each(function(){var s=ie(this,n);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return ne(s,n).value[e]}}var lr=d(()=>{ge()});function mn(t,e){var r;return(typeof e=="number"?Ee:e instanceof We?en:(r=We(e))?(e=r,en):ys)(t,e)}var js=d(()=>{Kr();Jt()});function td(t){return function(){this.removeAttribute(t)}}function rd(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nd(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttribute(t);return i===s?null:i===n?a:a=e(n=i,r)}}function sd(t,e,r){var n,s=r+"",a;return function(){var i=this.getAttributeNS(t.space,t.local);return i===s?null:i===n?a:a=e(n=i,r)}}function ad(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttribute(t):(i=this.getAttribute(t),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function id(t,e,r){var n,s,a;return function(){var i,o=r(this),c;return o==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),c=o+"",i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o)))}}function Jo(t,e){var r=ze(t),n=r==="transform"?vs:mn;return this.attrTween(t,typeof e=="function"?(r.local?id:ad)(r,n,At(this,"attr."+t,e)):e==null?(r.local?rd:td)(r):(r.local?sd:nd)(r,n,e))}var ec=d(()=>{Jt();Ce();lr();js()});function od(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function cd(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function ld(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&cd(t,a)),r}return s._value=e,s}function ud(t,e){var r,n;function s(){var a=e.apply(this,arguments);return a!==n&&(r=(n=a)&&od(t,a)),r}return s._value=e,s}function tc(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var n=ze(t);return this.tween(r,(n.local?ld:ud)(n,e))}var rc=d(()=>{Ce()});function fd(t,e){return function(){or(this,t).delay=+e.apply(this,arguments)}}function hd(t,e){return e=+e,function(){or(this,t).delay=e}}function nc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?fd:hd)(e,t)):ne(this.node(),e).delay}var sc=d(()=>{ge()});function dd(t,e){return function(){ie(this,t).duration=+e.apply(this,arguments)}}function md(t,e){return e=+e,function(){ie(this,t).duration=e}}function ac(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?dd:md)(e,t)):ne(this.node(),e).duration}var ic=d(()=>{ge()});function pd(t,e){if(typeof e!="function")throw new Error;return function(){ie(this,t).ease=e}}function oc(t){var e=this._id;return arguments.length?this.each(pd(e,t)):ne(this.node(),e).ease}var cc=d(()=>{ge()});function gd(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;ie(this,t).ease=r}}function lc(t){if(typeof t!="function")throw new Error;return this.each(gd(this._id,t))}var uc=d(()=>{ge()});function fc(t){typeof t!="function"&&(t=$t(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var a=e[s],i=a.length,o=n[s]=[],c,l=0;l<i;++l)(c=a[l])&&t.call(c,c.__data__,l,a)&&o.push(c);return new fe(n,this._parents,this._name,this._id)}var hc=d(()=>{Ce();Fe()});function dc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,n=e.length,s=r.length,a=Math.min(n,s),i=new Array(n),o=0;o<a;++o)for(var c=e[o],l=r[o],u=c.length,h=i[o]=new Array(u),p,g=0;g<u;++g)(p=c[g]||l[g])&&(h[g]=p);for(;o<n;++o)i[o]=e[o];return new fe(i,this._parents,this._name,this._id)}var mc=d(()=>{Fe()});function yd(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function xd(t,e,r){var n,s,a=yd(e)?or:ie;return function(){var i=a(this,t),o=i.on;o!==n&&(s=(n=o).copy()).on(e,r),i.on=s}}function pc(t,e){var r=this._id;return arguments.length<2?ne(this.node(),r).on.on(t):this.each(xd(r,t,e))}var gc=d(()=>{ge()});function _d(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function yc(){return this.on("end.remove",_d(this._id))}var xc=d(()=>{});function _c(t){var e=this._name,r=this._id;typeof t!="function"&&(t=st(t));for(var n=this._groups,s=n.length,a=new Array(s),i=0;i<s;++i)for(var o=n[i],c=o.length,l=a[i]=new Array(c),u,h,p=0;p<c;++p)(u=o[p])&&(h=t.call(u,u.__data__,p,o))&&("__data__"in u&&(h.__data__=u.__data__),l[p]=h,Ze(l[p],e,r,p,l,ne(u,r)));return new fe(a,this._parents,e,r)}var vc=d(()=>{Ce();Fe();ge()});function wc(t){var e=this._name,r=this._id;typeof t!="function"&&(t=Ut(t));for(var n=this._groups,s=n.length,a=[],i=[],o=0;o<s;++o)for(var c=n[o],l=c.length,u,h=0;h<l;++h)if(u=c[h]){for(var p=t.call(u,u.__data__,h,c),g,_=ne(u,r),x=0,w=p.length;x<w;++x)(g=p[x])&&Ze(g,e,r,x,p,_);a.push(p),i.push(u)}return new fe(a,i,e,r)}var Sc=d(()=>{Ce();Fe();ge()});function bc(){return new vd(this._groups,this._parents)}var vd,Vc=d(()=>{Ce();vd=Ne.prototype.constructor});function wd(t,e){var r,n,s;return function(){var a=Qe(this,t),i=(this.style.removeProperty(t),Qe(this,t));return a===i?null:a===r&&i===n?s:s=e(r=a,n=i)}}function jc(t){return function(){this.style.removeProperty(t)}}function Sd(t,e,r){var n,s=r+"",a;return function(){var i=Qe(this,t);return i===s?null:i===n?a:a=e(n=i,r)}}function bd(t,e,r){var n,s,a;return function(){var i=Qe(this,t),o=r(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(t),Qe(this,t))),i===c?null:i===n&&c===s?a:(s=c,a=e(n=i,o))}}function Vd(t,e){var r,n,s,a="style."+e,i="end."+a,o;return function(){var c=ie(this,t),l=c.on,u=c.value[a]==null?o||(o=jc(e)):void 0;(l!==r||s!==u)&&(n=(r=l).copy()).on(i,s=u),c.on=n}}function Tc(t,e,r){var n=(t+="")==="transform"?_s:mn;return e==null?this.styleTween(t,wd(t,n)).on("end.style."+t,jc(t)):typeof e=="function"?this.styleTween(t,bd(t,n,At(this,"style."+t,e))).each(Vd(this._id,t)):this.styleTween(t,Sd(t,n,e),r).on("end.style."+t,null)}var Ic=d(()=>{Jt();Ce();ge();lr();js()});function jd(t,e,r){return function(n){this.style.setProperty(t,e.call(this,n),r)}}function Td(t,e,r){var n,s;function a(){var i=e.apply(this,arguments);return i!==s&&(n=(s=i)&&jd(t,i,r)),n}return a._value=e,a}function Ec(t,e,r){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Td(t,e,r??""))}var Ac=d(()=>{});function Id(t){return function(){this.textContent=t}}function Ed(t){return function(){var e=t(this);this.textContent=e??""}}function Cc(t){return this.tween("text",typeof t=="function"?Ed(At(this,"text",t)):Id(t==null?"":t+""))}var Mc=d(()=>{lr()});function Ad(t){return function(e){this.textContent=t.call(this,e)}}function Cd(t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&Ad(s)),e}return n._value=t,n}function Rc(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Cd(t))}var Oc=d(()=>{});function kc(){for(var t=this._name,e=this._id,r=pn(),n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)if(c=i[l]){var u=ne(c,e);Ze(c,t,r,l,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new fe(n,this._parents,t,r)}var Pc=d(()=>{Fe();ge()});function Lc(){var t,e,r=this,n=r._id,s=r.size();return new Promise(function(a,i){var o={value:i},c={value:function(){--s==0&&a()}};r.each(function(){var l=ie(this,n),u=l.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(c)),l.on=e}),s===0&&a()})}var Yc=d(()=>{ge()});function fe(t,e,r,n){this._groups=t,this._parents=e,this._name=r,this._id=n}function Ts(t){return Ne().transition(t)}function pn(){return++Md}var Md,it,Fe=d(()=>{Ce();ec();rc();sc();ic();cc();uc();hc();mc();gc();xc();vc();Sc();Vc();Ic();Ac();Mc();Oc();Pc();lr();Yc();Md=0;it=Ne.prototype;fe.prototype=Ts.prototype={constructor:fe,select:_c,selectAll:wc,filter:fc,merge:dc,selection:bc,transition:kc,call:it.call,nodes:it.nodes,node:it.node,size:it.size,empty:it.empty,each:it.each,on:pc,attr:Jo,attrTween:tc,style:Tc,styleTween:Ec,text:Cc,textTween:Rc,remove:yc,tween:Ko,delay:nc,duration:ac,ease:oc,easeVarying:lc,end:Lc,[Symbol.iterator]:it[Symbol.iterator]}});function gn(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Dc=d(()=>{});var Is=d(()=>{Dc()});function Od(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function Xc(t){var e,r;t instanceof fe?(e=t._id,t=t._name):(e=pn(),(r=Rd).time=sr(),t=t==null?null:t+"");for(var n=this._groups,s=n.length,a=0;a<s;++a)for(var i=n[a],o=i.length,c,l=0;l<o;++l)(c=i[l])&&Ze(c,t,e,l,i,r||Od(c,e));return new fe(n,this._parents,t,e)}var Rd,zc=d(()=>{Fe();ge();Is();un();Rd={time:null,delay:0,duration:250,ease:gn}});var Nc=d(()=>{Ce();Zo();zc();Ne.prototype.interrupt=Wo;Ne.prototype.transition=Xc});var Fc=d(()=>{Fe();ge()});var yn=d(()=>{Nc();Fe();Fc();Vs()});var qc=d(()=>{});var Gc=d(()=>{});var Uc=d(()=>{});function $c(t){return[+t[0],+t[1]]}function kd(t){return[$c(t[0]),$c(t[1])]}function Es(t){return{type:t}}var J_,ev,tv,Bc=d(()=>{yn();qc();Gc();Uc();J_={name:"x",handles:["w","e"].map(Es),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},ev={name:"y",handles:["n","s"].map(Es),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},tv={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Es),input:function(t){return t==null?null:kd(t)},output:function(t){return t}}});var Qc=d(()=>{Bc()});var Hc=d(()=>{});var Wc=d(()=>{});var Zc=d(()=>{});var Kc=d(()=>{});var Jc=d(()=>{});var el=d(()=>{});var tl=d(()=>{});var rl=d(()=>{});function nl(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ot(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}var ur=d(()=>{});function sl(t){return t=ot(Math.abs(t)),t?t[1]:NaN}var al=d(()=>{ur()});function il(t,e){return function(r,n){for(var s=r.length,a=[],i=0,o=t[0],c=0;s>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),a.push(r.substring(s-=o,s+o)),!((c+=o+1)>n));)o=t[i=(i+1)%t.length];return a.reverse().join(e)}}var ol=d(()=>{});function cl(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var ll=d(()=>{});function fr(t){if(!(e=Pd.exec(t)))throw new Error("invalid format: "+t);var e;return new As({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function As(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}var Pd,ul=d(()=>{Pd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;fr.prototype=As.prototype;As.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function fl(t){e:for(var e=t.length,r=1,n=-1,s;r<e;++r)switch(t[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var hl=d(()=>{});function dl(t,e){var r=ot(t,e);if(!r)return t+"";var n=r[0],s=r[1],a=s-(Cs=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return a===i?n:a>i?n+new Array(a-i+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+ot(t,Math.max(0,e+a-1))[0]}var Cs,Ms=d(()=>{ur()});function Rs(t,e){var r=ot(t,e);if(!r)return t+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}var ml=d(()=>{ur()});var Os,pl=d(()=>{ur();Ms();ml();Os={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:nl,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Rs(t*100,e),r:Rs,s:dl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)}});function ks(t){return t}var gl=d(()=>{});function _l(t){var e=t.grouping===void 0||t.thousands===void 0?ks:il(yl.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?ks:cl(yl.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"\u2212":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(h){h=fr(h);var p=h.fill,g=h.align,_=h.sign,x=h.symbol,w=h.zero,V=h.width,E=h.comma,j=h.precision,W=h.trim,M=h.type;M==="n"?(E=!0,M="g"):Os[M]||(j===void 0&&(j=12),W=!0,M="g"),(w||p==="0"&&g==="=")&&(w=!0,p="0",g="=");var Y=x==="$"?r:x==="#"&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",ce=x==="$"?n:/[%p]/.test(M)?i:"",de=Os[M],Ae=/[defgprs%]/.test(M);j=j===void 0?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,j)):Math.max(0,Math.min(20,j));function je(R){var le=Y,re=ce,we,St,Ue;if(M==="c")re=de(R)+re,R="";else{R=+R;var $e=R<0||1/R<0;if(R=isNaN(R)?c:de(Math.abs(R),j),W&&(R=fl(R)),$e&&+R==0&&_!=="+"&&($e=!1),le=($e?_==="("?_:o:_==="-"||_==="("?"":_)+le,re=(M==="s"?xl[8+Cs/3]:"")+re+($e&&_==="("?")":""),Ae){for(we=-1,St=R.length;++we<St;)if(Ue=R.charCodeAt(we),48>Ue||Ue>57){re=(Ue===46?s+R.slice(we+1):R.slice(we))+re,R=R.slice(0,we);break}}}E&&!w&&(R=e(R,1/0));var Be=le.length+R.length+re.length,Se=Be<V?new Array(V-Be+1).join(p):"";switch(E&&w&&(R=e(Se+R,Se.length?V-re.length:1/0),Se=""),g){case"<":R=le+R+re+Se;break;case"=":R=le+Se+R+re;break;case"^":R=Se.slice(0,Be=Se.length>>1)+le+R+re+Se.slice(Be);break;default:R=Se+le+R+re;break}return a(R)}return je.toString=function(){return h+""},je}function u(h,p){var g=l((h=fr(h),h.type="f",h)),_=Math.max(-8,Math.min(8,Math.floor(sl(p)/3)))*3,x=Math.pow(10,-_),w=xl[8+_/3];return function(V){return g(x*V)+w}}return{format:l,formatPrefix:u}}var yl,xl,vl=d(()=>{al();ol();ll();ul();hl();pl();Ms();gl();yl=Array.prototype.map,xl=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function Ps(t){return xn=_l(t),wl=xn.format,Sl=xn.formatPrefix,xn}var xn,wl,Sl,bl=d(()=>{vl();Ps({thousands:",",grouping:[3],currency:["$",""]})});var Vl=d(()=>{bl()});var jl=d(()=>{});var Tl=d(()=>{});var Il=d(()=>{});var El=d(()=>{});function he(t,e,r,n){function s(a){return t(a=arguments.length===0?new Date:new Date(+a)),a}return s.floor=function(a){return t(a=new Date(+a)),a},s.ceil=function(a){return t(a=new Date(a-1)),e(a,1),t(a),a},s.round=function(a){var i=s(a),o=s.ceil(a);return a-i<o-a?i:o},s.offset=function(a,i){return e(a=new Date(+a),i==null?1:Math.floor(i)),a},s.range=function(a,i,o){var c=[],l;if(a=s.ceil(a),o=o==null?1:Math.floor(o),!(a<i)||!(o>0))return c;do c.push(l=new Date(+a)),e(a,o),t(a);while(l<a&&a<i);return c},s.filter=function(a){return he(function(i){if(i>=i)for(;t(i),!a(i);)i.setTime(i-1)},function(i,o){if(i>=i)if(o<0)for(;++o<=0;)for(;e(i,-1),!a(i););else for(;--o>=0;)for(;e(i,1),!a(i););})},r&&(s.count=function(a,i){return Ls.setTime(+a),Ys.setTime(+i),t(Ls),t(Ys),Math.floor(r(Ls,Ys))},s.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?s.filter(n?function(i){return n(i)%a==0}:function(i){return s.count(0,i)%a==0}):s}),s}var Ls,Ys,ct=d(()=>{Ls=new Date,Ys=new Date});var Ld,hr,Yd,lt,_n,Zv,Kv,dr=d(()=>{Ld=1e3,hr=Ld*60,Yd=hr*60,lt=Yd*24,_n=lt*7,Zv=lt*30,Kv=lt*365});var Al,vn,Dd,Cl=d(()=>{ct();dr();Al=he(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*hr)/lt,t=>t.getDate()-1),vn=Al,Dd=Al.range});function ut(t){return he(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r*7)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*hr)/_n})}var mr,Ct,Ml,Rl,Ke,Ol,kl,Pl,Xd,zd,Nd,Fd,qd,Gd,Ll=d(()=>{ct();dr();mr=ut(0),Ct=ut(1),Ml=ut(2),Rl=ut(3),Ke=ut(4),Ol=ut(5),kl=ut(6),Pl=mr.range,Xd=Ct.range,zd=Ml.range,Nd=Rl.range,Fd=Ke.range,qd=Ol.range,Gd=kl.range});var Ds,ft,Ud,Yl=d(()=>{ct();Ds=he(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Ds.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r*t)})};ft=Ds,Ud=Ds.range});var Dl,wn,$d,Xl=d(()=>{ct();dr();Dl=he(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/lt},function(t){return t.getUTCDate()-1}),wn=Dl,$d=Dl.range});function ht(t){return he(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r*7)},function(e,r){return(r-e)/_n})}var pr,Mt,zl,Nl,Je,Fl,ql,Gl,Bd,Qd,Hd,Wd,Zd,Kd,Ul=d(()=>{ct();dr();pr=ht(0),Mt=ht(1),zl=ht(2),Nl=ht(3),Je=ht(4),Fl=ht(5),ql=ht(6),Gl=pr.range,Bd=Mt.range,Qd=zl.range,Hd=Nl.range,Wd=Je.range,Zd=Fl.range,Kd=ql.range});var Xs,dt,Jd,$l=d(()=>{ct();Xs=he(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});Xs.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:he(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})};dt=Xs,Jd=Xs.range});var zs=d(()=>{Cl();Ll();Yl();Xl();Ul();$l()});function Ns(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Fs(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function gr(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function qs(t){var e=t.dateTime,r=t.date,n=t.time,s=t.periods,a=t.days,i=t.shortDays,o=t.months,c=t.shortMonths,l=yr(s),u=xr(s),h=yr(a),p=xr(a),g=yr(i),_=xr(i),x=yr(o),w=xr(o),V=yr(c),E=xr(c),j={a:$e,A:Be,b:Se,B:Ln,c:null,d:Kl,e:Kl,f:Sm,g:Rm,G:km,H:_m,I:vm,j:wm,L:Jl,m:bm,M:Vm,p:Yn,q:Dn,Q:au,s:iu,S:jm,u:Tm,U:Im,V:Em,w:Am,W:Cm,x:null,X:null,y:Mm,Y:Om,Z:Pm,"%":su},W={a:Xn,A:zn,b:Nn,B:Fn,c:null,d:tu,e:tu,f:Xm,g:Hm,G:Zm,H:Lm,I:Ym,j:Dm,L:ru,m:zm,M:Nm,p:qn,q:Gn,Q:au,s:iu,S:Fm,u:qm,U:Gm,V:Um,w:$m,W:Bm,x:null,X:null,y:Qm,Y:Wm,Z:Km,"%":su},M={a:je,A:R,b:le,B:re,c:we,d:Wl,e:Wl,f:pm,g:Hl,G:Ql,H:Zl,I:Zl,j:fm,L:mm,m:um,M:hm,p:Ae,q:lm,Q:ym,s:xm,S:dm,u:sm,U:am,V:im,w:nm,W:om,x:St,X:Ue,y:Hl,Y:Ql,Z:cm,"%":gm};j.x=Y(r,j),j.X=Y(n,j),j.c=Y(e,j),W.x=Y(r,W),W.X=Y(n,W),W.c=Y(e,W);function Y(T,O){return function(P){var S=[],ue=-1,z=0,me=T.length,pe,y,N;for(P instanceof Date||(P=new Date(+P));++ue<me;)T.charCodeAt(ue)===37&&(S.push(T.slice(z,ue)),(y=Bl[pe=T.charAt(++ue)])!=null?pe=T.charAt(++ue):y=pe==="e"?" ":"0",(N=O[pe])&&(pe=N(P,y)),S.push(pe),z=ue+1);return S.push(T.slice(z,ue)),S.join("")}}function ce(T,O){return function(P){var S=gr(1900,void 0,1),ue=de(S,T,P+="",0),z,me;if(ue!=P.length)return null;if("Q"in S)return new Date(S.Q);if("s"in S)return new Date(S.s*1e3+("L"in S?S.L:0));if(O&&!("Z"in S)&&(S.Z=0),"p"in S&&(S.H=S.H%12+S.p*12),S.m===void 0&&(S.m="q"in S?S.q:0),"V"in S){if(S.V<1||S.V>53)return null;"w"in S||(S.w=1),"Z"in S?(z=Fs(gr(S.y,0,1)),me=z.getUTCDay(),z=me>4||me===0?Mt.ceil(z):Mt(z),z=wn.offset(z,(S.V-1)*7),S.y=z.getUTCFullYear(),S.m=z.getUTCMonth(),S.d=z.getUTCDate()+(S.w+6)%7):(z=Ns(gr(S.y,0,1)),me=z.getDay(),z=me>4||me===0?Ct.ceil(z):Ct(z),z=vn.offset(z,(S.V-1)*7),S.y=z.getFullYear(),S.m=z.getMonth(),S.d=z.getDate()+(S.w+6)%7)}else("W"in S||"U"in S)&&("w"in S||(S.w="u"in S?S.u%7:"W"in S?1:0),me="Z"in S?Fs(gr(S.y,0,1)).getUTCDay():Ns(gr(S.y,0,1)).getDay(),S.m=0,S.d="W"in S?(S.w+6)%7+S.W*7-(me+5)%7:S.w+S.U*7-(me+6)%7);return"Z"in S?(S.H+=S.Z/100|0,S.M+=S.Z%100,Fs(S)):Ns(S)}}function de(T,O,P,S){for(var ue=0,z=O.length,me=P.length,pe,y;ue<z;){if(S>=me)return-1;if(pe=O.charCodeAt(ue++),pe===37){if(pe=O.charAt(ue++),y=M[pe in Bl?O.charAt(ue++):pe],!y||(S=y(T,P,S))<0)return-1}else if(pe!=P.charCodeAt(S++))return-1}return S}function Ae(T,O,P){var S=l.exec(O.slice(P));return S?(T.p=u.get(S[0].toLowerCase()),P+S[0].length):-1}function je(T,O,P){var S=g.exec(O.slice(P));return S?(T.w=_.get(S[0].toLowerCase()),P+S[0].length):-1}function R(T,O,P){var S=h.exec(O.slice(P));return S?(T.w=p.get(S[0].toLowerCase()),P+S[0].length):-1}function le(T,O,P){var S=V.exec(O.slice(P));return S?(T.m=E.get(S[0].toLowerCase()),P+S[0].length):-1}function re(T,O,P){var S=x.exec(O.slice(P));return S?(T.m=w.get(S[0].toLowerCase()),P+S[0].length):-1}function we(T,O,P){return de(T,e,O,P)}function St(T,O,P){return de(T,r,O,P)}function Ue(T,O,P){return de(T,n,O,P)}function $e(T){return i[T.getDay()]}function Be(T){return a[T.getDay()]}function Se(T){return c[T.getMonth()]}function Ln(T){return o[T.getMonth()]}function Yn(T){return s[+(T.getHours()>=12)]}function Dn(T){return 1+~~(T.getMonth()/3)}function Xn(T){return i[T.getUTCDay()]}function zn(T){return a[T.getUTCDay()]}function Nn(T){return c[T.getUTCMonth()]}function Fn(T){return o[T.getUTCMonth()]}function qn(T){return s[+(T.getUTCHours()>=12)]}function Gn(T){return 1+~~(T.getUTCMonth()/3)}return{format:function(T){var O=Y(T+="",j);return O.toString=function(){return T},O},parse:function(T){var O=ce(T+="",!1);return O.toString=function(){return T},O},utcFormat:function(T){var O=Y(T+="",W);return O.toString=function(){return T},O},utcParse:function(T){var O=ce(T+="",!0);return O.toString=function(){return T},O}}}function D(t,e,r){var n=t<0?"-":"",s=(n?-t:t)+"",a=s.length;return n+(a<r?new Array(r-a+1).join(e)+s:s)}function rm(t){return t.replace(tm,"\\$&")}function yr(t){return new RegExp("^(?:"+t.map(rm).join("|")+")","i")}function xr(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function nm(t,e,r){var n=ae.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function sm(t,e,r){var n=ae.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function am(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function im(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function om(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function Ql(t,e,r){var n=ae.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function Hl(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function cm(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function lm(t,e,r){var n=ae.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function um(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function Wl(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function fm(t,e,r){var n=ae.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function Zl(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function hm(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function dm(t,e,r){var n=ae.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function mm(t,e,r){var n=ae.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function pm(t,e,r){var n=ae.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function gm(t,e,r){var n=em.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function ym(t,e,r){var n=ae.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function xm(t,e,r){var n=ae.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function Kl(t,e){return D(t.getDate(),e,2)}function _m(t,e){return D(t.getHours(),e,2)}function vm(t,e){return D(t.getHours()%12||12,e,2)}function wm(t,e){return D(1+vn.count(ft(t),t),e,3)}function Jl(t,e){return D(t.getMilliseconds(),e,3)}function Sm(t,e){return Jl(t,e)+"000"}function bm(t,e){return D(t.getMonth()+1,e,2)}function Vm(t,e){return D(t.getMinutes(),e,2)}function jm(t,e){return D(t.getSeconds(),e,2)}function Tm(t){var e=t.getDay();return e===0?7:e}function Im(t,e){return D(mr.count(ft(t)-1,t),e,2)}function eu(t){var e=t.getDay();return e>=4||e===0?Ke(t):Ke.ceil(t)}function Em(t,e){return t=eu(t),D(Ke.count(ft(t),t)+(ft(t).getDay()===4),e,2)}function Am(t){return t.getDay()}function Cm(t,e){return D(Ct.count(ft(t)-1,t),e,2)}function Mm(t,e){return D(t.getFullYear()%100,e,2)}function Rm(t,e){return t=eu(t),D(t.getFullYear()%100,e,2)}function Om(t,e){return D(t.getFullYear()%1e4,e,4)}function km(t,e){var r=t.getDay();return t=r>=4||r===0?Ke(t):Ke.ceil(t),D(t.getFullYear()%1e4,e,4)}function Pm(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+D(e/60|0,"0",2)+D(e%60,"0",2)}function tu(t,e){return D(t.getUTCDate(),e,2)}function Lm(t,e){return D(t.getUTCHours(),e,2)}function Ym(t,e){return D(t.getUTCHours()%12||12,e,2)}function Dm(t,e){return D(1+wn.count(dt(t),t),e,3)}function ru(t,e){return D(t.getUTCMilliseconds(),e,3)}function Xm(t,e){return ru(t,e)+"000"}function zm(t,e){return D(t.getUTCMonth()+1,e,2)}function Nm(t,e){return D(t.getUTCMinutes(),e,2)}function Fm(t,e){return D(t.getUTCSeconds(),e,2)}function qm(t){var e=t.getUTCDay();return e===0?7:e}function Gm(t,e){return D(pr.count(dt(t)-1,t),e,2)}function nu(t){var e=t.getUTCDay();return e>=4||e===0?Je(t):Je.ceil(t)}function Um(t,e){return t=nu(t),D(Je.count(dt(t),t)+(dt(t).getUTCDay()===4),e,2)}function $m(t){return t.getUTCDay()}function Bm(t,e){return D(Mt.count(dt(t)-1,t),e,2)}function Qm(t,e){return D(t.getUTCFullYear()%100,e,2)}function Hm(t,e){return t=nu(t),D(t.getUTCFullYear()%100,e,2)}function Wm(t,e){return D(t.getUTCFullYear()%1e4,e,4)}function Zm(t,e){var r=t.getUTCDay();return t=r>=4||r===0?Je(t):Je.ceil(t),D(t.getUTCFullYear()%1e4,e,4)}function Km(){return"+0000"}function su(){return"%"}function au(t){return+t}function iu(t){return Math.floor(+t/1e3)}var Bl,ae,em,tm,ou=d(()=>{zs();Bl={"-":"",_:" ","0":"0"},ae=/^\s*\d+/,em=/^%/,tm=/[\\^$*+?|[\]().{}]/g});function Gs(t){return Rt=qs(t),cu=Rt.format,lu=Rt.parse,uu=Rt.utcFormat,fu=Rt.utcParse,Rt}var Rt,cu,lu,uu,fu,hu=d(()=>{ou();Gs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});var du=d(()=>{hu()});var mu=d(()=>{});var pu=d(()=>{});var gu=d(()=>{});var yu=d(()=>{});var xu=d(()=>{});function mt(t,e,r){this.k=t,this.x=e,this.y=r}function $s(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Us;return t.__zoom}var Us,Bs=d(()=>{mt.prototype={constructor:mt,scale:function(t){return t===1?this:new mt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new mt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Us=new mt(1,0,0);$s.prototype=mt.prototype});var _u=d(()=>{});var vu=d(()=>{yn();yu();xu();Bs();_u()});var wu=d(()=>{vu();Bs()});var pt=d(()=>{Ya();Da();Xa();Qc();Wc();Kr();Zc();Kc();Jn();po();Jc();Is();el();rl();Vl();jl();Tl();Jt();Hc();Il();tl();El();mu();pu();Ce();gu();zs();du();un();yn();wu()});var Su=d(()=>{Xr();pt();J.register("SliderTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{$(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove();let r=e.getSharedVar("x1")??0,n=e.getSharedVar("x2")??0,s=e.getSharedVar("height")??0,a=e.getSharedVar("fill")??"#000000",i=e.getSharedVar("opacity")??.3;$(t.getGraphic()).append("rect").attr("x1",r).attr("x2",n).attr("width",n-r).attr("height",s).attr("fill",a).attr("opacity",i)}});J.register("HighlightSelection",{constructor:J,redraw({layer:t,transformer:e}){let r=$(t.getGraphic()).selectAll(e.getSharedVar("selector")||"*");Object.entries(e.getSharedVar("highlightAttrValues")).forEach(([s,a])=>{r.attr(s,a)})}});J.register("TransientRectangleTransformer",{constructor:J,className:["draw-shape","transient-shape","rectangle-shape"],redraw:({layer:t,transformer:e})=>{$(t.getGraphic()).selectAll(":not(.ig-layer-background)").remove(),$(t.getGraphic()).append("rect").attr("x",e.getSharedVar("x")).attr("y",e.getSharedVar("y")).attr("width",e.getSharedVar("width")).attr("height",e.getSharedVar("height")).attr("fill",e.getSharedVar("fillColor")).attr("opacity",e.getSharedVar("opacity"))}});J.register("SelectionTransformer",{constructor:J,redraw:({layer:t,transformer:e})=>{e.getSharedVar("result").forEach(s=>{t.getGraphic().appendChild(s)});let r=e.getSharedVar("highlightColor"),n=Object.entries(e.getSharedVar("highlightAttrValues")||{});if(r||n.length){let s=Ie(e.getSharedVar("result"));r&&s.attr("fill",r).attr("stroke",r),n.forEach(([a,i])=>{s.attr(a,i)})}}});J.register("HelperLineTransformer",{constructor:J,transient:!0,sharedVar:{orientation:["horizontal","vertical"],style:{}},redraw({layer:t,transformer:e}){let r=t.getLayerFromQueue("mainLayer"),n=e.getSharedVar("orientation"),s=e.getSharedVar("style"),a=e.getSharedVar("x"),i=e.getSharedVar("y"),o=e.getSharedVar("tooltip"),c=e.getSharedVar("scaleX"),l=e.getSharedVar("scaleY"),u=[],h=0,p=0;o&&(typeof o=="object"&&o.prefix&&u.push(o.prefix),c&&c.invert&&typeof a=="number"&&u.push(c.invert(a-(t._offset?.x??0))),l&&l.invert&&typeof i=="number"&&u.push(l.invert(i-(t._offset?.y??0))),typeof o=="object"&&o.suffix&&u.push(o.suffix),typeof o=="object"&&o.offset&&(typeof o.offset.x=="number"&&(h=o.offset.x),typeof o.offset.y=="number"&&(p=o.offset.y),typeof o.offset.x=="function"&&typeof a=="number"&&(h=o.offset.x(a-(t._offset?.x??0))),typeof o.offset.y=="function"&&typeof i=="number"&&(p=o.offset.y(i-(t._offset?.y??0)))));let g=u.join(" ");if(n.includes("horizontal")&&typeof i=="number"){let _=$(t.getGraphic()).append("line").attr("x1",0).attr("x2",r.getGraphic().getBoundingClientRect().width).attr("y1",i-(t._offset?.y??0)).attr("y2",i-(t._offset?.y??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}if(n.includes("vertical")&&typeof a=="number"){let _=$(t.getGraphic()).append("line").attr("y1",0).attr("y2",r.getGraphic().getBoundingClientRect().height).attr("x1",a-(t._offset?.x??0)).attr("x2",a-(t._offset?.x??0)).attr("stroke-width",1).attr("stroke","#000");s&&Object.entries(s).forEach(([x,w])=>{_.attr(x,w)})}g&&$(t.getGraphic()).append("text").attr("x",a-(t._offset?.x??0)).attr("y",i-(t._offset?.y??0)).text(g)}});J.register("TextTransformer",{constructor:J,transient:!0,sharedVar:{style:{},content:"",field:null},redraw({layer:t,transformer:e}){let r=e.getSharedVar("style"),n=e.getSharedVar("offsetx")||e.getSharedVar("x"),s=e.getSharedVar("offsety")||e.getSharedVar("y"),a=e.getSharedVar("content"),i=e.getSharedVar("field"),o=e.getSharedVar("result"),c=e.getSharedVar("position"),l=a,u=n,h=s;if(i){let p=t.getDatum(o);if(p)if(l=p?.[i]??"",c instanceof Function){let{x:g,y:_}=c(p);u=g??u,h=_??h}else u=c?.x??u,h=c?.y??h;else l=""}$(t.getGraphic()).append("text").attr("x",u).attr("y",h).text(l).call(p=>{r&&Object.entries(r).forEach(([g,_])=>{p.style(g,_)})})}})});var _r,Qs,H,qe=d(()=>{Xr();Xr();Su();_r=J,Qs=Vt,H=J});var bu,Ot,Sn,L,Jm,DS,ep,Vu,kt=d(()=>{_e();qe();Ot={},Sn=[],L=class{constructor(e,r){this.joining=!1,this._linkCache={},this._transformers=[],this._joinTransformers=[],this._services=[],this._joinServices=[],this._initializing=null,this._nextTick=0,this._computing=null,this._result=null,this._oldResult=null,this[bu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._sharedVar={},this._transformers=r.transformers??[],this._joinTransformers=r.joinTransformers??[],this._services=r.services??[],this._joinServices=r.joinServices??[],this._layerInstances=[],this._resultAlias=r.resultAlias??"result",this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._initializing=Promise.all(Object.entries(r.sharedVar||{}).map(n=>this.setSharedVar(n[0],n[1]))).then(async()=>{r.postUpdate&&r.postUpdate.call(this,this),this._postUpdate=r.postUpdate??null,this._initializing=null}),r.layer&&this._layerInstances.push(r.layer),Sn.push(this),r.postInitialize&&r.postInitialize.call(this,this)}getSharedVar(e,r){if(!(r&&r.layer&&this._layerInstances.length&&!this._layerInstances.includes(r.layer)))return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}async setSharedVar(e,r,n){if(this.preUpdate(),this._sharedVar[e]=r,this._userOptions.evaluate&&this._resultAlias){if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._oldResult=this._result;try{this._computing=this._userOptions.evaluate({self:this,...this._userOptions.params??{},...this._sharedVar}),this._result=await this._computing,this._computing=null,this._services.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})}),this._transformers.forEach(s=>{s.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result})})}catch(s){console.error(s),this._result=void 0,this._computing=null}this._nextTick=0,this.postUpdate()})}else this.postUpdate()}async setSharedVars(e,r){Object.entries(e).forEach(([n,s])=>{this._sharedVar[n]=s}),Object.keys(e).length>0&&await this.setSharedVar(...Object.entries(e)[0],r)}async join(){if(this._resultAlias){this.joining=!0,Object.keys(this._sharedVar).length&&this.setSharedVar(...Object.entries(this._sharedVar)[0]);let e=await this._internalResults;this._joinServices&&this._joinServices.length?await Promise.all(this._joinServices.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))):this._initializing||await Promise.all(this._services.map(async r=>(await r.setSharedVar(this._resultAlias,e),r.results))),this._joinTransformers&&this._joinTransformers.length?await Promise.all(this._joinTransformers.map(r=>r.setSharedVar(this._resultAlias,e))):this._initializing||await Promise.all(this._transformers.map(r=>r.setSharedVar(this._resultAlias,e)))}}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}preAttach(e){this._preAttach&&this._preAttach.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return this._baseName===e||this._name===e}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>{e.setSharedVars({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}),this._transformers.splice(this._transformers.indexOf(e),1)},this)}get services(){return ve(this._services.slice(0),L,e=>this._services.push(e),e=>{Object.entries({...this._resultAlias?{[this._resultAlias]:null}:{},result:null}).forEach(([r,n])=>{e.setSharedVar(r,n)}),this._services.splice(this._services.indexOf(e),1)},this)}get _internalResults(){return this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing?e(await this._computing):e(this._result)})}):this._computing||this._result}get results(){return this._initializing?this._initializing.then(()=>this._internalResults):this._internalResults}get oldResults(){return this._initializing?this._initializing.then(()=>this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult):this._nextTick?new Promise(e=>{window.requestAnimationFrame(async()=>{this._computing&&await this._computing,e(this._oldResult)})}):this._oldResult}static register(e,r){Ot[e]=r}static unregister(e){return delete Ot[e],!0}static initialize(e,r){let n=Object.assign({constructor:L},Ot[e]??{},r??{},{on:Object.assign({},(Ot[e]??{}).on??{},r?.on??{}),sharedVar:Object.assign({},(Ot[e]??{}).sharedVar??{},r?.sharedVar??{}),params:Object.assign({},(Ot[e]??{}).params??{},r?.params??{})});return new n.constructor(e,n)}static findService(e){return Sn.filter(r=>r.isInstanceOf(e))}};bu=xe;Jm=L.register,DS=L.unregister,ep=L.initialize,Vu=L.findService});var Ve,Hs=d(()=>{kt();_e();qe();Ve=class extends L{constructor(e,r){super(e,{...r,resultAlias:r?.resultAlias??"result"});this._currentDimension=[],this._transformers.push(H.initialize("SelectionTransformer",{transient:!0,sharedVar:{[this._resultAlias]:[],layer:null,highlightColor:r?.sharedVar?.highlightColor,highlightAttrValues:r?.sharedVar?.highlightAttrValues}})),this._selectionMapping=new Map,Object.entries({...this._userOptions?.query?.attrName?typeof this._userOptions.query.attrName=="string"?{[this._userOptions.query.attrName]:this._userOptions?.query?.extent??[]}:Object.fromEntries(this._userOptions.query.attrName.map((n,s)=>[n,this._userOptions?.query?.extent?.[s]??[]])):{},...this._sharedVar?.attrName?typeof this._sharedVar.attrName=="string"?{[this._sharedVar.attrName]:this._sharedVar?.extent??[]}:Object.fromEntries(this._sharedVar.attrName.map((n,s)=>[n,this._sharedVar?.extent?.[s]??[]])):{}}).filter(([n,s])=>s instanceof Array).forEach(([n,s])=>this._selectionMapping.set(n,s))}async setSharedVar(e,r,n){if(!(n&&n.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(n.layer)))if(this.preUpdate(),this._sharedVar[e]=r,this._transformers.filter(s=>s.isInstanceOf("draw-shape")).forEach(s=>{let a=n?.layer||this._layerInstances[0];if(!a)return;let i=a.getGraphic().getBoundingClientRect();if(a._width&&i.width>a._width||a._height&&i.height>a._height){let h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width",a._width.toString()),h.setAttribute("height",a._height.toString()),h.setAttribute("opacity","0"),a.getGraphic().appendChild(h),i=h.getBoundingClientRect(),a.getGraphic().removeChild(h)}let o=this._sharedVar.x??i.left,c=this._sharedVar.y??i.top,l=this._sharedVar.width??a._width??0,u=this._sharedVar.height??a._height??0;(this._sharedVar.width!==void 0||this._sharedVar.height!==void 0)&&s.setSharedVars({layer:a.getLayerFromQueue("transientLayer"),x:o-i.left,y:c-i.top,width:l,height:u})}),(n?.layer||this._layerInstances.length==1)&&this._userOptions.query){let s=n?.layer||this._layerInstances[0];if(this._nextTick)return;this._nextTick=requestAnimationFrame(async()=>{this._evaluate(s)})}else this.postUpdate()}_evaluate(e){if(!e)return;this._sharedVar.skipPicking||(this._oldResult=this._result,this._result=e.picking({...this._userOptions.query,...this._sharedVar}));let r=e.getLayerFromQueue("selectionLayer").getGraphic();for(;r?.firstChild;)r.removeChild(r.lastChild);if(this._sharedVar.deepClone){let n=[],s=[];this._result.forEach(a=>{if(a!==e.getGraphic()){let i=s.length;for(let o=0;o<i;o++){let c=s[o],l=n[o];a.contains(c)&&(s.splice(o,1),n.splice(o,1),l.remove(),o--,i--)}n.push(e.cloneVisualElements(a,!0)),s.push(a)}}),this._services.forEach(a=>{a.setSharedVars({...this._sharedVar,[this._resultAlias]:n})}),this._transformers.filter(a=>!a.isInstanceOf("draw-shape")).forEach(a=>{a.setSharedVars({...this._sharedVar,layer:e.getLayerFromQueue("selectionLayer"),[this._resultAlias]:n})})}else this._services.forEach(n=>{n.setSharedVars({...this._sharedVar,[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})}),this._transformers.filter(n=>!n.isInstanceOf("draw-shape")).forEach(n=>{n.setSharedVars({...this._sharedVar,layer:e.getLayerFromQueue("selectionLayer"),[this._resultAlias]:this._result?this._result.map(s=>e.cloneVisualElements(s,!1)):[]})});if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert&&this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.offsety,a=this._sharedVar.width,i=this._sharedVar.height,o=e._offset?.x??0,c=e._offset?.y??0,l=[n-o,n-o+a].map(this._sharedVar.scaleX.invert),u=[s-c,s-c+i].map(this._sharedVar.scaleY.invert);this.filter([l,u],{passive:!0})}else if(this._sharedVar.scaleX&&this._sharedVar.scaleX.invert){let n=this._sharedVar.offsetx,s=this._sharedVar.width,a=e._offset?.x??0,i=[n-a,n-a+s].map(this._sharedVar.scaleX.invert);this.filter(i,{passive:!0})}else if(this._sharedVar.scaleY&&this._sharedVar.scaleY.invert){let n=this._sharedVar.offsety,s=this._sharedVar.height,a=e._offset?.y??0,i=[n-a,n-a+s].map(this._sharedVar.scaleY.invert);this.filter(i,{passive:!0})}this._nextTick=0,this.postUpdate()}isInstanceOf(e){return e==="SelectionService"||this._baseName===e||this._name===e}dimension(e,r){let n=[],s=[];typeof e=="string"?(n=[e],s=[r??(c=>c)]):(n=oe(e),s=r??n.map(()=>c=>c));let a=n.map((c,l)=>[c,s[l]]),i={},o=[];return this._currentDimension=a,new Proxy(this,{get(c,l,u){return l==="dimension"?c.dimension.bind(c):l==="_currentDimension"?a:l==="_scopeMode"?!0:l==="_sharedVar"?Object.keys(i).length?new Proxy({...c._sharedVar,scaleX:void 0,scaleY:void 0,...i},{set:(h,p,g)=>(i[p]=g,!0)}):new Proxy(c._sharedVar,{set:(h,p,g)=>(i[p]=g,!0)}):l==="_layerInstances"?o.length?o:c._layerInstances:c[l]instanceof Function?c[l].bind(u):c[l]},set(c,l,u){return l==="_layerInstances"?(o=u,!0):(c[l]=u,!0)}})}filter(e,r){if(r&&r.layer&&this._layerInstances.length!==0&&!this._layerInstances.includes(r.layer))return this;let n=r?.layer||this._layerInstances[0];return this._currentDimension.length===0&&e instanceof Array&&e.length>0?(this._sharedVar.attrName&&(this._userOptions.query.attrName=this._sharedVar.attrName),this._userOptions.query.attrName&&this.dimension(this._userOptions.query.attrName).filter(e)):this._currentDimension.length===1&&e instanceof Array&&e.length>0&&!(e[0]instanceof Array)?(this._selectionMapping.set(this._currentDimension[0][0],this._currentDimension[0][1](e).sort((s,a)=>typeof s=="number"?s-a:s<a?-1:s==a?0:1)),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})):this._currentDimension.length===e.length&&e.every(s=>s instanceof Array)&&(this._currentDimension.forEach((s,a)=>{this._selectionMapping.set(s[0],s[1](e[a]).sort((i,o)=>typeof i=="number"?i-o:i<o?-1:i==o?0:1))}),r?.passive||(this._sharedVar.attrName=[...this._selectionMapping.keys()],this._sharedVar.extent=[...this._selectionMapping.values()],this._evaluate(n)),this._services.forEach(s=>{s.setSharedVar("extents",this.extents)}),this._transformers.forEach(s=>{s.setSharedVar("extents",this.extents)})),this}get extents(){return Object.fromEntries(this._selectionMapping.entries())}};L.SelectionService=Ve;L.register("SelectionService",{constructor:Ve});L.register("SurfacePointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:G.SurfacePoint,x:0,y:0}});L.register("PointSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:G.Point,x:0,y:0}});L.register("RectSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Shape,type:G.Rect,x:0,y:0,width:1,height:1}});L.register("CircleSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:G.Circle,x:0,y:0,r:1}});L.register("PolygonSelectionService",{constructor:Ve,query:{baseOn:te.Shape,type:G.Polygon,points:[]}});L.register("QuantitativeSelectionService",{constructor:Ve,transformers:[H.initialize("TransientRectangleTransformer",{sharedVar:{x:0,y:0,width:0,height:0,opacity:.3}})],query:{baseOn:te.Data,type:et.Quantitative,attrName:"",extent:[0,0]}})});var vr,ju=d(()=>{kt();vr=class extends L{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="LayoutService"||this._baseName===e||this._name===e}};L.LayoutService=vr;L.register("LayoutService",{constructor:vr});L.register("ScaleService",{constructor:vr,evaluate({offsetx:t,width:e,offsety:r,height:n,scaleX:s,scaleY:a,layer:i,self:o}){let c=i;if(!c&&o._layerInstances&&o._layerInstances.length==1&&(c=o._layerInstances[0]),s&&s.invert&&!a){if(e<=0||isNaN(e))return s;let l=s.copy(),u=l.invert(t-(c?._offset?.x??0)),h=l.invert(t+e-(c?._offset?.x??0));return l.domain([u,h]),l.clamp(!0),l}if(!s&&a&&a.invert){if(n<=0||isNaN(n))return a;let l=a.copy(),u=l.invert(r-(c?._offset?.y??0)),h=l.invert(r+n-(c?._offset?.y??0));return l.domain([u,h]),l.clamp(!0),l}if(s&&a&&s.invert&&a.invert){if(e<=0||isNaN(e)||n<=0||isNaN(n))return{scaleX:s,scaleY:a};let l=s.copy(),u=a.copy(),h=l.invert(t-(c?._offset?.x??0)),p=l.invert(t+e-(c?._offset?.x??0)),g=u.invert(r-(c?._offset?.y??0)),_=u.invert(r+n-(c?._offset?.y??0));return l.domain([h,p]),u.domain([g,_]),l.clamp(!0),u.clamp(!0),{scaleX:l,scaleY:u}}return{scaleX:s,scaleY:a}}})});var gt,Tu=d(()=>{kt();pt();gt=class extends L{constructor(e,r){super(e,{...r,resultAlias:r.resultAlias??"result"})}isInstanceOf(e){return e==="AnalysisService"||this._baseName===e||this._name===e}};L.AnalysisService=gt;L.register("AnalysisService",{constructor:gt});L.register("FilterService",{constructor:gt,evaluate({data:t,extents:e,result:r,fields:n,self:s}){if(!e&&(!r||!r.length||!n||!n.length))return e?t:[];if(e)Object.entries(e).forEach(([a,i])=>{i[0]>=i[1]||isNaN(i[0])||isNaN(i[1])||(t=t.filter(o=>o[a]>=i[0]&&o[a]<=i[1]))});else{let a=s._layerInstances,i=Ie(r).datum();a&&a.length>0&&(i=a[0].getDatum(r[0])),i&&n.forEach(o=>{t=t.filter(c=>c[o]==i[o])})}return t}});L.register("InterpolationService",{constructor:gt,evaluate({result:t,field:e,data:r,formula:n}){if(!t)return null;let{data:s,interpolatedNum:a}=t;if(!s||a===void 0||isNaN(a))return null;let i=Math.floor(a),o=s[i][e],c=r.filter(l=>l[e]===o);if(a>i){let l=i+1,u=a-i;c=c.map(h=>{let p=r.find(g=>g[e]===s[l][e]&&!Object.entries(h).find(([_,x])=>typeof x!="number"&&g[_]!==x));return Object.fromEntries(Object.entries(h).map(([g,_])=>typeof _=="number"?[g,_*(1-u)+p[g]*u]:[g,_]))})}return c.map(l=>(n&&Object.entries(n).forEach(([u,h])=>{l[u]=h(l)}),l))}});L.register("AggregateService",{constructor:gt,evaluate({result:t}){return t instanceof Array?t.length:0}})});var Iu,Ws,Z,Pt=d(()=>{kt();kt();Hs();ju();Tu();Iu=Vu,Ws=Sn,Z=L});var Eu,Au=d(()=>{Eu=`#JSGF V1.0;

grammar actions;

public <action> = start | stop | pause | resume | play | delete | add | insert | create | remove | drag | move | drag | brush;`});function Ks(t){let e=t.events.map(r=>{if(typeof r=="string")return Vn(r)[0];{let n=Vn("*")[0];n.filterFuncs=[r]}});return{...t,eventStreams:e.map(r=>np(r))}}function np(t){return t.filter?{...t,filterFuncs:t.filter?t.filter.map(e=>new Function("event",`return ${e}`)):[]}:{...t}}var Cu,tp,rp,Zs,bn,X,sb,ab,ib,ob,wr=d(()=>{_e();Au();tp=window.SpeechRecognition||window.webkitSpeechRecognition,rp=window.SpeechGrammarList||window.webkitSpeechGrammarList,Zs={},bn=[],X=class{constructor(e,r){this[Cu]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._state=r.state,this._actions=oe(r.actions??[]).map(Ks),this._modalities={},this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUse=r.preUse??null,this._postUse=r.postUse??null,r.postInitialize&&r.postInitialize.call(this,this)}enableModality(e){switch(e){case"speech":if(this._modalities.speech)break;let r=new tp;this._modalities.speech=r;let n=new rp;n.addFromString(Eu),r.grammars=n,r.lang="en-US";break}}disableModality(e){switch(e){case"speech":this._modalities.speech&&(this._modalities.speech.onresult=null,this._modalities.speech.onend=null,this._modalities.speech.abort(),this._modalities.speech=null);break}}getActions(){return this._actions.slice(0)}setActions(e){let r=e.concat(this._actions);this._actions=r.filter((n,s)=>s===r.findIndex(a=>a.action===n.action))}_parseEvent(e){let r=n=>"stream"in n?n.between.concat(n.stream).flatMap(r):"between"in n?n.between.concat([{type:n.type}]).flatMap(r):n.type;return Vn(e).flatMap(r)}getAcceptEvents(){return[...new Set(this._actions.flatMap(e=>e.eventStreams.flatMap(r=>r.type)).concat(["contextmenu"]))]}async dispatch(e,r){let n=this._actions.find(s=>{let a=s.eventStreams.map(o=>o.type),i=!1;return a.includes("*")&&(i=!0),e instanceof Event?i=s.eventStreams.filter(o=>o.type===e.type).some(o=>o.filterFuncs?o.filterFuncs.every(c=>c(e)):!0):a.includes(e)&&(i=!0),i&&(!s.transition||s.transition.find(o=>o[0]===this._state||o[0]==="*"))});if(n){let s=n.transition&&n.transition.find(a=>a[0]===this._state||a[0]==="*");if(s){if(this._state=s[1],this._state.startsWith("speech:")){this.enableModality("speech");try{this._modalities.speech.start()}catch{}this._modalities.speech.onresult=a=>{let i=a.results[a.resultIndex][0];this.dispatch(i.transcript,r)},this._modalities.speech.onend=a=>{this._modalities.speech.start()}}else this.disableModality("speech");if(n.sideEffect)try{await n.sideEffect({self:this,layer:r,instrument:null,interactor:this,event:e})}catch(a){console.error(a)}return!0}}return!1}preUse(e){this._preUse&&this._preUse.call(this,this,e)}postUse(e){this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return e=="Interactor"||this._baseName===e||this._name===e}static register(e,r){Zs[e]=r}static unregister(e){return delete Zs[e],!0}static initialize(e,r){let n=Object.assign({constructor:X},Zs[e]??{},r??{}),s=new n.constructor(e,n);return bn.push(s),s}static findInteractor(e){return bn.filter(r=>r.isInstanceOf(e))}};Cu=xe;sb=X.register,ab=X.unregister,ib=X.initialize,ob=X.findInteractor});var Mu=d(()=>{wr();X.register("MousePositionInteractor",{constructor:X,state:"start",actions:[{action:"hover",events:["mousemove"],transition:[["start","start"]]},{action:"click",events:["mouseup"],transition:[["start","start"]]}]});X.register("TouchPositionInteractor",{constructor:X,state:"start",actions:[{action:"enter",events:["touchstart"],transition:[["start","running"]]},{action:"hover",events:["touchmove"],transition:[["running","running"]]},{action:"leave",events:["touchend"],transition:[["running","start"],["start","start"]]}]});X.register("MouseTraceInteractor",{constructor:X,state:"start",actions:[{action:"dragabort",events:["mousedown[event.button==2]","mouseup[event.button==2]"],transition:[["drag","start"]]},{action:"dragstart",events:["mousedown"],transition:[["start","drag"]]},{action:"drag",events:["mousemove"],transition:[["drag","drag"]]},{action:"dragend",events:["mouseup[event.button==0]"],transition:[["drag","start"]]}]});X.register("TouchTraceInteractor",{constructor:X,state:"start",actions:[{action:"dragstart",events:["touchstart"],transition:[["start","drag"]]},{action:"drag",events:["touchmove"],transition:[["drag","drag"]]},{action:"dragend",events:["touchend"],transition:[["drag","start"]]}]});X.register("SpeechControlInteractor",{constructor:X,state:"start",actions:[{action:"enableSpeech",events:["click"],transition:[["*","speech:ready"]]},{action:"disableSpeech",events:["mouseup[event.button==2]"],transition:[["*","start"]]},{action:"speech",events:["*"],transition:[["*","speech:ready"]]}]});X.register("KeyboardPositionInteractor",{constructor:X,state:"start",actions:[{action:"begin",events:["keydown[event.key===' ']"],transition:[["start","running"]]},{action:"up",events:["keypress[event.key==='w' || event.key==='W']","keydown[event.key==='ArrowUp']{100}"],transition:[["running","running"]]},{action:"left",events:["keypress[event.key==='a' || event.key==='A']","keydown[event.key==='ArrowLeft']{100}"],transition:[["running","running"]]},{action:"down",events:["keypress[event.key==='s' || event.key==='S']","keydown[event.key==='ArrowDown']{100}"],transition:[["running","running"]]},{action:"right",events:["keypress[event.key==='d' || event.key==='D']","keydown[event.key==='ArrowRight']{100}"],transition:[["running","running"]]}]});X.register("MouseWheelInteractor",{constructor:X,state:"start",actions:[{action:"enter",events:["mouseenter"],transition:[["start","running"]]},{action:"wheel",events:["wheel","mousewheel"],transition:[["running","running"]]},{action:"leave",events:["mouseleave"],transition:[["running","start"],["start","start"]]},{action:"abort",events:["mouseup[event.button==2]"],transition:[["running","running"],["start","start"]]}]})});var mb,pb,gb,Js,Ge,Sr=d(()=>{wr();wr();Mu();mb=X.register,pb=X.initialize,gb=X.findInteractor,Js=bn,Ge=X});function Pu(t,e){Ou[t]=e}function Lu(t,e){let r=Object.assign({constructor:K},Ou[t]??{},e??{},{});return new r.constructor(t,r)}function Yu(t){return ku.filter(e=>e.isInstanceOf(t))}var Ru,Ou,ku,Lt,tt,K,Yt=d(()=>{_e();Ou={},ku=[],Lt=new Map,tt=new Map,K=class{constructor(e,r){this._nextTick=0,this[Ru]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._container=r.container,this._order=0,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preUpdate=r.preUpdate??null,this._postUpdate=r.postUpdate??null,ku.push(this),this._postInitialize&&this._postInitialize.call(this,this)}getGraphic(){return this._graphic}getContainerGraphic(){return this._container}getVisualElements(){return[]}cloneVisualElements(e,r=!1){let n=e.cloneNode(r);return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}getDatum(e){return null}join(e,r){return[]}preUpdate(){this._preUpdate&&this._preUpdate.call(this,this)}postUpdate(){this._postUpdate&&this._postUpdate.call(this,this)}picking(e){return[]}isPointInPolygon(e,r){let n=!1;for(let s=0,a=r.length-1;s<r.length;a=s++){let i=r[s].x,o=r[s].y,c=r[a].x,l=r[a].y;o>e.y!=l>e.y&&e.x<(c-i)*(e.y-o)/(l-o)+i&&(n=!n)}return n}pathIntersectsRect(e,r){let n=e.getTotalLength();if(n<=0)return!1;let s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(i.x>=r.x&&i.x<=r.x+r.width&&i.y>=r.y&&i.y<=r.y+r.height)return!0}return!1}getLayerFromQueue(e){Lt.has(this)||Lt.set(this,{[this._name]:this}),tt.has(this)||tt.set(this,{[this._name]:0});let r=Lt.get(this);if(!(e in r)){let n=K.initialize(this._baseName,{...this._userOptions,name:e,group:"",redraw(){}});r[e]=n,Lt.set(n,r);let s=r[e].getGraphic();s&&s.style&&(s.style.pointerEvents="none")}return e in tt.get(this)||(tt.get(this)[e]=0),r[e]}setLayersOrder(e){Lt.has(this)||Lt.set(this,{[this._name]:this}),tt.has(this)||tt.set(this,{[this._name]:0});let r=tt.get(this),n=document.createDocumentFragment();Object.entries(e).forEach(([s,a])=>{r[s]=a}),Object.entries(r).sort((s,a)=>s[1]-a[1]).forEach(([s,a])=>{if(r[s]=a,tt.set(this.getLayerFromQueue(s),r),a>=0){let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="initial")}else{let i=this.getLayerFromQueue(s).getGraphic(!0);i&&i.style&&(i.style.display="none")}this.getLayerFromQueue(s)._order=a,n.append(this.getLayerFromQueue(s).getGraphic(!0))}),this.getContainerGraphic().appendChild(n)}isInstanceOf(e){return this._baseName===e||this._name===e}};Ru=xe;K.register=Pu;K.initialize=Lu;K.findLayer=Yu});var Du,Dt,br,Xu=d(()=>{Yt();pt();_e();Du="D3Layer",Dt="ig-layer-background",br=class extends K{constructor(e,r){super(e,r);this._width=r.width,this._height=r.height,this._offset=r.offset,this._name=r.name,this._graphic=$(r.container).append("g").call(s=>{this._name&&s.attr("className",this._name)}).call(s=>{this._offset&&s.attr("transform",`translate(${this._offset.x||0}, ${this._offset.y||0})`)}).node(),$(this._graphic).append("rect").attr("class",Dt).attr("width",this._width).attr("height",this._height).attr("opacity",0);let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum():$(e).datum()}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Dt})`)]}cloneVisualElements(e,r=!1){let n=$(e).clone(r).node();return document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Dt)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===G.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(this._isElementInLayer.bind(this)),r.length>=1&&(r=[r[0]])}else if(e.type===G.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(this._isElementInLayer.bind(this))}else if(e.type===G.Circle){let i=e.x-n.left,o=e.y-n.top,c=e.r,l=Math.floor(c*Math.sin(Math.PI/4))<<1,u=i-(l>>>1),h=o-(l>>>1),p=new Set,g=this._svg.createSVGRect();g.x=u,g.y=h,g.width=l,g.height=l,this._svg.getIntersectionList(g,this._graphic).forEach(M=>p.add(M));let _=[...this._graphic.querySelectorAll("path")].filter(M=>window.getComputedStyle(M).fill==="none");_.length>0&&_.filter(Y=>{let ce=this.transformRect(g,this._graphic);return this.pathIntersectsRect(Y,ce)}).forEach(Y=>p.add(Y));let x=c,w=i-c,V=o-c,E=new Set,j=this._svg.createSVGRect();j.x=w,j.y=V,j.width=x*2,j.height=x*2,this._svg.getIntersectionList(j,this._graphic).forEach(M=>E.add(M)),_.length>0&&_.filter(Y=>{let ce=this.transformRect(j,this._graphic);return this.pathIntersectsRect(Y,ce)}).forEach(Y=>E.add(Y));let W=1;for(;;){for(let je of E)p.has(je)&&E.delete(je);if(!E.size||W*2+l>=c*2)break;let M=Math.sqrt(c*c-Math.pow(l/2+W,2)),Y=this._svg.createSVGRect();Y.x=i-M,Y.y=h-W,Y.width=M*2,Y.height=1;let ce=this._svg.createSVGRect();ce.x=i-M,ce.y=h+l+W-1,ce.width=M*2,ce.height=1;let de=this._svg.createSVGRect();de.x=u-W,de.y=o-M,de.width=1,de.height=M*2;let Ae=this._svg.createSVGRect();Ae.x=u+l+W-1,Ae.y=o-M,Ae.width=1,Ae.height=M*2,[Y,ce,de,Ae].forEach(je=>{this._svg.getIntersectionList(je,this._graphic).forEach(le=>p.add(le));let R=[...this._graphic.querySelectorAll("path")].filter(le=>window.getComputedStyle(le).fill==="none");R.length>0&&R.filter(re=>{let we=this.transformRect(je,this._graphic);return this.pathIntersectsRect(re,we)}).forEach(re=>p.add(re))}),W++}r=[...p].filter(this._isElementInLayer.bind(this))}else if(e.type===G.Rect){let{x:i,y:o,width:c,height:l}=e,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(w=>!w.classList.contains(Dt));let x=[...this._graphic.querySelectorAll("path")].filter(w=>window.getComputedStyle(w).fill==="none");if(x.length>0){let w=x.filter(V=>{let E=this.transformRect(_,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...w])]}}else if(e.type===G.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(u=>({x:u.x-o.left,y:u.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement)}return a}_dataQuery(e){let r=[],n=Ie(this.getVisualElements());if(e.type===et.Quantitative){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(u=>u&&u[o]!==void 0&&l[0]<u[o]&&u[o]<l[1])}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a[0]<i[s]&&i[s]<a[1]).nodes()}else if(e.type===et.Nominal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c];i=i.filter(u=>u&&u[o]!==void 0&&l.findIndex(u[o])>=0)}),r=i.nodes()}else r=n.filter(i=>i&&i[s]!==void 0&&a.findIndex(i[s])>=0).nodes()}else if(e.type===et.Temporal){let{attrName:s,extent:a}=e;if(s instanceof Array){let i=n;s.forEach((o,c)=>{let l=a[c],u=e.dateParser?.[c]??(h=>h);i=i.filter(h=>h&&h[o]!==void 0&&l[0].getTime()<u(h[o]).getTime()&&u(h[o]).getTime()<l[1].getTime())}),r=i.nodes()}else{let i=e.dateParser||(o=>o);r=n.filter(o=>o&&o[s]!==void 0&&a[0].getTime()<i(o[s]).getTime()&&i(o[s]).getTime()<a[1].getTime()).nodes()}}return r}_attrQuery(e){let{attrName:r,value:n}=e;return $(this._graphic).filter(a=>a[r]===n).nodes()}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Dt)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(u=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(u,h)}).forEach(u=>r.add(u)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let u=s/10;c+u<=r.maxY;u+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:u},e)){let h=l*u;h>a&&(a=h,i={x:o,y:c,width:l,height:u})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Dt)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(u=>this.isPointInPolygon(u,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.D3Layer=br;K.register(Du,{constructor:br});K.register(Du,{constructor:br})});var ea=d(()=>{});function zu(t){return{a:parseFloat(t.a),b:parseFloat(t.b),c:parseFloat(t.c),d:parseFloat(t.d),e:parseFloat(t.e),f:parseFloat(t.f)}}var ta=d(()=>{});var Nu=d(()=>{});var Fu=d(()=>{});var ra=d(()=>{});function yt(t){return typeof t=="undefined"}var jn=d(()=>{});var qu=d(()=>{jn()});function Ye(t,e=0){return{a:1,c:0,e:t,b:0,d:1,f:e}}var Xt=d(()=>{});function xt(...t){t=Array.isArray(t[0])?t[0]:t;let e=(r,n)=>({a:r.a*n.a+r.c*n.b,c:r.a*n.c+r.c*n.d,e:r.a*n.e+r.c*n.f+r.e,b:r.b*n.a+r.d*n.b,d:r.b*n.c+r.d*n.d,f:r.b*n.e+r.d*n.f+r.f});switch(t.length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{let[r,n,...s]=t,a=e(r,n);return xt(a,...s)}}}function zt(...t){return xt(...t)}var _t=d(()=>{});function Gu(t,e,r){let n=sp(t),s=ap(t),a={a:n,c:-s,e:0,b:s,d:n,f:0};return yt(e)||yt(r)?a:xt([Ye(e,r),a,Ye(-e,-r)])}function na(t,e=void 0,r=void 0){return Gu(t*ip/180,e,r)}var sp,ap,ip,Tn=d(()=>{jn();Xt();_t();({cos:sp,sin:ap,PI:ip}=Math)});function Vr(t,e=void 0,r=void 0,n=void 0){yt(e)&&(e=t);let s={a:t,c:0,e:0,b:0,d:e,f:0};return yt(r)||yt(n)?s:xt([Ye(r,n),s,Ye(-r,-n)])}var jr=d(()=>{jn();Xt();_t()});function Uu(t,e){return{a:1,c:t,e:0,b:e,d:1,f:0}}var sa=d(()=>{});function op(t,e){return{a:1,c:$u(t),e:0,b:$u(e),d:1,f:0}}function aa(t,e){return op(t*Math.PI/180,e*Math.PI/180)}var $u,ia=d(()=>{({tan:$u}=Math)});var Bu=d(()=>{});var oa=d(()=>{});var Qu=d(()=>{ra();_t();oa()});function In(t){return Array.isArray(t)?t.map(e):e(t);function e(r){switch(r.type){case"matrix":if("a"in r&&"b"in r&&"c"in r&&"d"in r&&"e"in r&&"f"in r)return zu(r);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in r?Ye(r.tx,r.ty):Ye(r.tx);case"scale":if(!("sx"in r))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in r?Vr(r.sx,r.sy):Vr(r.sx);case"rotate":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in r&&"cy"in r?na(r.angle,r.cx,r.cy):na(r.angle);case"skewX":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return aa(r.angle,0);case"skewY":if(!("angle"in r))throw new Error("MISSING_MANDATORY_PARAM");return aa(0,r.angle);case"shear":if(!("shx"in r&&"shy"in r))throw new Error("MISSING_MANDATORY_PARAM");return Uu(r.shx,r.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR")}}}var Hu=d(()=>{ta();Xt();jr();Tn();ia();sa()});function cp(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function vt(t,e,r,n){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,vt.prototype),s.expected=e,s.found=r,s.location=n,s.name="SyntaxError",s}function ca(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,r+=r.repeat(e),t+r.slice(0,e))}function Wu(t,e){e=e!==void 0?e:{};var r={},n=e.grammarSource,s={transformList:Sa},a=Sa,i="matrix",o="(",c=")",l="translate",u="scale",h="rotate",p="skewX",g="skewY",_=",",x=".",w=/^[eE]/,V=/^[+\-]/,E=/^[0-9]/,j=/^[ \t\r\n]/,W=Oe("matrix",!1),M=Oe("(",!1),Y=Oe(")",!1),ce=Oe("translate",!1),de=Oe("scale",!1),Ae=Oe("rotate",!1),je=Oe("skewX",!1),R=Oe("skewY",!1),le=Oe(",",!1),re=_a("fractionalConstant"),we=Oe(".",!1),St=Yr(["e","E"],!1,!1),Ue=Yr(["+","-"],!1,!1),$e=Yr([["0","9"]],!1,!1),Be=Yr([" ","	","\r",`
`],!1,!1),Se=function(f){return f},Ln=function(f,m){return f.concat(m)},Yn=function(f,m,v,b,k,I){return[{type:"matrix",a:f,b:m,c:v,d:b,e:k,f:I}]},Dn=function(f,m){var v={type:"translate",tx:f};return m&&(v.ty=m),[v]},Xn=function(f,m){var v={type:"scale",sx:f};return m&&(v.sy=m),[v]},zn=function(f,m){var v={type:"rotate",angle:f};return m&&(v.cx=m[0],v.cy=m[1]),[v]},Nn=function(f){return[{type:"skewX",angle:f}]},Fn=function(f){return[{type:"skewY",angle:f}]},qn=function(f){return parseFloat(f.join(""))},Gn=function(f){return parseInt(f.join(""))},T=function(f){return f},O=function(f,m){return[f,m]},P=function(f){return f.join("")},S=function(f,m){return[f,m||null].join("")},ue=function(f,m){return[f,m].join("")},z=function(f,m){return[f?f.join(""):null,".",m.join("")].join("")},me=function(f){return f.join("")},pe=function(f,m){return["e",f,m.join("")].join("")},y=0,N=0,Pr=[{line:1,column:1}],Re=0,Un=[],F=0,Lr;if("startRule"in e){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');a=s[e.startRule]}function Ep(){return t.substring(N,y)}function Ap(){return N}function Cp(){return{source:n,start:N,end:y}}function Mp(){return Gt(N,y)}function Rp(f,m){throw m=m!==void 0?m:Gt(N,y),wa([_a(f)],t.substring(N,y),m)}function Op(f,m){throw m=m!==void 0?m:Gt(N,y),xf(f,m)}function Oe(f,m){return{type:"literal",text:f,ignoreCase:m}}function Yr(f,m,v){return{type:"class",parts:f,inverted:m,ignoreCase:v}}function kp(){return{type:"any"}}function yf(){return{type:"end"}}function _a(f){return{type:"other",description:f}}function va(f){var m=Pr[f],v;if(m)return m;for(v=f-1;!Pr[v];)v--;for(m=Pr[v],m={line:m.line,column:m.column};v<f;)t.charCodeAt(v)===10?(m.line++,m.column=1):m.column++,v++;return Pr[f]=m,m}function Gt(f,m,v){var b=va(f),k=va(m),I={source:n,start:{offset:f,line:b.line,column:b.column},end:{offset:m,line:k.line,column:k.column}};return v&&n&&typeof n.offset=="function"&&(I.start=n.offset(I.start),I.end=n.offset(I.end)),I}function U(f){y<Re||(y>Re&&(Re=y,Un=[]),Un.push(f))}function xf(f,m){return new vt(f,null,null,m)}function wa(f,m,v){return new vt(vt.buildMessage(f,m),f,m,v)}function Sa(){var f,m,v,b,k;for(f=y,m=[],v=C();v!==r;)m.push(v),v=C();for(v=ba(),v===r&&(v=null),b=[],k=C();k!==r;)b.push(k),k=C();return N=f,f=Se(v),f}function ba(){var f,m,v,b;if(f=y,m=Va(),m!==r){if(v=[],b=ke(),b!==r)for(;b!==r;)v.push(b),b=ke();else v=r;v!==r?(b=ba(),b!==r?(N=f,f=Ln(m,b)):(y=f,f=r)):(y=f,f=r)}else y=f,f=r;return f===r&&(f=Va()),f}function Va(){var f;return f=_f(),f===r&&(f=vf(),f===r&&(f=wf(),f===r&&(f=Sf(),f===r&&(f=bf(),f===r&&(f=Vf()))))),f}function _f(){var f,m,v,b,k,I,ee,q,B,Bn,Aa,Qn,Ca,Hn,Ma,Wn,Ra,nt;if(f=y,t.substr(y,6)===i?(m=i,y+=6):(m=r,F===0&&U(W)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r)if(ee=ke(),ee!==r)if(q=ye(),q!==r)if(B=ke(),B!==r)if(Bn=ye(),Bn!==r)if(Aa=ke(),Aa!==r)if(Qn=ye(),Qn!==r)if(Ca=ke(),Ca!==r)if(Hn=ye(),Hn!==r)if(Ma=ke(),Ma!==r)if(Wn=ye(),Wn!==r){for(Ra=[],nt=C();nt!==r;)Ra.push(nt),nt=C();t.charCodeAt(y)===41?(nt=c,y++):(nt=r,F===0&&U(Y)),nt!==r?(N=f,f=Yn(I,q,Bn,Qn,Hn,Wn)):(y=f,f=r)}else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r;else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function vf(){var f,m,v,b,k,I,ee,q,B;if(f=y,t.substr(y,9)===l?(m=l,y+=9):(m=r,F===0&&U(ce)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r){for(ee=ja(),ee===r&&(ee=null),q=[],B=C();B!==r;)q.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&U(Y)),B!==r?(N=f,f=Dn(I,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function wf(){var f,m,v,b,k,I,ee,q,B;if(f=y,t.substr(y,5)===u?(m=u,y+=5):(m=r,F===0&&U(de)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r){for(ee=ja(),ee===r&&(ee=null),q=[],B=C();B!==r;)q.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&U(Y)),B!==r?(N=f,f=Xn(I,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function Sf(){var f,m,v,b,k,I,ee,q,B;if(f=y,t.substr(y,6)===h?(m=h,y+=6):(m=r,F===0&&U(Ae)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r){for(ee=jf(),ee===r&&(ee=null),q=[],B=C();B!==r;)q.push(B),B=C();t.charCodeAt(y)===41?(B=c,y++):(B=r,F===0&&U(Y)),B!==r?(N=f,f=zn(I,ee)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function bf(){var f,m,v,b,k,I,ee,q;if(f=y,t.substr(y,5)===p?(m=p,y+=5):(m=r,F===0&&U(je)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r){for(ee=[],q=C();q!==r;)ee.push(q),q=C();t.charCodeAt(y)===41?(q=c,y++):(q=r,F===0&&U(Y)),q!==r?(N=f,f=Nn(I)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function Vf(){var f,m,v,b,k,I,ee,q;if(f=y,t.substr(y,5)===g?(m=g,y+=5):(m=r,F===0&&U(R)),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();if(t.charCodeAt(y)===40?(b=o,y++):(b=r,F===0&&U(M)),b!==r){for(k=[],I=C();I!==r;)k.push(I),I=C();if(I=ye(),I!==r){for(ee=[],q=C();q!==r;)ee.push(q),q=C();t.charCodeAt(y)===41?(q=c,y++):(q=r,F===0&&U(Y)),q!==r?(N=f,f=Fn(I)):(y=f,f=r)}else y=f,f=r}else y=f,f=r}else y=f,f=r;return f}function ye(){var f,m,v,b;return f=y,m=y,v=$n(),v===r&&(v=null),b=If(),b!==r?(v=[v,b],m=v):(y=m,m=r),m!==r&&(N=f,m=qn(m)),f=m,f===r&&(f=y,m=y,v=$n(),v===r&&(v=null),b=Tf(),b!==r?(v=[v,b],m=v):(y=m,m=r),m!==r&&(N=f,m=Gn(m)),f=m),f}function ja(){var f,m,v;return f=y,m=ke(),m!==r?(v=ye(),v!==r?(N=f,f=T(v)):(y=f,f=r)):(y=f,f=r),f}function jf(){var f,m,v,b,k;return f=y,m=ke(),m!==r?(v=ye(),v!==r?(b=ke(),b!==r?(k=ye(),k!==r?(N=f,f=O(v,k)):(y=f,f=r)):(y=f,f=r)):(y=f,f=r)):(y=f,f=r),f}function ke(){var f,m,v,b,k;if(f=y,m=[],v=C(),v!==r)for(;v!==r;)m.push(v),v=C();else m=r;if(m!==r){for(v=Ta(),v===r&&(v=null),b=[],k=C();k!==r;)b.push(k),k=C();m=[m,v,b],f=m}else y=f,f=r;if(f===r)if(f=y,m=Ta(),m!==r){for(v=[],b=C();b!==r;)v.push(b),b=C();m=[m,v],f=m}else y=f,f=r;return f}function Ta(){var f;return t.charCodeAt(y)===44?(f=_,y++):(f=r,F===0&&U(le)),f}function Tf(){var f,m;return f=y,m=bt(),m!==r&&(N=f,m=P(m)),f=m,f}function If(){var f,m,v;return f=y,m=Ef(),m!==r?(v=Ia(),v===r&&(v=null),N=f,f=S(m,v)):(y=f,f=r),f===r&&(f=y,m=bt(),m!==r?(v=Ia(),v!==r?(N=f,f=ue(m,v)):(y=f,f=r)):(y=f,f=r)),f}function Ef(){var f,m,v,b;return F++,f=y,m=bt(),m===r&&(m=null),t.charCodeAt(y)===46?(v=x,y++):(v=r,F===0&&U(we)),v!==r?(b=bt(),b!==r?(N=f,f=z(m,b)):(y=f,f=r)):(y=f,f=r),f===r&&(f=y,m=bt(),m!==r?(t.charCodeAt(y)===46?(v=x,y++):(v=r,F===0&&U(we)),v!==r?(N=f,f=me(m)):(y=f,f=r)):(y=f,f=r)),F--,f===r&&(m=r,F===0&&U(re)),f}function Ia(){var f,m,v,b;return f=y,w.test(t.charAt(y))?(m=t.charAt(y),y++):(m=r,F===0&&U(St)),m!==r?(v=$n(),v===r&&(v=null),b=bt(),b!==r?(N=f,f=pe(v,b)):(y=f,f=r)):(y=f,f=r),f}function $n(){var f;return V.test(t.charAt(y))?(f=t.charAt(y),y++):(f=r,F===0&&U(Ue)),f}function bt(){var f,m;if(f=[],m=Ea(),m!==r)for(;m!==r;)f.push(m),m=Ea();else f=r;return f}function Ea(){var f;return E.test(t.charAt(y))?(f=t.charAt(y),y++):(f=r,F===0&&U($e)),f}function C(){var f;return j.test(t.charAt(y))?(f=t.charAt(y),y++):(f=r,F===0&&U(Be)),f}if(Lr=a(),Lr!==r&&y===t.length)return Lr;throw Lr!==r&&y<t.length&&U(yf()),wa(Un,Re<t.length?t.charAt(Re):null,Re<t.length?Gt(Re,Re+1):Gt(Re,Re))}var Zu=d(()=>{cp(vt,Error);vt.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){r=t[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,i=this.location.source+":"+a.line+":"+a.column;if(r){var o=this.location.end,c=ca("",a.line.toString().length," "),l=r[s.line-1],u=s.line===o.line?o.column:l.length+1,h=u-s.column||1;e+=`
 --> `+i+`
`+c+` |
`+a.line+" | "+l+`
`+c+" | "+ca("",s.column-1," ")+ca("",h,"^")}else e+=`
 at `+i}return e};vt.buildMessage=function(t,e){var r={literal:function(l){return'"'+s(l.text)+'"'},class:function(l){var u=l.parts.map(function(h){return Array.isArray(h)?a(h[0])+"-"+a(h[1]):a(h)});return"["+(l.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function s(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function a(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function i(l){return r[l.type](l)}function o(l){var u=l.map(i),h,p;if(u.sort(),u.length>0){for(h=1,p=1;h<u.length;h++)u[h-1]!==u[h]&&(u[p]=u[h],p++);u.length=p}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function c(l){return l?'"'+s(l)+'"':"end of input"}return"Expected "+o(t)+" but "+c(e)+" found."}});function En(t){return Wu(t)}var Ku=d(()=>{Zu()});var Ju=d(()=>{jr();_t()});var ef=d(()=>{});var tf=d(()=>{Xt();ea();Tn();jr();_t()});var la=d(()=>{ea();ta();Nu();Fu();ra();qu();Tn();jr();sa();ia();Bu();_t();Xt();Qu();oa();Hu();Ku();Ju();ef();tf()});var rf,Nt,Tr,nf=d(()=>{Yt();pt();_e();la();rf="VegaLayer",Nt="background",Tr=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`.${r.group}`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(In(En(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${Nt})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:$(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=$(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform")||"";for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(Nt)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===G.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===G.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===G.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,u=e.r,h=u,p=c-u,g=l-u,_=new Set,x=this._svg.createSVGRect();x.x=p,x.y=g,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let V=w.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+u||j>V.height/2+u?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=u*u})}else if(e.type===G.Rect){let{x:i,y:o,width:c,height:l}=e,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(w=>!w.classList.contains(Nt));let x=[...this._graphic.querySelectorAll("path")].filter(w=>window.getComputedStyle(w).fill==="none");if(x.length>0){let w=x.filter(V=>{let E=this.transformRect(_,this._graphic);return this.pathIntersectsRect(V,E)});r=[...new Set([...r,...w])]}}else if(e.type===G.Polygon){let{points:i}=e,o=this._svg.getBoundingClientRect(),c=i.map(u=>({x:u.x-o.left,y:u.y-o.top})),l=new Set;this.queryLargestRectangles(c,l),r=Array.from(l)}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(Nt)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}transformRect(e,r){if(!this._offset)return e;let n=this._svg.createSVGRect();return n.x=e.x-this._offset.x,n.y=e.y-this._offset.y,n.width=e.width,n.height=e.height,n}queryLargestRectangles(e,r){let n=this.getBoundingBox(e);if((n.maxX-n.minX)*(n.maxY-n.minY)<100){this.queryPolygon(e,r);return}let s=this.findLargestRectangle(e,n),a=this._svg.createSVGRect();a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,[...this._svg.getIntersectionList(a,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(l=>!l.classList.contains(Nt)).forEach(l=>r.add(l));let o=[...this._graphic.querySelectorAll("path")].filter(l=>window.getComputedStyle(l).fill==="none");o.length>0&&o.filter(u=>{let h=this.transformRect(a,this._graphic);return this.pathIntersectsRect(u,h)}).forEach(u=>r.add(u)),this.subtractRectFromPolygon(e,s).forEach(l=>this.queryLargestRectangles(l,r))}getBoundingBox(e){let r=1/0,n=1/0,s=-1/0,a=-1/0;for(let i of e)r=Math.min(r,i.x),n=Math.min(n,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);return{minX:r,minY:n,maxX:s,maxY:a}}findLargestRectangle(e,r){let n=r.maxX-r.minX,s=r.maxY-r.minY,a=0,i={x:0,y:0,width:0,height:0};for(let o=r.minX;o<r.maxX;o+=n/10)for(let c=r.minY;c<r.maxY;c+=s/10)for(let l=n/10;o+l<=r.maxX;l+=n/10)for(let u=s/10;c+u<=r.maxY;u+=s/10)if(this.isRectangleInPolygon({x:o,y:c,width:l,height:u},e)){let h=l*u;h>a&&(a=h,i={x:o,y:c,width:l,height:u})}return i}isRectangleInPolygon(e,r){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].every(s=>this.isPointInPolygon(s,r))}subtractRectFromPolygon(e,r){let n=e.filter(a=>!(a.x>=r.x&&a.x<=r.x+r.width&&a.y>=r.y&&a.y<=r.y+r.height)),s=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return[n.concat(s)]}queryPolygon(e,r){let n=this.getBoundingBox(e),s=this._svg.createSVGRect();s.x=n.minX,s.y=n.minY,s.width=n.maxX-n.minX,s.height=n.maxY-n.minY,[...this._svg.getIntersectionList(s,this._graphic)].filter(this._isElementInLayer.bind(this)).filter(o=>!o.classList.contains(Nt)).forEach(o=>{let c=o.getBBox();[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].some(u=>this.isPointInPolygon(u,e))&&r.add(o)});let i=[...this._graphic.querySelectorAll("path")].filter(o=>window.getComputedStyle(o).fill==="none");i.length>0&&i.filter(c=>{let l=this.transformRect(s,this._graphic);return this.pathIntersectsRect(c,l)}).forEach(c=>r.add(c))}pathIntersectsPolygon(e,r){let n=e.getTotalLength(),s=n/100;for(let a=0;a<=n;a+=s){let i=e.getPointAtLength(a);if(this.isPointInPolygon(i,r))return!0}return!1}};K.VegaLayer=Tr;K.register(rf,{constructor:Tr});K.register(rf,{constructor:Tr})});var sf,ua,Ir,af=d(()=>{Yt();pt();_e();la();sf="PlotLayer",ua="background",Ir=class extends K{constructor(e,r){super(e,r);this._name=r.name,this._container=r.container,r.group?this._graphic=this._container.querySelector(`*[aria-label="${r.group}"]`):(this._graphic=document.createElementNS("http://www.w3.org/2000/svg","g"),r.container.appendChild(this._graphic));let n=this._container;for(;n&&n.tagName!=="svg";)n=n.parentElement;if(n.tagName!=="svg")throw Error("Container must be wrapped in SVGSVGElement");this._svg=n,this._postInitialize&&this._postInitialize.call(this,this)}get _offset(){let e="translate(0, 0)";if([...this._container.children].includes(this._graphic))e=this._container.querySelector("g")?.getAttribute("transform")??"translate(0,0)";else{let n=this._graphic;for(;n!=this._container;)n.getAttribute("transform")&&(e+=` ${n.getAttribute("transform")}`),n=n.parentElement}let r=zt(In(En(e??"translate(0,0)")));return{x:r.e,y:r.f}}getVisualElements(){return[...this._graphic.querySelectorAll(`:root :not(.${ua})`)]}getGraphic(e=!1){return this._userOptions.group?e?[...this._container.children].find(r=>r.contains(this._graphic)):this._container:this._graphic}getDatum(e){return!e||e instanceof Array&&e.length==0?null:e instanceof Array?Ie(e).datum()?.datum:$(e).datum()?.datum}cloneVisualElements(e,r=!1){let n=$(e).clone(r).node(),s=n.parentElement,a=n.getAttribute("transform");for(;s&&s!=this._container;)s.getAttribute("transform")&&(a+=` ${s.getAttribute("transform")}`),s=s.parentElement;return n.setAttribute("transform",a),document.createDocumentFragment().append(n),n.__libra__screenElement=e,n}select(e){return this._graphic.querySelectorAll(e)}picking(e){return e.baseOn===te.Shape?this._shapeQuery(e):e.baseOn===te.Data?this._dataQuery(e):e.baseOn===te.Attr?this._attrQuery(e):[]}_isElementInLayer(e){return this._graphic.contains(e)&&!e.classList.contains(ua)}_shapeQuery(e){let r=[],n=this._svg.getBoundingClientRect(),s=this._graphic.getBoundingClientRect();if(e.type===G.SurfacePoint){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=[...document.elementsFromPoint(i,o)].filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o}),r.length>=1&&(r=[r[0]])}else if(e.type===G.Point){let{x:i,y:o}=e;if(!isFinite(i)||!isFinite(o))return[];r=document.elementsFromPoint(i,o).filter(c=>{if(!this._isElementInLayer(c))return!1;let l=c.getBoundingClientRect();return l.right>=i&&l.left<=i&&l.bottom>=o&&l.top<=o})}else if(e.type===G.Circle){let i=e.x,o=e.y,c=e.x-n.left,l=e.y-n.top,u=e.r,h=u,p=c-u,g=l-u,_=new Set,x=this._svg.createSVGRect();x.x=p,x.y=g,x.width=h*2,x.height=h*2,this._svg.getIntersectionList(x,this._graphic).forEach(w=>_.add(w)),r=[..._].filter(w=>{if(!this._isElementInLayer(w))return!1;let V=w.getBoundingClientRect(),E=Math.abs(i-V.left),j=Math.abs(o-V.top);return E>V.width/2+u||j>V.height/2+u?!1:E<=V.width/2||j<=V.height/2?!0:Math.pow(E-V.width/2,2)+Math.pow(j-V.height/2,2)<=u*u})}else if(e.type===G.Rect){let{x:i,y:o,width:c,height:l}=e,u=Math.min(i,i+c)-n.left,h=Math.min(o,o+l)-n.top,p=Math.abs(c),g=Math.abs(l),_=this._svg.createSVGRect();_.x=u,_.y=h,_.width=p,_.height=g,r=[...this._svg.getIntersectionList(_,this._graphic)].filter(x=>{if(!this._isElementInLayer(x))return!1;let w=x.getBoundingClientRect();return!(w.right<u+n.left||w.left>u+p+n.left||w.bottom<h+n.top||w.top>h+g+n.top)})}else if(e.type===G.Polygon){let{points:i}=e,o=Math.min(...i.map(p=>p.x))-n.left,c=Math.min(...i.map(p=>p.y))-n.top,l=Math.max(...i.map(p=>p.x))-n.left,u=Math.max(...i.map(p=>p.y))-n.top,h=this._svg.createSVGRect();h.x=o,h.y=c,h.width=l-o,h.height=u-c,r=[...this._svg.getIntersectionList(h,this._graphic)].filter(p=>{if(!this._isElementInLayer(p))return!1;let g=p.getBoundingClientRect();return!(g.right<o+n.left||g.left>l+n.left||g.bottom<c+n.top||g.top>u+n.top)})}let a=[];for(;r.length>0;){let i=r.shift();i.classList.contains(ua)||(a.push(i),i.parentElement.tagName==="g"&&this._graphic.contains(i.parentElement)&&this._graphic!==i.parentElement&&r.push(i.parentElement))}return a}_dataQuery(e){return[]}_attrQuery(e){let{attrName:r,value:n}=e;return[]}};K.PlotLayer=Ir;K.register(sf,{constructor:Ir});K.register(sf,{constructor:Ir})});var De,Er=d(()=>{Yt();Yt();Xu();nf();af();De=K});var of,Xe,wt,Me,Ar,fa,A,lp,uV,up,fp,Ft=d(()=>{Sr();_e();Cr();Er();Pt();qe();Xe={},wt=[],Me=new Map,Ar=[],fa=!1,A=class{constructor(e,r){this._transformers=[],this._linkCache={},this[of]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preAttach=r.preAttach??null,this._postUse=r.postUse??null,this._baseName=e,this._userOptions=r,this._name=r.name??e,this._on=Object.assign({},r.on??{}),this._interactors=[],this._layers=[],this._layerInteractors=new Map,this._services=r.services??[],this._serviceInstances=[],this._sharedVar=r.sharedVar??{},this._transformers=r.transformers??[],r.interactors&&r.interactors.forEach(n=>{typeof n=="string"?this.useInteractor(Ge.initialize(n)):"options"in n?typeof n.interactor=="string"?this.useInteractor(Ge.initialize(n.interactor,n.options)):this.useInteractor(n.interactor,n.options):this.useInteractor(n)}),this._services.forEach(n=>{typeof n=="string"||!("options"in n)?this.useService(n):this.useService(n.service,n.options)}),r.layers&&r.layers.forEach(n=>{"options"in n?this.attach(n.layer,n.options):this.attach(n)}),r.postInitialize&&r.postInitialize.call(this,this)}emit(e,r){this._on[e]&&this._on[e].forEach(n=>{n instanceof rt?n.execute(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{})):n(Object.assign({self:this,layer:null,instrument:this,interactor:null},r||{}))})}on(e,r){return e instanceof Array?e.forEach(n=>{this._on[n]||(this._on[n]=[]),this._on[n].push(r)}):(this._on[e]||(this._on[e]=[]),this._on[e].push(r)),this}off(e,r){if(!!this._on[e])return this._on[e].includes(r)&&this._on[e].splice(this._on[e].indexOf(r),1),this}_use(e,r){e.preAttach(this),this._serviceInstances.push(e),e.postUse(this)}useService(e,r){typeof e!="string"&&this._serviceInstances.includes(e)||(arguments.length>=2?this._services.push({service:e,options:r}):this._services.push(e),typeof e=="string"?Iu(e).forEach(s=>this._use(s,r)):this._use(e,r))}useInteractor(e,r){e.preUse(this),arguments.length>=2?this._interactors.push({interactor:e,options:r}):this._interactors.push(e),this._layers.forEach(n=>{let s;n instanceof De?s=n:s=n.layer,this._layerInteractors.has(s)||this._layerInteractors.set(s,[]);let a=Ge.initialize(e._baseName,e._userOptions);this._layerInteractors.get(s).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof rt?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(s.getContainerGraphic())||Me.set(s.getContainerGraphic(),new Map),Me.get(s.getContainerGraphic()).has(i)||(s.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,s,i)),Me.get(s.getContainerGraphic()).set(i,[])),Me.get(s.getContainerGraphic()).get(i).push([a,s,n instanceof De?null:n.options,this])})}),e.postUse(this)}attach(e,r){this._layers.find(n=>n instanceof De?n===e:n.layer===e)||(this.preAttach(e,r??null),arguments.length>=2?this._layers.push({layer:e,options:r}):this._layers.push(e),this.postUse(e))}getSharedVar(e,r){return!(e in this._sharedVar)&&r&&"defaultValue"in r&&this.setSharedVar(e,r.defaultValue,r),this._sharedVar[e]}setSharedVar(e,r,n){this._sharedVar[e]=r,this._on[`update:${e}`]&&this._on[`update:${e}`].forEach(a=>{a instanceof rt?a.execute({self:this,layer:null,instrument:this,interactor:null}):a({self:this,layer:null,instrument:this,interactor:null})})}watchSharedVar(e,r){this.on(`update:${e}`,r)}preAttach(e,r){this._preAttach&&this._preAttach.call(this,this,e),this._interactors.forEach(n=>{let s;n instanceof Ge?s=n:s=n.interactor,this._layerInteractors.has(e)||this._layerInteractors.set(e,[]);let a=Ge.initialize(s._baseName,s._userOptions);this._layerInteractors.get(e).push(a),a.setActions(a.getActions().map(i=>({...i,sideEffect:async o=>{if(i.sideEffect&&i.sideEffect(o),this._on[i.action])for(let c of this._on[i.action])try{c instanceof rt?await c.execute({...o,self:this,instrument:this}):await c({...o,self:this,instrument:this})}catch(l){console.error(l)}}}))),a.getAcceptEvents().forEach(i=>{Me.has(e.getContainerGraphic())||Me.set(e.getContainerGraphic(),new Map),Me.get(e.getContainerGraphic()).has(i)||(e.getContainerGraphic().addEventListener(i,this._dispatch.bind(this,e,i)),Me.get(e.getContainerGraphic()).set(i,[])),Me.get(e.getContainerGraphic()).get(i).push([a,e,r,this])})})}async _dispatch(e,r,n){if(e._baseName!=="Layer"&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()),fa){let i=Ar.findIndex(o=>o.instrument===this&&o.layer===e&&o.eventType===r);i>=0&&Ar.splice(i,1),Ar.push({instrument:this,layer:e,eventType:r,event:n});return}fa=!0;let s=Me.get(e.getContainerGraphic()).get(r).filter(([i,o])=>o._order>=0);s.sort((i,o)=>o[1]._order-i[1]._order);let a=!1;for(let[i,o,c,l]of s){if(n instanceof MouseEvent&&!(o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="backgroundlayer"||o._name?.toLowerCase().replaceAll("-","").replaceAll("_","")==="bglayer"||c&&c.pointerEvents==="all"))if(!c||c.pointerEvents==="viewport"){let u=o;if(u._offset&&u._width&&u._height&&(n.offsetX<u._offset.x||n.offsetX>u._offset.x+u._width||n.offsetY<u._offset.y||n.offsetY>u._offset.y+u._height))continue}else{if(o.picking({baseOn:te.Shape,type:G.Point,x:n.clientX,y:n.clientY}).length<=0&&i._state==="start")continue;let h=o;if(h._offset&&h._width&&h._height&&(n.offsetX<h._offset.x||n.offsetX>h._offset.x+h._width||n.offsetY<h._offset.y||n.offsetY>h._offset.y+h._height))continue}try{if(await i.dispatch(n,o)&&n instanceof MouseEvent&&c&&c.pointerEvents==="visiblePainted"){a=!0;break}}catch(u){console.error(u);break}}if(fa=!1,Ar.length){let i=Ar.shift();i.instrument._dispatch(i.layer,i.eventType,i.event)}}postUse(e){let r=e.getGraphic();r&&r.style&&(r.style.pointerEvents="auto"),this._postUse&&this._postUse.call(this,this,e)}isInstanceOf(e){return this._baseName===e||this._name===e}get services(){return ve(this._serviceInstances.slice(0),Z,this.useService.bind(this),()=>{throw new Error("Do not support dynamic change service yet")},this)}get transformers(){return ve(this._transformers.slice(0),H,e=>this._transformers.push(e),e=>this._transformers.splice(this._transformers.indexOf(e),1),this)}static register(e,r){Xe[e]=r}static unregister(e){return delete Xe[e],!0}static initialize(e,r){let n=Object.assign({constructor:A},Xe[e]??{},r??{},{on:oe(Object.assign({},(Xe[e]??{}).on??{},r?.on??{})),sharedVar:Object.assign({},(Xe[e]??{}).sharedVar??{},r?.sharedVar??{})}),s=new n.constructor(e,n);return wt.push(s),s}static findInstrument(e){return wt.filter(r=>r.isInstanceOf(e))}};of=xe;lp=A.register,uV=A.unregister,up=A.initialize,fp=A.findInstrument});var cf=d(()=>{Ft();qe();_e();pt();An();A.register("HoverInstrument",{constructor:A,interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("SelectionService").setSharedVars({event:t,x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY},{layer:e}),r.transformers.setSharedVars({cx:t.clientX,cy:t.clientY})}],click:[se.initialize("Log",{execute(){}})]},postInitialize:t=>{t.services.add("SurfacePointSelectionService",{sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("ClickInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.setSharedVar("x",e.clientX),n.setSharedVar("y",e.clientY),n.services.find("SelectionService").setSharedVars({x:e.clientX,y:e.clientY,offsetx:e.offsetX,offsety:e.offsetY},{layer:r}),n.emit("clickstart",{...t,self:t.instrument})},se.initialize("Log",{execute(){}})],dragend:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:r}),e.clientX===n.getSharedVar("x")&&e.clientY===n.getSharedVar("y")?(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("click",{...t,self:t.instrument})):(n.setSharedVar("x",0),n.setSharedVar("y",0),n.emit("clickabort",{...t,self:t.instrument}))}],dragabort:[t=>{t.event.changedTouches&&(t.event=t.event.changedTouches[0]),t.instrument.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0},{layer:t.layer}),t.instrument.emit("clickabort",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.find("RectSelectionService").setSharedVars({x:t.clientX,y:t.clientY,offsetx:t.offsetX,offsety:t.offsetY,width:1,height:1,startx:t.clientX,starty:t.clientY,startoffsetx:t.offsetX,startoffsety:t.offsetY,currentx:t.clientX,currenty:t.clientY},{layer:e});let s=t.offsetX,a=t.offsetY,i=0,o=0,c=e._offset?.x??0,l=e._offset?.y??0,u=r.getSharedVar("scaleX"),h=r.getSharedVar("scaleY");if(u&&u.invert&&h&&h.invert){let p=[s-c,s-c+i].map(u.invert),g=[a-l,a-l+o].map(h.invert);r.setSharedVar("extent",[p,g],{layer:e}),r.services.find("SelectionService").filter([p,g])}else r.services.find("SelectionService").filter([[s-c,s-c+i],[a-l,a-l+o]]);r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY),r.setSharedVar("startoffsetx",t.offsetX),r.setSharedVar("startoffsety",t.offsetY)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("starty"),i=n.getSharedVar("startoffsetx"),o=n.getSharedVar("startoffsety"),c=Math.min(s,e.clientX),l=Math.min(a,e.clientY),u=Math.min(i,e.offsetX),h=Math.min(o,e.offsetY),p=Math.abs(e.clientX-s),g=Math.abs(e.clientY-a);n.services.find("SelectionService").setSharedVars({x:c,y:l,offsetx:u,offsety:h,width:p,height:g,currentx:e.clientX,currenty:e.clientY},{layer:r})}],dragend:[se.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.find("SelectionService").setSharedVars({x:0,y:0,offsetx:0,offsety:0,width:0,height:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{e.getLayerFromQueue("selectionLayer"),t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.services.setSharedVars({x:t.clientX,offsetx:t.offsetX,width:0,startx:t.clientX,startoffsetx:t.offsetX,currentx:t.clientX},{layer:e}),r.setSharedVar("startx",t.clientX),r.setSharedVar("startoffsetx",t.offsetX)}],drag:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]);let s=n.getSharedVar("startx"),a=n.getSharedVar("startoffsetx"),i=Math.min(s,e.clientX),o=Math.min(a,e.offsetX),c=Math.abs(e.clientX-s);n.services.find("SelectionService").setSharedVars({x:i,offsetx:o,width:c,currentx:e.clientX},{layer:r}),n.setSharedVar("currentx",e.clientX),n.setSharedVar("currentoffsetx",e.offsetX),n.emit("brush",t)}],dragend:[se.initialize("Log",{execute(){}})],dragabort:[async t=>{let{event:e,layer:r,instrument:n}=t;e.changedTouches&&(e=e.changedTouches[0]),n.services.setSharedVars({x:0,offsetx:0,width:0,currentx:e.clientX},{layer:r}),n.emit("brushabort",t)}]},preAttach:(t,e)=>{t.services.add("RectSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone"),highlightColor:t.getSharedVar("highlightColor"),highlightAttrValues:t.getSharedVar("highlightAttrValues")}})}});A.register("BrushYInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("RectSelectionService");n.setSharedVar("y",t.clientY,{layer:e}),n.setSharedVar("height",1,{layer:e}),n.setSharedVar("starty",t.clientY,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),r.setSharedVar("starty",t.clientY),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:1})}],drag:[se.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=r.services.find("SelectionService");i.setSharedVar("y",s,{layer:e}),i.setSharedVar("height",a,{layer:e}),i.setSharedVar("currenty",t.clientY,{layer:e}),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("starty"),s=Math.min(n,t.clientY),a=Math.abs(t.clientY-n),i=(e.getGraphic().querySelector(".ig-layer-background")||e.getGraphic()).getBoundingClientRect();r.transformers.find("TransientRectangleTransformer").setSharedVars({y:s-i.top,height:a})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("y",0,{layer:e}),n.setSharedVar("height",0,{layer:e}),n.setSharedVar("currenty",t.clientY,{layer:e}),n.setSharedVar("endy",t.clientY,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({y:0,height:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("x")??0,n=t.getSharedVar("width")??e._width,s=t.services.add("RectSelectionService",{layer:e}),a=e.getGraphic().getBoundingClientRect();s.setSharedVar("x",a.x+r),s.setSharedVar("width",n),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:0,y:0,width:n,height:0,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:{}}})}});A.register("HelperLineInstrument",{constructor:A,sharedVar:{orientation:["horizontal"]},interactors:["MousePositionInteractor","TouchPositionInteractor"],on:{hover:[({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]),r.transformers.setSharedVars({x:t.offsetX,y:t.offsetY}),r.setSharedVar("x",t.offsetX,{}),r.setSharedVar("y",t.offsetY,{})}]},preAttach:function(t,e){t.transformers.add("HelperLineTransformer",{layer:e.getLayerFromQueue("transientLayer"),sharedVar:{orientation:t.getSharedVar("orientation"),style:t.getSharedVar("style")||{},tooltip:t.getSharedVar("tooltip"),scaleX:t.getSharedVar("scaleX"),scaleY:t.getSharedVar("scaleY")}})}});A.register("DataBrushInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.getSharedVar("scaleY"),a=r.services.find("Quantitative2DSelectionService"),i=He(t,e.getGraphic());r.setSharedVar("layerOffsetX",t.clientX-i[0]),r.setSharedVar("layerOffsetY",t.clientY-i[1]),r.setSharedVar("startx",t.clientX),r.setSharedVar("starty",t.clientY);let o=[i[0],i[0]+1].map(n.invert);a.setSharedVar("extentX",o);let c=[i[1],i[1]+1].map(s.invert);a.setSharedVar("extentX",c),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,y:0,width:1,height:1})}],drag:[se.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("starty"),a=r.getSharedVar("layerOffsetX"),i=r.getSharedVar("layerOffsetY"),o=r.getSharedVar("scaleX"),c=r.getSharedVar("scaleY"),l=Math.min(n,t.clientX)-a,u=Math.min(s,t.clientY)-i,h=Math.abs(t.clientX-n),p=Math.abs(t.clientY-s);r.setSharedVar("x",l),r.setSharedVar("y",u),r.setSharedVar("width",h),r.setSharedVar("height",p);let g=[l,l+h].map(o.invert),_=[u+p,u].map(c.invert),x=r.services.find("SelectionService");x.setSharedVar("extentX",g),x.setSharedVar("extentY",_),console.log(x),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("x"),s=r.getSharedVar("y"),a=r.getSharedVar("width"),i=r.getSharedVar("height");r.transformers.find("TransientRectangleTransformer").setSharedVars({x:n,y:s,width:a,height:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:async(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("scaleY"),s=t.getSharedVar("attrNameX"),a=t.getSharedVar("extentX")??[0,0],i=a.map(r),o=t.getSharedVar("attrNameY"),c=t.getSharedVar("extentY")??[0,0],l=a.map(n).reverse(),u=t.services.add("Quantitative2DSelectionService",{layer:e});u.setSharedVar("attrNameX",s),u.setSharedVar("extentX",a),u.setSharedVar("attrNameY",o),u.setSharedVar("extentY",c),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:i[0],y:l[0],width:i[1]-i[0],height:l[1]-l[0],fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}}),await Promise.all(t.services.results)}});A.register("DataBrushXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("scaleX"),s=r.services.find("QuantitativeSelectionService"),a=He(t,e.getGraphic())[0];r.setSharedVar("layerOffsetX",t.clientX-a),r.setSharedVar("startx",t.clientX),r.setSharedVar("startLayerPosX",a);let i=[a,a+1].map(n.invert);s.setSharedVar("extent",i),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:1})}],drag:[se.initialize("drawBrushAndSelect",{continuous:!0,execute:async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.getSharedVar("startx"),s=r.getSharedVar("layerOffsetX"),a=r.getSharedVar("scaleX"),i=Math.min(n,t.clientX),o=Math.abs(t.clientX-n),c=[i-s,i-s+o].map(a.invert),l=r.services.find("QuantitativeSelectionService");r.setSharedVar("extent",c),l.setSharedVar("extent",c),await Promise.all(r.services.results)},feedback:[async({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("startLayerPosX"),s=He(t,e.getGraphic())[0];console.log(n,s);let a=Math.min(n,s),i=Math.abs(s-n);r.transformers.find("TransientRectangleTransformer").setSharedVars({x:a,width:i})},async({instrument:t})=>{t.transformers.find("HighlightSelection").setSharedVars({highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}})}]})],dragabort:[async({event:t,layer:e,instrument:r})=>{t.changedTouches&&(t=t.changedTouches[0]);let n=r.services.find("SelectionService");n.setSharedVar("x",0,{layer:e}),n.setSharedVar("width",0,{layer:e}),n.setSharedVar("currentx",t.clientX,{layer:e}),n.setSharedVar("endx",t.clientX,{layer:e}),r.transformers.find("TransientRectangleTransformer").setSharedVars({x:0,width:0})}]},preAttach:(t,e)=>{let r=t.getSharedVar("scaleX"),n=t.getSharedVar("height")??e._height,s=t.getSharedVar("y")??0,a=t.getSharedVar("attrNameX"),i=t.getSharedVar("extentX")??[0,0],o=i.map(r),c=t.services.add("QuantitativeSelectionService",{layer:e});c.setSharedVar("attrName",a),c.setSharedVar("extent",i),t.transformers.add("TransientRectangleTransformer",{transient:!0,layer:e.getLayerFromQueue("transientLayer"),sharedVar:{x:o[0],y:s,width:o[1]-o[0],height:n,fill:"#000",opacity:.3}}).add("HighlightSelection",{transient:!0,layer:e.getLayerFromQueue("selectionLayer"),sharedVar:{highlightAttrValues:t.getSharedVar("highlightAttrValues")||{}}})}});A.register("DragInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.services.setSharedVars({x:e.clientX,y:e.clientY,startx:e.clientX,starty:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,skipPicking:!1},{layer:t})}],drag:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t}),r.services.setSharedVars({x:e.clientX,y:e.clientY,currentx:e.clientX,currenty:e.clientY,offsetx:e.offsetX,offsety:e.offsetY,skipPicking:!0},{layer:t})}],dragend:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]);let n=e.clientX-r.services.getSharedVar("x",{layer:t})[0],s=e.clientY-r.services.getSharedVar("y",{layer:t})[0];r.services.setSharedVars({x:0,y:0,currentx:e.clientX,currenty:e.clientY,endx:e.clientX,endy:e.clientY,offsetx:0,offsety:0,skipPicking:!1},{layer:t}),r.setSharedVar("offsetx",n,{layer:t}),r.setSharedVar("offsety",s,{layer:t})}],dragabort:[t=>{let{layer:e,event:r,instrument:n}=t;r.changedTouches&&(r=r.changedTouches[0]),n.services.setSharedVars({x:0,y:0,currentx:r.clientX,currenty:r.clientY,endx:0,endy:0,offsetx:0,offsety:0,skipPicking:!1},{layer:e}),n.emit("dragconfirm",{...t,self:t.instrument})}]},preAttach:(t,e)=>{t.services.add("SurfacePointSelectionService",{layer:e,sharedVar:{deepClone:t.getSharedVar("deepClone")}})}});A.register("SpeechInstrument",{constructor:A,interactors:["SpeechControlInteractor"]});A.register("KeyboardHelperBarInstrument",{constructor:A,interactors:["KeyboardPositionInteractor"],on:{begin:[()=>console.log("begin")],left:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]-n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}],right:[({event:t,layer:e,instrument:r})=>{let n=r.getSharedVar("speed")||1,a=e.getLayerFromQueue("transientLayer").getGraphic().querySelector("line"),o=ha(a)[0]+n;a.setAttribute("transform",`translate(${o}, 0)`),r.setSharedVar("barX",o,{})}]},preAttach:function(t,e){e.getGraphic().setAttribute("tabindex",0),e.getGraphic().focus();let r=e._height,n=t.getSharedVar("startPos"),s=e.getLayerFromQueue("transientLayer"),a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",n),a.setAttribute("y1","0"),a.setAttribute("x2",n),a.setAttribute("y2",r),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1px"),s.getGraphic().append(a)}});A.register("PanInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.setSharedVar("starty",e.clientY);let n=r.transformers;n.length||(n=_r.findTransformerByLayer(t)),n.forEach(s=>{let a=s.getSharedVar("scaleX"),i=s.getSharedVar("scaleY");a&&s.setSharedVar("$$scaleX",a.copy()),i&&s.setSharedVar("$$scaleY",i.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers;s.length||(s=_r.findTransformerByLayer(t));let a=r.getSharedVar("startx"),i=r.getSharedVar("starty"),o=r.getSharedVar("fixRange")??!1;s.forEach(c=>{let l=c.getSharedVar("scaleX"),u=c.getSharedVar("scaleY");if(o){if(l){let h=c.getSharedVar("$$scaleX"),_=h.range().map((x,w)=>x-e.clientX+a).map(x=>h.invert(x));l.domain(_),c.setSharedVar("scaleX",l)}if(u){let h=c.getSharedVar("$$scaleY"),_=h.range().map((x,w)=>x-e.clientY+i).map(x=>h.invert(x));u.domain(_),c.setSharedVar("scaleY",u)}}else{if(l){let p=c.getSharedVar("$$scaleX").range().map((g,_)=>g+e.clientX-a);l.range(p),c.setSharedVar("scaleX",l)}if(u){let p=c.getSharedVar("$$scaleY").range().map((g,_)=>g+e.clientY-i);u.range(p),c.setSharedVar("scaleY",u)}}})}],dragend:[se.initialize("Log",{execute(){}})],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("PanXInstrument",{constructor:A,interactors:["MouseTraceInteractor","TouchTraceInteractor"],on:{dragstart:[({layer:t,event:e,instrument:r})=>{e.changedTouches&&(e=e.changedTouches[0]),r.setSharedVar("startx",e.clientX),r.transformers.forEach(s=>{let a=s.getSharedVar("scaleX");a&&s.setSharedVar("$$scaleX",a.copy())})}],drag:[async({layer:t,event:e,instrument:r,transformer:n})=>{e.changedTouches&&(e=e.changedTouches[0]);let s=r.transformers,a=r.getSharedVar("startx"),i=r.getSharedVar("fixRange")??!1;s.forEach(o=>{let c=o.getSharedVar("scaleX");if(i){if(c){let l=o.getSharedVar("$$scaleX"),p=l.range().map((g,_)=>g-e.clientX+a).map(g=>l.invert(g));c.domain(p),o.setSharedVar("scaleX",c)}}else if(c){let u=o.getSharedVar("$$scaleX").range().map((h,p)=>h+e.clientX-a);c.range(u),o.setSharedVar("scaleX",c)}})}],dragabort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("GeometricZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=$(n),a=e.transformers;a.length||(a=_r.findTransformerByLayer(t)),e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=He(r,n),u=e.getSharedVar("centroidX")||c,h=e.getSharedVar("centroidY")||l,p=e.getSharedVar("fixRange")??!1;a.forEach(g=>{let _=g.getSharedVar("scaleX"),x=g.getSharedVar("scaleY");if(p){if(_){if(_.type==="time"){let w=_.invert(u);_.domain(_.domain().map(V=>new Date(V.getTime()-w.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+w.getTime())))}else{let w=_.invert(u);_.domain(_.domain().map(V=>V-w).map(V=>V*Math.exp(-i)).map(V=>V+w))}a.forEach(w=>w.setSharedVar("scaleX",_))}if(x){if(x.type==="time"){let w=x.invert(h);x.domain(x.domain().map(V=>new Date(V.getTime()-w.getTime())).map(V=>new Date(V.getTime()*Math.exp(-i))).map(V=>new Date(V.getTime()+w.getTime())))}else{let w=x.invert(h);x.domain(x.domain().map(V=>V-w).map(V=>V*Math.exp(-i)).map(V=>V+w))}a.forEach(w=>w.setSharedVar("scaleY",x))}}else{if(_){let w=_.range().map(V=>(V-u)*Math.exp(i)+u);_.range(w),g.setSharedVar("scaleX",_)}if(x){let w=x.range().map(V=>(V-h)*Math.exp(i)+h);x.range(w),g.setSharedVar("scaleY",x)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}});A.register("SemanticZoomInstrument",{constructor:A,interactors:["MouseWheelInteractor"],sharedVar:{currentLevel:0},on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=$(n),a=e.transformers;a.length||(a=_r.findTransformerByLayer(t));let i=e.getSharedVar("scaleLevels"),o=e.getSharedVar("currentLevel");if(o+=Math.sign(r.deltaY),e.setSharedVar("currentLevel",o),typeof i=="object"){let x=Object.keys(i).reduce(function(w,V){return Math.abs(parseInt(V)-o)<Math.abs(parseInt(w)-o)?V:w});a.forEach(w=>w.setSharedVars(i[x]))}e.setSharedVar("currentx",r.offsetX),e.setSharedVar("currenty",r.offsetY);let c=r.deltaY;e.setSharedVar("delta",c);let l=e.getSharedVar("cumulativeDelta",{defaultValue:0});l+=c,e.setSharedVar("cumulativeDelta",l),c/=1e3;let[u,h]=He(r,n),p=e.getSharedVar("centroidX")||u,g=e.getSharedVar("centroidY")||h,_=e.getSharedVar("fixRange")??!1;a.forEach(x=>{let w=x.getSharedVar("scaleX"),V=x.getSharedVar("scaleY");if(_){if(w){if(w.type==="time"){let E=w.invert(p);w.domain(w.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=w.invert(p);w.domain(w.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleX",w))}if(V){if(V.type==="time"){let E=V.invert(g);V.domain(V.domain().map(j=>new Date(j.getTime()-E.getTime())).map(j=>new Date(j.getTime()*Math.exp(-c))).map(j=>new Date(j.getTime()+E.getTime())))}else{let E=V.invert(g);V.domain(V.domain().map(j=>j-E).map(j=>j*Math.exp(-c)).map(j=>j+E))}a.forEach(E=>E.setSharedVar("scaleY",V))}}else{if(w){let E=w.range().map(j=>(j-p)*Math.exp(c)+p);w.range(E),x.setSharedVar("scaleX",w)}if(V){let E=V.range().map(j=>(j-g)*Math.exp(c)+g);V.range(E),x.setSharedVar("scaleY",V)}}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]},postUse(t,e){let r=t.getSharedVar("scaleLevels"),n=t.transformers,s=t.getSharedVar("currentLevel");if(typeof r=="object"){let a=Object.keys(r).reduce(function(i,o){return Math.abs(parseInt(o)-s)<Math.abs(parseInt(i)-s)?o:i});n.setSharedVars(r[a])}}});A.register("ZoomXInstrument",{constructor:A,interactors:["MouseWheelInteractor"],on:{wheel:[({layer:t,instrument:e,event:r})=>{let n=t.getGraphic(),s=$(n),a=e.transformers;e.setSharedVar("currentx",r.offsetX);let i=r.deltaY;e.setSharedVar("delta",i);let o=e.getSharedVar("cumulativeDelta",{defaultValue:0});o+=i,e.setSharedVar("cumulativeDelta",o),i/=1e3;let[c,l]=He(r,n),u=e.getSharedVar("centroidX")||c,h=e.getSharedVar("fixRange")??!1;a.forEach(p=>{let g=p.getSharedVar("scaleX");if(h){if(g){let _=g.invert(u);g.domain(g.domain().map(x=>x-_).map(x=>x*Math.exp(-i)).map(x=>x+_)),a.forEach(x=>x.setSharedVar("scaleX",g))}}else if(g){let _=g.range().map(x=>(x-u)*Math.exp(i)+u);g.range(_),p.setSharedVar("scaleX",g)}})}],abort:[({layer:t,event:e,instrument:r,transformer:n})=>{}]}})});var da,ma,Cn=d(()=>{Ft();Ft();cf();da=wt,ma=A});var pa={};Cf(pa,{createHistoryTrrack:()=>Mn,tryGetHistoryTrrackInstance:()=>lf,tryRegisterDynamicInstance:()=>hp});async function Mn(){let t=null,e=null,r=!1,n={traceStructure:(s=t)=>({recordList:[...s.record.keys()],children:s.children.map(a=>n.traceStructure(a)),current:s===e}),commit:async()=>{if(r)return;let s=new Map;for(let{component:i,fields:o}of[{list:Js,fields:["_state","_modalities"]},{list:da,fields:["_sharedVar"]},{list:Ws,fields:["_sharedVar"]},{list:Qs,fields:["_sharedVar"]}].flatMap(({list:c,fields:l})=>c.filter(u=>lf(u)===n).map(u=>({component:u,fields:l}))))await i.results,s.set(i,Object.fromEntries(o.map(c=>[c,oe(i[c])])));let a={record:s,prev:e,next:null,children:[]};e&&e.children.push(a),e=a},async undo(){if(e&&e.prev){e.prev.next=e;let s=e.prev.record;r=!0;for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=oe(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.prev,r=!1}},async redo(){if(e&&e.children.length===1&&!e.next&&(e.next=e.children[0]),e&&e.next){let s=e.next.record;r=!0;try{for(let[a,i]of s.entries()){let o=null;"_sharedVar"in a&&a._sharedVar.layer&&(o=a._sharedVar.layer),Object.entries(i).forEach(([c,l])=>a[c]=oe(l)),o&&"_sharedVar"in a&&!a._sharedVar.layer&&(a._sharedVar.layer=o),"_sharedVar"in i&&await a.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=e.next}catch(a){console.error("Fail to redo history!",a);let i=e.record;for(let[o,c]of i.entries())Object.entries(c).forEach(([l,u])=>o[l]=oe(u)),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}},async jump(s=[]){let a=s.reduce((i,o)=>i?.children[o],t);if(a){let i=a.record;r=!0;try{for(let[o,c]of i.entries()){let l=null;"_sharedVar"in o&&o._sharedVar.layer&&(l=o._sharedVar.layer),Object.entries(c).forEach(([u,h])=>o[u]=oe(h)),l&&"_sharedVar"in o&&!o._sharedVar.layer&&(o._sharedVar.layer=l),"_sharedVar"in c&&await o.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}e=a}catch(o){console.error("Fail to jump history!",o);let c=e.record;for(let[l,u]of c.entries())Object.entries(u).forEach(([h,p])=>l[h]=oe(p)),"_sharedVar"in u&&await l.setSharedVar("$LIBRA_FORCE_UPDATE",void 0)}r=!1}else console.error(`History path [${s.join(", ")}] does not exist!`)}};return[Ws,Qs,uf,da,Js].flatMap(s=>s).forEach(s=>{Mr.has(s)||Mr.set(s,n)}),await n.commit(),t=e,n}function lf(t){let e=Mr.get(t);return e||{traceStructure(){return null},async commit(){},async undo(){},async redo(){}}}function hp(t,e){let r=Mr.get(t);r&&Mr.set(e,r)}var Mr,Rr=d(()=>{Pt();qe();Cr();Cn();Sr();_e();Mr=new Map});function ve(t,e,r,n,s){return new Proxy(t,{get(a,i){if(i==="find")return function(o,c){if("initialize"in e){let l=a.filter(u=>u.isInstanceOf(o));if(l.length<=0&&c){let u=e.initialize(c);r(u),l.push(u),ga(s,u)}return ve(l,e,r,n,s)}else{let l=a.slice();return l.forEach(u=>{u.find(...arguments)}),ve(l,e,r,n,s)}};if(i==="add")return(...o)=>{let c=a.slice();if("initialize"in e){let l=e.initialize(...o);return r(l),c.push(l),ga(s,l),ve(c,e,r,n,s)}else return c.forEach(l=>{l.add(...o)}),ve(c,e,r,n,s)};if(i==="remove")return o=>{if(e===Rn){let c=a.slice();return c.forEach(l=>{l.remove(o)}),ve(c,e,r,n,s)}else{let c=a.slice();return c.filter(u=>u.isInstanceOf(o)).forEach(u=>{n(u),c.splice(c.indexOf(u),1)}),ve(c,e,r,n,s)}};if(i in a&&i!=="join"&&i!=="filter")return a[i];if(a.length)return a[0][i]instanceof Function?function(){return ve(a.map(o=>o[i].apply(o,arguments)),Rn,()=>{},()=>{},s)}:ve(a.map(o=>o[i]),Rn,()=>{},()=>{},s);{let o=()=>{};return o[Symbol.iterator]=function*(){},o}}})}function ha(t){try{return t.getAttribute("transform").split("(")[1].split(")")[0].split(",").map(r=>parseFloat(r))}catch(e){return[0,0]}}function Vn(t){return mf(t.trim()).map(ya)}function wp(t){return vp.hasOwnProperty(t)}function Or(t,e,r,n,s){let a=0,i,o=t.length;for(;e<o;++e){if(i=t[e],!a&&i===r)return e;s&&s.indexOf(i)>=0?--a:n&&n.indexOf(i)>=0&&++a}return e}function mf(t){let e=[],r=t.length,n=0,s=0;for(;s<r;)s=Or(t,s,df,On+ff,kn+hf),e.push(t.substring(n,s).trim()),n=++s;if(e.length===0)throw"Empty event selector: "+t;return e}function ya(t){return t[0]==="["?Sp(t):bp(t)}function Sp(t){let e=t.length,r=1,n,s;if(r=Or(t,r,kn,On,kn),r===e)throw"Empty between selector: "+t;if(n=mf(t.substring(1,r)),n.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(r+1).trim(),t[0]!==gp)throw"Expected '>' after between selector: "+t;let a=n.map(ya);return s=ya(t.slice(1).trim()),s.between?{between:a,stream:s}:(s.between=a,s)}function bp(t){let e={source:xp,type:""},r=[],n=[0,0],s=0,a=0,i=t.length,o=0,c,l;if(t[i-1]===hf){if(o=t.lastIndexOf(ff),o>=0){try{n=Vp(t.substring(o+1,i-1))}catch(u){throw"Invalid throttle specification: "+t}t=t.slice(0,o).trim(),i=t.length}else throw"Unmatched right brace: "+t;o=0}if(!i)throw t;if(t[0]===pp&&(s=++o),c=Or(t,o,mp),c<i&&(r.push(t.substring(a,c).trim()),a=o=++c),o=Or(t,o,On),o===i)r.push(t.substring(a,i).trim());else if(r.push(t.substring(a,o).trim()),l=[],a=++o,a===i)throw"Unmatched left bracket: "+t;for(;o<i;){if(o=Or(t,o,kn),o===i)throw"Unmatched left bracket: "+t;if(l.push(t.substring(a,o).trim()),o<i-1&&t[++o]!==On)throw"Expected left bracket: "+t;a=++o}if(!(i=r.length)||yp.test(r[i-1]))throw"Invalid event selector: "+t;return i>1?(e.type=r[1],s?e.markname=r[0].slice(1):wp(r[0])?e.marktype=r[0]:e.source=r[0]):e.type=r[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),l!=null&&(e.filter=l),n[0]&&(e.throttle=n[0]),n[1]&&(e.debounce=n[1]),e}function Vp(t){let e=t.split(df);if(!t.length||e.length>2)throw t;return e.map(function(r){let n=+r;if(n!==n)throw t;return n})}function oe(t){if(t&&t instanceof Object&&"copy"in t&&t.copy instanceof Function){let r=t.copy();for(let n in Object.getOwnPropertyDescriptors(t))n in r||(r[n]=t[n]);return r}if(t instanceof Array)return t.map(oe);if(["string","number","boolean","undefined","bigint","symbol","function"].includes(typeof t))return t;if(t===null)return null;if(xe in t&&t[xe])return t;if(t instanceof Node){let r=t.cloneNode(!0);return Object.assign(r,t),r}let e=Object.fromEntries(Object.entries(t).map(([r,n])=>[r,oe(n)]));return Object.assign(Object.create(Object.getPrototypeOf(t)),e)}var xe,te,G,et,Rn,ga,dp,On,kn,ff,hf,mp,df,pp,gp,yp,xp,_p,vp,La,_e=d(()=>{xe=Symbol("Libra");(function(t){t[t.Shape=0]="Shape",t[t.Data=1]="Data",t[t.Attr=2]="Attr"})(te||(te={}));(function(t){t[t.SurfacePoint=0]="SurfacePoint",t[t.Point=1]="Point",t[t.Circle=2]="Circle",t[t.Rect=3]="Rect",t[t.Polygon=4]="Polygon"})(G||(G={}));(function(t){t[t.Quantitative=0]="Quantitative",t[t.Nominal=1]="Nominal",t[t.Temporal=2]="Temporal"})(et||(et={}));Rn=class{},ga=(...t)=>{};dp="view",On="[",kn="]",ff="{",hf="}",mp=":",df=",",pp="@",gp=">",yp=/[[\]{}]/,xp=dp,_p={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},vp=_p;La={stopTransient:!1};Promise.resolve().then(()=>(Rr(),pa)).then(t=>{ga=t.tryRegisterDynamicInstance})});var pf,gf,xa,Pn,se,jp,CV,Tp,Ip,An=d(()=>{_e();xa={},Pn=[],se=class{constructor(e,r){this[pf]=!0,r.preInitialize&&r.preInitialize.call(this,this),this._baseName=e,this._userOptions=r,this._name=r.name??e,this._feedback=r.feedback??[],this._undo=r.undo??null,this._redo=r.redo??null,this._execute=r.execute??null,this._preInitialize=r.preInitialize??null,this._postInitialize=r.postInitialize??null,this._preExecute=r.preExecute??null,this._postExecute=r.postExecute??null,r.postInitialize&&r.postInitialize.call(this,this)}undo(){this._undo&&this._undo.call(this)}redo(){this._redo&&this._redo.call(this)}async execute(e){try{this.preExecute(),this._execute&&await this._execute.call(this,e),this.postExecute();for(let r of this._feedback)await r.call(this,e);await gf(this).commit()}catch(r){console.error(r)}}preExecute(){this._preExecute&&this._preExecute.call(this,this)}postExecute(){this._postExecute&&this._postExecute.call(this,this)}isInstanceOf(e){return this._baseName===e||this._name===e}static register(e,r){xa[e]=r}static unregister(e){return delete xa[e],!0}static initialize(e,r){let n=Object.assign({constructor:se},xa[e]??{},r??{}),s=new n.constructor(e,n);return Pn.push(s),s}static findCommand(e){return Pn.filter(r=>r.isInstanceOf(e))}};pf=xe;jp=se.register,CV=se.unregister,Tp=se.initialize,Ip=se.findCommand;Promise.resolve().then(()=>(Rr(),pa)).then(t=>{gf=t.tryGetHistoryTrrackInstance})});var uf,rt,Cr=d(()=>{An();An();uf=Pn,rt=se});Cr();Cn();Sr();Er();Pt();Rr();qe();Ft();Ft();Er();Pt();qe();wr();Hs();_e();var kr={},qt=class{static build(e){if(!(e.inherit in Xe)&&!(e.inherit in kr))throw new Error(`Interaction ${e.inherit} is not registered, please register it first`);let r;if(e.inherit in Xe){let a=Object.assign({constructor:A},Xe[e.inherit],{sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},Xe[e.inherit].sharedVar??{},e.sharedVar??{})});e.layers&&(a.layers=e.layers),r=new a.constructor(e.inherit,a),wt.push(r)}else{let a=Object.assign({},kr[e.inherit],e,{inherit:kr[e.inherit].inherit,sharedVar:Object.assign({},{layers:e.layers??[],layer:e.layers?.length==1?e.layers[0]:void 0},kr[e.inherit].sharedVar??{},e.sharedVar??{})});r=qt.build(a),wt.push(r)}if(e.name&&(kr[e.name]=e,!e.layers||!e.layers.length))return;let n=(a,i)=>{if(a instanceof A){let o=a._serviceInstances.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a._serviceInstances){let u=n(l,i);if(u)return u}}else{let o=a._services.find(l=>l.isInstanceOf(i));if(o)return[o,a];let c=a._transformers.find(l=>l.isInstanceOf(i));if(c)return[c,a];for(let l of a.services){let u=n(l,i);if(u)return u}}return[void 0,void 0]},s=(a,i)=>{if(a.isInstanceOf(i))return a;if(a instanceof A){let o=a._serviceInstances.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a._serviceInstances){let l=s(c,i);if(l)return l}}else{let o=a._services.find(c=>c.isInstanceOf(i));if(o)return o;for(let c of a.services){let l=s(c,i);if(l)return l}}};if(e.remove)for(let a of e.remove){let[i,o]=n(r,a.find);if(!i)continue;let c=o instanceof A?o._serviceInstances:o._services;a.cascade?i instanceof Z?c.splice(c.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1):i instanceof Z?(c.splice(c.indexOf(i),1,...i._services),o._transformers.push(...i._transformers)):o._transformers.splice(o._transformers.indexOf(i),1)}if(e.override)for(let a of e.override)if(a.find.endsWith("Interactor")){let i=[...r._layerInteractors.values()],o=i.map(c=>c.filter(l=>l.isInstanceOf(a.find)));a.comp?o.forEach((c,l)=>{c.forEach(u=>{let h=X.initialize(a.comp);h&&i[l].splice(i[l].indexOf(u),1,h)})}):a.actions&&o.forEach(c=>{c.forEach(l=>{l._actions=oe(a.actions).map(Ks)})})}else{let[i,o]=n(r,a.find);if(!i)continue;let c;if(a.comp.includes("Transformer")){let u;a.name&&H.findTransformer(a.name).length>0&&(u=H.findTransformer(a.name)[0]),u||(u=H.initialize(a.comp,{name:a.name,sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),c=u}else if(a.comp.includes("Service")){let u;a.name&&Z.findService(a.name).length>0&&(u=Z.findService(a.name)[0]),u||(u=Z.initialize(a.comp,{...a,services:[...a.services||[],...i instanceof Z?i._services:[]],transformers:[...a.transformers||[],...i instanceof Z?i._transformers:[]],sharedVar:{...e.sharedVar||{},...a.sharedVar||{}}})),a.dimension&&u.isInstanceOf("SelectionService")&&(u=u.dimension(a.dimension),a.layers&&(u._layerInstances=a.layers.slice(0)),a.sharedVar&&u.setSharedVars(a.sharedVar)),c=u}let l=o instanceof A?o._serviceInstances:o._services;i instanceof Z?l.splice(l.indexOf(i),1):o._transformers.splice(o._transformers.indexOf(i),1),a.comp.includes("Transformer")?o._transformers.push(c):l.push(c)}if(e.insert)for(let a of e.insert){let i=s(r,a.find);if(!i)continue;let o=null,c=null;for(let l=a.flow.length-1;l>=0;l--){let u=a.flow[l];if(u instanceof Function){let h=[],p=null;for(let g=0;g<e.layers?.length;g++){let _=e.layers[g],x=u(_,g);if(x.comp.includes("Transformer")){let w;x.name&&H.findTransformer(x.name).length>0&&(w=H.findTransformer(x.name)[0]),w||(w=H.initialize(x.comp,{...x,sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),h.push(w),p="Transformer"}else if(x.comp.includes("Service")){let w;x.name&&Z.findService(x.name).length>0&&(w=Z.findService(x.name)[0]),w||(w=Z.initialize(x.comp,{...x,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...x.sharedVar||{}}})),x.dimension&&w instanceof Ve&&(w=w.dimension(x.dimension),x.layers&&(w._layerInstances=x.layers.slice(0)),x.sharedVar&&w.setSharedVars(x.sharedVar)),h.push(w),p="Service"}}o=h,c=p}else if(u instanceof Array){let h=[],p=null;for(let g=0;g<u.length;g++){let _=u[g];if(_ instanceof H)h.push(_),p="Transformer";else if(_ instanceof Z)c=="Transformer"?_._transformers.push(...o instanceof Array?o:[o]):_._services.push(...o instanceof Array?o:[o]),h.push(_),p="Service";else if(_.comp.includes("Transformer")){let x;_.name&&H.findTransformer(_.name).length>0&&(x=H.findTransformer(_.name)[0]),x||(x=H.initialize(_.comp,{..._,sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),h.push(x),p="Transformer"}else if(_.comp.includes("Service")){let x;_.name&&Z.findService(_.name).length>0&&(x=Z.findService(_.name)[0]),x||(x=Z.initialize(_.comp,{..._,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},..._.sharedVar||{}}})),_.dimension&&x instanceof Ve&&(x=x.dimension(_.dimension),_.layers&&(x._layerInstances=_.layers.slice(0)),_.sharedVar&&x.setSharedVars(_.sharedVar)),h.push(x),p="Service"}}o=h,c=p}else if(u instanceof H)o=u,c="Transformer";else if(u instanceof Z)c=="Transformer"?u._transformers.push(...o instanceof Array?o:[o]):u._services.push(...o instanceof Array?o:[o]),o=u,c="Service";else if(u.comp.includes("Transformer")){let h;u.name&&H.findTransformer(u.name).length>0&&(h=H.findTransformer(u.name)[0]),h||(h=H.initialize(u.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof De?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...u,sharedVar:{...e.sharedVar||{},...u.sharedVar||{}}})),o=h,c="Transformer"}else if(u.comp.includes("Service")){let h;u.name&&Z.findService(u.name).length>0&&(h=Z.findService(u.name)[0]),h||(h=Z.initialize(u.comp,{...e.layers&&e.layers.length==1?e.layers[0]instanceof De?{layer:e.layers[0]}:{layer:e.layers[0].layer}:{},...u,...o?c=="Transformer"?{transformers:o instanceof Array?o:[o]}:{services:o instanceof Array?o:[o]}:{},sharedVar:{...e.sharedVar||{},...u.sharedVar||{}}})),u.dimension&&h.isInstanceOf("SelectionService")&&(h=h.dimension(u.dimension),u.layers&&(h._layerInstances=u.layers.slice(0)),u.sharedVar&&h.setSharedVars(u.sharedVar)),o=h,c="Service"}}o&&(c=="Transformer"?o instanceof Array?i._transformers.push(...o):i._transformers.push(o):i instanceof A?o instanceof Array?i._serviceInstances.push(...o):i._serviceInstances.push(o):o instanceof Array?i._services.push(...o):i._services.push(o))}return r}};Cr();Cn();Sr();Er();Pt();Rr();qe();var KV={Command:rt,Instrument:ma,Interactor:Ge,Layer:De,Service:Z,createHistoryTrrack:Mn,GraphicalTransformer:H,Interaction:qt};export{rt as Command,H as GraphicalTransformer,ma as Instrument,qt as Interaction,Ge as Interactor,De as Layer,Z as Service,Mn as createHistoryTrrack,KV as default};
